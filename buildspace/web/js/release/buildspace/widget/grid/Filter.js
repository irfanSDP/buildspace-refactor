define("dojo/_base/declare dijit/layout/BorderContainer dijit/layout/ContentPane dijit/form/TextBox dijit/form/Button dijit/form/Select dijit/Toolbar dijit/ToolbarSeparator dojo/_base/connect dojo/i18n!buildspace/nls/Filter".split(" "),function(m,x,k,n,h,p,q,l,f,d){return m("buildspace.filterToolbar",q,{grid:null,filterFields:[],editableGrid:!1,autoFocus:!0,initialAutoFocus:!0,disableKeyBoardShortcuts:!1,style:"outline:none!important;padding:2px;overflow:hidden!important;border:none;",gutters:!1,
filterModeOff:!0,fieldSelectionSelectedIndex:null,arrayOfColumnIndexes:[],columnIndexToFocus:null,gridRowCount:null,filterReady:!0,onFetchCompleteCase:0,editFromFilter:!1,arrayOfMatchingRowIndexes:[],cursor:null,focusFromFilter:null,editingCell:null,hasIndirectSelection:!1,postCreate:function(){this.grid.plugins&&this.grid.plugins.indirectSelection&&(this.hasIndirectSelection=!0);var a=this,c=new h({label:d.refresh,style:"float: right",iconClass:"icon-16-container icon-16-reload",onClick:dojo.hitch(a,
"refreshFilter")}),b=this.filterLabel=new k({style:"padding-left: 10px; padding-right: 10px; padding-top: 3px; float: right;",content:d.findBy}),e=new h({label:d.search,style:"float: right",iconClass:"icon-16-container icon-16-zoom",onClick:dojo.hitch(a,"submit")}),g=this.fieldSelection=new p({style:"padding:2px!important;width:120px;float:right",options:a.getSelectOptions(),onChange:dojo.hitch(a,"onFieldSelectionChange")}),t=this.filterTextBox=new n({region:"right",style:"width:200px;float:right;padding:3px;",
onKeyPress:function(r){a.filterTextBoxOnKeyPress(r)},selectOnClick:!0,onChange:function(){a.filterModeOff=!0},intermediateChanges:!0}),u=this.nextButton=new h({iconClass:"icon-16-container icon-16-directional_down",style:"float: right;width: 22px",disabled:a.filterModeOff,onClick:dojo.hitch(a,"nextMatching")}),v=this.previousButton=new h({iconClass:"icon-16-container icon-16-directional_up",style:"float: right; width: 22px",disabled:a.filterModeOff,onClick:dojo.hitch(a,"previousMatching")}),w=this.numberOfRecordsDisplay=
new k({content:"",style:"padding-left: 10px; padding-right: 10px; padding-top: 3px; float: left;"});a.displayNumberOfRecords();a.columnIndexToFocus=a.arrayOfColumnIndexes[0];a.addChild(w);a.addChild(c);a.addChild(new l({style:"float: right; "}));a.addChild(e);a.addChild(new l({style:"float: right; "}));a.addChild(u);a.addChild(v);a.addChild(t);a.addChild(g);a.addChild(b);a._connects.push(f.connect(a.grid,"_onFetchComplete",function(){a.onFetchComplete()}));a._connects.push(f.connect(a.grid,"onCellFocus",
function(){a.focusFromFilter&&(a.focusFromFilter=!1,a.focusTextBox())}));a._connects.push(f.connect(a.grid.edit,"apply",function(){a.tryFocus()}));a._connects.push(f.connect(a.grid.edit,"cancel",function(){a.tryFocus()}));a._connects.push(f.connect(a.grid.edit,"setEditCell",function(){a.editingCell=!0}));a._connects.push(f.connect(a.grid.store,"save",function(){a.onGridSave()}))},tryFocus:function(){this.editingCell&&(this.editingCell=!1,this.editFromFilter&&(this.editFromFilter=!1,this.focusTextBox()))},
onFetchComplete:function(){null!=this.gridRowCount&&this.gridRowCount<this.grid.rowCount&&this.reset();this.gridRowCount=this.grid.rowCount;switch(this.onFetchCompleteCase){case 1:this.selectAndScrollToRow();break;case 2:this.reset()}this.onFetchCompleteCase=0;this.editFromFilter&&(this.editFromFilter=!1,this.initialAutoFocus?this.focusTextBox():this.initialAutoFocus=!0)},getSelectOptions:function(){this.filterFields.push(d.none);var a=[],c=!1,b;for(b in this.filterFields){if("string"===typeof this.filterFields[b]){var e=
{};for(structureIndex in this.grid.structure)this.grid.structure[structureIndex].field==this.filterFields[b]&&(e[this.filterFields[b]]=this.grid.structure[structureIndex].name,c=!0);c||(e[this.filterFields[b]]=this.filterFields[b].charAt(0).toUpperCase()+this.filterFields[b].replace("_"," ").replace("-"," ").slice(1));c=!1;this.filterFields[b]=e}for(var g in this.filterFields[b])e={},e.label=this.filterFields[b][g],e.value=g,a.push(e)}this.setArrayOfColumnIndexes();return a},setArrayOfColumnIndexes:function(){this.arrayOfColumnIndexes=
[];for(var a in this.grid.structure)this.arrayOfColumnIndexes.push(a);this.hasIndirectSelection&&this.arrayOfColumnIndexes.push(this.arrayOfColumnIndexes.length)},submit:function(){this.filterReady=!1;this.fieldSelectionSelectedIndex||this.updateFieldSelectionSelectedIndex();this.reset();this.getMatchingRecords();this.startFilter()},startFilter:function(){this.filterModeOff&&(0<this.arrayOfMatchingRowIndexes.length?(this.cursor=this.arrayOfMatchingRowIndexes.length-1,this.nextMatching(),this.filterModeOff=
!1,this.disableButtons(!1)):this.displayNumberOfRecords());this.filterReady=!0;this.focusTextBox()},getMatchingRecords:function(){var a=this,c=this.grid;this.arrayOfMatchingRowIndexes=[];c.store.fetch({query:this.generateStoreQuery(),queryOptions:{ignoreCase:!0},onComplete:function(b){dojo.forEach(b,function(e,g){a.arrayOfMatchingRowIndexes.push(e._0)})}})},getItemRowIndex:function(a){var c=this.grid,b=c.getItemIndex(a);b==buildspace.constants.GRID_LAST_ROW&&(c._fetch(a._0,!1),b=c.getItemIndex(a));
return b},generateStoreQuery:function(){this.filterTextBox.set("value",dojo.trim(this.filterTextBox.get("value")));var a={};a[this.getSelectedFieldName()]="*"+this.filterTextBox.get("value").toLowerCase()+"*";return a},getSelectedFieldName:function(){return this.fieldSelection.get("value")==d.none||""==this.filterTextBox.get("value")?d.none:this.fieldSelection.get("value")},filterTextBoxOnKeyPress:function(a){if(this.filterModeOff)13==a.keyCode&&this.submit();else if(!this.disableKeyBoardShortcuts)switch(a.keyCode){case 9:a.preventDefault();
this.onTabKey(a);break;case 13:this.onEnterKey(a);break;case 33:this.firstMatching();break;case 34:this.lastMatching()}},onTabKey:function(a){this.editableGrid&&(a.shiftKey?this.previousColumn():this.nextColumn())},onEnterKey:function(a){a.ctrlKey?a.shiftKey?this.doubleClickCell(a):this.nextMatching():a.shiftKey?this.previousMatching():this.hasIndirectSelection?this.toggleSelection():this.editCell()},toggleSelection:function(){this.isRowSelected(this.arrayOfMatchingRowIndexes[this.cursor])?this.grid.selection.setSelected(this.arrayOfMatchingRowIndexes[this.cursor],
!1):this.grid.selection.setSelected(this.arrayOfMatchingRowIndexes[this.cursor],!0)},isRowSelected:function(a){var c=this.grid,b;for(b in c.selection.selected)if(b==a&&1==c.selection.selected[b])return!0;return!1},previousColumn:function(){this.columnIndexPointer--;0>this.columnIndexPointer&&(this.columnIndexPointer=this.arrayOfColumnIndexes.length-1);this.focusNewColumn()},nextColumn:function(){this.columnIndexPointer++;this.columnIndexPointer>=this.arrayOfColumnIndexes.length&&(this.columnIndexPointer=
0);this.focusNewColumn()},focusNewColumn:function(){this.columnIndexToFocus=this.arrayOfColumnIndexes[this.columnIndexPointer];this.focusCell()},editCell:function(){this.editableGrid?(this.editFromFilter=!0,this.grid.edit.setEditCell(this.grid.getCell(this.columnIndexToFocus),this.arrayOfMatchingRowIndexes[this.cursor])):this.focusCell()},doubleClickCell:function(a){a.rowIndex=this.arrayOfMatchingRowIndexes[this.cursor];try{this.grid.dodblclick(a)}catch(c){}},displayNumberOfRecords:function(){1>this.arrayOfMatchingRowIndexes.length?
this.fieldSelection.value==d.none||""==this.filterTextBox.get("value")?this.numberOfRecordsDisplay.set("content",d.noFilterApplied):this.numberOfRecordsDisplay.set("content",d.noMatchingRecords):this.numberOfRecordsDisplay.set("content",(this.cursor+1).toString()+" "+d.of+" "+this.arrayOfMatchingRowIndexes.length.toString()+" "+d.matches)},validMatch:function(){return 0<this.arrayOfMatchingRowIndexes.length&&0<=this.cursor&&this.cursor<=this.arrayOfMatchingRowIndexes.length},focusCell:function(){this.focusFromFilter=
!0;this.grid.focus.setFocusIndex(this.arrayOfMatchingRowIndexes[this.cursor],this.columnIndexToFocus)},firstMatching:function(){this.validMatch()&&(this.onFetchCompleteCase=1,this.cursor=0,this.selectAndScrollToRow())},lastMatching:function(){this.validMatch()&&(this.onFetchCompleteCase=1,this.cursor=this.arrayOfMatchingRowIndexes.length-1,this.selectAndScrollToRow())},nextMatching:function(){this.validMatch()&&(this.onFetchCompleteCase=1,this.incrementCursor(),this.selectAndScrollToRow())},previousMatching:function(){this.validMatch()&&
(this.onFetchCompleteCase=1,this.decrementCursor(),this.selectAndScrollToRow())},selectAndScrollToRow:function(){this.deselectAll();this.selectRow();this.grid.scrollToRow(this.arrayOfMatchingRowIndexes[this.cursor]);this.focusCell();this.displayNumberOfRecords()},deselectAll:function(){this.hasIndirectSelection||this.grid.selection.deselectAll()},selectRow:function(){this.hasIndirectSelection||this.grid.selection.setSelected(this.arrayOfMatchingRowIndexes[this.cursor],!0)},focusTextBox:function(){this.autoFocus&&
this.filterTextBox.focus()},onGridSave:function(){this.grid.focus._focusifyCellNode(!1);this.arrayOfMatchingRowIndexes=[];this.cursor=0;this.filterModeOff=!0;this.disableButtons(!0);this.numberOfRecordsDisplay.set("content",d.noFilterApplied)},reset:function(){this.onGridSave();this.deselectAll()},refreshFilter:function(){this.grid.store.save();this.filterTextBox.set("value","");this.updateFieldSelectionSelectedIndex();this.onFetchCompleteCase=2;this.grid.selection.deselectAll();this.refreshGrid()},
refreshGrid:function(){this.grid.store.save();this.grid.store.close();this.grid.sort()},onFieldSelectionChange:function(){this.updateFieldSelectionSelectedIndex();this.filterTextBox&&this.filterTextBox.focus();this.filterTextBox.value&&this.submit()},updateFieldSelectionSelectedIndex:function(){for(var a in this.fieldSelection.options)if(1==this.fieldSelection.options[a].selected){this.fieldSelectionSelectedIndex=a;for(var c in this.grid.structure)if(this.grid.structure[c].name==this.fieldSelection.options[a].label){this.columnIndexToFocus=
this.hasIndirectSelection?this.columnIndexPointer=Number(c)+1:this.columnIndexPointer=c;break}break}},incrementCursor:function(){this.cursor++;this.cursor>=this.arrayOfMatchingRowIndexes.length&&(this.cursor=0)},decrementCursor:function(){this.cursor--;0>this.cursor&&(this.cursor=this.arrayOfMatchingRowIndexes.length-1)},disableButtons:function(a){this.nextButton._setDisabledAttr(a);this.previousButton._setDisabledAttr(a)},destroy:function(){this.inherited(arguments);dojo.forEach(this._connects,f.disconnect);
delete this._connects}})});
