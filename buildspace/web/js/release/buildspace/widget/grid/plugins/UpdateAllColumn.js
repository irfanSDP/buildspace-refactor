define("buildspace/widget/grid/plugins/UpdateAllColumn","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/query dojo/dom-attr dojo/dom-construct dojo/on dojo/_base/connect dojox/grid/enhanced/_Plugin dojox/grid/EnhancedGrid dijit/form/NumberTextBox dijit/form/Button dojo/i18n!buildspace/nls/Common".split(" "),function(d,l,n,p,q,w,x,h,r,t,u,v,m){d=d("buildspace.widget.grid.plugins.UpdateAllColumn",r,{name:"buildspaceUpdateAllColumn",constructor:function(b,a){this.grid=b;this.nls=m;this._connects=
[];a=l.isObject(a)?a:{};this.columns=a.columns;this.updateUrl=a.updateUrl;this._csrf_token=a._csrf_token;a.hasOwnProperty("onSuccess")&&(this.onSuccess=a.onSuccess);this._widgets=[];this._buttons=[];this._connects.push(h.connect(this.grid.views,"render",this,"_addWidgetsToHeaders"));this._connects.push(h.connect(this.grid,"_onFetchComplete",this,"_addWidgetsToHeaders"))},_addWidgetsToHeaders:function(){var b=p(".dojoxGridHeader table th",this.grid.viewsHeaderNode);if(this.columns){var a=this.columns,
c=this.grid,e=this;dojo.forEach(b,function(b){dojo.forEach(a,function(a){if(parseInt(q.get(b,"idx"))==parseInt(a.idx)){var f;f=b.firstChild&&3!=b.firstChild.nodeType?b.firstChild:b;a=c.layout.cells[a.idx];var g=dijit.byId(c.id+"-"+a.index+"-"+a.field+"_update_all-txtbox"),k=dijit.byId(c.id+"-"+a.index+"-"+a.field+"_update_all-btn");g||(g=new u({id:c.id+"-"+a.index+"-"+a.field+"_update_all-txtbox",style:"width:80px;padding:3px;font-weight:normal!important;",selectOnClick:!0,intermediateChanges:!0,
cell:a}),e._widgets.push(g));k||(k=new v({id:c.id+"-"+a.index+"-"+a.field+"_update_all-btn",iconClass:"icon-16-container icon-16-save",showLabel:!1,onClick:l.hitch(e,"_doApplyUpdate",g)}),e._buttons.push(k));g.placeAt(f,"after");k.placeAt(g,"after")}})})}},_doApplyUpdate:function(b){if(b.isValid()&&!isNaN(b.get("value"))){var a=this.grid.store._arrayOfAllItems,c=[];a.length&&(c=[],dojo.forEach(a,function(a,b){String(a.id)!=buildspace.constants.GRID_LAST_ROW&&(c[b]=String(a.id))}));if(c.length){var e=
this,d=this.updateUrl,h={ids:c.join(),field:b.cell.field,val:b.get("value"),_csrf_token:this._csrf_token},f=buildspace.dialog.indeterminateProgressBar({title:m.pleaseWait+"..."});f.show().then(function(){dojo.xhrPost({url:d,content:h,handleAs:"json",load:function(a){a.success&&(e.onSuccess(a.items,b),f.hide());e.resetSelectRow(b.cell.index)},error:function(a){f.hide()}});b.set("value",null)})}}},onSuccess:function(b,a){},resetSelectRow:function(b){this.deselectAll();this.focusCell(b)},deselectAll:function(){this.hasIndirectSelection||
this.grid.selection.deselectAll()},focusCell:function(b){this.grid.focus.setFocusIndex(0,b)},destroy:function(){n.forEach(this._connects,h.disconnect);delete this._connects;dojo.forEach(this._widgets,function(b){b.destroyRecursive()});dojo.forEach(this._buttons,function(b){b.destroyRecursive()});delete this._widgets;delete this._buttons}});t.registerPlugin(d);return d});
