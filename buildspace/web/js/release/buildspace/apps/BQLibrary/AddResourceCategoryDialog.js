define("buildspace/apps/BQLibrary/AddResourceCategoryDialog","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/when dojo/html dojo/dom dojo/keys dojo/dom-style dojo/currency ./buildUpGrid ./buildUpSummary buildspace/widget/grid/cells/Formatter dojo/i18n!buildspace/nls/AddResourceCategoryDialog".split(" "),function(c,w,x,y,z,A,m,n,p,q,r,t,b){var u=c("buildspace.apps.BQLibrary.AddResourceCategoryGrid",dojox.grid.EnhancedGrid,{libraryId:0,BQItem:null,currencyAbbr:null,BQItemGridStore:null,
baseContainer:null,region:"center",style:"border-top:none;",canSort:function(a){return!1},postCreate:function(){var a=this;a.inherited(arguments);this.on("RowClick",function(d){var f=a.getItem(d.rowIndex),h=a.store;if("resource_library_exists"==d.cell.field&&0<f.id){var k=buildspace.dialog.indeterminateProgressBar({title:b.pleaseWait+"..."});if(f.resource_library_exists[0])c={url:"bqLibrary/resourceCategoryDelete",content:{bqid:a.BQItem.id,rid:f.id,_csrf_token:f._csrf_token},handleAs:"json",load:function(l){if(l.success){h.setValue(f,
"resource_library_exists",!1);h.save();var d=dijit.byId("accPane-"+l.rid+"-"+a.BQItem.id),c=dijit.byId("accordian_"+a.libraryId+"_"+a.BQItem.id+"-container"),e=dijit.byId("buildUpRateSummary-"+a.BQItem.id);c&&d&&(c.removeChild(d),d.destroyRecursive());if(e)if(l.is_last_resource){a.baseContainer.removeChild(e);e.destroyRecursive();c.addChild(new dijit.layout.ContentPane({title:b.emptyResourceCategoryTitle,style:"padding:0px;border:0px;",doLayout:!1,id:"accPane-empty_resource-"+a.BQItem.id,content:'<div style="text-align:center;"><p><h1>'+
b.emptyResourceCategory+"</h1></p></div> "}));var g=a.BQItemGridStore;dojo.xhrGet({url:"bqLibrary/getBuildUpSummary",content:{id:a.BQItem.id},handleAs:"json",load:function(b){g.setValue(a.BQItem,"rate-final_value",b.final_cost);g.setValue(a.BQItem,"updated_at",b.updated_at);g.save()},error:function(a){}})}else e.refreshTotalCost()}k.hide()},error:function(a){k.hide()}},buildspace.dialog.confirm(b.confirmation,"<div>"+b.areYouSureDeleteResourceCategory+"</div>",60,280,function(){k.show();dojo.xhrPost(c)});
else{k.show();var c={url:"bqLibrary/resourceCategoryAdd",content:{bqid:a.BQItem.id,rid:f.id,_csrf_token:f._csrf_token},handleAs:"json",load:function(d){if(d.success){h.setValue(f,"resource_library_exists",d.resource_library_exists);h.save();var c=dijit.byId("buildUpRateSummary-"+a.BQItem.id);c||(c=new r({id:"buildUpRateSummary-"+a.BQItem.id,itemId:a.BQItem.id,container:a.baseContainer,bqItemGridStore:a.BQItemGridStore,_csrf_token:f._csrf_token}),a.baseContainer.addChild(c));var l=dijit.byId("accordian_"+
a.libraryId+"_"+a.BQItem.id+"-container"),e=d.resource;d=d.uom;var g=new t,m=new dojo.data.ItemFileWriteStore({url:"bqLibrary/getBuildUpRateItemList/item_id/"+a.BQItem.id+"/resource_id/"+e.id,clearOnClose:!0}),c=q({resource:e,bqItemId:a.BQItem.id,gridOpts:{itemId:a.BQItem.id,addUrl:"bqLibrary/buildUpRateItemAdd",updateUrl:"bqLibrary/buildUpRateItemUpdate",deleteUrl:"bqLibrary/buildUpRateItemDelete",pasteUrl:"bqLibrary/buildUpRateItemPaste",store:m,buildUpSummaryWidget:c,structure:[{name:"No.",field:"id",
width:"30px",styles:"text-align:center;",formatter:g.rowCountCellFormatter},{name:b.description,field:"description",width:"auto",editable:!0,cellType:"buildspace.widget.grid.cells.Textarea",formatter:g.linkedCellFormatter},{name:b.number,field:"number-value",width:"100px",styles:"text-align:right;",editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:g.formulaCurrencyCellFormatter},{name:b.constant,field:"constant-value",width:"100px",styles:"text-align:right;",editable:!0,
cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:g.formulaCurrencyCellFormatter},{name:b.qty,field:"quantity-value",width:"70px",styles:"text-align:right;",editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:g.formulaNumberCellFormatter},{name:b.unit,field:"uom_id",width:"70px",styles:"text-align:center;",editable:!0,cellType:"dojox.grid.cells.Select",options:d.options,values:d.values,formatter:g.linkedUnitIdCellFormatter},{name:b.rate,field:"rate-value",width:"120px",
styles:"text-align:right;",editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:g.formulaCurrencyCellFormatter},{name:b.total,field:"total",width:"120px",styles:"text-align:right;",formatter:g.linkedCurrencyCellFormatter},{name:b.wastage+" (%)",field:"wastage-value",width:"70px",styles:"text-align:right;",editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:g.formulaCurrencyCellFormatter},{name:b.lineTotal,field:"line_total",width:"120px",styles:"text-align:right;",
formatter:g.linkedCurrencyCellFormatter}]}}),e=new dijit.layout.ContentPane({title:e.name+'<span style="color:blue;float:right;">'+a.currencyAbbr+"&nbsp;"+p.format(0)+"</span>",style:"padding:0px;border:0px;",doLayout:!1,id:"accPane-"+e.id+"-"+a.BQItem.id,content:c});l.addChild(e);l.selectChild(e);if(e=dijit.byId("accPane-empty_resource-"+a.BQItem.id))l.removeChild(e),e.destroyRecursive()}k.hide()},error:function(a){k.hide()}};dojo.xhrPost(c)}}})},dodblclick:function(a){this.onRowDblClick(a)}}),v=
c("buildspace.apps.BQLibrary.AddResourceCategoryGrid.CellFormatter",null,{rowCountCellFormatter:function(a,b,c){return 0<this.grid.getItem(b).id?parseInt(b)+1:"&nbsp;"},actionCellFormatter:function(a,c){var d=a?b.remove:b.add,h=this.grid.getItem(c),k=Math.round((new Date).getTime()/1E3);return 0<h.id?'<a href="#'+k+'" onclick="return false;">'+d+"</a>":null}});return c("buildspace.apps.BQLibrary.AddResourceCategoryDialog",dijit.Dialog,{style:"padding:0px;margin:0px;",title:b.addResourceCategory,libraryId:null,
BQItem:null,currencyAbbr:null,BQItemGridStore:null,baseContainer:null,buildRendering:function(){var a=this.createContent();a.startup();this.content=a;this.inherited(arguments)},postCreate:function(){n.set(this.containerNode,{padding:"0px",margin:"0px"});this.closeButtonNode.style.display="none";this.inherited(arguments)},_onKey:function(a){key=a.keyCode;key==m.ESCAPE&&dojo.stopEvent(a)},onHide:function(){this.destroyRecursive()},createContent:function(){var a=new dijit.layout.BorderContainer({style:"padding:0px;width:500px;height:250px;",
gutters:!1}),c=new dijit.Toolbar({region:"top",style:"outline:none!important;padding:2px;overflow:hidden;border:0px;"});c.addChild(new dijit.form.Button({label:b.close,iconClass:"icon-16-container icon-16-close",style:"outline:none!important;",onClick:dojo.hitch(this,"hide")}));var f=new v,h=dojo.data.ItemFileWriteStore({url:"bqLibrary/getResourceList/item_id/"+this.BQItem.id}),f=u({libraryId:this.libraryId,BQItem:this.BQItem,currencyAbbr:this.currencyAbbr,BQItemGridStore:this.BQItemGridStore,baseContainer:this.baseContainer,
store:h,structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:f.rowCountCellFormatter},{name:b.name,field:"name",width:"auto"},{name:b.action,field:"resource_library_exists",width:"80px",styles:"text-align:center;",formatter:f.actionCellFormatter}]});a.addChild(c);a.addChild(f);return a}})});
