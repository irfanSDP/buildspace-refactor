define("dojo/_base/declare dojo/_base/lang dojox/grid/enhanced/plugins/Rearrange dojo/_base/event dojo/keys dijit/focus buildspace/widget/grid/cells/Textarea buildspace/widget/grid/Filter buildspace/widget/grid/cells/Formatter dojo/i18n!buildspace/nls/AccountGroup ./AccountCodeMaintenanceForm".split(" "),function(r,u,v,w,x,m,D,y,z,e,A){var C=r("buildspace.apps.AccountGroupMaintenance.AccountGroupMaintenenceGrid",dojox.grid.EnhancedGrid,{region:"center",style:"border-top:none;",selectedItem:null,keepSelection:!0,
rowSelector:"0px",constructor:function(a){this.rearranger=v(this,{})},canSort:function(a){return!1},postCreate:function(){this.inherited(arguments);this.on("RowContextMenu",function(a){this.selection.clear();var c=this.getItem(a.rowIndex);this.selection.setSelected(a.rowIndex,!0);this.contextMenu(a);c&&!isNaN(parseInt(c.id[0]))?this.disableToolbarButtons(!1):this.disableToolbarButtons(!0,["Add"])},!0);this.on("RowClick",function(a){(a=this.getItem(a.rowIndex))&&!isNaN(parseInt(a.id[0]))?this.disableToolbarButtons(!1):
this.disableToolbarButtons(!0,["Add"])})},doApplyCellEdit:function(a,c,b){var f=this,d=this.getItem(c),g=this.store;if(a!==d[b][0]){var h=buildspace.dialog.indeterminateProgressBar({title:e.savingData+". "+e.pleaseWait+"..."}),k={id:d.id,attr_name:b,val:a,_csrf_token:d._csrf_token?d._csrf_token:null},l="systemMaintenance/accountGroupUpdate";if(d&&isNaN(parseInt(d.id[0]))){var t=0<c?this.getItem(c-1):!1;u.mixin(k,{prev_item_id:t?t.id:0});l="systemMaintenance/accountGroupAdd"}var B=function(n,q){for(var p in n)d.hasOwnProperty(p)&&
p!=q._getIdentifierAttribute()&&q.setValue(d,p,n[p]);q.save()};h.show().then(function(){dojo.xhrPost({url:l,content:k,handleAs:"json",load:function(n){if(n.success){isNaN(parseInt(d.id[0]))?(g.deleteItem(d),g.save(),dojo.forEach(n.items,function(p){g.newItem(p)}),g.save()):B(n.data,g);var q=f.getCellByField(b);window.setTimeout(function(){f.focus.setFocusIndex(c,q.index)},10);h.hide()}},error:function(n){h.hide()}})})}this.inherited(arguments)},doCancelEdit:function(a){this.inherited(arguments);this.views.renormalizeRow(a);
this.scroller.rowHeightChanged(a,!0)},dodblclick:function(a){this.onRowDblClick(a)},contextMenu:function(a){var c=this.rowCtxMenu=new dijit.Menu;this.contextMenuItems(a);var b={target:a.target,coords:a.keyCode!==x.F10&&"pageX"in a?{x:a.pageX,y:a.pageY}:null},f=this.getItem(a.rowIndex);c&&f&&(this.selection.isSelected(a.rowIndex)||a.rowNode&&html.hasClass(a.rowNode,"dojoxGridRowbar"))&&(c._openMyself(b),w.stop(a))},contextMenuItems:function(a){a=this.getItem(a.rowIndex);console.log(a);a&&!isNaN(parseInt(a.id[0]))&&
(this.rowCtxMenu.addChild(new dijit.MenuItem({label:e.addRow,iconClass:"icon-16-container icon-16-add",onClick:dojo.hitch(this,"addRow")})),this.rowCtxMenu.addChild(new dijit.MenuItem({label:e.deleteRow,iconClass:"icon-16-container icon-16-delete",onClick:dojo.hitch(this,"deleteRow")})),"Yes"==a.disable?this.rowCtxMenu.addChild(new dijit.MenuItem({label:e.enable,iconClass:"icon-16-container icon-16-enable",onClick:dojo.hitch(this,"enable")})):this.rowCtxMenu.addChild(new dijit.MenuItem({label:e.disable,
iconClass:"icon-16-container icon-16-disable",onClick:dojo.hitch(this,"disable")})))},addRow:function(){m.curNode.blur();m.curNode=null;if(-1<this.selection.selectedIndex){var a=this.selection.selectedIndex,c=this,b=buildspace.dialog.indeterminateProgressBar({title:e.savingData+". "+e.pleaseWait+"..."}),f=this.store,d=this.getItem(a);if(isNaN(parseInt(d.id[0]))){var g=0<a?this.getItem(a-1).id:0;var h={id:d.id,prev_item_id:g,_csrf_token:d._csrf_token}}else g=0<a?this.getItem(a-1).id:0,h={prev_item_id:g,
before_id:d.id,_csrf_token:d._csrf_token};b.show().then(function(){dojo.xhrPost({url:"systemMaintenance/accountGroupAdd",content:h,handleAs:"json",load:function(k){k.success&&dojo.forEach(k.items,function(l){0<l.id&&(l=f.newItem(l),f.save(),l=c.getItemIndex(l),c.rearranger.moveRows([l],a),c.selection.clear())});window.setTimeout(function(){c.selection.setSelected(a,!0);c.focus.setFocusIndex(a,1)},30);b.hide()},error:function(k){c.selection.clear();c.disableToolbarButtons(!0);b.hide()}})})}},deleteRow:function(){var a=
this.selection.selectedIndex,c=this.getItem(a);m.curNode.blur();m.curNode=null;if(-1<this.selection.selectedIndex&&c&&!isNaN(parseInt(c.id[0]))){var b=this,f=buildspace.dialog.indeterminateProgressBar({title:e.deleting+". "+e.pleaseWait+"..."});buildspace.dialog.confirm(e.deleteAccountGroupConfirmation,"<div>"+e.doYouReallywantToDeleteAccountGroup+" ?</div>",90,320,function(){f.show().then(function(){dojo.xhrPost({url:"systemMaintenance/accountGroupDelete",content:{id:c.id,_csrf_token:c._csrf_token},
handleAs:"json",load:function(d){if(d.success){d=d.items;for(var g=b.store,h=0,k=d.length;h<k;++h)g.fetchItemByIdentity({identity:d[h].id,onItem:function(l){g.deleteItem(l);g.save()}});d.length=0;b.selection.clear();window.setTimeout(function(){b.focus.setFocusIndex(a,0)},10);b.disableToolbarButtons(!0)}else buildspace.dialog.alert(e.cannotDeleteAccountGroupTitle,e.cannotDeleteAccountGroupMsg,90,320);f.hide();b.selectedItem=null;b.pasteOp=null},error:function(d){b.selection.clear();b.disableToolbarButtons(!0);
b.selectedItem=null;b.pasteOp=null;f.hide()}})})})}},disable:function(){var a=this.selection.selectedIndex,c=this.getItem(a);m.curNode.blur();m.curNode=null;if(-1<this.selection.selectedIndex&&c&&!isNaN(parseInt(c.id[0]))){var b=this,f=buildspace.dialog.indeterminateProgressBar({title:e.pleaseWait+"..."});buildspace.dialog.confirm(e.disableAccountGroupConfirmation,"<div>"+e.doYouReallywantToDisableAccountGroup+" ?</div>",90,320,function(){f.show().then(function(){dojo.xhrPost({url:"systemMaintenance/accountGroupDisable",
content:{id:c.id,_csrf_token:c._csrf_token},handleAs:"json",load:function(d){d.success&&(b.reload(),b.selection.clear(),window.setTimeout(function(){b.focus.setFocusIndex(a,0)},10),b.disableToolbarButtons(!0));f.hide();b.selectedItem=null;b.pasteOp=null},error:function(d){b.selection.clear();b.disableToolbarButtons(!0);b.selectedItem=null;b.pasteOp=null;f.hide()}})})})}},enable:function(){var a=this.selection.selectedIndex,c=this.getItem(a);m.curNode.blur();m.curNode=null;if(-1<this.selection.selectedIndex&&
c&&!isNaN(parseInt(c.id[0]))){var b=this,f=buildspace.dialog.indeterminateProgressBar({title:e.pleaseWait+"..."});buildspace.dialog.confirm(e.enableAccountGroupConfirmation,"<div>"+e.doYouReallywantToEnableAccountGroup+" ?</div>",90,320,function(){f.show().then(function(){dojo.xhrPost({url:"systemMaintenance/accountGroupEnable",content:{id:c.id,_csrf_token:c._csrf_token},handleAs:"json",load:function(d){d.success&&(b.reload(),b.selection.clear(),window.setTimeout(function(){b.focus.setFocusIndex(a,
0)},10),b.disableToolbarButtons(!0));f.hide();b.selectedItem=null;b.pasteOp=null},error:function(d){b.selection.clear();b.disableToolbarButtons(!0);b.selectedItem=null;b.pasteOp=null;f.hide()}})})})}},disableToolbarButtons:function(a,c){var b=dijit.byId("AddAccountGroupRow-button"),f=dijit.byId("DeleteAccountGroupRow-button");b._setDisabledAttr(a);f._setDisabledAttr(a);a&&c instanceof Array&&dojo.forEach(c,function(d){(d=dijit.byId(d+"AccountGroupRow-button"))&&d._setDisabledAttr(!1)})},reload:function(){this.store.close();
this._refresh()}});return r("buildspace.apps.AccountGroupMaintenance.AccountGroupMaintenanceFormContainer",dijit.layout.BorderContainer,{style:"padding:0px;width:100%;height:100%;border:0px;",gutters:!1,postCreate:function(){this.inherited(arguments);var a=new z,c=dijit.byId("accountCodeMaintenance-stackContainer");c&&dijit.byId("accountCodeMaintenance-stackContainer").destroyRecursive();c=this.stackContainer=new dijit.layout.StackContainer({style:"width:100%;height:100%;",region:"center",id:"accountCodeMaintenance-stackContainer"});
a=this.AccountGroupMaintenenceGrid=new C({store:new dojo.data.ItemFileWriteStore({clearOnClose:!0,url:"systemMaintenance/getAccountGroups"}),structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:a.rowCountCellFormatter},{name:e.name,field:"name",editable:!0,cellType:"buildspace.widget.grid.cells.Textarea",noresize:!0,width:"auto",formatter:a.disabledCellFormatter},{name:e.disable,field:"disable",styles:"text-align:center;",width:"120px"},{name:e.updatedAt,field:"updated_at",
styles:"text-align:center;",width:"120px"}],onRowDblClick:dojo.hitch(this,"maintainAccountCodes")});var b=new dijit.Toolbar({region:"top",style:"padding:2px;border-bottom:none;width:100%;"});b.addChild(new dijit.form.Button({id:"AddAccountGroupRow-button",label:e.addRow,iconClass:"icon-16-container icon-16-add",disabled:!0,onClick:dojo.hitch(a,"addRow")}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({id:"DeleteAccountGroupRow-button",label:e.deleteRow,iconClass:"icon-16-container icon-16-delete",
disabled:!0,onClick:dojo.hitch(a,"deleteRow")}));var f=new y({grid:a,region:"top",filterFields:[{name:e.name}]}),d=new dijit.layout.BorderContainer({style:"padding:0px;width:100%;height:100%;",baseClass:"form",gutters:!1,region:"center"});d.addChild(f);d.addChild(b);d.addChild(a);a=new dijit.layout.ContentPane({title:e.accountGroup,content:d});b=new dijit.layout.StackController({region:"top",containerId:"accountCodeMaintenance-stackContainer"});b=new dijit.layout.ContentPane({style:"padding: 0px; overflow: hidden;",
baseClass:"breadCrumbTrail",region:"top",content:b});c.addChild(a);this.addChild(c);this.addChild(b);dojo.subscribe("accountCodeMaintenance-stackContainer-selectChild","",function(g){var h=dijit.byId("accountCodeMaintenance-stackContainer");if(h){var k=h.getChildren();g=dojo.indexOf(k,dijit.byId(g.id));for(g+=1;k.length>g;)h.removeChild(k[g]),k[g].destroyRecursive(!0),g+=1}})},maintainAccountCodes:function(a){a=this.AccountGroupMaintenenceGrid.getItem(a.rowIndex);"No"==a.disable&&a&&!isNaN(parseInt(a.id[0]))&&
this.createAccountCodeMaintenanceWindow(a)},createAccountCodeMaintenanceWindow:function(a){a=new dijit.layout.ContentPane({title:e.accountCode,content:new A({accountGroupId:a.id[0]})});this.stackContainer.addChild(a);this.stackContainer.selectChild(a)}})});
