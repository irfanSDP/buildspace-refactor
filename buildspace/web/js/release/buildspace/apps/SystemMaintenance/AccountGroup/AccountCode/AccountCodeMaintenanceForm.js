define("dojo/_base/declare dojo/_base/lang dojox/grid/enhanced/plugins/Rearrange dojo/_base/event dojo/keys dijit/focus buildspace/widget/grid/cells/Textarea buildspace/widget/grid/Filter buildspace/widget/grid/cells/Formatter dojo/i18n!buildspace/nls/AccountGroup".split(" "),function(l,p,q,r,t,h,x,u,v,d){var w=l("buildspace.apps.AccountCodeMaintenance.AccountCodeMaintenenceGrid",dojox.grid.EnhancedGrid,{region:"center",style:"border-top:none;",selectedItem:null,keepSelection:!0,rowSelector:"0px",
constructor:function(a){this.rearranger=q(this,{})},canSort:function(a){return!1},postCreate:function(){this.inherited(arguments);this.on("RowContextMenu",function(a){this.selection.clear();var b=this.getItem(a.rowIndex);this.selection.setSelected(a.rowIndex,!0);this.contextMenu(a);b&&!isNaN(parseInt(b.id[0]))?this.disableToolbarButtons(!1):this.disableToolbarButtons(!0,["Add"])},!0);this.on("RowClick",function(a){(a=this.getItem(a.rowIndex))&&!isNaN(parseInt(a.id[0]))?this.disableToolbarButtons(!1):
this.disableToolbarButtons(!0,["Add"])})},doCancelEdit:function(a){this.inherited(arguments);this.views.renormalizeRow(a);this.scroller.rowHeightChanged(a,!0)},doApplyCellEdit:function(a,b,c){var g=this,e=this.getItem(b),k=this.store;if(a!==e[c][0]){var f=buildspace.dialog.indeterminateProgressBar({title:d.savingData+". "+d.pleaseWait+"..."}),m={id:e.id,accountGroupId:this.accountGroupId,attr_name:c,val:a,_csrf_token:e._csrf_token?e._csrf_token:null},n="systemMaintenance/accountCodeUpdate";if(e&&
isNaN(parseInt(e.id[0]))){var h=0<b?this.getItem(b-1):!1;p.mixin(m,{prev_item_id:h?h.id:0});n="systemMaintenance/accountCodeAdd"}var l=function(a,b){for(var c in a)e.hasOwnProperty(c)&&c!=b._getIdentifierAttribute()&&b.setValue(e,c,a[c]);b.save()};f.show().then(function(){dojo.xhrPost({url:n,content:m,handleAs:"json",load:function(a){if(a.success){isNaN(parseInt(e.id[0]))?(k.deleteItem(e),k.save(),dojo.forEach(a.items,function(a){k.newItem(a)}),k.save()):l(a.data,k);var d=g.getCellByField(c);window.setTimeout(function(){g.focus.setFocusIndex(b,
d.index)},10);f.hide()}},error:function(a){f.hide()}})})}this.inherited(arguments)},dodblclick:function(a){this.onRowDblClick(a)},contextMenu:function(a){var b=this.rowCtxMenu=new dijit.Menu;this.contextMenuItems(a);var c={target:a.target,coords:a.keyCode!==t.F10&&"pageX"in a?{x:a.pageX,y:a.pageY}:null},d=this.getItem(a.rowIndex);b&&d&&(this.selection.isSelected(a.rowIndex)||a.rowNode&&html.hasClass(a.rowNode,"dojoxGridRowbar"))&&(b._openMyself(c),r.stop(a))},contextMenuItems:function(a){(a=this.getItem(a.rowIndex))&&
!isNaN(parseInt(a.id[0]))&&(this.rowCtxMenu.addChild(new dijit.MenuItem({label:d.addRow,iconClass:"icon-16-container icon-16-add",onClick:dojo.hitch(this,"addRow")})),this.rowCtxMenu.addChild(new dijit.MenuItem({label:d.deleteRow,iconClass:"icon-16-container icon-16-delete",onClick:dojo.hitch(this,"deleteRow")})))},addRow:function(){h.curNode.blur();h.curNode=null;if(-1<this.selection.selectedIndex){var a=this.selection.selectedIndex,b=this,c,g,e=buildspace.dialog.indeterminateProgressBar({title:d.savingData+
". "+d.pleaseWait+"..."}),k=this.store,f=this.getItem(a);isNaN(parseInt(f.id[0]))?(c=0<a?this.getItem(a-1).id:0,g={id:f.id,accountGroupId:this.accountGroupId,prev_item_id:c,_csrf_token:f._csrf_token}):(c=0<a?this.getItem(a-1).id:0,g={prev_item_id:c,accountGroupId:this.accountGroupId,before_id:f.id,_csrf_token:f._csrf_token});e.show().then(function(){dojo.xhrPost({url:"systemMaintenance/accountCodeAdd",content:g,handleAs:"json",load:function(c){c.success&&dojo.forEach(c.items,function(c){0<c.id&&(c=
k.newItem(c),k.save(),c=b.getItemIndex(c),b.rearranger.moveRows([c],a),b.selection.clear())});window.setTimeout(function(){b.selection.setSelected(a,!0);b.focus.setFocusIndex(a,1)},30);e.hide()},error:function(a){b.selection.clear();b.disableToolbarButtons(!0);e.hide()}})})}},deleteRow:function(){var a=this.selection.selectedIndex,b=this.getItem(a);h.curNode.blur();h.curNode=null;if(-1<this.selection.selectedIndex&&b&&!isNaN(parseInt(b.id[0]))){var c=this,g=buildspace.dialog.indeterminateProgressBar({title:d.deleting+
". "+d.pleaseWait+"..."});buildspace.dialog.confirm(d.deleteAccountCodeConfirmation,"<div>"+d.doYouReallywantToDeleteAccountCode+" ?</div>",90,320,function(){g.show().then(function(){dojo.xhrPost({url:"systemMaintenance/accountCodeDelete",content:{id:b.id,_csrf_token:b._csrf_token},handleAs:"json",load:function(b){if(b.success){b=b.items;for(var e=c.store,f=0,h=b.length;f<h;++f)e.fetchItemByIdentity({identity:b[f].id,onItem:function(a){e.deleteItem(a);e.save()}});b.length=0;c.selection.clear();window.setTimeout(function(){c.focus.setFocusIndex(a,
0)},10);c.disableToolbarButtons(!0)}else buildspace.dialog.alert(d.cannotDeleteAccountCodeTitle,d.cannotDeleteAccountCodeMsg,90,320);g.hide();c.selectedItem=null;c.pasteOp=null},error:function(a){c.selection.clear();c.disableToolbarButtons(!0);c.selectedItem=null;c.pasteOp=null;g.hide()}})})})}},disableToolbarButtons:function(a,b){var c=dijit.byId("AddAccountCodeRow-button"),d=dijit.byId("DeleteAccountCodeRow-button");c._setDisabledAttr(a);d._setDisabledAttr(a);a&&b instanceof Array&&dojo.forEach(b,
function(a){(a=dijit.byId(a+"AccountCodeRow-button"))&&a._setDisabledAttr(!1)})}});return l("buildspace.apps.AccountGroupMaintenance.AccountGroupMaintenanceFormContainer",dijit.layout.BorderContainer,{style:"padding:0px;width:100%;height:100%;border:0px;",gutters:!1,postCreate:function(){this.inherited(arguments);var a=new v,b=buildspace.apps.SystemMaintenance.AccountConstants,a=this.AccountCodeMaintenanceGrid=new w({store:new dojo.data.ItemFileWriteStore({clearOnClose:!0,url:"systemMaintenance/getAccountCodes/accountGroupId/"+
this.accountGroupId}),structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:a.rowCountCellFormatter},{name:d.code,field:"code",width:"150px",editable:!0,cellType:"buildspace.widget.grid.cells.Textarea",noresize:!0},{name:d.description,field:"description",editable:!0,cellType:"buildspace.widget.grid.cells.Textarea",noresize:!0,width:"auto"},{name:d.taxCode,field:"tax_code",width:"150px",editable:!0,cellType:"buildspace.widget.grid.cells.Textarea",noresize:!0},{name:d.type,
field:"type",width:"70px",styles:"text-align:center;",editable:!0,cellType:"dojox.grid.cells.Select",options:Object.values(b.AccountCodeValues),values:Object.values(b.AccountCodes)},{name:d.updatedAt,field:"updated_at",styles:"text-align:center;",width:"120px"}],accountGroupId:this.accountGroupId}),b=new dijit.Toolbar({region:"top",style:"padding:2px;border-bottom:none;width:100%;"});b.addChild(new dijit.form.Button({id:"AddAccountCodeRow-button",label:d.addRow,iconClass:"icon-16-container icon-16-add",
disabled:!0,onClick:dojo.hitch(a,"addRow")}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({id:"DeleteAccountCodeRow-button",label:d.deleteRow,iconClass:"icon-16-container icon-16-delete",disabled:!0,onClick:dojo.hitch(a,"deleteRow")}));var c=new u({grid:a,region:"top",filterFields:[{name:d.name}]});this.addChild(c);this.addChild(b);this.addChild(a)}})});
