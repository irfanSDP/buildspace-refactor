define("buildspace/apps/PostContractRemeasurementReport/RemeasurementGrid","dojo/_base/declare dojo/_base/lang dojo/_base/connect dijit/TooltipDialog dijit/popup dojo/aspect dojo/request dojo/number dijit/form/DropDownButton dijit/DropDownMenu dijit/MenuItem dijit/PopupMenuItem dojox/grid/enhanced/plugins/Rearrange buildspace/widget/grid/plugins/FormulatedColumn dojox/grid/enhanced/plugins/IndirectSelection buildspace/widget/grid/cells/Formatter ./PrintSelectedTypesOrElementsDialog ./PrintElementsDialog ./PrintItemsDialog dojo/i18n!buildspace/nls/PostContractRemeasurement".split(" "),
function(l,n,h,u,k,v,g,p,w,x,q,C,D,y,E,z,r,t,m,d){var A=l("buildspace.apps.PostContractRemeasurementReport.ResourceEnhancedGridFormatter",null,{postContractRemeasurementQuantityCellFormatter:function(a,b,c){b=this.grid.getItem(b);p.parse(a);var e=this.field.replace("-qty_per_unit",""),f=isNaN(a)||0==a||null==a?"&nbsp;":p.format(a,{places:2});void 0!=b.has_note&&"true"==b.has_note&&c.customClasses.push("hasNoteTypeItemCell");void 0!=b.version&&0<b.version&&c.customClasses.push("hasAddendumTypeItemCell");
a=void 0!=b[e+"-has_build_up"]&&b[e+"-has_build_up"][0]?'<span style="color:#0000FF;"><b>'+f+"</b></span>":0<=a?f:'<span style="color:#FF0000">'+f+"</span>";b.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER||b.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_N||b.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_NOID||b.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_RATE_ONLY?(c.customClasses.push("disable-cell"),a=b.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_RATE_ONLY?
d.rateOnly:"&nbsp;"):e==buildspace.apps.PostContractReport.ProjectStructureConstants.OMISSION?c.customClasses.push("disable-cell"):b&&0<b.id[0]&&!b.include[0]&&c.customClasses.push("disable-cell");return a}}),B=l("buildspace.apps.PostContractRemeasurementReport.ResourceEnhancedGrid",dojox.grid.EnhancedGrid,{type:null,style:"border-top:none;",rowSelector:"0px",region:"center",project:null,bill:null,billTypeId:-1,gridContainer:null,escapeHTMLInData:!1,constructor:function(a){this.structure=a.structure;
this.type=a.type;this.columnGroup=a.columnGroup;this.billTypeId=a.billTypeId;this.bill=a.bill;this.formatter=new z;"item"==this.type&&(this.setColumnStructure(),this.createHeaderCtxMenu());if("billTypes"===a.type||"element"===a.type||"item"===a.type)this.plugins={indirectSelection:{headerSelector:!0,width:"40px",styles:"text-align: center;"}};this.inherited(arguments)},canSort:function(a){return!1},postCreate:function(){var a=this,b,c=null;this.formulatedColumn=y(this,{});a.inherited(arguments);"element"===
a.type?b=a.gridContainer.selectedElementStore[a.billTypeId]:"item"===a.type&&(b=a.gridContainer.selectedItemStore[a.billTypeId]);b&&v.after(a,"_onFetchComplete",function(){a.gridContainer.markedCheckBoxObject(a,b)});"item"===a.type&&(this._connects.push(h.connect(this,"onCellMouseOver",function(a){var b=a.cell.field,e=a.rowIndex,d=this.getItem(e),b=b.replace("-value","");"undefined"!==typeof d[b+"-has_formula"]&&d[b+"-has_formula"][0]&&(d=d[b+"-value"][0],d=this.formulatedColumn.convertItemIdToRowIndex(d,
e),null===c&&(c=new u({content:d,onMouseLeave:function(){k.close(c)}}),k.open({popup:c,around:a.cellNode})))})),this._connects.push(h.connect(this,"onCellMouseOut",function(){null!==c&&(k.close(c),c=null)})),this._connects.push(h.connect(this,"onStartEdit",function(){null!==c&&(k.close(c),c=null)})))},startup:function(){var a=this;a.inherited(arguments);this._connects.push(h.connect(this,"onCellClick",function(b){""===b.cell.name&&a.singleCheckBoxSelection(b)}));this._connects.push(h.connect(this.rowSelectCell,
"toggleAllSelection",function(b){a.toggleAllSelection(b)}))},setColumnStructure:function(){var a=this.formatter;if("item"==this.type){var b=new A;this.structure={noscroll:!1,cells:[[{name:"No.",field:"id",width:"40px",styles:"text-align:center;",formatter:a.rowCountCellFormatter,rowSpan:2},{name:d.billReference,field:"bill_ref",styles:"text-align:center; color: red;",width:"80px",noresize:!0,hidden:!0,rowSpan:2,showInCtxMenu:!0},{name:d.description,field:"description",width:"auto",formatter:a.postContractPrintPreviewTreeCellFormatter,
rowSpan:2},{name:d.type,field:"type",width:"70px",styles:"text-align:center;",formatter:a.typeCellFormatter,rowSpan:2},{name:d.unit,field:"uom_id",width:"70px",styles:"text-align:center;",formatter:a.unitIdCellFormatter,rowSpan:2},{name:d.rate,field:"rate",width:"120px",styles:"text-align:right;",formatter:a.unEditableCurrencyCellFormatter,rowSpan:2},{name:d.qtyPerUnit,field:"omission-qty_per_unit",width:"90px",headerClasses:"typeHeader1",formatter:b.postContractRemeasurementQuantityCellFormatter,
styles:"text-align: right;",noresize:!0},{name:d.totalPerUnit,field:"omission-total_per_unit",width:"90px",headerClasses:"typeHeader1",formatter:a.unEditableCurrencyCellFormatter,styles:"text-align: right; color: red;",noresize:!0},{name:d.qtyPerUnit,field:"addition-qty_per_unit",width:"90px",headerClasses:"typeHeader1",formatter:b.postContractRemeasurementQuantityCellFormatter,styles:"text-align: right;",noresize:!0},{name:d.totalPerUnit,field:"addition-total_per_unit",width:"90px",headerClasses:"typeHeader1",
formatter:a.unEditableCurrencyCellFormatter,styles:"text-align: right;",noresize:!0},{name:d.nettAdditionOmission,field:"nett_addition_omission",width:"100px",styles:"text-align: right; color: green;",formatter:a.unEditableCurrencyCellFormatter,rowSpan:2}],[{name:d.omission,styles:"text-align: center;",headerClasses:"staticHeader typeHeader1",colSpan:2,noresize:!0},{name:d.addition,styles:"text-align: center;",headerClasses:"staticHeader typeHeader2",colSpan:2,noresize:!0}]]}}},onHeaderCellClick:function(a){dojo.hasClass(a.cell.id,
"staticHeader")||(a.grid.setSortIndex(a.cell.index),a.grid.onHeaderClick(a))},onHeaderCellMouseOver:function(a){dojo.hasClass(a.cell.id,"staticHeader")||dojo.addClass(a.cellNode,this.cellOverClass)},onStyleRow:function(a){this.inherited(arguments);if(a.node.children[0]&&2<=a.node.children[0].children[0].rows.length){var b=a.node.children[0].children[0].rows[1],c=a.node.children[0].children[0].rows[0].children;b.parentNode.removeChild(b);dojo.forEach(c,function(a,b){var c=dojo.attr(a,"rowSpan");(!c||
2>c)&&dojo.attr(a,"rowSpan",2)})}},createHeaderCtxMenu:function(){if("undefined"!==typeof this.structure){var a=this.structure.cells[0],b=this,c={headerMenu:new dijit.Menu};dojo.forEach(a,function(a,d){a.showInCtxMenu&&c.headerMenu.addChild(new dijit.CheckedMenuItem({label:a.name,checked:"undefined"===typeof a.hidden||!1===a.hidden?!0:!1,onChange:function(a){var c=!1;a&&(c=!0);b.showHideMergedColumn(c,d)}}))});this.plugins={menus:c}}},showHideMergedColumn:function(a,b){this.beginUpdate();this.layout.setColumnVisibility(b,
a);this.endUpdate()},destroy:function(){this.inherited(arguments);dojo.forEach(this._connects,h.disconnect);delete this._connects}});return l("buildspace.apps.PostContractRemeasurementReport.RemeasurementGrid",dijit.layout.BorderContainer,{stackContainerTitle:"",style:"padding:0px;width:100%;height:100%;",gutters:!1,project:null,gridOpts:{},pageId:0,postCreate:function(){var a=this;this.inherited(arguments);n.mixin(a.gridOpts,{project:a.project});var b=new x({style:"display: none;"}),c=new dijit.Toolbar({region:"top",
style:"padding:2px;border-bottom:none;width:100%;"}),e=this.grid=new B(a.gridOpts);if("billTypes"===a.gridOpts.type){var f=["selectedTypes","elementsBySelectedTypes"];dojo.forEach(f,function(c){var e;switch(c){case "selectedTypes":e="openPrintSelectedTypes";break;case "elementsBySelectedTypes":e="openPrintSelectedElementsByTypes"}b.addChild(new q({label:d[c],onClick:function(){a[e](c)}}))})}else if("element"===a.gridOpts.type||"item"===a.gridOpts.type)f=["selectedElements","elementsByAdditionOnly",
"selectedItems","itemsWithAdditionOnly","selectedItemsWithBuildUpQtyOnly"],dojo.forEach(f,function(c){var e;switch(c){case "selectedElements":e="openPrintSelectedElements";break;case "elementsByAdditionOnly":e="openPrintElementsWithAddition";break;case "selectedItems":e="openPrintSelectedItems";break;case "itemsWithAdditionOnly":e="openPrintItemsWithAdditionOnly";break;case "selectedItemsWithBuildUpQtyOnly":e="openPrintSelectedItemsWithBuildUpQtyOnly"}b.addChild(new q({label:d[c],onClick:function(){a[e](c)}}))});
if("billTypes"===a.gridOpts.type||"element"===a.gridOpts.type||"item"===a.gridOpts.type)c.addChild(new w({label:d.printPreview,iconClass:"icon-16-container icon-16-print",dropDown:b})),this.addChild(c);this.addChild(new dijit.layout.ContentPane({style:"width:100%",content:e,region:"center"}));if(c=dijit.byId("postContractReportRemeasurement-grid_"+a.project.id+"-stackContainer"))f=document.createElement("div"),f=new dojox.layout.ContentPane({title:buildspace.truncateString(a.stackContainerTitle,60),
id:a.pageId,executeScripts:!0},f),c.addChild(f),f.set("content",a),n.mixin(f,{grid:e}),c.selectChild(a.pageId)},openPrintSelectedTypes:function(){var a=this,b=[];a.gridOpts.gridContainer.selectedTypeStore.query().forEach(function(a){b.push(a.id)});var c=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});c.show();g.post("postContractRemeasurementReport/getPrintingSelectedTypes",{handleAs:"json",data:{bill_id:a.gridOpts.bill.id[0],type_ids:JSON.stringify(a.gridOpts.gridContainer.arrayUnique(b)),
opt:a.gridOpts.gridContainer.opt}}).then(function(e){(new r({bill:a.gridOpts.bill,title:d.selectedTypes,data:e,selectedItems:b,opt:a.gridOpts.gridContainer.opt,printURL:"postContractRemeasurementReport/printSelectedTypes",exportURL:"postContractRemeasurementExportExcel/exportSelectedTypes"})).show();c.hide()},function(a){console.log(a);c.hide()})},openPrintSelectedElementsByTypes:function(){var a=this,b=[];a.gridOpts.gridContainer.selectedTypeStore.query().forEach(function(a){b.push(a.id)});var c=
buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});c.show();g.post("postContractRemeasurementReport/getPrintingSelectedElementByTypes",{handleAs:"json",data:{bill_id:a.gridOpts.bill.id[0],type_ids:JSON.stringify(a.gridOpts.gridContainer.arrayUnique(b)),opt:a.gridOpts.gridContainer.opt}}).then(function(e){(new r({bill:a.gridOpts.bill,title:d.elementsBySelectedTypes,data:e,selectedItems:b,opt:a.gridOpts.gridContainer.opt,printURL:"postContractRemeasurementReport/printingSelectedElementByTypes",
exportURL:"postContractRemeasurementExportExcel/exportExcelSelectedElementByTypes"})).show();c.hide()},function(a){console.log(a);c.hide()})},openPrintSelectedElements:function(){var a=this,b=[];a.gridOpts.gridContainer.selectedElementStore[a.gridOpts.billTypeId].query().forEach(function(a){b.push(a.id)});var c=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});c.show();g.post("postContractRemeasurementReport/getPrintingSelectedElements",{handleAs:"json",data:{bill_id:a.gridOpts.bill.id[0],
bill_type_id:a.gridOpts.billTypeId,element_ids:JSON.stringify(a.gridOpts.gridContainer.arrayUnique(b)),opt:a.gridOpts.gridContainer.opt}}).then(function(e){(new t({bill:a.gridOpts.bill,bill_type_id:a.gridOpts.billTypeId,title:d.selectedElements,data:e,selectedItems:b,opt:a.gridOpts.gridContainer.opt,printURL:"postContractRemeasurementReport/printingSelectedElements",exportURL:"postContractRemeasurementExportExcel/exportExcelSelectedElements"})).show();c.hide()},function(a){console.log(a);c.hide()})},
openPrintElementsWithAddition:function(){var a=this,b=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});b.show();g.post("postContractRemeasurementReport/getPrintingElementsWithAddition",{handleAs:"json",data:{bill_id:a.gridOpts.bill.id[0],bill_type_id:a.gridOpts.billTypeId,opt:a.gridOpts.gridContainer.opt}}).then(function(c){(new t({bill:a.gridOpts.bill,bill_type_id:a.gridOpts.billTypeId,title:d.elementsByAdditionOnly,data:c,opt:a.gridOpts.gridContainer.opt,printURL:"postContractRemeasurementReport/printingElementsWithAddition",
exportURL:"postContractRemeasurementExportExcel/exportExcelElementsWithAddition"})).show();b.hide()},function(a){console.log(a);b.hide()})},openPrintSelectedItems:function(){var a=this,b=[];a.gridOpts.gridContainer.selectedItemStore[a.gridOpts.billTypeId].query().forEach(function(a){b.push(a.id)});var c=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});c.show();g.post("postContractRemeasurementReport/getPrintingSelectedItems",{handleAs:"json",data:{bill_id:a.gridOpts.bill.id[0],
bill_type_id:a.gridOpts.billTypeId,item_ids:JSON.stringify(a.gridOpts.gridContainer.arrayUnique(b)),opt:a.gridOpts.gridContainer.opt}}).then(function(e){(new m({bill:a.gridOpts.bill,bill_type_id:a.gridOpts.billTypeId,title:d.selectedItems,data:e,selectedItems:b,opt:a.gridOpts.gridContainer.opt,printURL:"postContractRemeasurementReport/printingSelectedItems",exportURL:"postContractRemeasurementExportExcel/exportExcelSelectedItems"})).show();c.hide()},function(a){console.log(a);c.hide()})},openPrintItemsWithAdditionOnly:function(){var a=
this,b=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});b.show();g.post("postContractRemeasurementReport/getPrintingItemsWithAdditionOnly",{handleAs:"json",data:{bill_id:a.gridOpts.bill.id[0],bill_type_id:a.gridOpts.billTypeId,opt:a.gridOpts.gridContainer.opt}}).then(function(c){(new m({bill:a.gridOpts.bill,bill_type_id:a.gridOpts.billTypeId,title:d.itemsWithAdditionOnly,data:c,opt:a.gridOpts.gridContainer.opt,printURL:"postContractRemeasurementReport/printingItemsWithAdditionOnly",
exportURL:"postContractRemeasurementExportExcel/exportExcelItemsWithAdditionOnly"})).show();b.hide()},function(a){console.log(a);b.hide()})},openPrintSelectedItemsWithBuildUpQtyOnly:function(){var a=this,b=[];a.gridOpts.gridContainer.selectedItemStore[a.gridOpts.billTypeId].query().forEach(function(a){b.push(a.id)});var c=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});c.show();g.post("postContractRemeasurementReport/getPrintingSelectedItemsWithBuildUpQty",{handleAs:"json",
data:{bill_id:a.gridOpts.bill.id[0],bill_type_id:a.gridOpts.billTypeId,item_ids:JSON.stringify(a.gridOpts.gridContainer.arrayUnique(b)),opt:a.gridOpts.gridContainer.opt}}).then(function(e){(new m({bill:a.gridOpts.bill,bill_type_id:a.gridOpts.billTypeId,title:d.selectedItemsWithBuildUpQtyOnly,data:e,selectedItems:b,opt:a.gridOpts.gridContainer.opt,printURL:"postContractRemeasurementReport/printingSelectedItemsWithBuildUpQty",exportURL:"postContractRemeasurementExportExcel/exportExcelSelectedItemsWithBuildUpQty"})).show();
c.hide()},function(a){console.log(a);c.hide()})}})});
