define("buildspace/apps/ScheduleOfRateLibrary/importScheduleOfRateDialog","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/currency dojo/when dojo/html dojo/dom dojo/keys dojo/dom-style buildspace/widget/grid/cells/Formatter dojox/grid/enhanced/plugins/IndirectSelection dojo/i18n!buildspace/nls/ScheduleOfRateLibrary".split(" "),function(h,m,k,n,t,u,v,p,q,f,w,d){var r=h("buildspace.apps.ScheduleOfRateLibrary.ImportScheduleOfRateGrid",dojox.grid.EnhancedGrid,{type:null,itemId:0,dialogWidget:null,
_csrf_token:null,resource:null,itemIds:[],buildUpGridStore:null,buildUpSummaryWidget:null,scheduleOfRateItemId:-1,style:"border-top:none;",constructor:function(a){this.itemIds=[];this.connects=[];"tree"==a.type&&(this.urlGetDescendantIds="scheduleOfRate/getResourceDescendantsForImport",this.plugins={indirectSelection:{headerSelector:!0,width:"20px",styles:"text-align: center;"}});this.inherited(arguments)},canSort:function(a){return!1},postCreate:function(){var a=this;a.inherited(arguments);this.on("RowClick",
function(b){b=a.getItem(b.rowIndex);"tree"==a.type&&(b&&0<b.id?a.disableToolbarButtons(!1):a.disableToolbarButtons(!0))});"tree"==this.type&&(this._connects.push(k.connect(this,"onCellClick",function(b){a.selectTree(b)})),this._connects.push(k.connect(this.rowSelectCell,"toggleAllSelection",function(b){a.toggleAllSelection(b)})))},dodblclick:function(a){this.onRowDblClick(a)},selectTree:function(a){var b=a.rowIndex;a=this.selection.selected[b];b=this.getItem(b);this.pushItemIdIntoGridArray(b,a)},
pushItemIdIntoGridArray:function(a,b){var c=dojo.indexOf(this.itemIds,a.id[0]);b?-1==c&&this.itemIds.push(a.id[0]):-1!=c&&this.itemIds.splice(c,1)},toggleAllSelection:function(a){var b=this,c=b.selection;a?(c.selectRange(0,b.rowCount-1),b.itemIds=[],b.store.fetch({onComplete:function(a){dojo.forEach(a,function(a,c){0<a.id&&b.itemIds.push(a.id[0])})}})):(c.deselectAll(),b.itemIds=[])},disableToolbarButtons:function(a,b){dijit.byId("ImportScheduleOfRateGrid-"+this.itemId+"_"+this.resource.id+"Import-button")._setDisabledAttr(a)},
"import":function(){var a=this,b=a.buildUpGridStore,c=a.itemIds;if(0<c.length){var e=buildspace.dialog.indeterminateProgressBar({title:d.importingItems+". "+d.pleaseWait+"..."});e.show();dojo.xhrPost({url:"scheduleOfRateImport/importSORBuildUpItems",content:{id:a.itemId,rid:a.resource.id,ids:[c],_csrf_token:a._csrf_token},handleAs:"json",load:function(c){c.success&&(b.fetchItemByIdentity({identity:buildspace.constants.GRID_LAST_ROW,onItem:function(a){b.deleteItem(a);b.save();dojo.forEach(c.items,
function(a){b.newItem(a)});b.save()}}),a.updateTotalBuildUp(c.totalBuildUp));a.itemIds=[];e.hide();a.dialogWidget.hide()},error:function(b){a.itemIds=[];e.hide();a.dialogWidget.hide()}})}},updateTotalBuildUp:function(a){dijit.byId("accPane-"+this.resource.id+"-"+this.itemId).set("title",this.resource.name+'<span style="color:blue;float:right;">'+buildspace.currencyAbbreviation+"&nbsp;"+n.format(a)+"</span>");this.buildUpSummaryWidget.refreshTotalCost()},destroy:function(){this.inherited(arguments);
dojo.forEach(this._connects,k.disconnect);delete this._connects}}),g=h("buildspace.apps.ScheduleOfRateLibrary.ImportScheduleOfRateGridContainer",dijit.layout.BorderContainer,{style:"padding:0px;width:100%;height:100%;border:0px;",gutters:!1,resource:null,stackContainerTitle:"",itemId:0,gridOpts:{},postCreate:function(){this.inherited(arguments);m.mixin(this.gridOpts,{type:this.type,resource:this.resource,itemId:this.itemId,region:"center"});var a=this.grid=new r(this.gridOpts);if("tree"==this.type){var b=
new dijit.Toolbar({region:"top",style:"padding:2px;border-bottom:none;width:100%;"});b.addChild(new dijit.form.Button({id:"ImportScheduleOfRateGrid-"+this.itemId+"_"+this.resource.id+"Import-button",label:d.importToBuildUp,iconClass:"icon-16-container icon-16-import",onClick:function(){a["import"]()}}));this.addChild(b)}this.addChild(new dijit.layout.ContentPane({style:"width:100%",content:a,region:"center"}));if(b=dijit.byId("scheduleOfRateBuildUpRate-resource_import_"+this.itemId+"-"+this.resource.id+
"-stackContainer")){var c=document.createElement("div"),c=new dojox.layout.ContentPane({title:buildspace.truncateString(this.stackContainerTitle,60),id:this.pageId,executeScripts:!0},c);b.addChild(c);c.set("content",this);b.selectChild(this.pageId)}}});return h("buildspace.apps.ScheduleOfRateLibrary.ImportScheduleOfRateDialog",dijit.Dialog,{style:"padding:0px;margin:0px;",title:d.importFromScheduleOfRate,itemId:0,resource:null,buildUpGridStore:null,buildUpSummaryWidget:null,buildRendering:function(){var a=
this.createContent();a.startup();this.content=a;this.inherited(arguments)},postCreate:function(){q.set(this.containerNode,{padding:"0px",margin:"0px"});this.closeButtonNode.style.display="none";this.inherited(arguments)},_onKey:function(a){key=a.keyCode;key==p.ESCAPE&&dojo.stopEvent(a)},onHide:function(){this.destroyRecursive()},createContent:function(){var a=this,b=new dijit.layout.BorderContainer({style:"padding:0px;width:1280px;height:600px;",gutters:!1}),c=new dijit.Toolbar({region:"top",style:"outline:none!important;padding:2px;overflow:hidden;border:0px;"});
c.addChild(new dijit.form.Button({label:d.close,iconClass:"icon-16-container icon-16-close",style:"outline:none!important;",onClick:dojo.hitch(this,"hide")}));var e=new f,l=dojo.data.ItemFileWriteStore({url:"scheduleOfRateImport/getScheduleOfRateListWithResource/resource_id/"+a.resource.resource_library_id}),e=g({stackContainerTitle:a.resource.name,pageId:"import-page_sor-"+a.resource.id,resource:this.resource,itemId:this.itemId,gridOpts:{store:l,structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",
formatter:e.rowCountCellFormatter},{name:d.name,field:"name",width:"auto"}],onRowDblClick:function(b){b=this.getItem(b.rowIndex);0<b.id&&null!==b.name[0]&&a.createScheduleOfRateTradeGrid(b)}}}),e=this.makeGridContainer(e);b.addChild(c);b.addChild(e);return b},createScheduleOfRateTradeGrid:function(a){var b=this,c=f(),e=new dojo.data.ItemFileWriteStore({url:"scheduleOfRateImport/getScheduleOfRateTradeListWithResource/resource_id/"+b.resource.resource_library_id+"/sor_id/"+a.id});return new g({stackContainerTitle:a.name,
pageId:"import-page_sor_trade-"+a.id,resource:this.resource,itemId:this.itemId,gridOpts:{store:e,structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:c.rowCountCellFormatter},{name:d.description,field:"description",width:"auto"}],onRowDblClick:function(c){c=this.getItem(c.rowIndex);0<c.id&&null!==c.description[0]&&b.createItemGrid(a,c)}}})},createItemGrid:function(a,b){var c=this,e=f(),l=new dojo.data.ItemFileWriteStore({url:"scheduleOfRateImport/getScheduleOfRateItemListWithResource/resource_id/"+
c.resource.resource_library_id+"/sor_id/"+a.id+"/trade_id/"+b.id});return new g({stackContainerTitle:b.description,pageId:"import-page_sor_item-"+b.id,resource:c.resource,itemId:c.itemId,gridOpts:{store:l,dialogWidget:c,buildUpGridStore:c.buildUpGridStore,structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:e.rowCountCellFormatter},{name:d.description,field:"description",width:"auto",formatter:e.treeCellFormatter},{name:d.type,field:"type",width:"80px",styles:"text-align:center;",
formatter:e.typeCellFormatter},{name:d.unit,field:"uom_id",width:"70px",styles:"text-align:center;",formatter:e.unitIdCellFormatter},{name:d.rate,field:"rate-value",width:"150px",styles:"text-align:right;",formatter:e.formulaCurrencyCellFormatter},{name:d.lastUpdated,field:"updated_at",width:"120px",styles:"text-align: center;"}],onRowDblClick:function(a){a=this.getItem(a.rowIndex);0<a.id&&null!==a.description[0]&&c.createBuildUpItemGrid(a)}}})},createBuildUpItemGrid:function(a){var b=f(),c=new dojo.data.ItemFileWriteStore({url:"scheduleOfRateImport/getScheduleOfRateBuildUpRateItemListWithResource/sor_item_id/"+
a.id+"/resource_library_id/"+this.resource.resource_library_id});return new g({stackContainerTitle:a.description,pageId:"import-sor_page_item-"+a.id,resource:this.resource,itemId:this.itemId,type:"tree",gridOpts:{store:c,dialogWidget:this,buildUpGridStore:this.buildUpGridStore,buildUpSummaryWidget:this.buildUpSummaryWidget,_csrf_token:a._csrf_token,structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:b.rowCountCellFormatter},{name:d.description,field:"description",
width:"auto",cellType:"buildspace.widget.grid.cells.Textarea",formatter:b.linkedCellFormatter},{name:d.number,field:"number-value",width:"100px",styles:"text-align:right;",formatter:b.formulaCurrencyCellFormatter},{name:d.constant,field:"constant-value",width:"100px",styles:"text-align:right;",formatter:b.formulaCurrencyCellFormatter},{name:d.qty,field:"quantity-value",width:"70px",styles:"text-align:right;",formatter:b.formulaNumberCellFormatter},{name:d.unit,field:"uom_id",width:"70px",styles:"text-align:center;",
formatter:b.linkedUnitIdCellFormatter},{name:d.rate,field:"rate-value",width:"80px",styles:"text-align:right;",formatter:b.formulaCurrencyCellFormatter},{name:d.total,field:"total",width:"80px",styles:"text-align:right;",formatter:b.linkedCurrencyCellFormatter},{name:d.wastage+" (%)",field:"wastage-value",width:"70px",styles:"text-align:right;",formatter:b.formulaCurrencyCellFormatter},{name:d.lineTotal,field:"line_total",width:"80px",styles:"text-align:right;",formatter:b.linkedCurrencyCellFormatter}],
onRowDblClick:function(a){}}})},makeGridContainer:function(a){var b=this.itemId+"-"+this.resource.id,c=dijit.byId("scheduleOfRateBuildUpRate-resource_import_"+b+"-stackContainer");c&&dijit.byId("scheduleOfRateBuildUpRate-resource_import_"+b+"-stackContainer").destroyRecursive();c=new dijit.layout.StackContainer({style:"width:100%;height:100%;border:0px;",region:"center",id:"scheduleOfRateBuildUpRate-resource_import_"+b+"-stackContainer"});a=new dijit.layout.ContentPane({title:d.resources,content:a});
c.addChild(a);a=new dijit.layout.StackController({region:"top",containerId:"scheduleOfRateBuildUpRate-resource_import_"+b+"-stackContainer"});a=new dijit.layout.ContentPane({style:"padding:0px;overflow:hidden;border:0px;","class":"breadCrumbTrail",region:"top",content:a});var e=new dijit.layout.BorderContainer({style:"padding:0px;width:100%;height:100%;border:0px;",gutters:!1,region:"center"});e.addChild(c);e.addChild(a);dojo.subscribe("scheduleOfRateBuildUpRate-resource_import_"+b+"-stackContainer-selectChild",
"",function(a){var c=dijit.byId("scheduleOfRateBuildUpRate-resource_import_"+b+"-stackContainer");if(c){var d=c.getChildren();a=dojo.indexOf(d,dijit.byId(a.id));for(a+=1;d.length>a;)c.removeChild(d[a]),d[a].destroyRecursive(!0),a+=1}});return e}})});
