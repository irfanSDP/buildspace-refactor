define("buildspace/apps/MasterCostData/PrimeCostSumGrid","dojo/_base/declare dojo/_base/lang dojox/grid/EnhancedGrid buildspace/widget/grid/cells/Formatter dijit/form/DropDownButton dijit/DropDownMenu dijit/MenuItem dojo/when dojo/aspect dojo/i18n!buildspace/nls/CostData".split(" "),function(k,n,p,t,u,v,w,x,y,d){var q=k("buildspace.apps.MasterCostData.PrimeCostSumGrid",p,{style:"border:none;",region:"center",keepSelection:!0,rowSelector:"0px",escapeHTMLInData:!1,masterCostData:null,addUrl:"masterCostData/addNewPrimeCostSumItem",
updateUrl:"masterCostData/updatePrimeCostSumItem",constructor:function(a){this.inherited(arguments)},canSort:function(a){return!1},postCreate:function(){var a=this;this.inherited(arguments);this.on("RowClick",function(b){if(b.cell){var c=!1;0<this.getItem(b.rowIndex).id[0]&&(c=!0);a.enableToolbarButtons(c)}})},enableToolbarButtons:function(a){dijit.byId(this.masterCostData.id+"prime-cost-sum-delete-button")._setDisabledAttr(!a)},dodblclick:function(a){this.onRowDblClick(a)},doApplyCellEdit:function(a,
b,c){var f=this,e=f.getItem(b),g=f.store;if(a!==e[c][0]){var m=buildspace.dialog.indeterminateProgressBar({title:d.savingData+". "+d.pleaseWait+"..."}),l={id:e.id,attr_name:c,val:a,master_cost_data_id:f.masterCostData.id,_csrf_token:e._csrf_token?e._csrf_token:null},h=this.updateUrl;e.id==buildspace.constants.GRID_LAST_ROW&&(h=0<b?f.getItem(b-1):!1,n.mixin(l,{prev_item_id:h?h.id:0}),h=this.addUrl);var k=function(a,b){for(var c in a)e.hasOwnProperty(c)&&c!=b._getIdentifierAttribute()&&b.setValue(e,
c,a[c]);b.save()};l={url:h,content:l,handleAs:"json",load:function(a){if(a.success){0<e.id?k(a.data,g):(g.deleteItem(e),g.save(),dojo.forEach(a.items,function(a){g.newItem(a)}),g.save());var d=f.getCellByField(c);window.setTimeout(function(){f.focus.setFocusIndex(b,d.index)},10);m.hide()}},error:function(a){m.hide()}};m.show();dojo.xhrPost(l)}f.inherited(arguments)},canEdit:function(a,b){return!0},reload:function(){this.store.close();this._refresh()}}),r=function(a,b){return parseInt(b)+1};return k("buildspace.apps.MasterCostData.PrimeCostSumItemsContainer",
dijit.layout.BorderContainer,{region:"center",title:"",style:"padding:0px;border:none;width:100%;height:100%;",gutters:!1,masterCostData:null,grid:null,stackContainer:null,postCreate:function(){this.inherited(arguments);var a=this.createBreakdownGrid();a=new dijit.layout.ContentPane({style:"padding:0px;border:none;width:100%;height:100%;",region:"center",content:a,grid:a});this.addChild(this.createToolbar());this.addChild(a)},createToolbar:function(){var a=this,b=new dijit.Toolbar({region:"top",style:"outline:none!important;border:none;padding:2px;width:100%;"});
b.addChild(new dijit.form.Button({id:this.masterCostData.id+"prime-cost-sum-delete-button",label:d.delete,iconClass:"icon-16-container icon-16-delete",disabled:!0,style:"outline:none!important;",onClick:function(){if(-1<a.grid.selection.selectedIndex){var b=a.grid.getItem(a.grid.selection.selectedIndex);0<b.id[0]&&a.deleteRow(b)}}}));return b},createBreakdownGrid:function(){return this.grid=q({masterCostData:this.masterCostData,structure:[{name:"No.",field:"count",width:"30px",styles:"text-align:center;",
formatter:r},{name:d.description,field:"description",width:"auto",cellType:"buildspace.widget.grid.cells.Textarea",editable:!0}],store:new dojo.data.ItemFileWriteStore({clearOnClose:!0,url:"masterCostData/getPrimeCostSumBreakdown/masterCostData/"+this.masterCostData.id})})},deleteRow:function(a){var b=this,c=buildspace.dialog.indeterminateProgressBar({title:d.deleting+". "+d.pleaseWait+"..."});buildspace.dialog.confirm(d.confirmation,d.confirmationMessage+"<br/>"+d.cannotBeUndone,80,300,function(){c.show().then(function(){dojo.xhrPost({url:"masterCostData/deletePrimeCostSumItem",
content:{id:a.id,_csrf_token:a._csrf_token},handleAs:"json",load:function(a){a.success?b.grid.reload():buildspace.dialog.alert(d.cannotBeDeleted,a.errorMsg,80,300);c.hide();b.grid.selection.clear();b.grid.enableToolbarButtons(!1)},error:function(a){c.hide();b.grid.selection.clear();b.grid.enableToolbarButtons(!1)}})})})}})});
