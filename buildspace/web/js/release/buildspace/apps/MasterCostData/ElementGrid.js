define("buildspace/apps/MasterCostData/ElementGrid","dojo/_base/declare dojo/_base/lang dojox/grid/EnhancedGrid dojox/grid/enhanced/plugins/Rearrange buildspace/widget/grid/cells/Formatter dijit/form/DropDownButton dijit/DropDownMenu dijit/MenuItem dijit/focus dojo/when dojo/aspect dojo/i18n!buildspace/nls/CostData".split(" "),function(q,t,u,v,A,B,C,D,r,E,F,e){var y=q("buildspace.apps.MasterCostData.ElementGrid",u,{style:"border:none;",region:"center",keepSelection:!0,rowSelector:"0px",escapeHTMLInData:!1,
masterCostData:null,workCategory:null,addUrl:"masterCostData/addNewElement",updateUrl:"masterCostData/updateItem",constructor:function(a){this.inherited(arguments);this.rearranger=v(this,{})},canSort:function(a){return!1},postCreate:function(){var a=this;this.inherited(arguments);this.on("RowClick",function(b){b.cell&&(b=this.getItem(b.rowIndex),0<b.id[0]?a.enableToolbarButtons(!0):b.id[0]===buildspace.constants.GRID_LAST_ROW&&(a.enableToolbarButtons(!0),dijit.byId(a.workCategory.id+"element-delete-button")._setDisabledAttr(!0)))})},
enableToolbarButtons:function(a){dijit.byId(this.workCategory.id+"element-delete-button")._setDisabledAttr(!a);dijit.byId(this.workCategory.id+"element-add-button")._setDisabledAttr(!a)},dodblclick:function(a){this.onRowDblClick(a)},doApplyCellEdit:function(a,b,d){var c=this,f=c.getItem(b),k=c.store;if(a!==f[d][0]){var n=buildspace.dialog.indeterminateProgressBar({title:e.savingData+". "+e.pleaseWait+"..."}),h={id:f.id,attr_name:d,val:a,master_cost_data_id:c.masterCostData.id,parent_id:c.workCategory.id,
_csrf_token:f._csrf_token?f._csrf_token:null},g=this.updateUrl;if(f.id==buildspace.constants.GRID_LAST_ROW){g=0<b?c.getItem(b-1):!1;var w=c.getItem(b);t.mixin(h,{prev_item_id:g?g.id:0,current_id:w.id});g=this.addUrl}var x=function(l,p){for(var m in l)f.hasOwnProperty(m)&&m!=p._getIdentifierAttribute()&&p.setValue(f,m,l[m]);p.save()};h={url:g,content:h,handleAs:"json",load:function(l){if(l.success){0<f.id?x(l.data,k):(k.deleteItem(f),k.save(),dojo.forEach(l.items,function(m){k.newItem(m)}),k.save(),
c.enableToolbarButtons(!1));var p=c.getCellByField(d);window.setTimeout(function(){c.focus.setFocusIndex(b,p.index)},10);n.hide()}},error:function(l){n.hide()}};n.show();dojo.xhrPost(h)}c.inherited(arguments)},canEdit:function(a,b){return!0},reload:function(){this.store.save();this.store.close();this.sort();this._refresh()}}),z=function(a,b){return parseInt(b)+1};return q("buildspace.apps.MasterCostData.ElementsContainer",dijit.layout.BorderContainer,{region:"center",title:"",style:"padding:0px;border:none;width:100%;height:100%;",
gutters:!1,masterCostData:null,workCategory:null,grid:null,stackContainer:null,postCreate:function(){this.inherited(arguments);var a=this.createBreakdownGrid();a=new dijit.layout.ContentPane({style:"padding:0px;border:none;width:100%;height:100%;",region:"center",content:a,grid:a});this.addChild(this.createToolbar());this.addChild(a)},createToolbar:function(){var a=this,b=new dijit.Toolbar({region:"top",style:"outline:none!important;border:none;padding:2px;width:100%;"});b.addChild(new dijit.form.Button({id:a.workCategory.id+
"element-add-button",label:e.addRow,iconClass:"icon-16-container icon-16-add",disabled:-1<a.grid.selection.selectedIndex?!1:!0,onClick:function(){-1<a.grid.selection.selectedIndex&&a.addRow(a.grid.selection.selectedIndex)}}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({id:this.workCategory.id+"element-delete-button",label:e.deleteRow,iconClass:"icon-16-container icon-16-delete",disabled:!0,style:"outline:none!important;",onClick:function(){if(-1<a.grid.selection.selectedIndex){var d=
a.grid.getItem(a.grid.selection.selectedIndex);0<d.id[0]&&a.deleteRow(d)}}}));return b},createBreakdownGrid:function(){return this.grid=y({masterCostData:this.masterCostData,workCategory:this.workCategory,structure:[{name:"No.",field:"count",width:"30px",styles:"text-align:center;",formatter:z},{name:e.element,field:"description",width:"auto",cellType:"buildspace.widget.grid.cells.Textarea",editable:!0}],store:new dojo.data.ItemFileWriteStore({clearOnClose:!0,url:"masterCostData/getElementList/masterCostData/"+
this.masterCostData.id+"/id/"+this.workCategory.id})})},addRow:function(a){r.curNode.blur();r.curNode=null;var b=this,d=buildspace.dialog.indeterminateProgressBar({title:e.addingRow+". "+e.pleaseWait+"..."}),c=b.grid.store,f=b.grid.getItem(a),k=0<a?b.grid.getItem(a-1).id:0,n={master_cost_data_id:b.masterCostData.id,parent_id:b.workCategory.id,prev_item_id:k,current_id:f.id,_csrf_token:f._csrf_token};d.show().then(function(){dojo.xhrPost({url:b.grid.addUrl,content:n,handleAs:"json",load:function(h){h.success&&
dojo.forEach(h.items,function(g){0<g.id&&(g=c.newItem(g),c.save(),g=b.grid.getItemIndex(g),b.grid.rearranger.moveRows([g],a),b.grid.selection.clear())});window.setTimeout(function(){b.grid.selection.setSelected(a,!0);b.grid.focus.setFocusIndex(a,1)},30);d.hide()},error:function(h){b.grid.selection.clear();b.grid.enableToolbarButtons(!0);d.hide()}})})},deleteRow:function(a){var b=this,d=buildspace.dialog.indeterminateProgressBar({title:e.deleting+". "+e.pleaseWait+"..."});buildspace.dialog.confirm(e.confirmation,
e.confirmationMessage+"<br/>"+e.cannotBeUndone,80,300,function(){d.show().then(function(){dojo.xhrPost({url:"masterCostData/deleteItem",content:{id:a.id,_csrf_token:a._csrf_token},handleAs:"json",load:function(c){c.success?(b.grid.store.deleteItem(a),b.grid.store.save(),b.grid.reload()):buildspace.dialog.alert(e.cannotBeDeleted,c.errorMsg,80,300);d.hide();b.grid.selection.clear();b.grid.enableToolbarButtons(!1)},error:function(c){d.hide();b.grid.selection.clear();b.grid.enableToolbarButtons(!1)}})})})}})});
