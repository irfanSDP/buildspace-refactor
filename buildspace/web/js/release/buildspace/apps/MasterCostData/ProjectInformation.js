define("buildspace/apps/MasterCostData/ProjectInformation",["dojo/_base/declare","dojo/_base/lang","dojox/grid/EnhancedGrid","buildspace/widget/grid/cells/Formatter","dojo/i18n!buildspace/nls/CostData"],function(g,n,m,t,c){var p=g("buildspace.apps.MasterCostData.ProjectInformationGrid",m,{style:"border:none;",region:"center",keepSelection:!0,rowSelector:"0px",escapeHTMLInData:!1,masterCostData:null,parentItem:null,addUrl:"masterCostData/addNewProjectInformation",updateUrl:"masterCostData/updateProjectInformation",
constructor:function(a){this.inherited(arguments)},canSort:function(a){return!1},postCreate:function(){var a=this;this.inherited(arguments);this.on("RowClick",function(b){if(b.cell){var e=!1;0<this.getItem(b.rowIndex).id[0]&&(e=!0);a.enableToolbarButtons(e)}})},enableToolbarButtons:function(a){dijit.byId(this.parentItem.id+"project-information-delete-button")._setDisabledAttr(!a)},dodblclick:function(a){this.onRowDblClick(a)},doApplyCellEdit:function(a,b,e){var d=this,f=d.getItem(b),h=d.store;if(a!==
f[e][0]){var g=buildspace.dialog.indeterminateProgressBar({title:c.savingData+". "+c.pleaseWait+"..."}),l={id:f.id,val:a,master_cost_data_id:d.masterCostData.id,parent_id:d.parentItem.id,_csrf_token:f._csrf_token?f._csrf_token:null},k=this.updateUrl;f.id==buildspace.constants.GRID_LAST_ROW&&(k=0<b?d.getItem(b-1):!1,n.mixin(l,{prev_item_id:k?k.id:0}),k=this.addUrl);var m=function(a,b){for(var d in a)f.hasOwnProperty(d)&&d!=b._getIdentifierAttribute()&&b.setValue(f,d,a[d]);b.save()};l={url:k,content:l,
handleAs:"json",load:function(a){if(a.success){0<f.id?m(a.data,h):(h.deleteItem(f),h.save(),dojo.forEach(a.items,function(a){h.newItem(a)}),h.save());var c=d.getCellByField(e);window.setTimeout(function(){d.focus.setFocusIndex(b,c.index)},10);g.hide()}},error:function(a){g.hide()}};g.show();dojo.xhrPost(l)}d.inherited(arguments)},canEdit:function(a,b){return!0},reload:function(){this.store.close();this._refresh()}}),q=function(a,b){return parseInt(b)+1},r=g("buildspace.apps.MasterCostData.ProjectInformationContainer",
dijit.layout.BorderContainer,{region:"center",title:"",style:"padding:0px;border:none;width:100%;height:100%;",gutters:!1,masterCostData:null,grid:null,stackContainer:null,level:null,parentItem:null,postCreate:function(){this.inherited(arguments);var a=this.createBreakdownGrid();a=new dijit.layout.ContentPane({style:"padding:0px;border:none;width:100%;height:100%;",region:"center",content:a,grid:a});this.addChild(this.createToolbar());this.addChild(a)},createToolbar:function(){var a=this,b=new dijit.Toolbar({region:"top",
style:"outline:none!important;border:none;padding:2px;width:100%;"});b.addChild(new dijit.form.Button({id:a.parentItem.id+"project-information-delete-button",label:c.delete,iconClass:"icon-16-container icon-16-delete",disabled:!0,style:"outline:none!important;",onClick:function(){if(-1<a.grid.selection.selectedIndex){var b=a.grid.getItem(a.grid.selection.selectedIndex);0<b.id[0]&&a.deleteRow(b)}}}));return b},createBreakdownGrid:function(){var a=this;a.grid=p({masterCostData:a.masterCostData,parentItem:a.parentItem,
structure:[{name:"No.",field:"count",width:"30px",styles:"text-align:center;",formatter:q},{name:c.description,field:"description",width:"auto",cellType:"buildspace.widget.grid.cells.Textarea",editable:!0}],store:new dojo.data.ItemFileWriteStore({clearOnClose:!0,url:"masterCostData/getProjectInformationBreakdown/masterCostData/"+this.masterCostData.id+"/parent_id/"+a.parentItem.id}),onRowDblClick:function(b){b=this.getItem(b.rowIndex);2>a.level&&0<b.id[0]&&a.stackContainer.addBreakdownContainer(b,
a.level+1)}});return a.grid},deleteRow:function(a){var b=this,e=buildspace.dialog.indeterminateProgressBar({title:c.deleting+". "+c.pleaseWait+"..."});buildspace.dialog.confirm(c.confirmation,c.confirmationMessage+"<br/>"+c.cannotBeUndone,80,300,function(){e.show().then(function(){dojo.xhrPost({url:"masterCostData/deleteProjectInformation",content:{id:a.id,_csrf_token:a._csrf_token},handleAs:"json",load:function(a){a.success?b.grid.reload():buildspace.dialog.alert(c.cannotBeDeleted,a.errorMsg,80,
300);e.hide();b.grid.selection.clear();b.grid.enableToolbarButtons(!1)},error:function(a){e.hide();b.grid.selection.clear();b.grid.enableToolbarButtons(!1)}})})})}});return g("buildspace.apps.MasterCostData.ProjectInformationStackContainer",dijit.layout.BorderContainer,{region:"center",title:"",style:"padding:0px;border:none;width:100%;height:100%;",gutters:!1,masterCostData:null,grid:null,stackContainer:null,level:null,postCreate:function(){this.inherited(arguments);this.stackContainer=this.createStackContainer();
this.addBreakdownContainer({id:0,description:c.projectInfo},1)},createStackContainer:function(){var a="masterCostDataProjectInformation"+this.masterCostData.id+"-stackContainer",b=this.stackContainer=new dijit.layout.StackContainer({style:"border:0px;width:100%;height:100%;",region:"center",id:a});dojo.subscribe(a+"-selectChild","",function(b){var c=dijit.byId(a);if(c){var d=c.getChildren();b=dojo.indexOf(d,b);b+=1;if(d.length>b)for(;d.length>b;)c.removeChild(d[b]),d[b].destroyDescendants(),d[b].destroyRecursive(),
b+=1}});var c=new dijit.layout.StackController({region:"top",containerId:a});c=new dijit.layout.ContentPane({style:"padding:0px;overflow:hidden;",baseClass:"breadCrumbTrail",region:"top",id:"masterCostDataProjectInformation"+this.masterCostData.id+"-controllerPane",content:c});this.addChild(b);this.addChild(c);return b},addBreakdownContainer:function(a,b){a=new r({title:buildspace.truncateString(a.description,60),masterCostData:this.masterCostData,level:b,stackContainer:this,parentItem:a});this.stackContainer.addChild(a);
1<this.stackContainer.getChildren().length&&this.stackContainer.selectChild(a)}})});
