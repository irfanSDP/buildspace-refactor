define("buildspace/apps/Location/ProjectLocationManagement/ProgressClaim/ProgressClaimContainer","dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/dom-style dojo/keys dojo/number dijit/Menu dijit/CheckedMenuItem dijit/layout/ContentPane dojox/form/manager/_Mixin dojox/form/manager/_NodeMixin dojox/form/manager/_ValueMixin dojox/form/manager/_DisplayMixin dijit/form/Form dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojox/grid/EnhancedGrid dojo/data/ItemFileWriteStore buildspace/widget/grid/cells/Formatter buildspace/widget/grid/cells/TextBox buildspace/widget/grid/plugins/LocationFilter dojox/grid/enhanced/plugins/Menu dojo/i18n!buildspace/nls/Location".split(" "),
function(l,n,J,p,q,K,r,t,u,v,w,x,y,z,A,B,C,D,E,F,L,M,N,c){var G=l("buildspace.apps.ProjectLocationManagement.ProgressClaim.Grid",D,{style:"border-top:none;",project:null,region:"center",filterParams:[],postCreate:function(){this.inherited(arguments)},canSort:function(a){return!1},doApplyCellEdit:function(a,b,g){var d=this,e=this.getItem(b),k=this.store;if(a!==e[g][0]){var h=buildspace.dialog.indeterminateProgressBar({title:c.savingData+". "+c.pleaseWait+"..."}),f={pid:this.project.id,id:e.id,attr_name:g,
val:a,_csrf_token:e._csrf_token?e._csrf_token:null},m=function(a,b){for(var d in a)e.hasOwnProperty(d)&&d!=b._getIdentifierAttribute()&&b.setValue(e,d,a[d]);b.save()};h.show().then(function(){dojo.xhrPost({url:"location/progressClaimUpdate",content:f,handleAs:"json",load:function(a){if(a.success){m(a.data,k);var c=d.getCellByField(g);window.setTimeout(function(){d.focus.setFocusIndex(b,c.index)},10)}h.hide()},error:function(a){h.hide()}})})}this.inherited(arguments)},canEdit:function(a,b){if(void 0!=
a){var c=this.getItem(b);if(c&&a.editable&&!c.has_prorate_qty[0]){var d=this;window.setTimeout(function(){d.edit.cancel();d.focus.setFocusIndex(b,a.index)},10);return!1}}return this._canEdit},onStyleRow:function(a){this.inherited(arguments);if(a.node.children[0]&&2<=a.node.children[0].children[0].rows.length){var b=a.node.children[0].children[0].rows[1],c=a.node.children[0].children[0].rows[0].children;b.parentNode.removeChild(b);dojo.forEach(c,function(a,b){b=dojo.attr(a,"rowSpan");(!b||2>b)&&dojo.attr(a,
"rowSpan",2)})}},doCancelEdit:function(a){this.inherited(arguments);this.views.renormalizeRow(a);this.scroller.rowHeightChanged(a,!0)},showHideColumn:function(a,b){this.beginUpdate();this.layout.setColumnVisibility(b,a);this.endUpdate()}}),H=l("buildspace.apps.Location.ProjectLocationManagement.ProgressClaim.ExportToExcelForm",[z,A,B,C,v,w,x,y],{templateString:'<form data-dojo-attach-point="containerNode"><table class="table-form"><tr><td class="label" style="width:80px;"><label style="display: inline;"></span>'+
c.exportAs+' :</label></td><td><input type="text" name="filename" style="padding:2px;width:220px;" data-dojo-type="dijit/form/ValidationTextBox" data-dojo-props="trim:true, propercase:true, maxlength:45, required: true"> .xlsx</td></tr></table></form>',project:null,region:"center",dialogWidget:null,style:"outline:none;padding:0px;margin:0px;border:none;",baseClass:"buildspace-form",params:[],startup:function(){this.inherited(arguments);this.setFormValues({filename:this.project.title+" - Progress Claims"});
var a=this.containerNode,b=this.params,c;for(c in b){var d=document.createElement("input");d.setAttribute("name",c);d.setAttribute("value",b[c]);d.setAttribute("type","hidden");a.appendChild(d)}b=document.createElement("input");b.setAttribute("name","_csrf_token");b.setAttribute("value",this.project._csrf_token);b.setAttribute("type","hidden");a.appendChild(b)},submit:function(){var a=dojo.formToObject(this.id);this.validate()&&(buildspace.windowOpen("POST","location/exportProgressClaims/pid/"+this.project.id,
a),this.dialogWidget&&this.dialogWidget.hide())}}),I=l("buildspace.apps.Location.ProjectLocationManagement.ProgressClaim.ExportExcelDialog",dijit.Dialog,{style:"padding:0px;margin:0px;",title:c.exportToExcel,project:null,params:[],buildRendering:function(){var a=this.createContent();a.startup();this.content=a;this.inherited(arguments)},postCreate:function(){p.set(this.containerNode,{padding:"0px",margin:"0px"});this.closeButtonNode.style.display="none";this.inherited(arguments)},_onKey:function(a){a.keyCode==
q.ESCAPE&&dojo.stopEvent(a)},onHide:function(){this.destroyRecursive()},createContent:function(){var a=new dijit.layout.BorderContainer({style:"padding:0px;width:400px;height:80px;",gutters:!1}),b=new dijit.Toolbar({region:"top",style:"outline:none!important;padding:2px;overflow:hidden;"}),g=H({project:this.project,params:this.params,dialogWidget:this});b.addChild(new dijit.form.Button({label:c.close,iconClass:"icon-16-container icon-16-close",style:"outline:none!important;",onClick:dojo.hitch(this,
"hide")}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({label:c.export,iconClass:"icon-16-container icon-16-export",style:"outline:none!important;",onClick:dojo.hitch(g,"submit")}));a.addChild(b);a.addChild(g);return a}});return l("buildspace.apps.Location.ProjectLocationManagement.ProgressClaim.ProgressClaimContainer",dijit.layout.BorderContainer,{style:"padding:0;margin:0;width:100%;height:100%;",gutters:!1,project:null,baseApp:null,postCreate:function(){this.inherited(arguments);
var a=buildspace.dialog.indeterminateProgressBar({title:c.pleaseWait+"..."}),b=this;a.show().then(function(){dojo.xhrGet({url:"location/getOpenClaimRevision",handleAs:"json",preventCache:!0,content:{pid:b.project.id},load:function(c){a.hide();c&&c.locked_status?b.renderContent(c):a.show().then(function(){dojo.xhrGet({url:"location/getLocationCodeLevels",handleAs:"json",preventCache:!0,content:{pid:b.project.id},load:function(d){b.renderContent(c,d);a.hide()},error:function(b){a.hide()}})})},error:function(b){a.hide()}})})},
renderContent:function(a,b){var g=this,d=dijit.byId(this.project.id+"-ProgressClaim-main_content");d&&d.destroyRecursive();if(a&&a.locked_status)d=new u({id:this.project.id+"-ProgressClaim-main_content",style:"padding:0px;border:0px;height:auto;",doLayout:!1,content:'<div style="text-align:center;"><p><h1>'+c.noOpenClaimRevisionMsg+"</h1></p></div>",region:"center"});else{d=new F;a=function(a,b,c){if(a&&0<a.length)return a;c.customClasses.push("disable-cell");return"&nbsp;"};var e=[{name:"No.",field:"count",
width:"30px",styles:"text-align:center;",rowSpan:2,formatter:d.rowCountCellFormatter},{name:c.bill,field:"bill_title",width:"280px",rowSpan:2,hidden:!0,showInCtxMenu:!0},{name:c.columnType,field:"column_name",width:"120px",styles:"text-align:center;",rowSpan:2,hidden:!0,showInCtxMenu:!0},{name:c.columnUnit,field:"column_unit",width:"120px",styles:"text-align:center;",rowSpan:2,hidden:!0,showInCtxMenu:!0}],k=[];k.push({idx:2,widgetName:"dropdown",type:buildspace.constants.LOCATION_SEQUENCE_TYPE_COLUMN_TYPE,
data:b.column_types});k.push({idx:3,widgetName:"dropdown",type:buildspace.constants.LOCATION_SEQUENCE_TYPE_COLUMN_UNIT,data:b.column_units});for(var h=3,f=0;f<parseInt(b.predefined_location_codes.length);f++){switch(f){case buildspace.constants.PREDEFINED_LOCATION_CODE_TRADE_LEVEL:var m=c.trade;break;case buildspace.constants.PREDEFINED_LOCATION_CODE_ELEMENT_LEVEL:m=c.element;break;default:m=f>buildspace.constants.PREDEFINED_LOCATION_CODE_SUB_ELEMENT_LEVEL?c.subElement+" ("+(f-1)+")":c.subElement}e.push({name:m,
field:f+"-predefined_location_code",width:"180px",formatter:a,styles:"text-align:center;",rowSpan:2});h++;k.push({idx:h,widgetName:"dropdown",type:buildspace.constants.LOCATION_SEQUENCE_TYPE_TRADE,data:b.predefined_location_codes[f],level:f})}for(f=0;f<parseInt(b.project_structure_location_codes.length);f++)e.push({name:c.location+" "+(f+1),field:f+"-project_structure_location_code",width:"180px",formatter:a,styles:"text-align:center;",rowSpan:2}),h++,k.push({idx:h,widgetName:"dropdown",type:buildspace.constants.LOCATION_SEQUENCE_TYPE_LOCATION,
data:b.project_structure_location_codes[f],level:f});e.push({name:c.billItem,field:"description",width:0<parseInt(b.project_structure_location_codes.length)&&0<parseInt(b.predefined_location_codes.length)?"640px":"auto",rowSpan:2});k.push({idx:h+1,widgetName:"textbox"});e.push({name:c.unit,field:"uom",width:"70px",styles:"text-align:center;",rowSpan:2,noresize:!0});e.push({name:c.prorated+" "+c.qty,field:"prorated_qty",width:"80px",styles:"text-align:right;",formatter:d.numberCellFormatter,rowSpan:2,
noresize:!0});var l=new r;dojo.forEach(e,function(a,b){a.hasOwnProperty("showInCtxMenu")&&a.showInCtxMenu&&l.addChild(new t({label:a.name,checked:!a.hasOwnProperty("hidden")||!1===a.hidden,onChange:n.hitch(g,"showHideHeaderColumn",b)}))});e.push({name:"%",field:"previous_percentage",headerClasses:"typeHeader1",styles:"text-align:right;",width:"60px",formatter:d.unEditablePercentageCellFormatter,noresize:!0});e.push({name:c.qty,field:"previous_quantity",headerClasses:"typeHeader1",styles:"text-align:right;",
width:"90px",formatter:d.unEditableNumberCellFormatter,noresize:!0});e.push({name:"%",field:"current_percentage",headerClasses:"typeHeader2",styles:"text-align:right;",width:"60px",editable:!0,cellType:"buildspace.widget.grid.cells.TextBox",formatter:d.editablePercentageCellFormatter,noresize:!0});e.push({name:c.qty,field:"current_quantity",headerClasses:"typeHeader2",styles:"text-align:right;",width:"90px",editable:!0,cellType:"buildspace.widget.grid.cells.TextBox",formatter:d.currencyCellFormatter,
noresize:!0});e.push({name:"%",field:"up_to_date_percentage",headerClasses:"typeHeader1",styles:"text-align:right;",width:"60px",editable:!0,cellType:"buildspace.widget.grid.cells.TextBox",formatter:d.editablePercentageCellFormatter,noresize:!0});e.push({name:c.qty,field:"up_to_date_quantity",headerClasses:"typeHeader1",styles:"text-align:right;",width:"90px",editable:!0,cellType:"buildspace.widget.grid.cells.TextBox",formatter:d.currencyCellFormatter,noresize:!0});this.grid=d=new G({id:this.project.id+
"-ProgressClaim-main_content",project:this.project,structure:{cells:[e,[{name:c.previousClaim,field:"id",styles:"text-align:center;",headerClasses:"staticHeader typeHeader1",noresize:!0,colSpan:2},{name:c.currentClaim,field:"id",styles:"text-align:center;",headerClasses:"staticHeader typeHeader2",noresize:!0,colSpan:2},{name:c.upToDateClaim,field:"id",styles:"text-align:center;",headerClasses:"staticHeader typeHeader1",noresize:!0,colSpan:2}]]},plugins:{menus:{headerMenu:l},buildspaceLocationFilter:{columns:k,
gridStoreUrl:"location/getBillByLocations/pid/"+this.project.id,dropDownFilterUrl:"location/getLocationCodeLevels/pid/"+this.project.id,manualFilter:!0}},store:new E({url:"location/getBillByLocations/pid/"+this.project.id,clearOnClose:!0})})}b=new dijit.Toolbar({region:"top",style:"outline:none!important;border-bottom:none;padding:2px;width:100%;"});b.addChild(new dijit.form.Button({label:c.exportToExcel,iconClass:"icon-16-container icon-16-spreadsheet",style:"outline:none!important;",onClick:function(a){I({project:g.project,
params:g.grid.filterParams}).show()}}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({label:c.filterLocations,iconClass:"icon-16-container icon-16-zoom",style:"outline:none!important;",onClick:n.hitch(this,"filterLocations")}));this.addChild(b);this.addChild(d)},filterLocations:function(){this.grid.manualFilter()},showHideHeaderColumn:function(a,b){this.grid.showHideColumn(b,a)}})});
