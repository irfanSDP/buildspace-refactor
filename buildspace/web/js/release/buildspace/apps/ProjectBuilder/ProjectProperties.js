define("buildspace/apps/ProjectBuilder/ProjectProperties","dojo/_base/declare dojo/html dojo/dom dijit/form/Form dijit/form/ValidationTextBox dijit/form/Textarea dijit/form/DateTextBox dijit/form/Select dijit/form/FilteringSelect dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin buildspace/apps/AssignUser/assignGroupProjectGrid dojo/text!./templates/projectProperties.html dojo/i18n!buildspace/nls/ProjectBuilder".split(" "),function(g,h,k,v,w,x,y,l,e,m,
n,p,q,r,t,f){var u=g("buildspace.apps.ProjectBuilder.MainInfoFormWidget",[m,n,p,q],{templateString:t,baseClass:"buildspace-form",region:"center",style:"border:none;padding:5px;overflow:auto;",rootProject:null,nls:f,formData:null,postCreate:function(){this.inherited(arguments);var a=this,b=new dojo.data.ItemFileReadStore({url:"projectBuilder/getCurrency"}),c=new dojo.data.ItemFileReadStore({url:"projectBuilder/getCountry"});this.stateSelectStore=stateSelectStore=new dojo.data.ItemFileReadStore({url:"projectBuilder/getStateByCountry/regionId/"+
(this.formData.formValues["project_main_information[region_id]"]?this.formData.formValues["project_main_information[region_id]"]:0)});this.countrySelect=(new e({name:"project_main_information[region_id]",searchAttr:"name",style:"padding:2px;",store:c,onChange:function(d){d?a.stateSelect.set("readOnly",!1):a.stateSelect.set("readOnly",!0);a.updateStateSelectStore(d)}})).placeAt(this.countrySelectDivNode);this.stateSelect=(new e({name:"project_main_information[subregion_id]",store:stateSelectStore,
style:"padding:2px;",searchAttr:"name"})).placeAt(this.stateSelectDivNode);this.currencySelect=(new e({name:"project_main_information[currency_id]",store:b,style:"padding:2px;",searchAttr:"name"})).placeAt(this.currencySelectDivNode)},disableForm:function(){this.inputTitle.set("disabled",!0);this.countrySelect.set("disabled",!0);this.stateSelect.set("disabled",!0);this.currencySelect.set("disabled",!0);this.inputSiteAdress.set("disabled",!0);this.inputDescription.set("disabled",!0);this.inputDate.set("disabled",
!0);this.inputClient.set("disabled",!0);this.workCategories.set("disabled",!0);dijit.byId("mainFormSaveButton"+this.rootProject.id).set("disabled",!0)},refreshStateSelectStore:function(){this.stateSelect.store.close();this.stateSelect.set("store",this.stateSelectStore);this.stateSelect.set("value","")},updateStateSelectStore:function(a){var b=a?a:0,c=this;dojo.xhrPost({url:"projectBuilder/getCurrencyValueByCountry",content:{regionId:b},handleAs:"json",load:function(a){c.stateSelectStore=new dojo.data.ItemFileReadStore({url:"projectBuilder/getStateByCountry/regionId/"+
b,clearOnClose:!0});c.currencySelect.set("value",a.id);c.refreshStateSelectStore()},error:function(a){}})},startup:function(){this.inherited(arguments);this.mainInfoForm.setFormValues(this.formData.formValues);this.workCategories=(new l({name:"project_main_information[work_category_id]",style:"width:180px;padding:2px!important;",options:this.formData.workCategoryOptions},"project_main_information_work_category_id")).set("readOnly",!0);this.rootProject.status_id!=buildspace.constants.STATUS_PRETENDER&&
this.disableForm()},save:function(){var a=buildspace.dialog.indeterminateProgressBar({title:f.savingData+"..."}),b=this,c=dojo.formToObject(this.mainInfoForm.id);this.mainInfoForm.validate()&&a.show().then(function(){dojo.xhrPost({url:"projectBuilder/mainInfoUpdate",content:c,handleAs:"json",load:function(d){dojo.query('[id^="error-project_main_information_"]').forEach(function(a){a.innerHTML=""});if(d.success)dijit.byId("buildspace-main_window").titleNode.innerHTML=buildspace.truncateString(d.title,
100)+" ("+f.status+"::"+b.rootProject.status[0].toUpperCase()+")",b.rootProject.title[0]=d.title,buildspace.currencyAbbreviation=buildspace.billCurrencyAbbreviation=d.currency;else for(var c in d.errors){var e=d.errors[c];h.set(k.byId("error-project_main_information_"+c),e)}a.hide()},error:function(b){a.hide()}})})},assignUserPermission:function(){var a=new r({rootProject:this.rootProject,sysName:"ProjectBuilder",projectStatus:buildspace.constants.USER_PERMISSION_STATUS_PROJECT_BUILDER});a.show();
a.selectGroup()},close:function(){},onCancel:function(){}});return g("buildspace.apps.ProjectBuilder.ProjectProperties",dijit.layout.BorderContainer,{region:"center",style:"padding:0;margin:0;width:100%;height:100%;",gutters:!1,rootProject:null,data:null,postCreate:function(){this.inherited(arguments);var a=this.projectMainInfoForm=new u({rootProject:this.rootProject,formData:this.data}),b=new dijit.Toolbar({region:"top",style:"border-top:none;border-left:none;border-right:none;padding:2px;width:100%;"});
b.addChild(new dijit.form.Button({label:f.save,iconClass:"icon-16-container icon-16-save",style:"outline:none!important;",id:"mainFormSaveButton"+this.rootProject.id,onClick:dojo.hitch(a,"save")}));this.rootProject.is_admin[0]&&(b.addChild(new dijit.ToolbarSeparator),b.addChild(new dijit.form.Button({label:f.assignUsersToProject,iconClass:"icon-16-container icon-16-add",style:"outline:none!important;",onClick:dojo.hitch(a,"assignUserPermission")})));this.addChild(b);this.addChild(a)}})});
