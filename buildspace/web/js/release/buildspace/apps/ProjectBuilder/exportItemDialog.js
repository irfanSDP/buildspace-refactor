define("buildspace/apps/ProjectBuilder/exportItemDialog","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/when dojo/html dojo/dom dojo/keys dojo/dom-style dijit/form/Form dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/form/ValidationTextBox buildspace/widget/grid/cells/Formatter dojox/grid/enhanced/plugins/IndirectSelection dojo/i18n!buildspace/nls/BillManagerExport dijit/form/ToggleButton dijit/form/RadioButton".split(" "),function(h,
q,k,z,A,B,l,m,r,t,C,u,v,D,n,E,d,e,F){var w=h("buildspace.apps.ProjectBuilder.ExportBillForm",[r,t,u,v,dojox.form.manager._Mixin,dojox.form.manager._NodeMixin,dojox.form.manager._ValueMixin,dojox.form.manager._DisplayMixin],{templateString:'<form data-dojo-attach-point="containerNode"><table class="table-form"><tr><td class="label" style="width:80px;"><label style="display: inline;"></span>'+d.downloadAs+' :</label></td><td><input type="text" name="filename" style="padding:2px;width:220px;" data-dojo-type="dijit/form/ValidationTextBox" data-dojo-props="trim:true, propercase:true, maxlength:45, required: true"> .xlsx<input type="hidden" name="eids" value=""></td></tr></table></form>',
bill:null,elementIds:{},withRate:!1,withQuantity:!1,withBillRef:!1,region:"center",dialogWidget:null,style:"outline:none;padding:0;margin:0;border:none;",baseClass:"buildspace-form",startup:function(){this.inherited(arguments);this.setFormValues({filename:this.bill.title,eids:this.elementIds})},submit:function(){if(this.validate()){var a=dojo.formToObject(this.id),b=a.filename.replace(/ /g,"_");buildspace.windowOpen("POST","billManagerExportFile/exportExcelByElement",{filename:b,id:this.bill.id[0],
eids:a.eids,wr:this.withRate,wq:this.withQuantity,wbr:this.withBillRef,_csrf_token:this.bill._csrf_token[0]});this.dialogWidget&&this.dialogWidget.hide()}}}),x=h("buildspace.apps.ProjectBuilder.ExportBillDialog",dijit.Dialog,{style:"padding:0px;margin:0;",title:d.downloadExcelFile,bill:null,elementIds:{},withRate:!1,withQuantity:!1,withBillRef:!1,buildRendering:function(){var a=this.createContent();a.startup();this.content=a;this.inherited(arguments)},postCreate:function(){m.set(this.containerNode,
{padding:"0",margin:"0"});this.closeButtonNode.style.display="none";this.inherited(arguments)},_onKey:function(a){a.keyCode==l.ESCAPE&&dojo.stopEvent(a)},onHide:function(){this.destroyRecursive()},createContent:function(){var a=new dijit.layout.BorderContainer({style:"padding:0;width:400px;height:80px;",gutters:!1}),b=new dijit.Toolbar({region:"top",style:"outline:none!important;padding:2px;overflow:hidden;"}),c=w({bill:this.bill,elementIds:this.elementIds,withRate:this.withRate,withQuantity:this.withQuantity,
withBillRef:this.withBillRef,dialogWidget:this});b.addChild(new dijit.form.Button({label:d.close,iconClass:"icon-16-container icon-16-close",style:"outline:none!important;",onClick:dojo.hitch(this,"hide")}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({label:d.download,iconClass:"icon-16-container icon-16-import",style:"outline:none!important;",onClick:dojo.hitch(c,"submit")}));a.addChild(b);a.addChild(c);return a}}),y=h("buildspace.apps.ProjectBuilder.ExportItemGrid",
dojox.grid.EnhancedGrid,{type:null,selectedItem:null,bill:null,dialogWidget:null,billGrid:null,style:"border-top:none;",constructor:function(a){this.itemIds=[];this.connects=[];"tree"!=a.type&&(this.plugins={indirectSelection:{headerSelector:!0,width:"20px",styles:"text-align:center;"}});this.inherited(arguments)},canSort:function(a){return!1},postCreate:function(){var a=this;this.inherited(arguments);this.on("RowClick",function(b){b=a.getItem(b.rowIndex);"tree"==a.type&&(b&&0<b.id?a.disableToolbarButtons(!1):
a.disableToolbarButtons(!0))});"tree"!=this.type&&(this._connects.push(k.connect(this,"onCellClick",function(b){a.selectTree(b)})),this._connects.push(k.connect(this.rowSelectCell,"toggleAllSelection",function(b){a.toggleAllSelection(b)})))},dodblclick:function(a){this.onRowDblClick(a)},disableToolbarButtons:function(a){dijit.byId("ExportItemGrid-"+this.bill.id+"Export-button")._setDisabledAttr(a)},exportBill:function(a,b,c){0<this.itemIds.length&&(this.dialogWidget.hide(),(new x({bill:this.bill,
elementIds:this.itemIds,withRate:a,withQuantity:b,withBillRef:c})).show())},selectTree:function(a){var b=a.rowIndex;a=this.selection.selected[b];(b=this.getItem(b))&&this.pushItemIdIntoGridArray(b,a)},pushItemIdIntoGridArray:function(a,b){var c=dojo.indexOf(this.itemIds,a.id[0]);b?-1==c&&this.itemIds.push(a.id[0]):-1!=c&&this.itemIds.splice(c,1)},toggleAllSelection:function(a){var b=this,c=b.selection;a?(c.selectRange(0,b.rowCount-1),b.itemIds=[],b.store.fetch({onComplete:function(a){dojo.forEach(a,
function(a,c){0<a.id&&b.itemIds.push(a.id[0])})}})):(c.deselectAll(),b.itemIds=[])},destroy:function(){this.inherited(arguments);dojo.forEach(this._connects,k.disconnect);delete this._connects}}),p=h("buildspace.apps.ProjectBuilder.ExportItemGridContainer",dijit.layout.BorderContainer,{stackContainerTitle:"",style:"padding:0px;width:100%;height:100%;",gutters:!1,bill:null,withRate:!1,withQuantity:!1,withBillRef:!1,gridOpts:{},postCreate:function(){var a=this;this.inherited(arguments);q.mixin(this.gridOpts,
{type:this.type,bill:this.bill,region:"center"});var b=this.grid=new y(this.gridOpts);if("tree"!=this.type){var c=new dijit.Toolbar({region:"top",style:"padding:2px;border-bottom:none;width:100%;"});c.addChild(new dijit.form.Button({id:"ExportItemGrid-"+a.bill.id+"Export-button",label:d["export"],iconClass:"icon-16-container icon-16-export",onClick:function(){b.exportBill(a.withRate,a.withQuantity,a.withBillRef)}}));c.addChild(new dijit.ToolbarSeparator);c.addChild(new e({name:"withRate",label:d.rate,
iconClass:"dijitCheckBoxIcon",value:!0,checked:!1,onChange:function(b){a.withRate=b}}));c.addChild(new dijit.ToolbarSeparator);c.addChild(new e({name:"withQuantity",label:d.quantity,iconClass:"dijitCheckBoxIcon",value:!0,checked:!1,onChange:function(b){a.withQuantity=b}}));c.addChild(new dijit.ToolbarSeparator);c.addChild(new e({name:"withBillRef",label:d.billRef,iconClass:"dijitCheckBoxIcon",value:!0,checked:!0,disabled:!0,onChange:function(b){a.withBillRef=b}}));c.addChild(new dijit.ToolbarSeparator);
c.addChild(new e({name:"exportTypeExcel",label:d.excel,iconClass:"dijitCheckBoxIcon",value:!0,disabled:!0,checked:!0}));c.addChild(new e({name:"exportTypeCSV",label:d.csv,iconClass:"dijitCheckBoxIcon",value:!0,disabled:!0,checked:!1}));c.addChild(new e({name:"exportTypeXML",label:d.xml,iconClass:"dijitCheckBoxIcon",value:!0,disabled:!0,checked:!1}));a.addChild(c)}a.addChild(new dijit.layout.ContentPane({style:"width:100%",content:b,region:"center"}));if(c=dijit.byId("ProjectBuilder-item_export_"+
this.bill.id+"-stackContainer")){var f=document.createElement("div"),f=new dojox.layout.ContentPane({title:buildspace.truncateString(a.stackContainerTitle,60),id:a.pageId,executeScripts:!0},f);c.addChild(f);f.set("content",a);c.selectChild(a.pageId)}}});return h("buildspace.apps.ProjectBuilder.ExportItemDialog",dijit.Dialog,{style:"padding:0px;margin:0px;",title:d.exportFromItemBill,selectedItem:null,bill:null,billGrid:null,buildRendering:function(){var a=this.createContent();a.startup();this.content=
a;this.inherited(arguments)},postCreate:function(){m.set(this.containerNode,{padding:"0px",margin:"0px"});this.closeButtonNode.style.display="none";this.inherited(arguments)},_onKey:function(a){a.keyCode==l.ESCAPE&&dojo.stopEvent(a)},onHide:function(){this.destroyRecursive()},createContent:function(){var a=this,b=new dijit.layout.BorderContainer({style:"padding:0px;width:950px;height:500px;",gutters:!1}),c=new dijit.Toolbar({region:"top",style:"outline:none!important;padding:2px;overflow:hidden;"});
c.addChild(new dijit.form.Button({label:d.close,iconClass:"icon-16-container icon-16-close",style:"outline:none!important;",onClick:dojo.hitch(this,"hide")}));var f=new n,g=dojo.data.ItemFileWriteStore({url:"billManagerExportFile/getBillElementList/id/"+a.bill.id}),f=p({stackContainerTitle:d.elements,pageId:"export-page_library-"+this.bill.id,bill:this.bill,gridOpts:{store:g,projectId:this.projectId,dialogWidget:a,structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:f.rowCountCellFormatter},
{name:d.description,field:"description",width:"auto"}],onRowDblClick:function(b){b=this.getItem(b.rowIndex);0<b.id&&null!==b.description[0]&&a.createItemGrid(b)}}}),f=this.makeGridContainer(f,d.elements);b.addChild(c);b.addChild(f);return b},createItemGrid:function(a){var b=n(),c=new dojo.data.ItemFileWriteStore({url:"billManagerExportFile/getBillItemList/id/"+a.id});p({stackContainerTitle:a.description,pageId:"export-page_item-"+this.bill.id+"_"+a.id,bill:this.bill,type:"tree",gridOpts:{store:c,
dialogWidget:this,selectedItem:this.selectedItem,billGrid:this.billGrid,structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:b.rowCountCellFormatter},{name:d.description,field:"description",width:"auto",formatter:b.treeCellFormatter},{name:d.type,field:"type",width:"70px",styles:"text-align:center;",formatter:b.typeCellFormatter},{name:d.unit,field:"uom_id",width:"70px",styles:"text-align:center;",formatter:b.unitIdCellFormatter},{name:d.rate,field:"rate-value",width:"80px",
styles:"text-align:right;",formatter:b.formulaCurrencyCellFormatter}]}})},makeGridContainer:function(a,b){var c=this.bill.id,d=dijit.byId("ProjectBuilder-item_export_"+c+"-stackContainer");d&&dijit.byId("ProjectBuilder-item_export_"+c+"-stackContainer").destroyRecursive();var d=new dijit.layout.StackContainer({style:"width:100%;height:100%;border:0px;",region:"center",id:"ProjectBuilder-item_export_"+c+"-stackContainer"}),g=new dijit.layout.ContentPane({title:b,content:a});d.addChild(g);var g=new dijit.layout.StackController({region:"top",
containerId:"ProjectBuilder-item_export_"+c+"-stackContainer"}),g=new dijit.layout.ContentPane({style:"padding:0px;overflow:hidden;","class":"breadCrumbTrail",region:"top",content:g}),e=new dijit.layout.BorderContainer({style:"padding:0px;width:100%;height:100%;border:0px;",gutters:!1,region:"center"});e.addChild(d);e.addChild(g);dojo.subscribe("ProjectBuilder-item_export_"+c+"-stackContainer-selectChild","",function(a){var b=dijit.byId("ProjectBuilder-item_export_"+c+"-stackContainer");if(b){var d=
b.getChildren();a=dojo.indexOf(d,dijit.byId(a.id));for(a+=1;d.length>a;)b.removeChild(d[a]),d[a].destroyRecursive(!0),a+=1}});return e}})});
