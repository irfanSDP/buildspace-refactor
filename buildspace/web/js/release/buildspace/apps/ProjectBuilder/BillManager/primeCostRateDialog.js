define("buildspace/apps/ProjectBuilder/BillManager/primeCostRateDialog","dojo/_base/declare dojo/_base/lang dojo/when dojo/html dojo/dom dojo/keys dojo/dom-style dijit/form/Form dijit/form/CurrencyTextBox dijit/form/NumberTextBox dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/primeCostRateForm.html dojo/currency dojo/number dojo/i18n!buildspace/nls/ProjectBuilder".split(" "),function(p,z,A,B,C,q,r,D,E,F,t,u,v,w,x,G,d,h){var y=p("buildspace.apps.ProjectBuilder.BillManager.PrimeCostRateForm",
[t,u,v,w],{templateString:x,baseClass:"buildspace-form",style:"outline:none;",itemObj:null,nls:h,billGridStore:null,elementGridStore:null,region:"center",disableEditingMode:!1,constructor:function(a){this.inherited(arguments);this.currencyAbbreviation=buildspace.billCurrencyAbbreviation?buildspace.billCurrencyAbbreviation:buildspace.currencyAbbreviation},postCreate:function(){this.inherited(arguments);var a=this;dojo.connect(this.supplyRateNode,"onKeyUp",function(){a.updateTotal()});dojo.connect(this.wastagePercentageNode,
"onKeyUp",function(){a.updateTotal()});dojo.connect(this.labourForInstallationNode,"onKeyUp",function(){a.updateTotal()});dojo.connect(this.otherCostNode,"onKeyUp",function(){a.updateTotal()});dojo.connect(this.profitPercentageNode,"onKeyUp",function(){a.updateTotal()});this.supplyRateNode.set("readOnly",this.disableEditingMode);this.wastagePercentageNode.set("readOnly",this.disableEditingMode);this.labourForInstallationNode.set("readOnly",this.disableEditingMode);this.otherCostNode.set("readOnly",
this.disableEditingMode);this.profitPercentageNode.set("readOnly",this.disableEditingMode)},startup:function(){this.inherited(arguments);var a=this,b=buildspace.dialog.indeterminateProgressBar({title:h.pleaseWait+"..."});b.show();dojo.xhrGet({url:"billManager/primeCostRateForm",handleAs:"json",content:{id:this.itemObj.id},load:function(c){a.primeCostRateForm.setFormValues(c);b.hide()},error:function(c){b.hide()}})},submit:function(a){var b=buildspace.dialog.indeterminateProgressBar({title:h.savingData+
"..."}),c=this,e=this.billGridStore,f={url:"billManager/primeCostRateUpdate",content:dojo.formToObject(c.primeCostRateForm.id),handleAs:"json",load:function(m){b.hide();var n=m.data;m.success&&(e.fetchItemByIdentity({identity:c.itemObj.id,onItem:function(k){for(var g in n.item)k.hasOwnProperty(g)&&g!=e._getIdentifierAttribute()&&e.setValue(k,g,n.item[g]);e.save()}}),dojo.forEach(n.affected_nodes,function(k){e.fetchItemByIdentity({identity:k.id,onItem:function(g){for(var l in k)g.hasOwnProperty(l)&&
l!=e._getIdentifierAttribute()&&e.setValue(g,l,k[l]);e.save()}})}),a.hide(),c.elementGridStore.grid.store.save(),c.elementGridStore.grid.store.close(),c.elementGridStore.grid.store.fetch(),c.elementGridStore.grid.render())},error:function(m){b.hide();a.hide()}};this.primeCostRateForm.validate()&&(b.show(),dojo.xhrPost(f))},roundValue(a,b){b=Math.pow(10,b||0);return Math.round(a*b)/b},updateTotal:function(){var a=isNaN(this.supplyRateNode.get("value"))?0:this.supplyRateNode.get("value"),b=isNaN(this.wastagePercentageNode.get("value"))?
0:this.wastagePercentageNode.get("value");b=d.parse(a)*(d.parse(b)/100);var c=isNaN(this.labourForInstallationNode.get("value"))?0:this.labourForInstallationNode.get("value"),e=isNaN(this.otherCostNode.get("value"))?0:this.otherCostNode.get("value"),f=isNaN(this.profitPercentageNode.get("value"))?0:this.profitPercentageNode.get("value");f=(d.parse(a)+b+d.parse(c)+d.parse(e))*(d.parse(f)/100);f=this.roundValue(f,2);this.wastageAmountNode.set("value",b);this.profitAmountNode.set("value",f);a=d.parse(a)+
d.parse(b)+d.parse(c)+d.parse(e)+d.parse(f);this.totalNode.set("value",a)}});return p("buildspace.apps.ProjectBuilder.BillManager.PrimeCostRateDialog",dijit.Dialog,{style:"padding:0px;margin:0px;",title:h.primeCostRate,itemObj:null,billGridStore:null,elementGridStore:null,currentBillLockedStatus:!1,disableEditingMode:!1,constructor:function(a){a.currentBillLockedStatus&&(this.disableEditingMode=!0)},buildRendering:function(){var a=this.createContent();a.startup();this.content=a;this.inherited(arguments)},
postCreate:function(){r.set(this.containerNode,{padding:"0px",margin:"0px"});this.closeButtonNode.style.display="none";this.inherited(arguments)},_onKey:function(a){a.keyCode==q.ESCAPE&&dojo.stopEvent(a)},onHide:function(){this.destroyRecursive()},createContent:function(){var a=new dijit.layout.BorderContainer({style:"padding:0px;width:450px;height:300px;",gutters:!1}),b=new y({itemObj:this.itemObj,billGridStore:this.billGridStore,elementGridStore:this.elementGridStore,disableEditingMode:this.disableEditingMode}),
c=new dijit.Toolbar({region:"top",style:"outline:none!important;padding:2px;overflow:hidden;"});c.addChild(new dijit.form.Button({label:h.save,iconClass:"icon-16-container icon-16-save",style:"outline:none!important;",onClick:dojo.hitch(b,"submit",this),disabled:this.disableEditingMode}));c.addChild(new dijit.ToolbarSeparator);c.addChild(new dijit.form.Button({label:h.close,iconClass:"icon-16-container icon-16-close",style:"outline:none!important;",onClick:dojo.hitch(this,"hide")}));a.addChild(c);
a.addChild(b);return a}})});
