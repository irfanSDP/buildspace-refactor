define("buildspace/apps/ProjectBuilder/BillManager/lumpSumPercentDialog","dojo/_base/declare dojo/_base/lang dojo/when dojo/html dojo/dom dojo/keys dojo/dom-style dijit/form/Form dijit/form/CurrencyTextBox dijit/form/NumberTextBox dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/lumpSumPercentForm.html dojo/currency dojo/number dojo/i18n!buildspace/nls/ProjectBuilder".split(" "),function(e,t,u,v,w,h,k,x,y,z,l,m,n,p,q,A,g,d){var r=
e("buildspace.apps.ProjectBuilder.BillManager.LumpSumPercentForm",[l,m,n,p],{templateString:q,baseClass:"buildspace-form",style:"outline:none;",itemObj:null,nls:d,billGridStore:null,elementGridStore:null,region:"center",disableEditingMode:!1,constructor:function(a){this.inherited(arguments);this.currencyAbbreviation=buildspace.billCurrencyAbbreviation?buildspace.billCurrencyAbbreviation:buildspace.currencyAbbreviation},postCreate:function(){this.inherited(arguments);var a=this;dojo.connect(this.rateNode,
"onKeyUp",function(){a.updateTotal()});dojo.connect(this.percentageNode,"onKeyUp",function(){a.updateTotal()});this.rateNode.set("readOnly",this.disableEditingMode);this.percentageNode.set("readOnly",this.disableEditingMode)},startup:function(){this.inherited(arguments);var a=this,c=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});c.show();dojo.xhrGet({url:"billManager/lumpSumPercentageForm",handleAs:"json",content:{id:this.itemObj.id},load:function(b){a.lumpSumPercentageForm.setFormValues(b);
c.hide()},error:function(a){c.hide()}})},submit:function(a){var c=buildspace.dialog.indeterminateProgressBar({title:d.savingData+"..."}),b=this,f=this.billGridStore,e={url:"billManager/lumpSumPercentageUpdate",content:dojo.formToObject(b.lumpSumPercentageForm.id),handleAs:"json",load:function(d){c.hide();var e=d.data;d.success&&(f.fetchItemByIdentity({identity:b.itemObj.id,onItem:function(a){for(var b in e.item)a.hasOwnProperty(b)&&b!=f._getIdentifierAttribute()&&f.setValue(a,b,e.item[b]);f.save()}}),
dojo.forEach(e.affected_nodes,function(a){f.fetchItemByIdentity({identity:a.id,onItem:function(b){for(var c in a)b.hasOwnProperty(c)&&c!=f._getIdentifierAttribute()&&f.setValue(b,c,a[c]);f.save()}})}),a.hide(),b.elementGridStore.grid.store.save(),b.elementGridStore.grid.store.close(),b.elementGridStore.grid.store.fetch(),b.elementGridStore.grid.render())},error:function(b){c.hide();a.hide()}};this.lumpSumPercentageForm.validate()&&(c.show(),dojo.xhrPost(e))},updateTotal:function(){var a=isNaN(this.rateNode.get("value"))?
0:this.rateNode.get("value"),c=isNaN(this.percentageNode.get("value"))?0:this.percentageNode.get("value"),a=g.parse(a)*(g.parse(c)/100);this.amountNode.set("value",a)}});return e("buildspace.apps.ProjectBuilder.BillManager.LumpSumPercentDialog",dijit.Dialog,{style:"padding:0px;margin:0px;",title:d.lumpSumPercentage,itemObj:null,billGridStore:null,elementGridStore:null,currentBillLockedStatus:!1,disableEditingMode:!1,constructor:function(a){a.currentBillLockedStatus&&(this.disableEditingMode=!0)},
buildRendering:function(){var a=this.createContent();a.startup();this.content=a;this.inherited(arguments)},postCreate:function(){k.set(this.containerNode,{padding:"0px",margin:"0px"});this.closeButtonNode.style.display="none";this.inherited(arguments)},_onKey:function(a){a.keyCode==h.ESCAPE&&dojo.stopEvent(a)},onHide:function(){this.destroyRecursive()},createContent:function(){var a=new dijit.layout.BorderContainer({style:"padding:0px;width:400px;height:200px;",gutters:!1}),c=new r({itemObj:this.itemObj,
billGridStore:this.billGridStore,elementGridStore:this.elementGridStore,disableEditingMode:this.disableEditingMode}),b=new dijit.Toolbar({region:"top",style:"outline:none!important;padding:2px;overflow:hidden;"});b.addChild(new dijit.form.Button({label:d.save,iconClass:"icon-16-container icon-16-save",style:"outline:none!important;",onClick:dojo.hitch(c,"submit",this),disabled:this.disableEditingMode}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({label:d.close,iconClass:"icon-16-container icon-16-close",
style:"outline:none!important;",onClick:dojo.hitch(this,"hide")}));a.addChild(b);a.addChild(c);return a}})});
