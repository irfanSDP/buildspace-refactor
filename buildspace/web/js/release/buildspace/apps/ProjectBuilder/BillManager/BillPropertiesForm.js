define("buildspace/apps/ProjectBuilder/BillManager/BillPropertiesForm","dojo/_base/declare dojo/html dojo/dom dojo/dom-construct dojo/keys dojo/dom-style dojo/dom-attr dojo/dom-geometry dijit/form/Form dijit/form/RadioButton dijit/form/Select dijit/form/ValidationTextBox dijit/form/NumberTextBox dijit/form/CurrencyTextBox dojo/number dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/billPropertiesForm.html dojo/text!./templates/columnSettingsForm.html dojo/text!./templates/markupSettingsForm.html dojo/i18n!buildspace/nls/ProjectBuilder ./buildUpFloorAreaDialog".split(" "),
function(q,h,z,A,J,c,x,B,C,K,L,M,N,O,n,r,P,t,u,D,E,F,e,G,Q){var H=q("buildspace.apps.ProjectBuilder.BillManager.MarkupSettingsForm",[r,t,u],{billId:-1,templateString:F,baseClass:"buildspace-form",nls:e,billElementObj:null,markupSettings:null,_csrf_token:0,region:"center",style:"padding:5px;overflow:auto;border:0px;height:146px;",constructor:function(){this.ROUNDING_TYPE_DISABLED=buildspace.constants.ROUNDING_TYPE_DISABLED;this.ROUNDING_TYPE_UPWARD=buildspace.constants.ROUNDING_TYPE_UPWARD;this.ROUNDING_TYPE_DOWNWARD=
buildspace.constants.ROUNDING_TYPE_DOWNWARD;this.ROUNDING_TYPE_NEAREST_WHOLE_NUMBER=buildspace.constants.ROUNDING_TYPE_NEAREST_WHOLE_NUMBER;this.ROUNDING_TYPE_NEAREST_TENTH=buildspace.constants.ROUNDING_TYPE_NEAREST_TENTH;this.ROUNDING_TYPE_DISABLED_TEXT=buildspace.constants.ROUNDING_TYPE_DISABLED_TEXT;this.ROUNDING_TYPE_UPWARD_TEXT=buildspace.constants.ROUNDING_TYPE_UPWARD_TEXT;this.ROUNDING_TYPE_DOWNWARD_TEXT=buildspace.constants.ROUNDING_TYPE_DOWNWARD_TEXT;this.ROUNDING_TYPE_NEAREST_WHOLE_NUMBER_TEXT=
buildspace.constants.ROUNDING_TYPE_NEAREST_WHOLE_NUMBER_TEXT;this.ROUNDING_TYPE_NEAREST_TENTH_TEXT=buildspace.constants.ROUNDING_TYPE_NEAREST_TENTH_TEXT;this.currencyAbbreviation=buildspace.billCurrencyAbbreviation?buildspace.billCurrencyAbbreviation:buildspace.currencyAbbreviation;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.setValues()},setValues:function(){this.elementMarkupEnabledNode.set("checked",this.markupSettings.element_markup_enabled);h.set(this.elementMarkupEnabledViewDivNode,
this.markupSettings.element_markup_enabled?e.yesCapital:e.noCapital);this.itemMarkupEnabledNode.set("checked",this.markupSettings.item_markup_enabled);h.set(this.itemMarkupEnabledViewDivNode,this.markupSettings.item_markup_enabled?e.yesCapital:e.noCapital);this.roundingTypeNode.set("value",this.markupSettings.rounding_type);var a=this.getRoundingTypeText();h.set(this.roundingTypeViewDivNode,a)},editElementMarkup:function(){c.set(this.editElementMarkupButton.domNode,"display","none");c.set(this.saveElementMarkupButton.domNode,
"display","");c.set(this.elementMarkupEnabledViewDivNode,"display","none");c.set(this.elementMarkupEnabledInputDivNode,"display","")},saveElementMarkup:function(){var a=this,b=buildspace.dialog.indeterminateProgressBar({title:e.savingData+"..."}),d=this.billElementObj;b.show().then(function(){dojo.xhrPost({url:"billManager/billMarkupSettingUpdate",content:{bill_id:a.billId,type:"element","bill_markup_setting[element_markup_enabled]":a.elementMarkupEnabledNode.get("checked"),"bill_markup_setting[_csrf_token]":a._csrf_token},
handleAs:"json",load:function(f){if(1==f.success)c.set(a.editElementMarkupButton.domNode,"display",""),c.set(a.saveElementMarkupButton.domNode,"display","none"),c.set(a.elementMarkupEnabledViewDivNode,"display",""),c.set(a.elementMarkupEnabledInputDivNode,"display","none"),a.markupSettings=f.data,a.setValues(),d.reconstructBillContainer();else{f=f.errors;for(var k in f)a["error-"+k]&&h.set(a["error-"+k],f[k])}b.hide()},error:function(f){b.hide()}})})},editItemMarkup:function(){c.set(this.editItemMarkupButton.domNode,
"display","none");c.set(this.saveItemMarkupButton.domNode,"display","");c.set(this.itemMarkupEnabledViewDivNode,"display","none");c.set(this.itemMarkupEnabledInputDivNode,"display","")},saveItemMarkup:function(){var a=this,b=buildspace.dialog.indeterminateProgressBar({title:e.savingData+"..."}),d=this.billElementObj;b.show().then(function(){dojo.xhrPost({url:"billManager/billMarkupSettingUpdate",content:{bill_id:a.billId,type:"item","bill_markup_setting[item_markup_enabled]":a.itemMarkupEnabledNode.get("checked"),
"bill_markup_setting[_csrf_token]":a._csrf_token},handleAs:"json",load:function(f){if(1==f.success)c.set(a.editItemMarkupButton.domNode,"display",""),c.set(a.saveItemMarkupButton.domNode,"display","none"),c.set(a.itemMarkupEnabledViewDivNode,"display",""),c.set(a.itemMarkupEnabledInputDivNode,"display","none"),a.markupSettings=f.data,a.setValues(),d.reconstructBillContainer();else{f=f.errors;for(var k in f)a["error-"+k]&&h.set(a["error-"+k],f[k])}b.hide()},error:function(f){b.hide()}})})},editRoundingType:function(){c.set(this.editRoundingTypeButton.domNode,
"display","none");c.set(this.saveRoundingTypeButton.domNode,"display","");c.set(this.roundingTypeViewDivNode,"display","none");c.set(this.roundingTypeInputDivNode,"display","")},saveRoundingType:function(){var a=this,b=buildspace.dialog.indeterminateProgressBar({title:e.savingData+"..."}),d=this.billElementObj;b.show().then(function(){dojo.xhrPost({url:"billManager/billMarkupSettingUpdate",content:{bill_id:a.billId,type:"rounding","bill_markup_setting[rounding_type]":a.roundingTypeNode.get("value"),
"bill_markup_setting[_csrf_token]":a._csrf_token},handleAs:"json",load:function(f){1==f.success&&(c.set(a.editRoundingTypeButton.domNode,"display",""),c.set(a.saveRoundingTypeButton.domNode,"display","none"),c.set(a.editRoundingTypeButton.domNode,"display",""),c.set(a.saveRoundingTypeButton.domNode,"display","none"),c.set(a.roundingTypeViewDivNode,"display",""),c.set(a.roundingTypeInputDivNode,"display","none"),a.markupSettings=f.data,a.setValues(),d.reconstructBillContainer());b.hide()},error:function(f){b.hide()}})})},
getRoundingTypeText:function(){switch(this.markupSettings.rounding_type.toString()){case buildspace.constants.ROUNDING_TYPE_DISABLED:return buildspace.constants.ROUNDING_TYPE_DISABLED_TEXT;case buildspace.constants.ROUNDING_TYPE_UPWARD:return buildspace.constants.ROUNDING_TYPE_UPWARD_TEXT;case buildspace.constants.ROUNDING_TYPE_DOWNWARD:return buildspace.constants.ROUNDING_TYPE_DOWNWARD_TEXT;case buildspace.constants.ROUNDING_TYPE_NEAREST_WHOLE_NUMBER:return buildspace.constants.ROUNDING_TYPE_NEAREST_WHOLE_NUMBER_TEXT;
case buildspace.constants.ROUNDING_TYPE_NEAREST_TENTH:return buildspace.constants.ROUNDING_TYPE_NEAREST_TENTH_TEXT;default:return null}}}),y=q("buildspace.apps.ProjectBuilder.BillManager.ColumnSettingsForm",[r,t,u],{count:0,billId:-1,columnSettingName:"",columnSettingQuantity:1,columnSettingRemeasurementQuantityEnabled:!1,columnSettingUseOriginalQuantity:!0,columnSettingTotalFloorAreaM2:0,columnSettingTotalFloorAreaFT2:0,columnSettingShowEstimatedTotalCost:!1,columnSettingFloorAreaHasBuildUp:!1,columnSettingFloorAreaUseMetric:!1,
columnSettingFloorAreaDisplayMetric:!1,editMode:!1,locked:!1,columnId:-1,quantity:1,templateString:E,billElementObj:null,_csrf_token:0,postCreate:function(){this.inherited(arguments);this.toggleEditableInputElements(this.editMode);this.setValues()},setValues:function(){this.nameNode.set("value",this.columnSettingName);this.quantityNode.set("value",this.columnSettingQuantity);this.totalFloorAreaM2Node.set("value",this.columnSettingTotalFloorAreaM2);this.totalFloorAreaFT2Node.set("value",this.columnSettingTotalFloorAreaFT2);
this.remeasurementQuantityEnabledNode.set("checked",this.columnSettingRemeasurementQuantityEnabled);this.showEstimatedTotalCostNode.set("checked",this.columnSettingShowEstimatedTotalCost);var a=this.columnSettingShowEstimatedTotalCost?e.yesCapital:e.noCapital;h.set(this.nameViewDivNode,this.columnSettingName);h.set(this.showEstimatedTotalCostViewDivNode,a);h.set(this.quantityViewDivNode,""+this.columnSettingQuantity);this.columnSettingFloorAreaUseMetric?(h.set(this.totalFloorAreaM2ViewDivNode,this.createBuildUpFloorAreaLinks("M2")),
h.set(this.totalFloorAreaFT2ViewDivNode,""+this.columnSettingTotalFloorAreaFT2)):(h.set(this.totalFloorAreaM2ViewDivNode,""+this.columnSettingTotalFloorAreaM2),h.set(this.totalFloorAreaFT2ViewDivNode,this.createBuildUpFloorAreaLinks("FT2")));this.columnSettingUseOriginalQuantity?this.originalQtyNode.set("checked",!0):this.remeasurementQtyNode.set("checked",!0);this.columnSettingFloorAreaDisplayMetric?this.floorAreaDisplayMetricNode.set("checked",!0):this.floorAreaDisplayImperialNode.set("checked",
!0);this.toggleCheckUseMetric();this.editMode?(c.set(this.editButton.domNode,"display","none"),c.set(this.saveButton.domNode,"display","")):(c.set(this.saveButton.domNode,"display","none"),c.set(this.editButton.domNode,"display",""));this.locked&&this.lockColumnSetting()},toggleCheckUseMetric:function(){this.columnSettingFloorAreaUseMetric?this.floorAreaUseMetricNode.set("checked",!0):this.floorAreaUseImperialNode.set("checked",!0)},lockColumnSetting:function(){this.removeColumnButton.set("disabled",
!0)},createBuildUpFloorAreaLinks:function(a){var b=this,d=null;d="M2"==a?this.columnSettingTotalFloorAreaM2:this.columnSettingTotalFloorAreaFT2;return A.create("a",{onclick:function(){(new G({billColumnSettingId:b.columnId,billId:b.billId,columnSettingForm:b})).show();return!1},class:"buildUpLink",href:"#",title:"Open Build Up Floor Area",innerHTML:d})},toggleDeleteButton:function(){var a=this.billId;dojo.xhrGet({url:"billManager/getColumnSettingCount",handleAs:"json",content:{id:a},load:function(b){var d=
dojo.query("#columnSettingTbody-"+a+" > tr");d.hasOwnProperty("0")&&(d=dijit.byId(x.get(d[0],"id")),1<parseInt(b.c)?d.removeColumnButton.set("disabled",!1):d.removeColumnButton.set("disabled",!0))},error:function(b){}})},toggleEditableInputElements:function(a){var b=this,d=function(f){f?(c.set(b.remeasurementQuantityEnabledViewDivNode,"display","none"),c.set(b.showEstimatedTotalCostViewDivNode,"display","none"),b.locked?(c.set(b.nameViewDivNode,"display",""),c.set(b.quantityViewDivNode,"display",
""),c.set(b.nameInputDivNode,"display","none"),c.set(b.quantityInputDivNode,"display","none")):(c.set(b.nameViewDivNode,"display","none"),c.set(b.quantityViewDivNode,"display","none"),c.set(b.nameInputDivNode,"display",""),c.set(b.quantityInputDivNode,"display","")),c.set(b.remeasurementQuantityEnabledInputDivNode,"display",""),c.set(b.showEstimatedTotalCostInputDivNode,"display","")):(c.set(b.nameInputDivNode,"display","none"),c.set(b.quantityInputDivNode,"display","none"),c.set(b.remeasurementQuantityEnabledInputDivNode,
"display","none"),c.set(b.showEstimatedTotalCostInputDivNode,"display","none"),c.set(b.nameViewDivNode,"display",""),c.set(b.quantityViewDivNode,"display",""),c.set(b.remeasurementQuantityEnabledViewDivNode,"display",""),c.set(b.showEstimatedTotalCostViewDivNode,"display",""));b.toggleFloorAreaInputDiv(f)};a?(d(!0),this.toggleFloorAreaDisplayMetric(!0),this.columnSettingRemeasurementQuantityEnabled?this.toggleUseOriginalQuantity(!0):this.toggleUseOriginalQuantity(!1)):(d(!1),h.set(this.remeasurementQuantityEnabledViewDivNode,
this.columnSettingRemeasurementQuantityEnabled?e.yesCapital:e.noCapital),this.toggleUseOriginalQuantity(!1),this.toggleFloorAreaDisplayMetric(!1))},toggleUseOriginalQuantity:function(a){var b=this,d=function(f){f?(c.set(b.originalQtyViewDivNode,"display","none"),c.set(b.remeasurementQtyViewDivNode,"display","none"),c.set(b.originalQtyInputDivNode,"display",""),c.set(b.remeasurementQtyInputDivNode,"display","")):(c.set(b.originalQtyInputDivNode,"display","none"),c.set(b.remeasurementQtyInputDivNode,
"display","none"),c.set(b.originalQtyViewDivNode,"display",""),c.set(b.remeasurementQtyViewDivNode,"display",""))};a?d(!0):(d(!1),d=a=null,this.columnSettingRemeasurementQuantityEnabled&&(a=this.columnSettingUseOriginalQuantity?"icon-16-container icon-16-checkmark2":"icon-16-container icon-16-cross",d=this.columnSettingUseOriginalQuantity?"icon-16-container icon-16-cross":"icon-16-container icon-16-checkmark2"),h.set(this.originalQtyViewDivNode,'<span class="dijitReset dijitInline dijitIcon '+a+'"></span>'),
h.set(this.remeasurementQtyViewDivNode,'<span class="dijitReset dijitInline dijitIcon '+d+'"></span>'))},toggleFloorAreaInputDiv:function(a){a?this.columnSettingFloorAreaUseMetric?(c.set(this.totalFloorAreaM2ViewDivNode,"display","none"),c.set(this.totalFloorAreaM2InputDivNode,"display",""),c.set(this.totalFloorAreaFT2ViewDivNode,"display",""),c.set(this.totalFloorAreaFT2InputDivNode,"display","none"),this.totalFloorAreaFT2Node.set("value",this.columnSettingTotalFloorAreaFT2),h.set(this["error-total_floor_area_ft2"],
"")):(c.set(this.totalFloorAreaFT2ViewDivNode,"display","none"),c.set(this.totalFloorAreaFT2InputDivNode,"display",""),c.set(this.totalFloorAreaM2ViewDivNode,"display",""),c.set(this.totalFloorAreaM2InputDivNode,"display","none"),this.totalFloorAreaM2Node.set("value",this.columnSettingTotalFloorAreaM2),h.set(this["error-total_floor_area_m2"],"")):(c.set(this.totalFloorAreaM2InputDivNode,"display","none"),c.set(this.totalFloorAreaM2ViewDivNode,"display",""),c.set(this.totalFloorAreaFT2InputDivNode,
"display","none"),c.set(this.totalFloorAreaFT2ViewDivNode,"display",""))},toggleFloorAreaDisplayMetric:function(a){var b=this,d=function(f){f?(c.set(b.floorAreaDisplayMetricViewDivNode,"display","none"),c.set(b.floorAreaDisplayImperialViewDivNode,"display","none"),c.set(b.floorAreaDisplayMetricInputDivNode,"display",""),c.set(b.floorAreaDisplayImperialInputDivNode,"display","")):(c.set(b.floorAreaDisplayMetricInputDivNode,"display","none"),c.set(b.floorAreaDisplayImperialInputDivNode,"display","none"),
c.set(b.floorAreaDisplayMetricViewDivNode,"display",""),c.set(b.floorAreaDisplayImperialViewDivNode,"display",""))};a?d(!0):(d(!1),a=this.columnSettingFloorAreaDisplayMetric?"icon-16-container icon-16-cross":"icon-16-container icon-16-checkmark2",h.set(this.floorAreaDisplayMetricViewDivNode,'<span class="dijitReset dijitInline dijitIcon '+(this.columnSettingFloorAreaDisplayMetric?"icon-16-container icon-16-checkmark2":"icon-16-container icon-16-cross")+'"></span>'),h.set(this.floorAreaDisplayImperialViewDivNode,
'<span class="dijitReset dijitInline dijitIcon '+a+'"></span>'))},doEnableRemeasurementQuantity:function(){var a=this;this.remeasurementQuantityEnabledNode.get("checked")?a.toggleUseOriginalQuantity(!0):this.columnSettingRemeasurementQuantityEnabled?buildspace.dialog.confirm(e.confirmation,"<div>"+e.detachAllQty2BuildUpAndLink+"</div>",60,280,function(){a.columnSettingRemeasurementQuantityEnabled=!1;a.toggleUseOriginalQuantity(!1)},function(){a.remeasurementQuantityEnabledNode.set("checked",!0);a.toggleUseOriginalQuantity(!0)}):
a.toggleUseOriginalQuantity(!1)},edit:function(){c.set(this.editButton.domNode,"display","none");c.set(this.saveButton.domNode,"display","");this.editMode=!0;this.toggleEditableInputElements(!0)},checkManualFloorArea:function(){var a=n.format(this.totalFloorAreaM2Node.get("value"),{places:2}),b=n.format(this.totalFloorAreaFT2Node.get("value"),{places:2});if(0<this.columnId&&this.columnSettingFloorAreaHasBuildUp&&(a!=this.columnSettingTotalFloorAreaM2||b!=this.columnSettingTotalFloorAreaFT2))return!0},
save:function(){var a=function(){this.columnSettingFloorAreaHasBuildUp=!1;this.doSave()},b=function(){this.totalFloorAreaM2Node.set("value",this.columnSettingTotalFloorAreaM2);this.totalFloorAreaFT2Node.set("value",this.columnSettingTotalFloorAreaFT2)};this.checkManualFloorArea()?buildspace.dialog.confirm(e.confirmation,"<div>"+e.detachAllBuildUpAndLink+"</div>",60,280,a,b):this.doSave()},doSave:function(){var a=this,b=buildspace.dialog.indeterminateProgressBar({title:e.savingData+"..."}),d=this.billElementObj,
f=this.originalQtyNode.get("checked")?!0:!1,k=this.floorAreaDisplayMetricNode.get("checked")?!0:!1,l=this.floorAreaUseMetricNode.get("checked")?!0:!1,p={id:this.columnId,"bill_column_setting[project_structure_id]":this.billId,"bill_column_setting[name]":this.nameNode.get("value"),"bill_column_setting[quantity]":this.quantityNode.get("value"),"bill_column_setting[total_floor_area_m2]":this.totalFloorAreaM2Node.get("value"),"bill_column_setting[total_floor_area_ft2]":this.totalFloorAreaFT2Node.get("value"),
"bill_column_setting[floor_area_display_metric]":k,"bill_column_setting[floor_area_use_metric]":l,"bill_column_setting[floor_area_has_build_up]":this.columnSettingFloorAreaHasBuildUp,"bill_column_setting[remeasurement_quantity_enabled]":this.remeasurementQuantityEnabledNode.get("checked"),"bill_column_setting[show_estimated_total_cost]":this.showEstimatedTotalCostNode.get("checked"),"bill_column_setting[use_original_quantity]":f,"bill_column_setting[_csrf_token]":this._csrf_token};b.show().then(function(){dojo.xhrPost({url:"billManager/billColumnSettingUpdate",
content:p,handleAs:"json",load:function(g){h.set(a["error-name"],"");h.set(a["error-quantity"],"");h.set(a["error-total_floor_area_m2"],"");h.set(a["error-total_floor_area_ft2"],"");if(1==g.success)c.set(a.saveButton.domNode,"display","none"),c.set(a.editButton.domNode,"display",""),a.editMode=!1,a.columnId=g.item.id,a.columnSettingName=g.item.name,a.columnSettingQuantity=g.item.quantity,a.columnSettingRemeasurementQuantityEnabled=g.item.remeasurement_quantity_enabled,a.columnSettingUseOriginalQuantity=
g.item.use_original_quantity,a.columnSettingTotalFloorAreaFT2=n.format(g.item.total_floor_area_ft2,{places:2}),a.columnSettingTotalFloorAreaM2=n.format(g.item.total_floor_area_m2,{places:2}),a.columnSettingFloorAreaHasBuildUp=g.item.floor_area_has_build_up,a.columnSettingFloorAreaUseMetric=g.item.floor_area_use_metric,a.columnSettingFloorAreaDisplayMetric=g.item.floor_area_display_metric,a.columnSettingShowEstimatedTotalCost=g.item.show_estimated_total_cost,a.setValues(),a.toggleEditableInputElements(!1),
a.toggleDeleteButton(),d.reconstructBillContainer();else{g=g.errors;for(var m in g)a["error-"+m]&&h.set(a["error-"+m],g[m])}b.hide()},error:function(g){b.hide()}})})},refreshColumn:function(){var a=this,b=buildspace.dialog.indeterminateProgressBar({title:e.savingData+"..."}),d=this.billElementObj;b.show().then(function(){dojo.xhrPost({url:"billManager/getBillColumnSetting",content:{id:a.columnId},handleAs:"json",load:function(f){c.set(a.saveButton.domNode,"display","none");c.set(a.editButton.domNode,
"display","");a.editMode=!1;a.columnId=f.item.id;a.columnSettingName=f.item.name;a.columnSettingQuantity=f.item.quantity;a.columnSettingRemeasurementQuantityEnabled=f.item.remeasurement_quantity_enabled;a.columnSettingUseOriginalQuantity=f.item.use_original_quantity;a.columnSettingTotalFloorAreaFT2=n.format(f.item.total_floor_area_ft2,{places:2});a.columnSettingTotalFloorAreaM2=n.format(f.item.total_floor_area_m2,{places:2});a.columnSettingFloorAreaHasBuildUp=f.item.floor_area_has_build_up;a.columnSettingFloorAreaUseMetric=
f.item.floor_area_use_metric;a.columnSettingFloorAreaDisplayMetric=f.item.floor_area_display_metric;a.columnSettingShowEstimatedTotalCost=f.item.show_estimated_total_cost;a.setValues();a.toggleEditableInputElements(!1);d.reconstructBillContainer();b.hide()},error:function(f){b.hide()}})})},doChangeFloorAreaUseMetric:function(a){if(a&&this.floorAreaUseMetricNode.get("checked")!=this.columnSettingFloorAreaUseMetric){var b=this;a=function(){b.toggleCheckUseMetric()};var d=function(){b.columnSettingFloorAreaUseMetric=
b.floorAreaUseMetricNode.get("checked")?!0:!1},f=function(){b.columnSettingFloorAreaHasBuildUp=!1;d();this.editMode?b.toggleFloorAreaInputDiv(!0):b.doSave()};b.columnSettingFloorAreaHasBuildUp?buildspace.dialog.confirm(e.confirmation,"<div>"+e.detachAllBuildUpAndLink+"</div>",60,280,f,a):this.editMode?(d(),b.toggleFloorAreaInputDiv(!0)):b.doSave()}},removeColumn:function(){var a=this,b=buildspace.dialog.indeterminateProgressBar({title:e.deleting+". "+e.pleaseWait+"..."});if(null!==this.columnId&&
0<this.columnId){var d={id:this.columnId},f=this.billElementObj;new buildspace.dialog.confirm(e.deleteBillTypeDialogBoxTitle,e.deleteBillTypeDialogBoxMsg,80,320,function(){b.show().then(function(){dojo.xhrPost({url:"billManager/billColumnSettingDelete",content:d,handleAs:"json",load:function(k){!0===k.success&&(a.destroy(),a.onDelete(),a.toggleDeleteButton(),f.reconstructBillContainer());b.hide()},error:function(k){b.hide()}})})},function(){})}else this.destroy(),this.onDelete()},onDelete:function(){}}),
I=q("buildspace.apps.ProjectBuilder.BillManager.BillPropertiesMainInfoForm",[C,r,t,u,dojox.form.manager._Mixin,dojox.form.manager._NodeMixin,dojox.form.manager._ValueMixin,dojox.form.manager._DisplayMixin],{templateString:D,baseClass:"buildspace-form",region:"top",billId:-1,projectBreakdownGrid:null,tenderAlternativeBillGridId:null,formData:null,buildUpRateRoundingType:null,buildUpQuantityRoundingType:null,unitTypeText:null,description:null,nls:e,style:"padding:5px;overflow:auto;border:0px;height:140px;",
constructor:function(){var a=this.BillTypeConstantArray=[];this.ROUNDING_TYPE_DISABLED=buildspace.constants.ROUNDING_TYPE_DISABLED;this.ROUNDING_TYPE_UPWARD=buildspace.constants.ROUNDING_TYPE_UPWARD;this.ROUNDING_TYPE_DOWNWARD=buildspace.constants.ROUNDING_TYPE_DOWNWARD;this.ROUNDING_TYPE_NEAREST_WHOLE_NUMBER=buildspace.constants.ROUNDING_TYPE_NEAREST_WHOLE_NUMBER;this.ROUNDING_TYPE_NEAREST_TENTH=buildspace.constants.ROUNDING_TYPE_NEAREST_TENTH;this.ROUNDING_TYPE_DISABLED_TEXT=buildspace.constants.ROUNDING_TYPE_DISABLED_TEXT;
this.ROUNDING_TYPE_UPWARD_TEXT=buildspace.constants.ROUNDING_TYPE_UPWARD_TEXT;this.ROUNDING_TYPE_DOWNWARD_TEXT=buildspace.constants.ROUNDING_TYPE_DOWNWARD_TEXT;this.ROUNDING_TYPE_NEAREST_WHOLE_NUMBER_TEXT=buildspace.constants.ROUNDING_TYPE_NEAREST_WHOLE_NUMBER_TEXT;this.ROUNDING_TYPE_NEAREST_TENTH_TEXT=buildspace.constants.ROUNDING_TYPE_NEAREST_TENTH_TEXT;a[buildspace.apps.ProjectBuilder.ProjectStructureConstants.BILL_TYPE_STANDARD]=buildspace.apps.ProjectBuilder.ProjectStructureConstants.BILL_TYPE_STANDARD_TEXT;
a[buildspace.apps.ProjectBuilder.ProjectStructureConstants.BILL_TYPE_PRELIMINARY]=buildspace.apps.ProjectBuilder.ProjectStructureConstants.BILL_TYPE_PRELIMINARY_TEXT;a[buildspace.apps.ProjectBuilder.ProjectStructureConstants.BILL_TYPE_PROVISIONAL]=buildspace.apps.ProjectBuilder.ProjectStructureConstants.BILL_TYPE_PROVISIONAL_TEXT;a[buildspace.apps.ProjectBuilder.ProjectStructureConstants.BILL_TYPE_PRIMECOST]=buildspace.apps.ProjectBuilder.ProjectStructureConstants.BILL_TYPE_PRIMECOST_TEXT;this.currencyAbbreviation=
buildspace.billCurrencyAbbreviation?buildspace.billCurrencyAbbreviation:buildspace.currencyAbbreviation;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);h.set(this.unitTypeTextNode,this.unitTypeText);h.set(this.billTypeTextNode,this.BillTypeConstantArray[this.formData.billType])},disableForm:function(){this.buildUpQuantityRoundingTypeNode.set("disabled",!0);this.titleNode.set("disabled",!0);this.descriptionNode.set("disabled",!0)},submit:function(){var a=buildspace.dialog.indeterminateProgressBar({title:e.savingData+
"..."}),b=this.billElementObj;if(this.validate()){var d=this,f=dojo.formToObject(this.id);a.show().then(function(){dojo.xhrPost({url:"billManager/billPropertiesUpdate",content:f,handleAs:"json",load:function(k){dojo.query('[id^="error-bill_setting_"]').forEach(function(g){g.innerHTML=""});if(k.success)d.projectBreakdownGrid.store.fetchItemByIdentity({identity:k.item.id,onItem:function(g){if(g){for(var m in k.item)g.hasOwnProperty(m)&&m!=d.projectBreakdownGrid.store._getIdentifierAttribute()&&d.projectBreakdownGrid.store.setValue(g,
m,k.item[m]);d.projectBreakdownGrid.store.save();m=dijit.byId(g.id+"-form_"+g.type).getParent();var v=m.getChildren(),w;for(w in v)if(v[w].id==g.id+"-form_"+g.type){v[w].set("title",buildspace.truncateString(g.title,35)+" :: "+buildspace.apps.ProjectBuilder.getBillTypeText(g.bill_type));m.resize();break}d.projectBreakdownGrid.reload();d.tenderAlternativeBillGridId&&(tenderAlternativeGrid=dijit.byId(d.tenderAlternativeBillGridId))&&tenderAlternativeGrid.grid.reload();b.reconstructBillContainer()}}});
else for(var l in k.errors){var p=k.errors[l];h.set(z.byId("error-bill_setting_"+l),p)}a.hide()},error:function(k){a.hide()}})})}},startup:function(){this.inherited(arguments);this.setFormValues(this.formData);this.projectBreakdownGrid.rootProject.status_id!=buildspace.constants.STATUS_PRETENDER&&this.disableForm()}});return q("buildspace.apps.ProjectBuilder.BillManager.BillPropertiesForm",dijit.layout.BorderContainer,{style:"padding:0px;width:100%;margin:0px;border:0px;height:100%;overflow:auto;",
gutters:!1,region:"center",billId:-1,projectBreakdownGrid:null,tenderAlternativeBillGridId:null,billElementObj:null,nls:e,locked:!1,totalColumnSettings:0,columnSettings_csrf_token:null,postCreate:function(){this.inherited(arguments);var a=this,b=buildspace.dialog.indeterminateProgressBar({title:e.pleaseWait+"..."});b.show().then(function(){dojo.xhrGet({url:"billManager/billPropertiesForm",handleAs:"json",content:{id:a.billId},load:function(d){a.markupSettings_csrf_token=d.markup_settings_csrf_token;
a.columnSettings_csrf_token=d.column_settings_csrf_token;a.renderBillPropertiesInfoForm(d.bill_setting);a.renderMarkupSettings(d.markup_settings);a.renderBillColumnSettings(d.column_settings);a.resize();a.toggleDeleteButtonAfterStartup();b.hide()},error:function(d){b.hide()}})})},renderBillPropertiesInfoForm:function(a){a=this.mainForm=new I({billId:this.billId,projectBreakdownGrid:this.projectBreakdownGrid,tenderAlternativeBillGridId:this.tenderAlternativeBillGridId,unitTypeText:a.unit_type_text,
billElementObj:this.billElementObj,formData:a});this.addChild(a)},renderMarkupSettings:function(a){this.addChild(new H({billId:this.billId,billElementObj:this.billElementObj,markupSettings:a,_csrf_token:this.markupSettings_csrf_token}))},renderBillColumnSettings:function(a){var b=this,d=this.billId,f=this.billElementObj,k=this.columnSettings_csrf_token;q("ColumnSettingTableWidget",[r,t,u],{style:"padding:5px;overflow:auto;border:0px;overflow:auto;",region:"bottom",locked:b.locked,baseClass:"buildspace-form",
totalColumnSettings:0,columnSettings:a,templateString:"<div><fieldset><legend>"+e.columnSettings+'</legend><div data-dojo-type="dijit/form/Button" id="addColumnButton-'+d+'" data-dojo-attach-event="onClick:addColumn" data-dojo-attach-point="addColumnButton" data-dojo-props="iconClass:\'icon-16-container icon-16-add\'">'+e.addType+'</div><div style="height:2px;">&nbsp;</div><table class="buildspace-table"><thead><tr class="gridHeader"><th class="gridCell" style="text-align:center;" rowspan="2">No.</th><th class="gridCell" rowspan="2">'+
e.name+'</th><th class="gridCell" style="text-align: center;" rowspan="2">'+e.totalUnit+'</th><th class="gridCell" style="text-align: center;" rowspan="2">'+e.enable+" "+e.qty+' (2)</th><th class="gridCell" style="text-align: center;" rowspan="2">'+e.use+" "+e.qty+'</th><th class="gridCell" style="text-align: center;" rowspan="2">'+e.use+" "+e.qty+' (2)</th><th class="gridCell" style="text-align: center;" colspan="7">'+e.gross+" "+e.floorArea+'</th><th class="gridCell" style="text-align: center;" rowspan="2">'+
e.action+'</th><th class="gridCell" style="text-align: center;" rowspan="2">'+e.delete+'</th></tr><tr class="gridHeaderBottom"><th style="text-align:center;" colspan="2">'+e.metreSquare+'</th><th style="text-align:center;" colspan="2">'+e.squareFeet+'</th><th style="text-align:center;">'+e.show+" "+e.metreSquare+'</th><th style="text-align:center;">'+e.show+" "+e.squareFeet+'</th><th style="text-align:center;">'+e.show+" "+e.estimation+'</th></tr></thead><tbody id="columnSettingTbody-'+d+'" data-dojo-attach-point="columnSettingsTBody"></tbody></table></fieldset></div>',
postCreate:function(){this.inherited(arguments);var l=this,p=0;dojo.forEach(this.columnSettings,function(g,m){l.updateTotalColumnSettings(!0);p=l.totalColumnSettings;g=new y({count:p,columnSettingName:g.name,columnSettingQuantity:g.quantity,columnSettingRemeasurementQuantityEnabled:g.remeasurement_quantity_enabled,columnSettingUseOriginalQuantity:g.use_original_quantity,columnSettingTotalFloorAreaM2:n.format(g.total_floor_area_m2,{places:2}),columnSettingTotalFloorAreaFT2:n.format(g.total_floor_area_ft2,
{places:2}),columnSettingFloorAreaHasBuildUp:g.floor_area_has_build_up,columnSettingFloorAreaUseMetric:g.floor_area_use_metric,columnSettingFloorAreaDisplayMetric:g.floor_area_display_metric,columnSettingShowEstimatedTotalCost:g.show_estimated_total_cost,columnId:g.id,billId:d,locked:l.locked,billElementObj:f,_csrf_token:k,onDelete:function(){l.updateTotalColumnSettings(!1);l.addColumnButton.set("disabled",!1);b.resize()}});g.placeAt(l.columnSettingsTBody);dojo.parser.parse(g.domNode)},l)},updateTotalColumnSettings:function(l){this.totalColumnSettings=
l?this.totalColumnSettings+1:this.totalColumnSettings-1;5<=this.totalColumnSettings||this.locked?this.addColumnButton.set("disabled",!0):this.addColumnButton.set("disabled",!1)},addColumn:function(){this.updateTotalColumnSettings(!0);var l=new y({billId:d,billElementObj:f,locked:this.locked,_csrf_token:k,count:this.totalColumnSettings,editMode:!0,onDelete:dojo.hitch(this,"updateTotalColumnSettings",!1)});l.placeAt(this.columnSettingsTBody);dojo.parser.parse(l.domNode);l.toggleDeleteButton();b.resize()}});
this.columnSettingsTable=new ColumnSettingTableWidget;this.addChild(this.columnSettingsTable)},resize:function(){var a=B.getContentBox(this.domNode).h-265;this.columnSettingsTable&&c.set(this.columnSettingsTable.domNode,"height",a+"px");this.inherited(arguments)},toggleDeleteButtonAfterStartup:function(){var a=this.billId;dojo.xhrGet({url:"billManager/getColumnSettingCount",handleAs:"json",content:{id:a},load:function(b){var d=dojo.query("#columnSettingTbody-"+a+" > tr");d.hasOwnProperty("0")&&(d=
dijit.byId(x.get(d[0],"id")),1<parseInt(b.c)?d.removeColumnButton.set("disabled",!1):d.removeColumnButton.set("disabled",!0))},error:function(b){}})}})});
