define("buildspace/apps/ProjectBuilder/ProjectBreakdown","dojo/_base/declare dojo/_base/lang dojox/grid/EnhancedGrid dijit/PopupMenuItem dijit/MenuSeparator dojo/_base/event dojo/html dojo/keys dojo/_base/connect dijit/TooltipDialog dijit/popup buildspace/widget/grid/cells/Formatter ./RecalculateDialog ./exportItemDialog ./exportSupplyOfMaterialItemDialog ./ExportScheduleOfRateBillDialog ./fileImportDialog ./SupplyOfMaterialFileImportDialog ./ScheduleOfRateBillFileImportDialog ./importBackupDialog ./ExportProjectBackupDialog ./EmptyGrandTotalQtyDialog ./LevelForm ./BillForm ./SupplyOfMaterialForm ./ScheduleOfRateBillForm buildspace/apps/TenderAlternative/TenderAlternativeFormDialog dijit/form/DropDownButton dijit/DropDownMenu dijit/MenuItem buildspace/apps/PageGenerator/GeneratorDialog dojo/i18n!buildspace/nls/ProjectBuilder".split(" "),
function(A,B,F,ca,da,G,H,I,u,J,v,K,L,M,N,O,w,C,D,P,Q,R,S,T,U,V,W,x,y,q,X,f){var Z=A("buildspace.apps.ProjectBuilder.ProjectBreakdownGrid",F,{rootProject:null,workArea:null,style:"border:none;",region:"center",keepSelection:!0,rowSelector:"0px",currencySetting:buildspace.currencyAbbreviation,aspectHandles:[],canSort:function(){return!1},postCreate:function(){var a=this;this.inherited(arguments);var b=null,e=["AddBill","AddLevel"],l=["AddBill","AddLevel","BackupDropDown","ImportBackup","ImportDropDown"],
c="AddBill AddLevel BackupDropDown ImportBackup ExportBackup Delete Indent Outdent ExportItemFromBill ImportDropDown ImportBill ImportBuildsoft ImportExcel".split(" "),d="AddBill AddLevel BackupDropDown ImportBackup Delete Indent Outdent ImportDropDown".split(" "),h="AddBill AddLevel Delete Indent Outdent ImportDropDown ImportBill ImportExcel ExportItemFromBill".split(" "),n="AddBill AddLevel Delete Indent Outdent ImportDropDown ImportBill ImportExcel ExportItemFromBill".split(" ");this.on("RowContextMenu",
function(g){a.selection.clear();a.selection.setSelected(g.rowIndex,!0);var k=this.getItem(g.rowIndex);if(a.rootProject.status_id==buildspace.constants.STATUS_PRETENDER){var m=e.slice();if(k&&!isNaN(parseInt(String(k.id))))switch(parseInt(String(k.type))){case buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_ROOT:m=l.slice();break;case buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_BILL:m=c.slice();break;case buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SUPPLY_OF_MATERIAL_BILL:m=
h.slice();break;case buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SCHEDULE_OF_RATE_BILL:m=n.slice();break;case buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_LEVEL:m=d.slice()}this.disableToolbarButtons(!0,m);a.contextMenu(g)}else!k||isNaN(parseInt(String(k.id)))||parseInt(String(k.type))!=buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_BILL&&k.type[0]!=buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SUPPLY_OF_MATERIAL_BILL&&k.type[0]!=buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SCHEDULE_OF_RATE_BILL?
this.disableToolbarButtons(!0,[]):this.disableButtonsAfterPublish()},!0);this.on("RowClick",function(g){if(g.cell){var k=g.cell.field;g=this.getItem(g.rowIndex);if(a.rootProject.status_id==buildspace.constants.STATUS_PRETENDER){var m=e.slice();if(g&&!isNaN(parseInt(String(g.id))))switch(parseInt(String(g.type))){case buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_ROOT:m=l.slice();break;case buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_BILL:m=c.slice();break;case buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SUPPLY_OF_MATERIAL_BILL:m=
h.slice();break;case buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SCHEDULE_OF_RATE_BILL:m=n.slice();break;case buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_LEVEL:m=d.slice()}g&&!isNaN(parseInt(String(g.id)))&&parseInt(String(g.type))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_BILL&&buildspace.apps.ProjectBuilder.isRecalculateBillStatus(parseInt(String(g.bill_status)))&&("recalculate"==k&&(new L({title:f.recalculate+" "+buildspace.truncateString(g.title,
65),rootProject:a.rootProject,bill:g,projectBreakDownGrid:a})).show(),["BackupDropDown","ExportItemFromBill"].forEach(function(p){p=m.indexOf(p);-1<p&&m.splice(p,1)}));this.disableToolbarButtons(!0,m)}else k=[buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_BILL,buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SUPPLY_OF_MATERIAL_BILL,buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SCHEDULE_OF_RATE_BILL],g&&!isNaN(parseInt(String(g.id)))&&0<=k.indexOf(parseInt(String(g.type)))?
this.disableButtonsAfterPublish():this.disableToolbarButtons(!0,[])}});this._connects.push(u.connect(this,"onCellMouseOver",function(g){var k=g.cell.field,m=this.getItem(g.rowIndex);m&&m.hasOwnProperty("tender_alternative_count")&&"tender_alternative_count"==k&&"undefined"!==typeof m.tender_alternative_count&&parseInt(String(m.tender_alternative_count))&&null===b&&dojo.xhrGet({url:"getTenderAlternativeInfoByBill/"+String(m.id),handleAs:"json",sync:!0,preventCache:!0}).then(function(p){if(p.length){for(var t=
'<table class="buildspace-table"><thead><tr><th class="gridCell" style="text-align:center;padding:2px;">'+f.title+'</th><th class="gridCell" style="text-align:center;padding:2px;">'+f.revision+"</th></tr><tbody>",r=0;r<p.length;r++)t+='<tr><td class="gridCell" style="text-align:center;">'+p[r].title+'</td><td class="gridCell" style="text-align:center;padding-left:4px;padding-right:4px;">'+p[r].revision+"</td></tr>";b=new J({content:t+"</tbody></table>",onMouseLeave:function(){v.close(b)}});v.open({popup:b,
around:g.cellNode})}})}));this._connects.push(u.connect(this,"onCellMouseOut",function(){null!==b&&(v.close(b),b=null)}));this._connects.push(u.connect(this,"onStartEdit",function(){null!==b&&(v.close(b),b=null)}))},dodblclick:function(a){this.onRowDblClick(a)},onRowDblClick:function(a){this.inherited(arguments);var b=this.getItem(a.rowIndex);switch(parseInt(String(b.type))){case buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_BILL:parseInt(String(b.bill_status))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.BILL_STATUS_OPEN&&
this.workArea.initTab(b,{billId:parseInt(String(b.id)),billType:parseInt(String(b.bill_type)),billLayoutSettingId:b.billLayoutSettingId,projectBreakdownGrid:this,rootProject:this.rootProject});break;case buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SUPPLY_OF_MATERIAL_BILL:this.workArea.initTab(b,{billId:parseInt(String(b.id)),somBillLayoutSettingId:b.somBillLayoutSettingId,projectBreakdownGrid:this,rootProject:this.rootProject});break;case buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SCHEDULE_OF_RATE_BILL:this.workArea.initTab(b,
{billId:parseInt(String(b.id)),sorBillLayoutSettingId:b.sorBillLayoutSettingId,projectBreakdownGrid:this,rootProject:this.rootProject});break;case buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_LEVEL:parseInt(String(this.rootProject.status_id))==buildspace.constants.STATUS_PRETENDER&&this.openLevelForm(a.rowIndex,"edit")}},contextMenu:function(a){var b=this.rowCtxMenu=new dijit.Menu;this.contextMenuItems(a);var e={target:a.target,coords:a.keyCode!==I.F10&&"pageX"in a?{x:a.pageX,y:a.pageY}:
null},l=this.getItem(a.rowIndex);b&&l&&(this.selection.isSelected(a.rowIndex)||a.rowNode&&H.hasClass(a.rowNode,"dojoxGridRowbar"))&&(b._openMyself(e),G.stop(a))},contextMenuItems:function(a){var b=this,e=this.getItem(a.rowIndex),l=new dijit.PopupMenuItem({label:f.addBill,iconClass:"icon-16-container icon-16-add",popup:new dijit.Menu});l.popup.addChild(new dijit.MenuItem({label:f.normalBill,onClick:dojo.hitch(this,"openBillForm",a.rowIndex)}));l.popup.addChild(new dijit.MenuItem({label:f.supplyOfMaterialBill,
onClick:dojo.hitch(this,"openSupplyOfMaterialForm",a.rowIndex)}));l.popup.addChild(new dijit.MenuItem({label:f.scheduleOfRateBill,onClick:dojo.hitch(this,"openScheduleOfRateBillForm",a.rowIndex)}));this.rowCtxMenu.addChild(l);this.rowCtxMenu.addChild(new dijit.MenuItem({label:f.addLevel,iconClass:"icon-16-container icon-16-add",onClick:dojo.hitch(this,"openLevelForm",a.rowIndex,"add")}));!e||isNaN(parseInt(String(e.id)))||parseInt(String(e.type))!=buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_BILL&&
parseInt(String(e.type))!=buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SUPPLY_OF_MATERIAL_BILL&&parseInt(String(e.type))!=buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SCHEDULE_OF_RATE_BILL&&parseInt(String(e.type))!=buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_LEVEL||(parseInt(String(e.type))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_BILL?this.rowCtxMenu.addChild(new dijit.MenuItem({label:f.editBill,iconClass:"icon-16-container icon-16-edit",
disabled:parseInt(String(e.bill_status))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.BILL_STATUS_OPEN?!1:!0,onClick:function(c){parseInt(String(e.bill_status))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.BILL_STATUS_OPEN&&b.workArea.initTab(e,{billId:parseInt(String(e.id)),billType:parseInt(String(e.bill_type)),billLayoutSettingId:e.billLayoutSettingId,projectBreakdownGrid:b,rootProject:b.rootProject})}})):parseInt(String(e.type))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_LEVEL?
this.rowCtxMenu.addChild(new dijit.MenuItem({label:f.editLevel,iconClass:"icon-16-container icon-16-edit",onClick:dojo.hitch(this,"openLevelForm",a.rowIndex,"edit")})):parseInt(String(e.type))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SUPPLY_OF_MATERIAL_BILL?this.rowCtxMenu.addChild(new dijit.MenuItem({label:f.editBill,iconClass:"icon-16-container icon-16-edit",onClick:function(c){b.workArea.initTab(e,{billId:parseInt(String(e.id)),somBillLayoutSettingId:e.somBillLayoutSettingId,
projectBreakdownGrid:b,rootProject:b.rootProject})}})):parseInt(String(e.type))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SCHEDULE_OF_RATE_BILL&&this.rowCtxMenu.addChild(new dijit.MenuItem({label:f.editBill,iconClass:"icon-16-container icon-16-edit",onClick:function(c){b.workArea.initTab(e,{billId:parseInt(String(e.id)),projectBreakdownGrid:b,rootProject:b.rootProject})}})),this.rowCtxMenu.addChild(new dijit.MenuItem({label:f.indent,iconClass:"icon-16-container icon-16-indent",
onClick:dojo.hitch(b,"indentOutdent",a.rowIndex,"Indent")})),this.rowCtxMenu.addChild(new dijit.MenuItem({label:f.outdent,iconClass:"icon-16-container icon-16-outdent",onClick:dojo.hitch(this,"indentOutdent",a.rowIndex,"Outdent")})),this.rowCtxMenu.addChild(new dijit.MenuItem({label:f.cut,iconClass:"icon-16-container icon-16-cut",onClick:dojo.hitch(this,"cutItem")})));this.rowCtxMenu.addChild(new dijit.MenuItem({label:f.paste,iconClass:"icon-16-container icon-16-paste",onClick:dojo.hitch(this,"pasteItem",
a.rowIndex),disabled:this.selectedItem?!1:!0}));0<parseInt(String(e.id))&&(parseInt(String(e.type))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_BILL||parseInt(String(e.type))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SUPPLY_OF_MATERIAL_BILL||parseInt(String(e.type))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SCHEDULE_OF_RATE_BILL||parseInt(String(e.type))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_LEVEL)&&this.rowCtxMenu.addChild(new dijit.MenuItem({label:f.delete,
iconClass:"icon-16-container icon-16-delete",onClick:dojo.hitch(this,"deleteRow",e)}))},openLevelForm:function(a,b){var e=this.getItem(a);String(e.id)==buildspace.constants.GRID_LAST_ROW&&(e=this.getItem(a-1));a={title:"edit"==b?f.editLevel:f.addLevel,projectBreakdownGrid:this};"edit"==b?B.mixin(a,{levelId:e.id}):B.mixin(a,{parentId:e.id});b=S(a);b.startup();b.show()},openBillForm:function(a){var b=this.getItem(a);String(b.id)==buildspace.constants.GRID_LAST_ROW&&(b=this.getItem(a-1));a=T({title:f.addBill,
projectBreakdownGrid:this,parentId:parseInt(String(b.id))});a.startup();a.show()},openSupplyOfMaterialForm:function(a){var b=this.getItem(a);String(b.id)==buildspace.constants.GRID_LAST_ROW&&(b=this.getItem(a-1));a=U({title:f.addSupplyOfMaterialBill,projectBreakdownGrid:this,parentId:parseInt(String(b.id))});a.startup();a.show()},openScheduleOfRateBillForm:function(a){var b=this.getItem(a);String(b.id)==buildspace.constants.GRID_LAST_ROW&&(b=this.getItem(a-1));a=V({title:f.addScheduleOfRateBill,projectBreakdownGrid:this,
parentId:parseInt(String(b.id))});a.startup();a.show()},cutItem:function(){this.selectedItem=this.selection.getFirstSelected()},pasteItem:function(a){var b=this,e=buildspace.dialog.indeterminateProgressBar({title:f.pleaseWait+"..."}),l=this.selection.getFirstSelected(),c=String(l.id)==buildspace.constants.GRID_LAST_ROW&&0<a?this.getItem(a-1).id:0;e.show().then(function(){dojo.xhrPost({url:"projectBuilder/itemPaste",content:{tid:l.id,pid:c,id:b.selectedItem.id,_csrf_token:b.selectedItem._csrf_token},
handleAs:"json",load:function(d){d.success&&b.reload();b.selection.clear();b.disableToolbarButtons(!0);b.selectedItem=null;e.hide()},error:function(d){b.selection.clear();b.disableToolbarButtons(!0);b.selectedItem=null;e.hide()}})})},deleteRow:function(a){var b=this,e=buildspace.dialog.indeterminateProgressBar({title:f.deleting+". "+f.pleaseWait+"..."}),l;parseInt(String(a.type))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_BILL||parseInt(String(a.type))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SUPPLY_OF_MATERIAL_BILL||
parseInt(String(a.type))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SCHEDULE_OF_RATE_BILL?l="<div>"+f.deleteBillAndAllData+"</div>":parseInt(String(a.type))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_LEVEL&&(l="<div>"+f.deleteLevelAndAllData+"</div>");buildspace.dialog.confirm(f.confirmation,l,80,300,function(){e.show().then(function(){dojo.xhrPost({url:"projectBuilder/projectStructureDelete",content:{id:a.id,_csrf_token:a._csrf_token},handleAs:"json",load:function(c){if(c.success){c=
c.items;for(var d=0,h=c.length;d<h;++d)b.store.fetchItemByIdentity({identity:c[d].id,onItem:function(n){var g=b.workArea.getChildren(),k;for(k in g)if("object"==typeof g[k].pane_info&&g[k].pane_info.id==parseInt(String(n.id))+"-form_"+parseInt(String(n.type))){b.workArea.removeChild(g[k]);break}}});c.length=0;b.reload()}e.hide();b.selection.clear();b.disableToolbarButtons(!0)},error:function(c){e.hide();b.selection.clear();b.disableToolbarButtons(!0)}})})})},indentOutdent:function(a,b){if(0<a){var e=
this.getItem(a),l=buildspace.dialog.indeterminateProgressBar({title:f.recalculateRows+". "+f.pleaseWait+"..."});if(e&&!isNaN(parseInt(String(e.id)))){var c=this,d=c.store;l.show().then(function(){dojo.xhrPost({url:"projectBuilder/item"+b,content:{id:e.id,_csrf_token:e._csrf_token},handleAs:"json",load:function(h){if(h.success){var n=h.c,g;for(g in h.item)h.item.hasOwnProperty(g)&&g!=d._getIdentifierAttribute()&&d.setValue(e,g,h.item[g]);var k=0;for(h=n.length;k<h;++k)d.fetchItemByIdentity({identity:n[k].id,
onItem:function(m){for(var p in n[k])m.hasOwnProperty(p)&&p!=d._getIdentifierAttribute()&&d.setValue(m,p,n[k][p])}});d.save()}l.hide()},error:function(h){c.selection.clear();c.disableToolbarButtons(!0);l.hide()}})})}}},disableToolbarButtons:function(a,b){var e=dijit.byId(this.rootProject.id+"ExportItemFromBillRow-button"),l=dijit.byId(this.rootProject.id+"ImportDropDownRow-button"),c=dijit.byId(this.rootProject.id+"ImportBillRow-button"),d=dijit.byId(this.rootProject.id+"ImportBuildsoftRow-button"),
h=dijit.byId(this.rootProject.id+"ImportExcelRow-button"),n=dijit.byId(this.rootProject.id+"BackupDropDownRow-button"),g=dijit.byId(this.rootProject.id+"AddBillRow-button"),k=dijit.byId(this.rootProject.id+"AddLevelRow-button"),m=dijit.byId(this.rootProject.id+"ImportBackupRow-button"),p=dijit.byId(this.rootProject.id+"ExportBackupRow-button"),t=dijit.byId(this.rootProject.id+"DeleteRow-button"),r=dijit.byId(this.rootProject.id+"IndentRow-button"),E=dijit.byId(this.rootProject.id+"OutdentRow-button");
e&&e._setDisabledAttr(a);l&&l._setDisabledAttr(a);c&&c._setDisabledAttr(a);d&&d._setDisabledAttr(a);h&&h._setDisabledAttr(a);n&&n._setDisabledAttr(a);g&&g._setDisabledAttr(a);k&&k._setDisabledAttr(a);p&&p._setDisabledAttr(a);m&&m._setDisabledAttr(a);t&&t._setDisabledAttr(a);r&&r._setDisabledAttr(a);E&&E._setDisabledAttr(a);if(a&&b instanceof Array){var Y=this;dojo.forEach(b,function(z){(z=dijit.byId(Y.rootProject.id+z+"Row-button"))&&z._setDisabledAttr(!1)})}parseInt(String(this.rootProject.status_id))==
buildspace.constants.STATUS_TENDERING&&this.disableButtonsAfterPublish();parseInt(String(this.rootProject.status_id))==buildspace.constants.STATUS_PRETENDER&&this.checkPublishButton()},checkPublishButton:function(){var a=dijit.byId(this.rootProject.id+"PublishToTenderRow-button");this.store.fetch({query:{type:buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_BILL},onComplete:function(b,e){0>=b.length?a&&a._setDisabledAttr(!0):a&&a._setDisabledAttr(!1)}})},disableButtonsAfterPublish:function(){var a=
dijit.byId(this.rootProject.id+"PublishToTenderRow-button"),b=dijit.byId(this.rootProject.id+"ImportDropDownRow-button"),e=dijit.byId(this.rootProject.id+"AddBillRow-button"),l=dijit.byId(this.rootProject.id+"AddLevelRow-button"),c=dijit.byId(this.rootProject.id+"DeleteRow-button"),d=dijit.byId(this.rootProject.id+"IndentRow-button"),h=dijit.byId(this.rootProject.id+"OutdentRow-button"),n=dijit.byId(this.rootProject.id+"ImportBackupRow-button"),g=dijit.byId(this.rootProject.id+"AddTenderAlternative-button"),
k=dijit.byId("soq-"+this.rootProject.id+"-mainButton");a&&a._setDisabledAttr(!0);b&&b._setDisabledAttr(!0);n&&n._setDisabledAttr(!0);e&&e._setDisabledAttr(!0);l&&l._setDisabledAttr(!0);c&&c._setDisabledAttr(!0);d&&d._setDisabledAttr(!0);h&&h._setDisabledAttr(!0);g&&g._setDisabledAttr(!0);k&&k._setDisabledAttr(!0);if(a=dijit.byId(String(this.rootProject.id)+"-form_1337"))this.workArea.removeChild(a),a.destroy(),this.workArea.initTab({id:String(this.rootProject.id),type:1337},{projectBreakdownGrid:this,
project:this.rootProject,editable:!1},!1),(a=dijit.byId("main-project_breakdown"))&&this.workArea.selectChild(a)},reload:function(){var a=this;dojo.xhrGet({url:"projectBuilder/validateEmptyGrandTotalQty/",content:{pid:this.rootProject.id},handleAs:"json"}).then(function(b){b.has_error&&(new R({id:"EmptyGrandTotalQtyDialog-"+a.rootProject.id,project:a.rootProject,data:b})).show()});this.store.close();this._refresh();this.checkPublishButton()},destroy:function(){this.inherited(arguments);this.aspectHandles.forEach(function(a){a.remove()});
this.aspectHandles=[];dojo.forEach(this._connects,u.disconnect);delete this._connects}}),aa=function(a,b){return 0<a?a:""},ba=function(a,b){b=this.grid.getItem(b);var e=16*b.level;a=null==a?"&nbsp":a;b&&parseInt(String(b.type))<buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_BILL&&(a="<b>"+a+"</b>");return'<div class="treeNode" style="padding-left:'+e+'px;"><div class="treeContent">'+a+"&nbsp;</div></div>"};return A("buildspace.apps.ProjectBuilder.ProjectBreakdown",dijit.layout.BorderContainer,
{region:"center",style:"padding:0px;width:100%;height:100%;",gutters:!1,rootProject:null,workArea:null,grid:null,postCreate:function(){this.inherited(arguments);var a=this,b=new K,e=buildspace.billCurrencyAbbreviation?buildspace.billCurrencyAbbreviation:buildspace.currencyAbbreviation,l=[{name:"No.",field:"count",width:"30px",styles:"text-align:center;",formatter:aa},{name:f.description,field:"title",width:"auto",formatter:ba}];parseInt(String(this.rootProject.has_tender_alternative))&&l.push({name:f.tenderAlternative,
field:"tender_alternative_count",styles:"text-align: center;",width:"68px",formatter:b.tenderAlternativeInfoCellFormatter,noresize:!0});dojo.forEach([{name:f.originalAmount,field:"original_total",width:"150px",styles:"text-align: right;",formatter:b.unEditableCurrencyCellFormatter},{name:f.total+" "+f.markup+" (%)",field:"original_total",width:"100px",styles:"text-align: right;",formatter:b.elementTotalMarkupPercentageCellFormatter},{name:f.total+" "+f.markup+" ("+e+")",field:"original_total",width:"120px",
styles:"text-align: right;",formatter:b.elementTotalMarkupAmountCellFormatter},{name:f.overallTotal,field:"overall_total_after_markup",width:"150px",styles:"text-align: right;",formatter:b.unEditableCurrencyCellFormatter},{name:"% "+f.project,field:"overall_total_after_markup",width:"80px",styles:"text-align: center;",formatter:b.projectBreakdownJobPercentageCellFormatter},{name:f.recalculate,field:"recalculate",width:"80px",styles:"text-align: center;",formatter:b.recalculateBillCellFormatter}],
function(d){l.push(d)});var c=this.grid=Z({id:"projectBuilder-projectBreakdownGrid",rootProject:this.rootProject,workArea:this.workArea,currencySetting:e,structure:l,store:new dojo.data.ItemFileWriteStore({clearOnClose:!0,url:"projectBuilder/getProjectBreakdown/id/"+this.rootProject.id})});b=new dijit.Toolbar({region:"top",style:"outline:none!important;border:none;padding:2px;width:100%;"});e=new y({style:"display: none;"});e.addChild(new q({label:f.normalBill,onClick:function(d){-1<c.selection.selectedIndex&&
c.openBillForm(c.selection.selectedIndex)}}));e.addChild(new q({label:f.supplyOfMaterialBill,onClick:function(d){-1<c.selection.selectedIndex&&c.openSupplyOfMaterialForm(c.selection.selectedIndex)}}));e.addChild(new q({label:f.scheduleOfRateBill,onClick:function(d){-1<c.selection.selectedIndex&&c.openScheduleOfRateBillForm(c.selection.selectedIndex)}}));b.addChild(new x({id:a.rootProject.id+"AddBillRow-button",label:f.addBill,iconClass:"icon-16-container icon-16-add",dropDown:e,disabled:!0,style:"outline:none!important;"}));
b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({id:a.rootProject.id+"AddLevelRow-button",label:f.addLevel,iconClass:"icon-16-container icon-16-add",disabled:!0,style:"outline:none!important;",onClick:function(){-1<c.selection.selectedIndex&&c.openLevelForm(c.selection.selectedIndex,"add")}}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({id:a.rootProject.id+"AddTenderAlternative-button",label:f.addTenderAlternative,iconClass:"icon-16-container icon-16-add",
style:"outline:none!important;",onClick:function(){(new W({tenderAlternativeId:-1,project:a.rootProject,projectBreakdownGrid:c})).show()}}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({id:a.rootProject.id+"IndentRow-button",label:f.indent,iconClass:"icon-16-container icon-16-indent",disabled:!0,style:"outline:none!important;",onClick:function(){if(-1<c.selection.selectedIndex){var d=c.getItem(c.selection.selectedIndex);d&&0<parseInt(String(d.id))&&(parseInt(String(d.type))==
buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_BILL||parseInt(String(d.type))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SUPPLY_OF_MATERIAL_BILL||parseInt(String(d.type))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SCHEDULE_OF_RATE_BILL||parseInt(String(d.type))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_LEVEL)&&c.indentOutdent(c.selection.selectedIndex,"Indent")}}}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({id:a.rootProject.id+
"OutdentRow-button",label:f.outdent,iconClass:"icon-16-container icon-16-outdent",disabled:!0,style:"outline:none!important;",onClick:function(){if(-1<c.selection.selectedIndex){var d=c.getItem(c.selection.selectedIndex);d&&0<parseInt(String(d.id))&&(parseInt(String(d.type))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_BILL||parseInt(String(d.type))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SUPPLY_OF_MATERIAL_BILL||parseInt(String(d.type))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SCHEDULE_OF_RATE_BILL||
parseInt(String(d.type))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_LEVEL)&&c.indentOutdent(c.selection.selectedIndex,"Outdent")}}}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({id:a.rootProject.id+"DeleteRow-button",label:f.delete,iconClass:"icon-16-container icon-16-delete",disabled:!0,style:"outline:none!important;",onClick:function(){if(-1<c.selection.selectedIndex){var d=c.getItem(c.selection.selectedIndex);d&&0<parseInt(String(d.id))&&(parseInt(String(d.type))==
buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_BILL||parseInt(String(d.type))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SUPPLY_OF_MATERIAL_BILL||parseInt(String(d.type))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SCHEDULE_OF_RATE_BILL||parseInt(String(d.type))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_LEVEL)&&c.deleteRow(d)}}}));e=new y({style:"display: none;"});e.addChild(new q({id:a.rootProject.id+"ImportBillRow-button",
label:f.importBill,disabled:!0,onClick:function(d){-1<c.selection.selectedIndex&&(d=c.getItem(c.selection.selectedIndex),parseInt(String(d.type))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SUPPLY_OF_MATERIAL_BILL?(new C({bill:d,importType:buildspace.constants.FILE_IMPORT_TYPE_BUILDSPACE,uploadUrl:"supplyOfMaterialImportFile/importBuildSpaceExcel",title:f.importSupplyOfMaterialBill})).show():parseInt(String(d.type))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SCHEDULE_OF_RATE_BILL?
(new D({bill:d,importType:buildspace.constants.FILE_IMPORT_TYPE_BUILDSPACE,uploadUrl:"scheduleOfRateBill/importBuildSpaceExcel",title:f.importScheduleOfRateBill})).show():(new w({bill:d,importType:buildspace.constants.FILE_IMPORT_TYPE_BUILDSPACE,uploadUrl:"billManagerImportFile/importBuildspaceExcel",title:f.importBill})).show())}}));e.addChild(new q({id:a.rootProject.id+"ImportBuildsoftRow-button",label:f.importFromBuildsoft,disabled:!0,onClick:function(d){-1<c.selection.selectedIndex&&(d=c.getItem(c.selection.selectedIndex),
(new w({bill:d,importType:buildspace.constants.FILE_IMPORT_TYPE_BUILDSOFT,uploadUrl:"billManagerImportFile/importBuildsoftExcel",title:f.importFromBuildsoft})).show())}}));e.addChild(new q({label:f.importFromExcel,id:a.rootProject.id+"ImportExcelRow-button",disabled:!0,onClick:function(d){-1<c.selection.selectedIndex&&(d=c.getItem(c.selection.selectedIndex),parseInt(String(d.type))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SUPPLY_OF_MATERIAL_BILL?(new C({bill:d,importType:buildspace.constants.FILE_IMPORT_TYPE_EXCEL,
uploadUrl:"supplyOfMaterialImportFile/previewImportedFile/bid/"+parseInt(String(d.id)),title:f.importFromExcel})).show():parseInt(String(d.type))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SCHEDULE_OF_RATE_BILL?(new D({bill:d,importType:buildspace.constants.FILE_IMPORT_TYPE_EXCEL,uploadUrl:"scheduleOfRateBill/previewImportedFile/bid/"+parseInt(String(d.id)),title:f.importFromExcel})).show():(new w({bill:d,importType:buildspace.constants.FILE_IMPORT_TYPE_EXCEL,uploadUrl:"billManagerImportFile/previewImportedFile/bid/"+
parseInt(String(d.id)),title:f.importFromExcel})).show())}}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new x({id:a.rootProject.id+"ImportDropDownRow-button",label:f.importFromFiles,iconClass:"icon-16-container icon-16-import",dropDown:e,disabled:-1<c.selection.selectedIndex?!1:!0}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({id:a.rootProject.id+"ExportItemFromBillRow-button",label:f.exportBill,iconClass:"icon-16-container icon-16-export",disabled:-1<c.selection.selectedIndex?
!1:!0,onClick:function(d){-1<c.selection.selectedIndex&&(d=c.getItem(c.selection.selectedIndex),(new X({project:a.rootProject,bill:d,onSuccess:dojo.hitch(a,"_openExportExcelDialog",d),onClickErrorNode:function(h,n){switch(parseInt(String(h.type))){case buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_BILL:parseInt(String(h.bill_status))==buildspace.apps.ProjectBuilder.ProjectStructureConstants.BILL_STATUS_OPEN&&a.workArea.initTab(h,{billId:parseInt(String(h.id)),billType:parseInt(String(h.bill_type)),
billLayoutSettingId:h.billLayoutSettingId,projectBreakdownGrid:c,rootProject:a.rootProject});break;case buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SUPPLY_OF_MATERIAL_BILL:a.workArea.initTab(h,{billId:parseInt(String(h.id)),somBillLayoutSettingId:h.somBillLayoutSettingId,projectBreakdownGrid:c,rootProject:a.rootProject});break;case buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SCHEDULE_OF_RATE_BILL:a.workArea.initTab(h,{billId:parseInt(String(h.id)),sorBillLayoutSettingId:h.sorBillLayoutSettingId,
projectBreakdownGrid:c,rootProject:a.rootProject})}}})).show())}}));e=new y({style:"display: none;"});e.addChild(new q({id:a.rootProject.id+"ExportBackupRow-button",label:f.exportBackup,iconClass:"icon-16-container icon-16-export",onClick:function(d){-1<c.selection.selectedIndex&&(d=c.getItem(c.selection.selectedIndex),(new Q({bill:d,project:a.rootProject,exportUrl:"projectBackup/index"})).show())}}));e.addChild(new q({id:a.rootProject.id+"ImportBackupRow-button",label:f.importBackup,iconClass:"icon-16-container icon-16-import",
onClick:function(d){-1<c.selection.selectedIndex&&(d=a.grid.getItem(c.selection.selectedIndex),(new P({item:d,rootProject:a.rootProject,projectBreakdownGrid:a.grid,title:f.importBackup})).show())}}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new x({id:a.rootProject.id+"BackupDropDownRow-button",label:f.backup,iconClass:"icon-16-container icon-16-cabinet",dropDown:e,disabled:-1<c.selection.selectedIndex?!1:!0}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({id:a.rootProject.id+
"LocationCodeContainerRow-button",label:f.defineLocations,iconClass:"icon-16-container icon-16-location",onClick:dojo.hitch(this.workArea,"initLocationCodeContainerTab")}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({id:a.rootProject.id+"ReloadGridRow-button",label:f.reload,iconClass:"icon-16-container icon-16-reload",onClick:dojo.hitch(c,"reload")}));c.checkPublishButton();this.addChild(b);this.addChild(c)},_openExportExcelDialog:function(a){switch(parseInt(String(a.type))){case buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SUPPLY_OF_MATERIAL_BILL:(new N({bill:a})).show();
break;case buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SCHEDULE_OF_RATE_BILL:(new O({bill:a})).show();break;default:(new M({bill:a})).show()}}})});
