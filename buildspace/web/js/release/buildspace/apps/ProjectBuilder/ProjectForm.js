define("buildspace/apps/ProjectBuilder/ProjectForm","dojo/_base/declare dojo/html dojo/dom dojo/keys dojo/dom-style dijit/form/Form dijit/form/ValidationTextBox dijit/form/Textarea dijit/form/Select dijit/form/FilteringSelect dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/projectForm.html dojo/i18n!buildspace/nls/ProjectBuilder dojo/on".split(" "),function(h,k,l,m,n,x,y,z,p,f,q,r,t,u,v,e,A){var w=h("buildspace.apps.ProjectBuilder.ProjectFormWidget",
[q,r,t,u],{templateString:v,baseClass:"buildspace-form",region:"center",dialogObj:null,projectId:-1,nls:e,style:"padding:5px;overflow:auto;",postCreate:function(){this.inherited(arguments);var a=this,c=new dojo.data.ItemFileReadStore({url:"projectBuilder/getCountry"}),b=new dojo.data.ItemFileReadStore({url:"projectBuilder/getCurrency"});this.stateSelectStore=stateSelectStore=new dojo.data.ItemFileReadStore({url:"projectBuilder/getStateByCountry/regionId/null"});a.countrySelect=(new f({name:"project_main_information[region_id]",
store:c,style:"padding:2px;",searchAttr:"name",onChange:function(c){c?a.stateSelect.set("readOnly",!1):a.stateSelect.set("readOnly",!0);a.updateStateSelectStore(c)}})).placeAt(a.countrySelectDivNode);a.stateSelect=(new f({name:"project_main_information[subregion_id]",store:stateSelectStore,style:"padding:2px;",searchAttr:"name",readOnly:!0})).placeAt(a.stateSelectDivNode);a.currencySelect=(new f({name:"project_main_information[currency_id]",store:b,style:"padding:2px;",searchAttr:"name"})).placeAt(a.currencySelectDivNode)},
refreshStateSelectStore:function(){this.stateSelect.store.close();this.stateSelect.set("store",this.stateSelectStore);this.stateSelect.set("value","")},updateStateSelectStore:function(a){var c=a?a:0,b=this;dojo.xhrPost({url:"projectBuilder/getCurrencyValueByCountry",content:{regionId:c},handleAs:"json",load:function(a){b.stateSelectStore=new dojo.data.ItemFileReadStore({url:"projectBuilder/getStateByCountry/regionId/"+c,clearOnClose:!0});b.currencySelect.set("value",a.id);b.refreshStateSelectStore()},
error:function(a){}})},startup:function(){this.inherited(arguments);var a=this;dojo.xhrGet({url:"projectBuilder/projectForm",handleAs:"json",content:{id:this.projectId},load:function(c){new p({name:"project_main_information[work_category_id]",style:"width:180px;padding:2px!important;",options:c.workCategoryOptions},"project_main_information_work_category_id");a.projectForm.setFormValues(c.projectForm)},error:function(a){}})},save:function(){var a=buildspace.dialog.indeterminateProgressBar({title:e.savingData+
"..."}),c=this,b=dojo.formToObject(c.projectForm.id);this.projectForm.validate()&&a.show().then(function(){dojo.xhrPost({url:"projectBuilder/projectUpdate",content:b,handleAs:"json",load:function(b){dojo.query('[id^="error-project_main_information_"]').forEach(function(a){a.innerHTML=""});if(b.success){var g=[],d=c.dialogObj.projectListingGrid,e=d.selection.selectedIndex,f=d.store;b=f.newItem(b.items);b=d.getItemIndex(b);g.push(b);-1!=e&&0<=e&&d.selection.setSelected(e,!1);0<g.length&&(d.rearranger.moveRows(g,
0),d.selection.setSelected(0,!0),d.render());f.save();c.dialogObj&&c.dialogObj.hide()}else for(g in b.errorMsg)d=b.errorMsg[g],k.set(l.byId("error-project_main_information_"+g),d);a.hide()},error:function(b){a.hide()}})})}});return h("buildspace.apps.ProjectBuilder.ProjectFormDialog",dijit.Dialog,{style:"padding:0;margin:0;",projectId:-1,title:null,projectListingGrid:null,buildRendering:function(){var a=this.createForm();a.startup();this.content=a;this.inherited(arguments)},postCreate:function(){n.set(this.containerNode,
{padding:"0px",margin:"0px"});this.closeButtonNode.style.display="none";this.inherited(arguments)},_onKey:function(a){a.keyCode==m.ESCAPE&&dojo.stopEvent(a)},onHide:function(){this.destroyRecursive()},createForm:function(){var a=new dijit.layout.BorderContainer({style:"padding:0px;width:645px;height:420px;",gutters:!1}),c=new w({dialogObj:this,projectId:this.projectId}),b=new dijit.Toolbar({region:"top",style:"outline:none!important;padding:2px;overflow:hidden;"});b.addChild(new dijit.form.Button({label:e.save,
iconClass:"icon-16-container icon-16-save",style:"outline:none!important;",onClick:dojo.hitch(c,"save")}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({label:e.close,iconClass:"icon-16-container icon-16-close",style:"outline:none!important;",onClick:dojo.hitch(this,"hide")}));a.addChild(b);a.addChild(c);return a}})});
