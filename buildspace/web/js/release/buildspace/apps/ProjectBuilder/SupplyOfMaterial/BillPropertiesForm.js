define("buildspace/apps/ProjectBuilder/SupplyOfMaterial/BillPropertiesForm","dojo/_base/declare dojo/html dojo/dom dojo/dom-construct dojo/keys dojo/dom-style dojo/dom-attr dojo/dom-geometry dijit/form/Form dijit/form/Select dijit/form/ValidationTextBox dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/billPropertiesForm.html dojo/i18n!buildspace/nls/ProjectBuilder".split(" "),function(l,m,p,y,z,A,B,C,q,D,E,r,F,t,u,v,f){var x=l("buildspace.apps.ProjectBuilder.SupplyOfMaterial.BillPropertiesMainInfoForm",
[q,r,t,u,dojox.form.manager._Mixin,dojox.form.manager._NodeMixin,dojox.form.manager._ValueMixin,dojox.form.manager._DisplayMixin],{templateString:v,baseClass:"buildspace-form",region:"top",billId:-1,projectBreakdownGrid:null,tenderAlternativeBillGridId:null,billElementGrid:null,formData:null,unitTypeText:null,description:null,nls:f,style:"padding:5px;overflow:auto;border:0px;height:140px;",postCreate:function(){this.inherited(arguments);m.set(this.unitTypeTextNode,this.unitTypeText)},disableForm:function(){this.titleNode.set("disabled",
!0);this.descriptionNode.set("disabled",!0)},submit:function(){var b=buildspace.dialog.indeterminateProgressBar({title:f.savingData+"..."}),a=this,g=dojo.formToObject(this.id);this.validate()&&(b.show(),dojo.xhrPost({url:"supplyOfMaterial/billUpdate",content:g,handleAs:"json",load:function(d){dojo.query('[id^="error-supply_of_material_"]').forEach(function(c){c.innerHTML=""});if(d.success)a.projectBreakdownGrid.store.fetchItemByIdentity({identity:d.item.id,onItem:function(c){if(c){for(var e in d.item)c.hasOwnProperty(e)&&
e!=a.projectBreakdownGrid.store._getIdentifierAttribute()&&a.projectBreakdownGrid.store.setValue(c,e,d.item[e]);a.projectBreakdownGrid.store.save();e=dijit.byId(c.id+"-form_"+c.type).getParent();var h=e.getChildren(),k;for(k in h)if(h[k].id==c.id+"-form_"+c.type){h[k].set("title",buildspace.truncateString(c.title,35));e.resize();break}a.projectBreakdownGrid.reload();a.tenderAlternativeBillGridId&&(tenderAlternativeGrid=dijit.byId(a.tenderAlternativeBillGridId))&&tenderAlternativeGrid.grid.reload()}}});
else for(var n in d.errors){var w=d.errors[n];m.set(p.byId("error-supply_of_material_"+n),w)}b.hide()},error:function(d){b.hide()}}))},startup:function(){this.inherited(arguments);this.setFormValues(this.formData);this.projectBreakdownGrid.rootProject.status_id!=buildspace.constants.STATUS_PRETENDER&&this.disableForm()}});return l("buildspace.apps.ProjectBuilder.SupplyOfMaterial.BillPropertiesForm",dijit.layout.BorderContainer,{style:"padding:0px;width:100%;margin:0px;border:0px;height:100%;overflow:auto;",
gutters:!1,region:"center",billId:-1,projectBreakdownGrid:null,tenderAlternativeBillGridId:null,billElementGrid:null,nls:f,postCreate:function(){this.inherited(arguments);var b=this,a=buildspace.dialog.indeterminateProgressBar({title:f.pleaseWait+"..."});a.show();dojo.xhrGet({url:"supplyOfMaterial/billForm",handleAs:"json",content:{id:this.billId},load:function(g){b.renderBillPropertiesInfoForm(g);a.hide()},error:function(g){a.hide()}})},renderBillPropertiesInfoForm:function(b){b=this.mainForm=new x({billId:this.billId,
projectBreakdownGrid:this.projectBreakdownGrid,tenderAlternativeBillGridId:this.tenderAlternativeBillGridId,unitTypeText:b.unitTypeText,billElementGrid:this.billElementGrid,formData:b});this.addChild(b)}})});
