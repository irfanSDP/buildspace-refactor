define("buildspace/apps/ProjectBuilderReport/BillManager/BillGrid","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/dom-attr dojo/aspect dijit/Menu dojo/number dojox/grid/enhanced/plugins/Menu dojox/grid/enhanced/plugins/Selector dojox/grid/enhanced/plugins/Rearrange buildspace/widget/grid/plugins/FormulatedColumn dojo/_base/event dojo/keys dijit/focus dojo/_base/html dojo/request dijit/form/Button dijit/DropDownMenu dijit/form/DropDownButton dijit/MenuItem dijit/PopupMenuItem dijit/MenuSeparator ./PrintPreviewFormDialog buildspace/widget/grid/cells/Formatter dojox/grid/enhanced/plugins/IndirectSelection ./PrintPreviewDialog/PrintSelectedItemWithBuildUpQtyGridDialog ./PrintPreviewDialog/PrintSelectedItemWithBuildUpRatesGridDialog ./PrintPreviewDialog/PrintSelectedItemQtyIncludingQty2GridDialog ./PrintPreviewDialog/PrintSelectedItemAmountIncludingQty2GridDialog dojo/i18n!buildspace/nls/ProjectBuilder dojo/on dojox/grid/_Grid dojox/widget/PlaceholderMenuItem buildspace/widget/grid/cells/TextBox".split(" "),
function(m,n,p,D,E,r,F,G,H,I,t,u,J,K,L,M,h,N,v,w,l,O,P,x,y,Q,z,q,A,B,b,R){var C=m("buildspace.apps.ProjectBuilderReport.BillManager.BillGrid",dojox.grid.EnhancedGrid,{type:null,billId:-1,elementId:0,itemId:-1,style:"border-top:none;",selectedItem:null,borderContainerWidget:null,keepSelection:!0,rowSelector:"0px",headerMenu:null,typeColumns:null,markupSettings:null,parentGrid:null,elementGridStore:null,currentBillLockedStatus:!1,currentGridType:"element",currentBillType:null,ORIGINAL_BILL_VERSION:0,
typeColumsToQtyUsed:[],gridContainer:null,constructor:function(a){this.type=a.type;this.hierarchyTypes=a.hierarchyTypes;this.hierarchyTypesForHead=a.hierarchyTypesForHead;this.unitOfMeasurements=a.unitOfMeasurements;this.columnGroup=a.columnGroup;this.typeColumns=a.typeColumns;this.markupSettings=a.markupSettings;this.currencySetting=buildspace.billCurrencyAbbreviation?buildspace.billCurrencyAbbreviation:buildspace.currencyAbbreviation;this.currentBillLockedStatus=a.currentBillLockedStatus;this.currentGridType=
a.currentGridType;this.gridContainer=a.gridContainer;a=this.formatter=new y;this.typeColumnChildren="tree"!=this.type?[{name:"% "+b.job,field_name:"total",width:"60px",styles:"text-align:right;",formatter:a.elementTypeJobPercentageCellFormatter},{name:b.costPerMetreSquare,field_name:"total_cost",width:"100px",styles:"text-align:right;",formatter:a.unEditableCurrencyCellFormatter},{name:b.total+"/"+b.unit,field_name:"total_per_unit",width:"100px",styles:"text-align:right;",formatter:a.elementTotalPerUnitCellFormatter},
{name:b.estimated+" "+b.costPerMetreSquare,field_name:"estimated_cost_per_metre_square",width:"100px",styles:"text-align:right;",formatter:a.numberCellFormatter},{name:b.estimated+" "+b.totalCost,field_name:"estimated_cost",width:"100px",styles:"text-align:right;",formatter:a.unEditableCurrencyCellFormatter}]:[{name:b.include,field_name:"include",width:"60px",styles:"text-align:center;",formatter:a.yesNoCellFormatter},{name:b.qty+"/"+b.unit,field_name:"quantity_per_unit-value",width:"70px",styles:"text-align:right;",
formatter:a.billQuantityCellFormatter},{name:b.qty+"/"+b.unit+" (2)",field_name:"quantity_per_unit_remeasurement-value",width:"70px",styles:"text-align:right;",formatter:a.billQuantityCellFormatter},{name:b.difference+" (%)",field_name:"quantity_per_unit_difference",width:"85px",styles:"text-align:right;color:blue;",formatter:a.unEditablePercentageCellFormatter},{name:b.total+"/"+b.unit,field_name:"total_per_unit",width:"100px",styles:"text-align:right;",formatter:a.itemTotalPerUnitCellFormatter}];
this.rearranger=t(this,{});this.formulatedColumn=u(this,{});this.setColumnStructure();this.plugins={indirectSelection:{headerSelector:!0,width:"40px",styles:"text-align: center;"}}},postCreate:function(){var a=this;a.inherited(arguments);"tree"===a.type&&r.after(a,"_onFetchComplete",function(){a.gridContainer.markedCheckBoxObject(a,a.gridContainer.selectedItemStore)})},startup:function(){var a=this;a.inherited(arguments);this._connects.push(p.connect(this,"onCellClick",function(b){""===b.cell.name&&
a.singleCheckBoxSelection(b)}));this._connects.push(p.connect(this.rowSelectCell,"toggleAllSelection",function(b){a.toggleAllSelection(b)}))},canSort:function(a){return!1},setColumnStructure:function(){var a=this.formatter,d=!0;this.currentBillLockedStatus&&(d=!1);var c="auto";if(1<this.typeColumns.length||this.markupSettings.bill_markup_enabled||this.markupSettings.element_markup_enabled||this.markupSettings.item_markup_enabled)c="500px";if("tree"==this.type){var e=this.unitOfMeasurements;d=this.hierarchyTypes;
c=this.fixedColumns={noscroll:!1,width:57.8,cells:[[{name:"No",field:"id",styles:"text-align:center;",width:"30px",formatter:a.rowCountCellFormatter,noresize:!0,rowSpan:2,showInCtxMenu:!0},{name:b.billReference,field:"bill_ref",styles:"text-align:center; color: red;",width:"80px",noresize:!0,hidden:!0,rowSpan:2,showInCtxMenu:!0,formatter:a.billRefCellFormatter},{name:b.description,field:"description",width:c,formatter:a.treeCellFormatter,noresize:!0,rowSpan:2,showInCtxMenu:!0},{name:b.type,field:"type",
width:"70px",styles:"text-align:center;",type:"dojox.grid.cells.Select",options:d.options,values:d.values,formatter:a.typeCellFormatter,noresize:!0,rowSpan:2,showInCtxMenu:!0},{name:b.unit,field:"uom_id",width:"70px",styles:"text-align:center;",type:"dojox.grid.cells.Select",options:e.options,values:e.values,formatter:a.unitIdCellFormatter,noresize:!0,rowSpan:2,showInCtxMenu:!0},{name:b.grandTotalQty,field:"grand_total_quantity",styles:"text-align:right;color:blue;",width:"90px",formatter:a.unEditableNumberCellFormatter,
noresize:!0,hidden:!0,rowSpan:2,showInCtxMenu:!0}]]};e=!0;if(this.markupSettings.bill_markup_enabled||this.markupSettings.element_markup_enabled||this.markupSettings.item_markup_enabled)e=!1;e=[{name:b.rate,field:"rate-value",styles:"text-align:right;",width:"75px",formatter:a.formulaCurrencyCellFormatter,noresize:!0,rowSpan:2},{name:b.originalGrandTotal,field:"grand_total",styles:"text-align:right;color:blue;",width:"100px",formatter:a.unEditableCurrencyCellFormatter,noresize:!0,hidden:e,rowSpan:2,
showInCtxMenu:!0}];var f=this.constructTypeColumnStructure(c)}else{e=!0;if(this.markupSettings.bill_markup_enabled||this.markupSettings.element_markup_enabled||this.markupSettings.item_markup_enabled)e=!1;c="auto";if(1<this.typeColumns.length||this.markupSettings.bill_markup_enabled||this.markupSettings.element_markup_enabled||this.markupSettings.item_markup_enabled)c="500px";c=this.fixedColumns={noscroll:!1,width:"50",cells:[[{name:"No",field:"id",styles:"text-align:center;",width:"30px",formatter:a.rowCountCellFormatter,
noresize:!0,rowSpan:2},{name:b.description,field:"description",width:c,editable:d,formatter:a.treeCellFormatter,noresize:!0,rowSpan:2}]]};e=[{name:b.grandTotal,field:"grand_total",styles:"text-align:right;color:blue;",width:"100px",formatter:a.unEditableCurrencyCellFormatter,hidden:e,rowSpan:2,noresize:!0,showInCtxMenu:!0}];f=this.constructTypeColumnStructure(c)}dojo.forEach(e,function(a){f.cells[0].push(a)});if("tree"==this.type&&this.markupSettings.item_markup_enabled||"tree"!=this.type&&this.markupSettings.element_markup_enabled)c=
[{name:b.markup+" (%)",field:"markup_percentage-value",width:"80px",styles:"text-align:right;",formatter:a.formulaPercentageCellFormatter,noresize:!0},{name:b.markup+" ("+this.currencySetting+")",field:"markup_amount-value",width:"100px",styles:"text-align:right;",formatter:a.formulaCurrencyCellFormatter,noresize:!0}],dojo.forEach(c,function(a){f.cells[0].push(a)}),f.cells[1].push({name:"tree"==this.type?b.item+" "+b.markup:b.element+" "+b.markup,styles:"text-align:center;",headerClasses:"staticHeader",
colSpan:c.length});if(this.markupSettings.bill_markup_enabled||this.markupSettings.element_markup_enabled||this.markupSettings.item_markup_enabled){var g=[];"tree"==this.type&&g.push({name:b.rateAfterMarkup,field:"rate_after_markup",width:"100px",styles:"text-align:right;",headerClasses:"typeHeader1",formatter:a.rateAfterMarkupCellFormatter,noresize:!0});dojo.forEach([{name:b.total+" (%) "+b.markup,field:"tree"==this.type?"grand_total":"original_grand_total",formatter:"tree"==this.type?a.itemTotalMarkupPercentageCellFormatter:
a.elementTotalMarkupPercentageCellFormatter},{name:b.total+" ("+this.currencySetting+") "+b.markup,field:"tree"==this.type?"grand_total":"original_grand_total",formatter:"tree"==this.type?a.itemTotalMarkupAmountCellFormatter:a.elementTotalMarkupAmountCellFormatter},{name:b.overallTotalAfterMarkup,field:"tree"==this.type?"grand_total_after_markup":"overall_total_after_markup",formatter:"tree"==this.type?a.itemOverallTotalAfterMarkupCellFormatter:a.elementOverallTotalAfterMarkupCellFormatter}],function(a){g.push({name:a.name,
field:a.field,width:"100px",styles:"text-align:right;",headerClasses:"typeHeader1",formatter:a.formatter,noresize:!0})});"tree"!=this.type&&g.push({name:"% "+b.job,field:"overall_total_after_markup",styles:"text-align:right;",headerClasses:"typeHeader1",width:"70px",formatter:a.elementJobPercentageCellFormatter,noresize:!0});dojo.forEach(g,function(a){f.cells[0].push(a)});a=[];this.markupSettings.item_markup_enabled&&a.push(b.item);this.markupSettings.element_markup_enabled&&a.push(b.element);this.markupSettings.bill_markup_enabled&&
a.push(b.bill);f.cells[1].push({name:'<div style="font-weight:normal;">('+a.toString()+")</div>"+b.markupSummary,styles:"text-align:center;",headerClasses:"staticHeader typeHeader1",colSpan:g.length})}this.structure=f},constructTypeColumnStructure:function(a){var d=this,c=this.typeColumnChildren,e=[],f=0;dojo.forEach(this.typeColumns,function(g){d.typeColumsToQtyUsed[g.id]=g.use_original_quantity;var k=g.remeasurement_quantity_enabled||"tree"!=d.type?c.length:c.length-2;f++;if("tree"!=d.type){c[1].name=
g.floor_area_display_metric?b.costPerMetreSquare:b.costPerSquareFeet;if(g.show_estimated_total_cost)var h=!1;else h=!0,k-=2;c[3].hidden=h;c[4].hidden=h}e.push({name:g.name+"<br>"+b.totalUnit+":"+g.quantity,styles:"text-align:center;",headerClasses:"staticHeader typeHeader"+f,colSpan:k,headerId:g.id,hidden:g.is_hidden});for(i=0;i<c.length;i++)if(k=g.id+"-"+c[i].field_name,g.remeasurement_quantity_enabled||"tree"!=d.type||"quantity_per_unit_remeasurement-value"!=c[i].field_name&&"quantity_per_unit_difference"!=
c[i].field_name)k={field:k,columnType:"typeColumn",billColumnSettingId:g.id,hidden:g.is_hidden,headerClasses:"typeHeader"+f},n.mixin(k,c[i]),a.cells[0].push(k)});a.cells.push(e);return a},showHideMergedColumn:function(a,b){this.beginUpdate();this.layout.setColumnVisibility(b,a);this.endUpdate()},refreshGrid:function(){this.beginUpdate();this.set("structure",this.structure);this.store.close();this.pluginMgr=new this._pluginMgrClass(this);this.pluginMgr.preInit();this.pluginMgr.postInit();this.pluginMgr.startup();
this._refresh();this.endUpdate()},onHeaderCellClick:function(a){dojo.hasClass(a.cell.id,"staticHeader")||(a.grid.setSortIndex(a.cell.index),a.grid.onHeaderClick(a))},onHeaderCellMouseOver:function(a){dojo.hasClass(a.cell.id,"staticHeader")||dojo.addClass(a.cellNode,this.cellOverClass)},onStyleRow:function(a){this.inherited(arguments);if(a.node.children[0]&&2<=a.node.children[0].children[0].rows.length){var b=a.node.children[0].children[0].rows[1],c=a.node.children[0].children[0].rows[0].children;
b.parentNode.removeChild(b);dojo.forEach(c,function(a,b){b=dojo.attr(a,"rowSpan");(!b||2>b)&&dojo.attr(a,"rowSpan",2)})}}});return m("buildspace.apps.ProjectBuilderReport.BillManager.BillGridBuilder",dijit.layout.BorderContainer,{pageId:"page-00",style:"padding:0px;width:100%;height:100%;",gutters:!1,stackContainerTitle:"",rootProject:null,billId:-1,elementId:0,itemId:-1,rowSelector:null,gridOpts:{},type:null,postCreate:function(){var a=this;a.inherited(arguments);n.mixin(a.gridOpts,{billId:a.billId,
elementId:a.elementId,type:a.type,region:"center",borderContainerWidget:a});var d=this.grid=new C(a.gridOpts),c=new dijit.Toolbar({region:"top",style:"outline:none!important; border-bottom:none; padding:2px; width:100%;"}),e=new v({style:"display: none;"});if("tree"!==a.type){var f=new l({label:b.projectElementEstimateSummary,onClick:function(){a.openSelectedElementsPrintingFormDialog()}});e.addChild(f)}f=new l({label:b.itemsWithBuildUpQtyPrintPreview,onClick:function(){a.openSelectedItemsBuildUpQtyPrintPreviewDialog()}});
e.addChild(f);f=new l({label:b.itemsWithBuildUpRatePrintPreview,onClick:function(){a.openSelectedItemsBuildUpRatesPrintPreviewDialog()}});e.addChild(f);f=new l({label:b.itemsWithMarkupBuildUpRatePrintPreview,onClick:function(){a.openSelectedItemsWithMarkupBuildUpRatePrintPreview()}});e.addChild(f);f=new l({label:b.itemsQtyIncludingQty2,onClick:function(){a.openSelectedItemsQtyIncludingQty2PrintPreviewDialog()}});e.addChild(f);f=new l({label:b.itemsAmountIncludingQty2,onClick:function(){a.openSelectedItemsAmountIncludingQty2PrintPreviewDialog()}});
e.addChild(f);c.addChild(new w({label:b.print,iconClass:"icon-16-container icon-16-print",dropDown:e}));a.addChild(c);a.addChild(new dijit.layout.ContentPane({style:"width:100%",content:d,region:"center"}));(d=dijit.byId("add_resource_category_"+this.billId+"-btn"))&&d.destroy();if(d=dijit.byId("projectBuilderReportBillGrid"+this.billId+"-stackContainer"))c=document.createElement("div"),c=new dojox.layout.ContentPane({title:buildspace.truncateString(a.stackContainerTitle,60),id:a.pageId},c),d.addChild(c),
c.set("content",a),d.selectChild(a.pageId)},openSelectedElementsPrintingFormDialog:function(){var a=this,d=[];a.gridOpts.gridContainer.selectedElementStore.query().forEach(function(a){d.push(a.id)});var c=buildspace.dialog.indeterminateProgressBar({title:b.pleaseWait+"..."});c.show();return h.get("viewTendererReporting/getPrintingInformation",{handleAs:"json"}).then(function(e){(new x({title:b.projectElementEstimateSummary,billId:a.billId,selectedRows:d,printURL:"projectBuilderReport/printSelectedElementsEstimateSummaryByTypes",
exportURL:"projectBuilderReport/exportExcelSelectedElementsEstimateSummaryByTypes",_csrf_token:e._csrf_token})).show();c.hide()},function(a){console.log(a);c.hide()})},openSelectedItemsBuildUpQtyPrintPreviewDialog:function(){var a=this,d=[];a.gridOpts.gridContainer.selectedItemStore.query().forEach(function(a){d.push(a.id)});var c=buildspace.dialog.indeterminateProgressBar({title:b.pleaseWait+"..."});c.show();h.post("projectBuilderReport/getPrintPreviewSelectedItemsWithBuildUpQty",{handleAs:"json",
data:{bill_id:a.billId,itemIds:JSON.stringify(a.gridOpts.gridContainer.arrayUnique(d))}}).then(function(e){(new z({billId:a.billId,title:b.itemsWithBuildUpQtyPrintPreview,data:e,typeColumns:a.gridOpts.typeColumns,selectedItems:d})).show();c.hide()},function(a){console.log(a);c.hide()})},openSelectedItemsBuildUpRatesPrintPreviewDialog:function(){var a=this,d=[];a.gridOpts.gridContainer.selectedItemStore.query().forEach(function(a){d.push(a.id)});var c=buildspace.dialog.indeterminateProgressBar({title:b.pleaseWait+
"..."});c.show();h.post("projectBuilderReport/getPrintPreviewSelectedItemsWithBuildUpRates",{handleAs:"json",data:{bill_id:a.billId,itemIds:JSON.stringify(a.gridOpts.gridContainer.arrayUnique(d))}}).then(function(e){(new q({billId:a.billId,title:b.itemsWithBuildUpRatePrintPreview,data:e,selectedItems:d,printURL:"projectBuilderBuildUpItemsReports/printSelectedItemsWithBuildUpRate",exportURL:"projectBuilderBuildUpItemsReports/exportExcelSelectedItemsWithBuildUpRate"})).show();c.hide()},function(a){console.log(a);
c.hide()})},openSelectedItemsWithMarkupBuildUpRatePrintPreview:function(){var a=this,d=[];a.gridOpts.gridContainer.selectedItemStore.query().forEach(function(a){d.push(a.id)});var c=buildspace.dialog.indeterminateProgressBar({title:b.pleaseWait+"..."});c.show();h.post("projectBuilderReport/getPrintPreviewSelectedItemsWithBuildUpRates",{handleAs:"json",data:{bill_id:a.billId,itemIds:JSON.stringify(a.gridOpts.gridContainer.arrayUnique(d))}}).then(function(e){(new q({billId:a.billId,title:b.itemsWithMarkupBuildUpRatePrintPreview,
data:e,selectedItems:d,rateFieldName:"rate-after_markup",printURL:"projectBuilderBuildUpItemsReports/printSelectedItemsWithMarkupBuildUpRate",exportURL:"projectBuilderBuildUpItemsReports/exportExcelSelectedItemsWithMarkupBuildUpRate"})).show();c.hide()},function(a){console.log(a);c.hide()})},openSelectedItemsQtyIncludingQty2PrintPreviewDialog:function(){var a=this,d=[];a.gridOpts.gridContainer.selectedItemStore.query().forEach(function(a){d.push(a.id)});var c=buildspace.dialog.indeterminateProgressBar({title:b.pleaseWait+
"..."});c.show();h.post("projectBuilderReport/getPrintPreviewSelectedItemsQtyIncludingQty2",{handleAs:"json",data:{bill_id:a.billId,itemIds:JSON.stringify(a.gridOpts.gridContainer.arrayUnique(d))}}).then(function(e){(new A({billId:a.billId,title:b.itemsQtyIncludingQty2,data:e,typeColumns:a.gridOpts.typeColumns,selectedItems:d})).show();c.hide()},function(a){console.log(a);c.hide()})},openSelectedItemsAmountIncludingQty2PrintPreviewDialog:function(){var a=this,d=[];a.gridOpts.gridContainer.selectedItemStore.query().forEach(function(a){d.push(a.id)});
var c=buildspace.dialog.indeterminateProgressBar({title:b.pleaseWait+"..."});c.show();h.post("projectBuilderReport/getPrintPreviewSelectedItemsQtyIncludingQty2",{handleAs:"json",data:{bill_id:a.billId,itemIds:JSON.stringify(a.gridOpts.gridContainer.arrayUnique(d))}}).then(function(e){(new B({billId:a.billId,title:b.itemsAmountIncludingQty2,data:e,typeColumns:a.gridOpts.typeColumns,selectedItems:d})).show();c.hide()},function(a){console.log(a);c.hide()})}})});
