define("buildspace/apps/ProjectBuilderReport/BillManager/buildUpRateSummary","dojo/_base/declare dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/form/Button dijit/form/TextBox dijit/form/CheckBox dijit/form/Select dijit/InlineEditBox dojo/text!./templates/buildUpRateSummary.html dojo/currency dojo/i18n!buildspace/nls/BuildUpGrid".split(" "),function(g,h,k,l,m,q,r,t,n,u,p,d,f){return g("buildspace.apps.ProjectBuilderReport.BillManager.buildUpRateSummary",
[h,k,l,m],{templateString:p,style:"outline:none;",itemId:-1,nls:f,region:"bottom",_csrf_token:null,container:null,billGridStore:null,applyConversionFactor:!1,conversionFactorAmount:0,conversionFactorOperator:buildspace.constants.ARITHMETIC_OPERATOR_MULTIPLICATION,totalCost:0,totalCostAfterConversion:0,markup:0,finalCost:0,roundingType:1,currentBillLockedStatus:!1,disableEditingMode:!1,constructor:function(a){this.ROUNDING_TYPE_DISABLED=buildspace.constants.ROUNDING_TYPE_DISABLED;this.ROUNDING_TYPE_UPWARD=
buildspace.constants.ROUNDING_TYPE_UPWARD;this.ROUNDING_TYPE_DOWNWARD=buildspace.constants.ROUNDING_TYPE_DOWNWARD;this.ROUNDING_TYPE_NEAREST_WHOLE_NUMBER=buildspace.constants.ROUNDING_TYPE_NEAREST_WHOLE_NUMBER;this.ROUNDING_TYPE_NEAREST_TENTH=buildspace.constants.ROUNDING_TYPE_NEAREST_TENTH;this.ROUNDING_TYPE_DISABLED_TEXT=buildspace.constants.ROUNDING_TYPE_DISABLED_TEXT;this.ROUNDING_TYPE_UPWARD_TEXT=buildspace.constants.ROUNDING_TYPE_UPWARD_TEXT;this.ROUNDING_TYPE_DOWNWARD_TEXT=buildspace.constants.ROUNDING_TYPE_DOWNWARD_TEXT;
this.ROUNDING_TYPE_NEAREST_WHOLE_NUMBER_TEXT=buildspace.constants.ROUNDING_TYPE_NEAREST_WHOLE_NUMBER_TEXT;this.ROUNDING_TYPE_NEAREST_TENTH_TEXT=buildspace.constants.ROUNDING_TYPE_NEAREST_TENTH_TEXT;a.currentBillLockedStatus&&(this.disableEditingMode=!0);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);var a=this;dojo.xhrGet({url:"billBuildUpRate/getBuildUpSummary",content:{id:this.itemId},handleAs:"json",load:function(c){a.applyConversionFactor=c.apply_conversion_factor;
a.applyConversionFactorNode.set("checked",a.applyConversionFactor);a.doApplyConversionFactor();a.roundingType=c.rounding_type;a.roundingTypeNode.set("value",a.roundingType);a.conversionFactorAmount=c.conversion_factor_amount;a.conversionFactorAmountNode.set("value",a.conversionFactorAmount);a.conversionFactorOperator=c.conversion_factor_operator;a.conversionFactorOperatorNode.set("value",a.conversionFactorOperator);var b=a.totalCost=d.format(c.total_cost);dojo.attr(a.totalCostNode,"innerHTML",b);
b=a.totalCostAfterConversion=d.format(c.total_cost_after_conversion);dojo.attr(a.totalCostAfterConversionNode,"innerHTML",b);b=a.finalCost=d.format(c.final_cost);dojo.attr(a.finalCostNode,"innerHTML",b);c=a.markup=d.format(c.markup);a.markupNode.set("value",c);a.applyConversionFactorNode.set("disabled",a.disableEditingMode);a.roundingTypeNode.set("disabled",a.disableEditingMode);a.conversionFactorAmountNode.set("disabled",a.disableEditingMode);a.conversionFactorOperatorNode.set("disabled",a.disableEditingMode);
a.markupNode.set("disabled",a.disableEditingMode)},error:function(a){console.log(a)}})},startup:function(){this.inherited(arguments);this.toggleConversionFactorRows(!1)},submitMarkup:function(){var a=this.markupNode.get("value");if(a!=this.markup){var c=buildspace.dialog.indeterminateProgressBar({title:f.pleaseWait+"..."});c.show();var b=this;dojo.xhrPost({url:"billBuildUpRate/buildUpSummaryMarkupUpdate",content:{id:this.itemId,value:a,_csrf_token:this._csrf_token},handleAs:"json",load:function(a){var e=
b.finalCost=d.format(a.final_cost);dojo.attr(b.finalCostNode,"innerHTML",e);a=b.markup=d.format(a.markup);b.markupNode.set("value",a);b.updateBillGridStore(b.itemId);c.hide()},error:function(a){console.log(a);c.hide()}})}},doApplyConversionFactor:function(){var a=this.applyConversionFactorNode.get("checked");if(a!=this.applyConversionFactor){var c=buildspace.dialog.indeterminateProgressBar({title:f.pleaseWait+"..."});c.show();var b=this;dojo.xhrPost({url:"billBuildUpRate/buildUpSummaryApplyConversionFactorUpdate",
content:{id:this.itemId,value:a,_csrf_token:this._csrf_token},handleAs:"json",load:function(a){b.conversionFactorAmount=a.conversion_factor_amount;b.conversionFactorAmountNode.set("value",b.conversionFactorAmount);b.conversionFactorOperator=a.conversion_factor_operator;b.conversionFactorOperatorNode.set("value",b.conversionFactorOperator);var e=b.totalCostAfterConversion=d.format(a.total_cost_after_conversion);dojo.attr(b.totalCostAfterConversionNode,"innerHTML",e);a=b.finalCost=d.format(a.final_cost);
dojo.attr(b.finalCostNode,"innerHTML",a);b.updateBillGridStore(b.itemId);c.hide()},error:function(a){console.log(a);c.hide()}})}this.applyConversionFactor=a;this.toggleConversionFactorRows(a)},toggleConversionFactorRows:function(a){if(a){var c=this;dojo.xhrPost({url:"billBuildUpRate/getConversionFactorUom",content:{id:this.itemId},handleAs:"json",load:function(a){new n({name:"bill_item_build_up_rate[conversion_factor_uom_id]",style:"width:100%;",options:a.uomOptions,onChange:function(){c.submitConversionFactorUOM(this.value)}},
c.conversionFactorUOMNode);dojo.query("."+c.itemId+"-conversion_factor-row").style({display:""});c.container.resize()},error:function(a){console.log(a)}})}else dojo.query("."+this.itemId+"-conversion_factor-row").style({display:"none"}),this.container.resize()},submitConversionFactorAmount:function(){var a=this.conversionFactorAmountNode.get("value");if(a!=this.conversionFactorAmount){var c=buildspace.dialog.indeterminateProgressBar({title:f.pleaseWait+"..."});c.show();var b=this;dojo.xhrPost({url:"billBuildUpRate/buildUpSummaryConversionFactorUpdate",
content:{id:this.itemId,val:a,type:"amount",_csrf_token:this._csrf_token},handleAs:"json",load:function(a){b.conversionFactorAmount=a.conversion_factor_amount;b.conversionFactorAmountNode.set("value",b.conversionFactorAmount);var e=b.totalCostAfterConversion=d.format(a.total_cost_after_conversion);dojo.attr(b.totalCostAfterConversionNode,"innerHTML",e);a=b.finalCost=d.format(a.final_cost);dojo.attr(b.finalCostNode,"innerHTML",a);b.updateBillGridStore(b.itemId);c.hide()},error:function(a){console.log(a);
c.hide()}})}},submitConversionFactorOperator:function(){var a=this.conversionFactorOperatorNode.get("value");if(a!=this.conversionFactorOperator){var c=buildspace.dialog.indeterminateProgressBar({title:f.pleaseWait+"..."});c.show();var b=this;dojo.xhrPost({url:"billBuildUpRate/buildUpSummaryConversionFactorUpdate",content:{id:this.itemId,val:a,type:"operator",_csrf_token:this._csrf_token},handleAs:"json",load:function(a){b.conversionFactorOperator=a.conversion_factor_operator;b.conversionFactorOperatorNode.set("value",
b.conversionFactorOperator);var e=b.totalCostAfterConversion=d.format(a.total_cost_after_conversion);dojo.attr(b.totalCostAfterConversionNode,"innerHTML",e);a=b.finalCost=d.format(a.final_cost);dojo.attr(b.finalCostNode,"innerHTML",a);b.updateBillGridStore(b.itemId);c.hide()},error:function(a){console.log(a);c.hide()}})}},submitConversionFactorUOM:function(a){var c=buildspace.dialog.indeterminateProgressBar({title:f.pleaseWait+"..."});c.show();dojo.xhrPost({url:"billBuildUpRate/buildUpSummaryConversionFactorUomUpdate",
content:{id:this.itemId,uom_id:a,_csrf_token:this._csrf_token},handleAs:"json",load:function(a){c.hide()},error:function(a){console.log(a);c.hide()}})},submitRoundingType:function(){var a=this.roundingTypeNode.get("value");if(a!=this.roundingType){var c=buildspace.dialog.indeterminateProgressBar({title:f.pleaseWait+"..."});c.show();var b=this;dojo.xhrPost({url:"billBuildUpRate/buildUpSummaryRoundingUpdate",content:{rounding_type:a,_csrf_token:this._csrf_token,id:this.itemId},handleAs:"json",load:function(a){var e=
b.finalCost=d.format(a.final_cost);dojo.attr(b.finalCostNode,"innerHTML",e);b.roundingType=a.rounding_type;b.updateBillGridStore(b.itemId);c.hide()},error:function(a){console.log(a);c.hide()}})}},refreshTotalCost:function(){var a=this;dojo.xhrGet({url:"billBuildUpRate/getBuildUpSummary",content:{id:this.itemId},handleAs:"json",load:function(c){var b=a.totalCost=d.format(c.total_cost);dojo.attr(a.totalCostNode,"innerHTML",b);b=a.totalCostAfterConversion=d.format(c.total_cost_after_conversion);dojo.attr(a.totalCostAfterConversionNode,
"innerHTML",b);c=a.finalCost=d.format(c.final_cost);dojo.attr(a.finalCostNode,"innerHTML",c)},error:function(a){console.log(a)}})}})});
