define("buildspace/apps/SubPackage/SubPackageContainer","dojo/_base/declare dojo/_base/lang dojo/dom-style dojo/when dojo/currency dojo/aspect buildspace/widget/grid/cells/Formatter ./grid dojo/i18n!buildspace/nls/SubPackages".split(" "),function(q,r,v,t,w,u,l,m,d){return q("buildspace.apps.SubPackage.SubPackageContainer",dijit.layout.BorderContainer,{region:"center",rootProject:null,disableEditing:!1,gutters:!1,style:"padding:0px;border:0px;margin:0px;width:100%;height:100%;",postCreate:function(){this.inherited(arguments);
var b=this;this.createSubPackageListGrid();dojo.subscribe("SubPackages-"+b.rootProject.id+"-stackContainer-selectChild","",function(c){var d=dijit.byId("SubPackages-"+b.rootProject.id+"-stackContainer");if(d){var a=d.getChildren(),e=dojo.indexOf(a,c);e+=1;if(a.length>e){for(;a.length>e;)d.removeChild(a[e]),a[e].destroyRecursive(!0),e+=1;var g=c.grid.selection.selectedIndex;c.grid.store.save();c.grid.store.close();var k=u.after(c.grid,"_onFetchComplete",function(){k.remove();-1<g&&(this.scrollToRow(g),
this.selection.setSelected(g,!0))});c.grid.sort()}}})},createSubPackageListGrid:function(){var b=dijit.byId("SubPackages-"+this.rootProject.id+"-stackContainer");b&&dijit.byId("SubPackages"+this.rootProject.id+"-stackContainer").destroyRecursive();b=this.stackContainer=new dijit.layout.StackContainer({style:"padding:0px;border:0px;width:100%;height:100%;",region:"center",id:"SubPackages-"+this.rootProject.id+"-stackContainer"});var c=dojo.data.ItemFileWriteStore({url:"subPackage/getSubPackageList/id/"+
this.rootProject.id,clearOnClose:!0,urlPreventCache:!0}),f=new l,a=this;try{new m({id:"sub_packages_list-page-container-"+a.rootProject.id,stackContainerTitle:d.subPackages,pageId:"sub_packages_grid_page-"+a.rootProject.id,disableEditing:a.disableEditing,rootProject:a.rootProject,type:"sub_packages-list",gridOpts:{store:c,structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:f.rowCountCellFormatter},{name:d.name,field:"name",width:"auto",editable:a.disableEditing?!1:
!0,cellType:"buildspace.widget.grid.cells.Textarea"},{name:"&nbsp;",field:"filter",width:"32px",styles:"text-align:center;",formatter:function(a,b){a=this.grid.getItem(b);return 0<parseInt(String(a.id))?'<span class="dijitReset dijitInline dijitIcon icon-16-container icon-16-zoom"></span>':null}},{name:d.estAmount,field:"est_amount",width:"120px",styles:"text-align:right;",formatter:f.unEditableCurrencyCellFormatter},{name:d.selectedAmount,field:"selected_amount",width:"120px",styles:"text-align:right;",
formatter:f.unEditableCurrencyCellFormatter}],addUrl:"subPackage/subPackageAdd",updateUrl:"subPackage/subPackageUpdate",deleteUrl:"subPackage/subPackageDelete",pasteUrl:"subPackage/subPackagePaste",onRowDblClick:function(b){var c=this.getItem(b.rowIndex);b=b.cell&&"filter"==b.cell.field;0<parseInt(String(c.id))&&!b&&a.createBillGrid(c)}}});var e=new dijit.layout.StackController({region:"top",containerId:"SubPackages-"+a.rootProject.id+"-stackContainer"});a.addChild(b);a.addChild(new dijit.layout.ContentPane({style:"padding:0px;overflow:hidden;",
baseClass:"breadCrumbTrail",region:"top",id:"SubPackages-"+a.rootProject.id+"-controllerPane",content:e}))}catch(g){console.debug(g)}},createBillGrid:function(b){var c=this,f=dojo.xhrGet({url:"subPackage/getSubContractors/id/"+b.id,handleAs:"json"}),a=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});a.show();return t(f,function(e){a.hide();var g=l(),f=new dojo.data.ItemFileWriteStore({url:"subPackage/getBills/id/"+b.id,clearOnClose:!0,urlPreventCache:!0}),h=[{name:"No.",field:"id",
width:"30px",styles:"text-align:center;",formatter:g.rowCountCellFormatter},{name:d.title,field:"title",width:5<e.length?"500px":"auto"},{name:d.estAmount,field:"est_amount",width:"120px",styles:"text-align:right;",formatter:g.unEditableCurrencyCellFormatter}];dojo.forEach(e.items,function(a){if(0<a.id){var b=null!=a.shortname&&0<a.shortname.length?a.shortname:buildspace.truncateString(a.name,20);h.push({name:a.selected?'<p style="color:#0000FF!important;">'+b+"</p>":b,field:"total_amount-"+a.id,
width:"120px",styles:"text-align:right;",formatter:g.unEditableCurrencyCellFormatter})}});new m({id:"sub_packages_bills-page-container-"+c.rootProject.id+"-"+b.id,stackContainerTitle:b.name,pageId:"sub_packages-bills_grid_page-"+c.rootProject.id+"-"+b.id,rootProject:c.rootProject,subPackage:b,type:"sub_packages-bill_list",gridOpts:{store:f,structure:h,onRowDblClick:function(a){a=this.getItem(a.rowIndex);0<a.id&&null!==a.title[0]&&c.createBillElementGrid(a,b,e.items)}}})})},createBillElementGrid:function(b,
c,f){var a=this,e=l(),g=new dojo.data.ItemFileWriteStore({url:"subPackage/getBillElements/id/"+b.id+"/sid/"+c.id,clearOnClose:!0,urlPreventCache:!0}),k=5<parseInt(f.length)?"500px":"auto",h=[{name:"No",field:"id",styles:"text-align:center;",width:"30px",formatter:e.rowCountCellFormatter,noresize:!0},{name:d.description,field:"description",width:k,noresize:!0},{name:d.estAmount,field:"est_amount_total",styles:"text-align:right;color:blue;",width:"120px",formatter:e.unEditableCurrencyCellFormatter,
noresize:!0}];dojo.forEach(f,function(a){if(0<a.id){var b=null!=a.shortname&&0<a.shortname.length?a.shortname:buildspace.truncateString(a.name,20);h.push({name:a.selected?'<p style="color:#0000FF!important;">'+b+"</p>":b,field:"est_amount-bill_column-"+a.id,width:"150px",styles:"text-align:right;",noresize:!0,formatter:e.unEditableCurrencyCellFormatter})}});new m({id:"sub_packages_bill_elements-page-container-"+a.rootProject.id+"-"+c.id+"-"+b.id,stackContainerTitle:b.title,pageId:"sub_packages-bill_elements_grid_page-"+
a.rootProject.id+"-"+c.id+"-"+b.id,rootProject:a.rootProject,type:"sub_packages-bill_element_list",gridOpts:{store:g,structure:h,onRowDblClick:function(b){b=this.getItem(b.rowIndex);0<b.id&&null!==b.description[0]&&a.createBillItemGrid(b,c,f)}}})},createBillItemGrid:function(b,c,f){var a=l(),e=5<parseInt(f.length)?"500px":"auto",g=new dojo.data.ItemFileWriteStore({clearOnClose:!0,url:"subPackage/getBillItems/sid/"+c.id+"/eid/"+b.id}),k={noscroll:!1,cells:[[{name:"No",field:"id",styles:"text-align:center;",
width:"30px",formatter:a.rowCountCellFormatter,noresize:!0,rowSpan:2},{name:d.billReference,field:"bill_ref",styles:"text-align:center; color: red;",width:"80px",noresize:!0,hidden:!0,rowSpan:2,showInCtxMenu:!0},{name:d.description,field:"description",width:e,formatter:a.treeCellFormatter,noresize:!0,rowSpan:2},{name:d.type,field:"type",width:"70px",styles:"text-align:center;",formatter:a.typeCellFormatter,noresize:!0,hidden:!0,rowSpan:2,showInCtxMenu:!0},{name:d.unit,field:"uom_id",width:"70px",
styles:"text-align:center;",formatter:a.unitIdCellFormatter,noresize:!0,rowSpan:2},{name:d.totalQty,field:"total_qty",styles:"text-align:right;color:blue;",width:"90px",formatter:a.unEditableNumberCellFormatter,noresize:!0,showInCtxMenu:!0,rowSpan:2},{name:d.estRate,field:"rate-value",styles:"text-align:right;color:blue;",width:"100px",formatter:a.unEditableCurrencyCellFormatter,noresize:!0,showInCtxMenu:!0,rowSpan:2},{name:d.estAmount,field:"total_est_amount",styles:"text-align:right;color:blue;",
width:"100px",formatter:a.unEditableCurrencyCellFormatter,noresize:!0,showInCtxMenu:!0,rowSpan:2}]]},h=0,p=[],n=[{name:d.rate,field_name:"rate-value",width:"100px",cellType:"buildspace.widget.grid.cells.TextBox",styles:"text-align:right;",editable:!0,formatter:a.companyRateCurrencyCellFormatter},{name:d.totalAmount,field_name:"total_amount",width:"100px",styles:"text-align:right;",editable:!1,formatter:a.unEditableCurrencyCellFormatter}];dojo.forEach(f,function(a){if(0<a.id){h++;var b=null!=a.shortname&&
0<a.shortname.length?a.shortname:buildspace.truncateString(a.name,20);p.push({name:a.selected?'<p style="color:#0000FF!important;">'+b+"</p>":b,styles:"text-align:center;",headerClasses:"staticHeader typeHeader"+h,colSpan:n.length,headerId:a.id,hidden:!1});for(i=0;i<n.length;i++)field=n[i].field_name+"-"+a.id,b={field:field,columnType:"contractorColumn",companyId:a.id,headerClasses:"typeHeader"+h},r.mixin(b,n[i]),k.cells[0].push(b)}});k.cells.push(p);new m({id:"sub_packages_bill_items-page-container-"+
this.rootProject.id+"-"+c.id+"-"+b.id,stackContainerTitle:b.description,pageId:"sub_packages-bill_items_grid_page-"+this.rootProject.id+"-"+c.id+"-"+b.id,rootProject:this.rootProject,type:"sub_packages-bill_item_list",gridOpts:{store:g,escapeHTMLInData:!1,structure:k,updateUrl:"subPackage/billItemUpdate",subPackage:c}})}})});
