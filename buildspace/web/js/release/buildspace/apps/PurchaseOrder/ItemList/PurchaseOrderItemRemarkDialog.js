(function(){define("buildspace/apps/PurchaseOrder/ItemList/PurchaseOrderItemRemarkDialog","dojo/_base/declare dojo/_base/lang dojo/on dojo/keys dojo/parser dojo/_base/connect dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/Toolbar dijit/form/Button dijit/layout/BorderContainer dijit/layout/ContentPane dijit/form/ValidationTextBox dijit/form/SimpleTextarea dijit/registry dojo/dom-style dojo/dom-form dojo/request dojox/validate/web dijit/form/Select dijit/form/FilteringSelect dojo/store/Memory dojox/form/Manager dojo/text!./templates/rfqItemRemarkForm.html buildspace/widget/grid/cells/Formatter dojo/i18n!../../../nls/PurchaseOrder buildspace/widget/grid/Filter".split(" "),
function(h,k,u,v,F,w,x,y,z,A,m,G,n,B,H,I,J,l,K,p,L,M,N,O,P,C,D,e,E){var q,r,t;t=h("buildspace.apps.PurchaseOrder.ItemList.POItemRemarkGrid",dojox.grid.EnhancedGrid,{style:"border:none;",keepSelection:!0,rowSelector:"0px",newPOItemRemarkId:-1,rfqItemRemarkId:-1,poItemId:-1,poItem:null,resourceItemId:-1,poItemGridStore:null,dialogContainer:null,_csrf_token:null,postCreate:function(){var a;this.inherited(arguments);a=this;this.on("RowClick",function(a){return(a=this.getItem(a.rowIndex))&&0<a.id[0]?this.disableToolbarButtons(!1):
this.disableToolbarButtons(!0)});return this._connects.push(w.connect(this,"onCellClick",function(c){var b;b=this.getItem(c.rowIndex);return"action"!==c.cell.field?!1:a.updatePOItemDescription(b)}))},canSort:function(a){return!1},updatePOItemDescription:function(a){var c,b;b=this;a={"rfq_item_remark[resource_item_id]":b.resourceItemId,"rfq_item_remark[description]":a.description,"rfq_item_remark[_csrf_token]":b._csrf_token};0<b.newPOItemRemarkId?k.mixin(a,{poItemRemarkId:b.newPOItemRemarkId,poItemId:b.poItemId}):
k.mixin(a,{poItemRemarkId:b.rfqItemRemarkId,poItemId:b.poItemId});c=buildspace.dialog.indeterminateProgressBar({title:e.pleaseWait+"..."});c.show();return p.post("purchaseOrder/updateSelectedPreviousRFQItemRemark",{data:a,handleAs:"json"}).then(function(a){var d,f,e;c.hide();if(a.success&&0<a.id){b.newPOItemRemarkId=a.id;b.refreshGrid();a=a.data;for(d in a)b.poItem.hasOwnProperty(d)&&d!==b.poItemGridStore._getIdentifierAttribute()&&b.poItemGridStore.setValue(b.poItem,d,a[d]);return b.dialogContainer.hide()}e=
[];for(f in a.errorMsgs)d=b["error-"+f],d.innerHTML=a.errorMsgs[f],e.push(l.set(d,"display","block"));return e},function(a){return c.hide()})},deleteRow:function(a){var c,b,f;b=this;a=this.getItem(a);c=buildspace.dialog.indeterminateProgressBar({title:e.deleting+". "+e.pleaseWait+"..."});c.show();f={url:"requestForQuotation/deleteRFQItemRemark",content:{rfqItemRemarkId:a.id,_csrf_token:a._csrf_token},handleAs:"json",load:function(a){c.hide();return a.success?b.refreshGrid():console.log(a)},error:function(a){return c.hide()}};
return new buildspace.dialog.confirm(e.deleteRFQItemRemarkTitle,e.deleteRFQItemRemarkMsg,80,320,function(){return dojo.xhrPost(f)},function(){return c.hide()})},refreshGrid:function(){this.store.save();this.store.close();return this.setStore(this.store)},disableToolbarButtons:function(a,c){var b=dijit.byId("deleteRemarkFromRequestForQuotationItem");b&&b.set("disabled",a)}});q=h("buildspace.apps.PurchaseOrder.ItemList.POItemRemarkForm",[x,y,z,A],{baseClass:"buildspace-form",style:"overflow: auto;",
item:null,poItemId:-1,resourceItemId:-1,rfqItemRemarkId:-1,newPOItemRemarkId:-1,templateString:C,region:"center",style:"overflow: auto;",formInfo:null,nls:e,dialogContainer:null,poItemGridStore:null,_csrf_token:null,postCreate:function(){var a;this.inherited(arguments);a=this;return u(this.rfqItemRemarkFormSaveButton,"click",function(c){return a.save()})},startup:function(){this.inherited(arguments);return this.rfqItemRemarkForm.setFormValues(this.formInfo)},clearInputErrorMsgs:function(){var a,c,
b,f;b={description:null};f=[];for(c in b)a=this["error-"+c],a.innerHTML=b[c],f.push(l.set(a,"display","none"));return f},save:function(){var a,c,b;b=this;this.clearInputErrorMsgs();if(!this.rfqItemRemarkForm.validate())return!1;a=dojo.formToObject(this.rfqItemRemarkForm.id);c=buildspace.dialog.indeterminateProgressBar({title:e.pleaseWait+"..."});0<b.newPOItemRemarkId?k.mixin(a,{rfqItemRemarkId:b.newPOItemRemarkId,poItemId:b.poItemId,resourceItemId:b.resourceItemId}):k.mixin(a,{rfqItemRemarkId:b.rfqItemRemarkId,
poItemId:b.poItemId,resourceItemId:b.resourceItemId});c.show();return p.post("purchaseOrder/updateRFQItemRemark",{data:a,handleAs:"json"}).then(function(a){var d,e,f;c.hide();if(a.success&&0<a.id)return b.newPOItemRemarkId=a.id,b.rfqItemRemarkForm.reset(),b.grid.refreshGrid();f=[];for(e in a.errorMsgs)d=b["error-"+e],d.innerHTML=a.errorMsgs[e],f.push(l.set(d,"display","block"));return f},function(a){return c.hide()})}});r=h("buildspace.apps.PurchaseOrder.ItemList.POItemRemarkFormContainer",B,{gutters:!1,
style:"padding:0px;margin:0px;width:100%;height:100%;",item:null,dialogContainer:null,formInfo:null,poItemGridStore:null,_csrf_token:null,postCreate:function(){var a,c,b,f,d,g;this.inherited(arguments);d=this;a=d.item.poItemId[0];c=d.item.id[0];f=d.item.poItemRemarkId;g=new dojo.data.ItemFileWriteStore({url:"purchaseOrder/getPreviousRFQItemRemarks/poItemId/"+a+"/resourceItemId/"+c,clearOnClose:!0,urlPreventCache:!0});b=new t({poItemId:a,rfqItemRemarkId:f,structure:d.getRemarksGridLayout(),store:g,
poItem:d.item,resourceItemId:c,poItemGridStore:d.poItemGridStore,dialogContainer:d.dialogContainer,_csrf_token:d._csrf_token,region:"center"});c=new q({item:d.item,poItemId:a,resourceItemId:c,rfqItemRemarkId:f,dialogContainer:d.dialogContainer,formInfo:d.formInfo,poItemGridStore:d.poItemGridStore,_csrf_token:d._csrf_token,grid:b});a=new m({region:"top",style:"outline:none!important;padding:2px;overflow:hidden;"});a.addChild(new dijit.form.Button({label:e.close,iconClass:"icon-16-container icon-16-close",
onClick:function(){return d.dialogContainer.hide()}}));f=new m({region:"top",style:"outline:none!important;padding:2px;overflow:hidden;border-bottom:none;"});f.addChild(new dijit.form.Button({label:e["delete"],id:"deleteRemarkFromRequestForQuotationItem",iconClass:"icon-16-container icon-16-delete",disabled:!0,onClick:function(){return b.deleteRow(b.selection.selectedIndex)}}));g=new n({gutters:!1,style:"width:100%;height:200px;margin:0;padding:0;overflow:hidden;",region:"top"});g.addChild(a);g.addChild(c);
this.addChild(g);a=new n({gutters:!1,style:"width:100%;height:200px;margin:0;padding:0;overflow:hidden;",region:"center"});a.addChild(new E({region:"top",grid:b,editableGrid:!1,filterFields:[{description:e.description}]}));a.addChild(f);a.addChild(b);this.addChild(a)},getRemarksGridLayout:function(){return[{name:"No",field:"id",width:"30px",styles:"text-align: center;",formatter:(new D).rowCountCellFormatter},{name:e.description,field:"description",width:"auto"},{name:e.action,field:"action",width:"100px",
styles:"text-align: center;",formatter:function(a,c,b){a=this.grid.getItem(c);c=a.id;0<c?(a=a.selected[0]?e.selected:e.select,c='<a href="javascript:void(0);">'+a+"</a>"):c="&nbsp;";return c}}]}});return h("buildspace.apps.PurchaseOrder.ItemList.PurchaseOrderItemRemarkDialog",dijit.Dialog,{style:"padding:0px;margin:0px;width:750px;height:420px;",item:null,data:null,poItemGridStore:null,buildRendering:function(){var a=this.createContent();this.content=a;a.startup();return this.inherited(arguments)},
postCreate:function(){l.set(this.containerNode,{padding:"0px",margin:"0px"});this.closeButtonNode.style.display="none";return this.inherited(arguments)},createContent:function(){return new r({item:this.item,dialogContainer:this,formInfo:this.data.rfqItemRemarkForm,_csrf_token:this.data.rfqItemRemarkForm._csrf_token,poItemGridStore:this.poItemGridStore})},_onKey:function(a){if(a.keyCode===v.ESCAPE)return dojo.stopEvent(a)},onHide:function(){return this.destroyRecursive()}})})}).call(this);
