define("buildspace/apps/StockOut/StockOutDialog/StockOutListingDialog","dojo/_base/declare dojo/aspect dojo/_base/lang dojo/_base/connect dojo/when dojo/html dojo/dom dojo/keys dijit/focus dojo/dom-style dojo/request dojox/layout/ContentPane dijit/form/Button dojox/grid/enhanced/plugins/Rearrange buildspace/widget/grid/plugins/FormulatedColumn buildspace/widget/grid/cells/Formatter buildspace/widget/grid/cells/FormulaTextBox ./DeliveryOrderDialog ./StockOutFormDialog dojo/i18n!../../../nls/StockOut".split(" "),
function(p,v,w,x,H,I,J,y,k,z,A,B,q,C,D,r,K,E,F,e){var G=p("buildspace.apps.StockOut.StockOutUsedQuantityItemsGrid",dojox.grid.EnhancedGrid,{stockOutUsedQuantity:null,type:null,dialogWidget:null,style:"border-top:none;",constructor:function(){this.rearranger=C(this,{});this.formulatedColumn=D(this,{})},canSort:function(){return!1},postCreate:function(){var a=this;a.inherited(arguments);this.on("RowClick",function(b){(b=a.getItem(b.rowIndex))&&0<b.id?a.disableToolbarButtons(!1):a.disableToolbarButtons(!0)})},
canEdit:function(a,b){var d;var c=this;if(void 0!==a)if((d=this.getItem(b))&&0<parseInt(d.id)&&d.hasOwnProperty("type")){if(d.type[0]===buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER||d.type[0]===buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_N)return window.setTimeout(function(){c.edit.cancel();c.focus.setFocusIndex(b,a.index)},10),!1}else return window.setTimeout(function(){c.edit.cancel();c.focus.setFocusIndex(b,a.index)},10),!1;return this._canEdit},dodblclick:function(a){this.onRowDblClick(a)},
doApplyCellEdit:function(a,b,d){var c=this;var f=this.getItem(b);if(a!==f[d][0]){var g={field_name:d,stockOutUsedQuantityId:parseInt(c.stockOutUsedQuantity.id),resourceItemId:parseInt(f.id),val:a,_csrf_token:f._csrf_token?f._csrf_token:null};var h=buildspace.dialog.indeterminateProgressBar({title:e.savingData+". "+e.pleaseWait+"..."});h.show().then(function(){dojo.xhrPost({url:"stockOut/updateStockOutQuantityItemInformation",content:g,handleAs:"json",load:function(m){m.success&&(dojo.forEach(m.items,
function(l){c.store.fetchItemByIdentity({identity:l.id,onItem:function(t){for(var n in l)t.hasOwnProperty(n)&&n!=c.store._getIdentifierAttribute()&&c.store.setValue(t,n,l[n])}})}),c.store.save());h.hide().then(function(){var l=c.getCellByField(d);window.setTimeout(function(){k.curNode&&(k.curNode.blur(),k.curNode=null);c.focus.setFocusIndex(b,l.index)},10)})},error:function(){h.hide()}})})}c.inherited(arguments)},deleteStockOutRow:function(a){var b=this;var d=this.getItem(a);var c=buildspace.dialog.indeterminateProgressBar({title:e.deleting+
". "+e.pleaseWait+"..."});k.curNode.blur();k.curNode=null;new buildspace.dialog.confirm(e.deleteItemDialogBoxTitle,e.deleteItemDialogBoxMsg,80,320,function(){c.show().then(function(){dojo.xhrPost({url:"stockOut/deleteStockOutUsedQuantity",content:{stockOutUsedQuantityId:parseInt(d.id),_csrf_token:d._csrf_token},handleAs:"json",load:function(f){f.success&&(b.refreshGrid(),c.hide(),b.selection.clear(),b.disableToolbarButtons(!0),window.setTimeout(function(){b.focus.setFocusIndex(a,0)},10))},error:function(){b.selection.clear();
b.disableToolbarButtons(!0);c.hide()}})})})},deleteItemsRow:function(a){var b=this;var d=this.getItem(a);var c=b.store;var f=buildspace.dialog.indeterminateProgressBar({title:e.deleting+". "+e.pleaseWait+"..."});k.curNode.blur();k.curNode=null;if(d.type[0]===buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER||d.type[0]===buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_N){var g=e.deleteHeadDialogBoxTitle;var h=e.deleteHeadDialogBoxMsg}else g=e.deleteItemDialogBoxTitle,h=e.deleteItemDialogBoxMsg;
new buildspace.dialog.confirm(g,h,80,320,function(){f.show().then(function(){dojo.xhrPost({url:"stockOut/deleteStockOutQuantityUsedItems",content:{stockOutUsedQuantityId:parseInt(b.stockOutUsedQuantity.id),resourceItemId:parseInt(d.id),_csrf_token:d._csrf_token},handleAs:"json",load:function(m){if(m.success){c=b.store;c.save();c.close();var l=v.after(b,"_onFetchComplete",function(){l.remove();0<a&&(this.scrollToRow(a),this.focus.setFocusIndex(a,0))});b.sort();f.hide();b.selection.clear();b.disableToolbarButtons(!0);
window.setTimeout(function(){b.focus.setFocusIndex(a,0)},10)}},error:function(){b.selection.clear();b.disableToolbarButtons(!0);f.hide()}})})})},disableToolbarButtons:function(a){var b;(b="tree"===this.type?dijit.byId("ImportResourceItemIntoStockOutUsedQuantityItemGrid-Delete-button"):dijit.byId("StockOutUsedQuantityGrid-Delete-button"))&&b._setDisabledAttr(a)},onStyleRow:function(a){this.inherited(arguments);if(a.node.children[0]&&2<=a.node.children[0].children[0].rows.length){var b=a.node.children[0].children[0].rows[1],
d=a.node.children[0].children[0].rows[0].children;b.parentNode.removeChild(b);dojo.forEach(d,function(c,f){f=dojo.attr(c,"rowSpan");(!f||2>f)&&dojo.attr(c,"rowSpan",2)})}},destroy:function(){this.inherited(arguments);dojo.forEach(this._connects,x.disconnect);delete this._connects},doCancelEdit:function(a){this.inherited(arguments);this.views.renormalizeRow(a);this.scroller.rowHeightChanged(a,!0)},refreshGrid:function(){this.store.save();this.store.close();this.setStore(this.store)}});var u=p("buildspace.apps.StockOut.StockOutUsedQuantityItemsGridContainer",
dijit.layout.BorderContainer,{style:"padding:0px;width:100%;height:100%;",gutters:!1,project:null,stockOutUsedQuantity:null,type:null,gridOpts:{},postCreate:function(){var a=this;a.inherited(arguments);w.mixin(a.gridOpts,{type:a.type,stockOutUsedQuantity:a.stockOutUsedQuantity,region:"center"});var b=new G(a.gridOpts);var d=new dijit.Toolbar({region:"top",style:"padding:2px;border:none;width:100%;"});"tree"===a.type?(d.addChild(new dijit.form.Button({id:"ImportResourceItemIntoStockOutUsedQuantityItemGrid-Import-button",
label:e.copyFromDeliveryOrder,iconClass:"icon-16-container icon-16-import",onClick:function(){(new E({title:e.copyFromDeliveryOrder,project:a.project,stockOutUsedQuantity:a.stockOutUsedQuantity,itemListGrid:b})).show()}})),d.addChild(new dijit.ToolbarSeparator),d.addChild(new q({label:e["delete"],id:"ImportResourceItemIntoStockOutUsedQuantityItemGrid-Delete-button",iconClass:"icon-16-container icon-16-delete",disabled:!0,onClick:function(){b.deleteItemsRow(b.selection.selectedIndex)}}))):(d.addChild(new dijit.form.Button({label:e.addNewStockOut,
iconClass:"icon-16-container icon-16-add",onClick:function(){var f=buildspace.dialog.indeterminateProgressBar({title:e.pleaseWait+"..."});f.show().then(function(){A("stockOut/getStockOutFormInformation/projectId/"+parseInt(a.project.id),{handleAs:"json"}).then(function(g){(new F({project:a.project,formInfo:g.form,stockOutGrid:b})).show();f.hide()},function(g){f.hide()})})}})),d.addChild(new dijit.ToolbarSeparator),d.addChild(new q({label:e["delete"],id:"StockOutUsedQuantityGrid-Delete-button",iconClass:"icon-16-container icon-16-delete",
disabled:!0,onClick:function(){b.deleteStockOutRow(b.selection.selectedIndex)}})));a.addChild(d);a.addChild(b);if(d=dijit.byId("stockOutUsedQuantityItems-stackContainer")){var c=document.createElement("div");c=new B({title:buildspace.truncateString(a.title,60),executeScripts:!0},c);d.addChild(c);c.set("content",a);d.selectChild(c)}}});return p("buildspace.apps.StockOut.ManageStockOutDialog",dijit.Dialog,{project:null,style:"padding:0px;margin:0px;",buildRendering:function(){var a=this.createContent();
a.startup();this.content=a;this.inherited(arguments)},postCreate:function(){z.set(this.containerNode,{padding:"0px",margin:"0px"});this.closeButtonNode.style.display="none";this.inherited(arguments)},_onKey:function(a){a.keyCode===y.ESCAPE&&dojo.stopEvent(a)},onHide:function(){this.destroyRecursive()},createContent:function(){var a=this;var b=new dijit.layout.BorderContainer({style:"padding:0px;width:1020px;height:480px;",gutters:!1});var d=new dijit.Toolbar({region:"top",style:"outline:none!important;padding:2px;overflow:hidden;"});
d.addChild(new dijit.form.Button({id:"manageStockOutCloseBtn",label:e.close,iconClass:"icon-16-container icon-16-close",style:"outline:none!important;",onClick:dojo.hitch(this,"hide")}));var c=new r;var f=dojo.data.ItemFileWriteStore({url:"stockOut/getStockOutListings/projectId/"+parseInt(this.project.id),urlPreventCache:!0,clearOnClose:!0});c=new u({project:a.project,gridOpts:{store:f,structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:c.rowCountCellFormatter},{name:e.runningNumber,
field:"running_number",width:"auto"},{name:e.created_by,field:"created_by",styles:"text-align:center;",width:"140px",noresize:!0},{name:e.stockOutDate,field:"stock_out_date",styles:"text-align:center;",width:"160px",noresize:!0}],onRowDblClick:function(g){g=this.getItem(g.rowIndex);0<parseInt(g.id)&&a.createItemGrid(g)}}});c=this.makeGridContainer(c);b.addChild(d);b.addChild(c);return b},createItemGrid:function(a){var b=new r;var d=new dojo.data.ItemFileWriteStore({url:"stockOut/getStockOutResourceItemList/stockOutUsedQuantityId/"+
parseInt(a.id),urlPreventCache:!0,clearOnClose:!0});return new u({title:a.running_number,type:"tree",project:this.project,stockOutUsedQuantity:a,gridOpts:{store:d,dialogWidget:this,structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:b.rowCountCellFormatter},{name:e.description,field:"description",width:"auto",formatter:b.treeCellFormatter},{name:e.type,field:"type",width:"80px",styles:"text-align:center;",formatter:b.typeCellFormatter},{name:e.unit,field:"uom_id",
width:"70px",styles:"text-align:center;",formatter:b.unitIdCellFormatter},{name:e.availableDOQuantity,field:"available_quantity",styles:"text-align:right;color:blue;",width:"90px",formatter:b.unEditableCurrencyCellFormatter,noresize:!0},{name:e.stockOutQuantity,field:"quantity",width:"90px",styles:"text-align: right;",cellType:"buildspace.widget.grid.cells.FormulaTextBox",editable:!0,formatter:b.rfqQuantityCellFormatter,noresize:!0}]}})},makeGridContainer:function(a){var b;(b=dijit.byId("stockOutUsedQuantityItems-stackContainer"))&&
dijit.byId("stockOutUsedQuantityItems-stackContainer").destroyRecursive();b=new dijit.layout.StackContainer({style:"width:100%;height:100%;border:0px;",region:"center",id:"stockOutUsedQuantityItems-stackContainer"});a=new dijit.layout.ContentPane({title:e.stockOut,content:a});b.addChild(a);a=new dijit.layout.StackController({region:"top",containerId:"stockOutUsedQuantityItems-stackContainer"});var d=new dijit.layout.ContentPane({style:"padding:0px;overflow:hidden;","class":"breadCrumbTrail",region:"top",
content:a});a=new dijit.layout.BorderContainer({style:"padding:0px;width:100%;height:100%;border:0px;",gutters:!1,region:"center"});a.addChild(b);a.addChild(d);dojo.subscribe("stockOutUsedQuantityItems-stackContainer-selectChild","",function(c){var f,g;if(f=dijit.byId("stockOutUsedQuantityItems-stackContainer")){var h=f.getChildren();c=dojo.indexOf(h,dijit.byId(c.id));c+=1;for(g=[];h.length>c;)f.removeChild(h[c]),h[c].destroyRecursive(!0),g.push(c+=1);return g}});return a}})});
