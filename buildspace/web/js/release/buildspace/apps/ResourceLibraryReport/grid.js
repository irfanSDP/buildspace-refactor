define("buildspace/apps/ResourceLibraryReport/grid","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/aspect dojo/dom-attr dijit/TooltipDialog dijit/popup dojox/grid/enhanced/plugins/Menu dojox/grid/enhanced/plugins/Selector dojox/grid/enhanced/plugins/Rearrange buildspace/widget/grid/plugins/FormulatedColumn dojox/grid/enhanced/plugins/IndirectSelection dojo/_base/event dojo/keys dijit/focus dojo/_base/html dojo/request dijit/PopupMenuItem buildspace/widget/grid/cells/Textarea buildspace/widget/grid/cells/FormulaTextBox dijit/form/DropDownButton dijit/DropDownMenu dijit/MenuItem ./PrintItemsDialog dojo/i18n!buildspace/nls/ResourceLibrary buildspace/widget/grid/Filter".split(" "),
function(k,l,f,z,p,A,q,h,B,C,r,t,D,E,F,G,H,m,I,J,K,u,v,w,n,d,x){var y=k("buildspace.apps.ResourceLibraryReport.Grid",dojox.grid.EnhancedGrid,{type:null,libraryId:0,tradeId:0,style:"border-top:none;",selectedItem:null,borderContainerWidget:null,keepSelection:!0,rowSelector:"0px",gridContainer:null,constructor:function(a){this.rearranger=r(this,{});this.formulatedColumn=t(this,{});this.plugins={indirectSelection:{headerSelector:!0,width:"40px",styles:"text-align: center;"}};this.inherited(arguments)},
canSort:function(a){return!1},postCreate:function(){var a=this,b=null;a.inherited(arguments);"tree"===a.type&&(p.after(a,"_onFetchComplete",function(){a.gridContainer.markedCheckBoxObject(a,a.gridContainer.selectedItemStore[a.libraryId])}),this._connects.push(f.connect(this,"onCellMouseOver",function(a){var c=a.cell.field,d=a.rowIndex,g=this.getItem(d),c=c.replace("-value","");"undefined"!==typeof g[c+"-has_formula"]&&g[c+"-has_formula"][0]&&(g=g[c+"-value"][0],g=this.formulatedColumn.convertItemIdToRowIndex(g,
d),null===b&&(b=new q({content:g,onMouseLeave:function(){h.close(b)}}),h.open({popup:b,around:a.cellNode})))})),this._connects.push(f.connect(this,"onCellMouseOut",function(){null!==b&&(h.close(b),b=null)})),this._connects.push(f.connect(this,"onStartEdit",function(){null!==b&&(h.close(b),b=null)})))},startup:function(){var a=this;a.inherited(arguments);this._connects.push(f.connect(this,"onCellClick",function(b){""===b.cell.name&&a.singleCheckBoxSelection(b)}));this._connects.push(f.connect(this.rowSelectCell,
"toggleAllSelection",function(b){a.toggleAllSelection(b)}))},destroy:function(){this.inherited(arguments);dojo.forEach(this._connects,f.disconnect);delete this._connects}});return k("buildspace.apps.ResourceLibraryReport.grid",dijit.layout.BorderContainer,{pageId:"page-00",style:"padding:0px;border:0px;width:100%;height:100%;",gutters:!1,stackContainerTitle:null,libraryId:0,tradeId:0,gridOpts:{},type:null,postCreate:function(){var a=this,b;this.inherited(arguments);l.mixin(a.gridOpts,{libraryId:a.libraryId,
tradeId:a.tradeId,type:a.type,region:"center",borderContainerWidget:a});var e=new v({style:"display: none;"}),c=new dijit.Toolbar({region:"top",style:"padding:2px;border-bottom:none;width:100%;"}),f=this.grid=new y(a.gridOpts);"tree"==a.type&&(b=[{description:d.description},{"constant-final_value":d.constant},{uom_symbol:d.unit},{"rate-final_value":d.rate},{"wastage-final_value":d.wastage+" (%)"}]);"tree"!=a.type&&(b=[{description:d.description}]);dojo.forEach(["selectedItems","selectedItemsWithSupplierRate"],
function(b){var c;switch(b){case "selectedItems":c="openPrintSelectedItems";break;case "selectedItemsWithSupplierRate":c="openPrintSelectedItemsWithSupplierRate"}e.addChild(new w({label:d[b],onClick:function(){a[c](b)}}))});c.addChild(new u({label:d.printPreview,iconClass:"icon-16-container icon-16-print",dropDown:e}));a.addChild(new x({grid:a.grid,region:"top",editableGrid:!1,filterFields:b}));a.addChild(c);a.addChild(new dijit.layout.ContentPane({style:"width:100%",content:f,region:"center"}));
if(b=dijit.byId("resourceLibraryReportGrid"+this.libraryId+"-stackContainer"))c=document.createElement("div"),c=new dojox.layout.ContentPane({title:buildspace.truncateString(a.stackContainerTitle,60),id:a.pageId,executeScripts:!0},c),b.addChild(c),c.set("content",a),l.mixin(c,{grid:f}),b.selectChild(a.pageId)},openPrintSelectedItems:function(){var a=this,b=[];a.gridOpts.gridContainer.selectedItemStore[a.libraryId].query().forEach(function(a){b.push(a.id)});var e=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+
"..."});e.show();m.post("resourceLibraryReporting/getPrintPreviewSelectedItems",{handleAs:"json",data:{libraryId:a.libraryId,item_ids:JSON.stringify(a.gridOpts.gridContainer.arrayUnique(b))}}).then(function(c){(new n({libraryId:a.libraryId,title:d.selectedItems,data:c,selectedItems:b,printURL:"resourceLibraryReporting/printingSelectedItems",exportURL:"resourceLibraryExcelExporting/exportExcelSelectedItems"})).show();e.hide()},function(a){console.log(a);e.hide()})},openPrintSelectedItemsWithSupplierRate:function(){var a=
this,b=[];a.gridOpts.gridContainer.selectedItemStore[a.libraryId].query().forEach(function(a){b.push(a.id)});var e=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});e.show();m.post("resourceLibraryReporting/getPrintPreviewSelectedItemsWithSupplierRates",{handleAs:"json",data:{libraryId:a.libraryId,item_ids:JSON.stringify(a.gridOpts.gridContainer.arrayUnique(b))}}).then(function(c){(new n({libraryId:a.libraryId,title:d.selectedItemsWithSupplierRate,data:c,selectedItems:b,printURL:"resourceLibraryReporting/printingSelectedItemsWithSupplierRates",
exportURL:"resourceLibraryExcelExporting/exportExcelSelectedItemsWithSupplierRates"})).show();e.hide()},function(a){console.log(a);e.hide()})}})});
