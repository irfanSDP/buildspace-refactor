define("buildspace/apps/Editor/ProjectBreakdown","dojo/_base/declare dojo/aspect dojo/keys dojo/dom-style dojo/_base/lang dojo/_base/connect dojox/grid/EnhancedGrid dijit/TooltipDialog dijit/popup buildspace/widget/grid/cells/Formatter dijit/form/Form dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/form/ValidationTextBox dijit/Menu dijit/form/DropDownButton dijit/DropDownMenu dijit/MenuItem dijit/PopupMenuItem ./PrintFinalBQDialog buildspace/apps/Editor/TenderAlternativeListDialog dojo/i18n!buildspace/nls/Tendering dojo/i18n!buildspace/nls/Common".split(" "),
function(r,E,I,J,t,u,x,F,m,v,K,L,M,N,O,P,Q,n,p,q,R,y,z,c,G){var A=r("buildspace.apps.Editor.ProjectBreakdownGrid",x,{project:null,workArea:null,style:"border:none;",region:"center",keepSelection:!0,rowSelector:"0px",aspectHandles:[],currencySetting:buildspace.currencyAbbreviation,canSort:function(a){return!1},postCreate:function(){this.inherited(arguments);var a=null;this._connects.push(u.connect(this,"onCellMouseOver",function(b){var g=b.cell.field,f=this.getItem(b.rowIndex);f&&f.hasOwnProperty("addendum_version")&&
"addendum_version"==g&&"undefined"!==typeof f.addendum_version&&parseInt(f.addendum_version)&&null===a&&dojo.xhrGet({url:"addendumInfoByBill/"+String(f.id),handleAs:"json",sync:!0,preventCache:!0}).then(function(d){if(d.length){for(var e='<table class="buildspace-table"><thead><tr><th class="gridCell" style="text-align:center;padding:2px;">'+c.version+'</th><th class="gridCell" style="text-align:center;padding:2px;">'+c.revision+"</th></tr><tbody>",h=0;h<d.length;h++)e+='<tr><td class="gridCell" style="text-align:center;">'+
d[h].version+'</td><td class="gridCell" style="text-align:center;padding-left:4px;padding-right:4px;">'+d[h].revision+"</td></tr>";a=new F({content:e+"</tbody></table>",onMouseLeave:function(){m.close(a)}});m.open({popup:a,around:b.cellNode})}})}));this._connects.push(u.connect(this,"onCellMouseOut",function(){null!==a&&(m.close(a),a=null)}));this._connects.push(u.connect(this,"onStartEdit",function(){null!==a&&(m.close(a),a=null)}))},dodblclick:function(a){this.onRowDblClick(a)},disableButtonsAfterPublish:function(){},
onRowDblClick:function(a){a=this.getItem(a.rowIndex);switch(parseInt(a.type)){case buildspace.apps.Editor.ProjectStructureConstants.TYPE_BILL:parseInt(String(a.bill_status))==buildspace.apps.Editor.ProjectStructureConstants.BILL_STATUS_OPEN&&this.workArea.initTab(a,{bill:a,billLayoutSettingId:a.billLayoutSettingId,projectBreakdownGrid:this,project:this.project})}},reload:function(){this.store.close();this._refresh()}}),B=function(a,b){return 0<a?a:""},C=function(a,b){b=this.grid.getItem(b);var g=
16*parseInt(String(b.level));a=null==a?"&nbsp":a;parseInt(String(b.type))<buildspace.apps.Editor.ProjectStructureConstants.TYPE_BILL&&(a="<b>"+a+"</b>");return'<div class="treeNode" style="padding-left:'+g+'px;"><div class="treeContent">'+a+"&nbsp;</div></div>"},D=r("buildspace.apps.Editor.TenderAlternative.GridContainer",dijit.layout.BorderContainer,{pageId:"page-00",style:"padding:0px;width:100%;height:100%;border:0px!important;",gutters:!1,stackContainerTitle:"",project:null,workArea:null,mainContainer:null,
tenderAlternative:null,gridOpts:{},postCreate:function(){var a=this.project;this.inherited(arguments);t.mixin(this.gridOpts,{project:a,workArea:this.workArea,tenderAlternative:this.tenderAlternative,region:"center",borderContainerWidget:this});var b=this.grid=this.tenderAlternative?new A(this.gridOpts):new x(this.gridOpts);a=new dijit.Toolbar({region:"top",style:"outline:none!important;border:none;padding:2px;width:100%;"});this.project.disable_tender_rates_submission||(a.addChild(new dijit.form.Button({label:c.submitTender,
iconClass:"icon-16-container icon-16-export",style:"outline:none!important;",onClick:t.hitch(this.mainContainer,"submitTender")})),a.addChild(new dijit.ToolbarSeparator));var g=new p({style:"display: none;"}),f=this;dojo.forEach(["printWithPrice","printWithoutPrice"],function(k){return g.addChild(new q({label:c[k],onClick:dojo.hitch(f,"_printProjectSummary","printWithoutPrice"===k?0:1)}))});a.addChild(new n({label:c.projectSummary,iconClass:"icon-16-container icon-16-list",style:"outline:none!important;",
dropDown:g}));var d=new p({style:"display: none;"});dojo.forEach(["withPrice","withoutPrice"],function(k){return d.addChild(new q({label:c[k],onClick:dojo.hitch(f,"_printFinalBQ","withPrice"===k)}))});a.addChild(new dijit.ToolbarSeparator);a.addChild(new n({label:c.printFinalBQ,iconClass:"icon-16-container icon-16-print",style:"outline:none!important;",dropDown:d}));a.addChild(new dijit.ToolbarSeparator);a.addChild(new dijit.form.Button({label:c.reload,iconClass:"icon-16-container icon-16-reload",
style:"outline:none!important;",onClick:function(k){b.store.close();b._refresh()}}));var e=this.project.eproject_url;a.addChild(new dijit.ToolbarSeparator);a.addChild(new dijit.form.Button({label:"eProject",iconClass:"icon-16-buildspace_eproject",style:"outline:none!important;",onClick:function(){window.open(e,"_self")}}));this.addChild(a);this.addChild(b);if(a=dijit.byId("editorTenderAlternativeGrid"+String(this.project.id)+"-stackContainer")){var h=document.createElement("div");a.addChild(new dojox.layout.ContentPane({title:buildspace.truncateString(this.stackContainerTitle,
60),content:this,id:this.pageId,grid:b},h));a.selectChild(this.pageId)}},_printProjectSummary:function(a){var b=this,g=buildspace.dialog.indeterminateProgressBar({title:c.pleaseWait+"..."}),f=dojo.xhrGet({url:"getTenderAlternatives/"+String(this.project.id),handleAs:"json"});g.show().then(function(){f.then(function(d){g.hide();if(2<d.items.length)(new z({project:b.project,workArea:b.workArea,type:"printProjectSummary",opt:{withPrice:a}})).show();else return window.open("projectSummary/"+b.project.id+
"/"+b.project._csrf_token+"/"+a,"_blank"),window.focus()})})},_printFinalBQ:function(a){var b=this,g=buildspace.dialog.indeterminateProgressBar({title:c.pleaseWait+"..."}),f=dojo.xhrGet({url:"getTenderAlternatives/"+String(this.project.id),handleAs:"json"});g.show().then(function(){f.then(function(d){g.hide();(2<d.items.length?new z({project:b.project,workArea:b.workArea,type:"printFinalBQ",opt:{withPrice:a}}):new y({title:c.printFinalBQ+" ("+(a?c.withPrice:c.withoutPrice)+")",project:b.project,withPrice:a})).show()})})}});
return r("buildspace.apps.Editor.ProjectBreakdown",dijit.layout.BorderContainer,{region:"center",style:"padding:0px;width:100%;height:100%;",gutters:!1,project:null,workArea:null,grid:null,postCreate:function(){this.inherited(arguments);var a=this.project;if(parseInt(String(a.has_tender_alternatives))){var b=this.grid=this.createTenderAlternativeGrid();dojo.subscribe("editorTenderAlternativeGrid"+String(a.id)+"-stackContainer-selectChild","",function(e){var h=dijit.byId("editorTenderAlternativeGrid"+
String(a.id)+"-stackContainer");if(h){var k=h.getChildren(),l=dojo.indexOf(k,e);l+=1;if(k.length>l){for(;k.length>l;)h.removeChild(k[l]),k[l].destroyDescendants(),k[l].destroyRecursive(),l+=1;if(e.grid){var w=e.grid.selection.selectedIndex;e.grid.store.save();e.grid.store.close();var H=E.after(e.grid,"_onFetchComplete",function(){H.remove();-1<w&&(this.scrollToRow(w),this.selection.setSelected(w,!0))});e.grid.sort()}}}});this.pane_info={name:c.tenderAlternative,type:1337,id:a.id+"-form_1337"}}else{b=
this.grid=this.createBillGrid();toolbar=new dijit.Toolbar({region:"top",style:"outline:none!important;border:none;padding:2px;width:100%;background:#f7f7f7;"});a.disable_tender_rates_submission||(toolbar.addChild(new dijit.form.Button({id:a.id+"SubmitTenderRow-button",label:c.submitTender,iconClass:"icon-16-container icon-16-export",style:"outline:none!important;",onClick:t.hitch(this,"submitTender")})),toolbar.addChild(new dijit.ToolbarSeparator));var g=new p({style:"display: none;"});dojo.forEach(["printWithPrice",
"printWithoutPrice"],function(e){var h="printWithoutPrice"===e?0:1;return g.addChild(new q({label:c[e],onClick:function(){window.open("projectSummary/"+a.id+"/"+a._csrf_token+"/"+h,"_blank");return window.focus()}}))});toolbar.addChild(new n({label:c.projectSummary,iconClass:"icon-16-container icon-16-list",style:"outline:none!important;",dropDown:g}));var f=new p({style:"display: none;"});dojo.forEach(["withPrice","withoutPrice"],function(e){var h="withPrice"===e;return f.addChild(new q({label:c[e],
onClick:function(){(new y({title:c.printFinalBQ+" ("+(h?c.withPrice:c.withoutPrice)+")",project:a,withPrice:h})).show()}}))});toolbar.addChild(new dijit.ToolbarSeparator);toolbar.addChild(new n({id:a.id+"PrintFinalBQ-button",label:c.printFinalBQ,iconClass:"icon-16-container icon-16-print",style:"outline:none!important;",dropDown:f}));toolbar.addChild(new dijit.ToolbarSeparator);toolbar.addChild(new dijit.form.Button({id:a.id+"ReloadGridRow-button",label:c.reload,iconClass:"icon-16-container icon-16-reload",
style:"outline:none!important;",onClick:function(e){b.reload()}}));var d=a.eproject_url;toolbar.addChild(new dijit.ToolbarSeparator);toolbar.addChild(new dijit.form.Button({id:"eproject-link",label:G.goToBuildspaceEProject,iconClass:"icon-24-buildspace_eproject",style:"outline:none!important;",onClick:function(){window.open(d,"_blank")}}));this.addChild(toolbar);this.addChild(b)}},submitTender:function(){var a=buildspace.dialog.indeterminateProgressBar({title:c.pleaseWait+"..."}),b={pid:this.project.id,
_csrf_token:this.project._csrf_token},g;a.show().then(function(){dojo.xhrPost({url:"billManager/submitTender",content:b,handleAs:"json",load:function(f){g=f.success?c.editorSuccessSubmitTenderMsg:f.errorMsg;a.hide();buildspace.dialog.alert(c.submitTender,g,120,320)},error:function(f){a.hide()}})})},createBillGrid:function(){var a=new v,b=buildspace.billCurrencyAbbreviation?buildspace.billCurrencyAbbreviation:buildspace.currencyAbbreviation,g=[{name:"No.",field:"count",width:"30px",styles:"text-align:center;",
formatter:B},{name:c.description,field:"title",width:"auto",formatter:C}];parseInt(String(this.project.has_addendum))&&g.push({name:c.addendum,field:"addendum_version",styles:"text-align: center;",width:"68px",formatter:a.addendumInfoCellFormatter,noresize:!0});dojo.forEach([{name:c.overallTotal,field:"overall_total",width:"150px",styles:"text-align: right;",formatter:a.unEditableCurrencyCellFormatter},{name:"% "+c.project,field:"overall_total",width:"80px",styles:"text-align: center;",formatter:a.projectBreakdownJobPercentageCellFormatter}],
function(f){g.push(f)});return new A({project:this.project,workArea:this.workArea,currencySetting:b,structure:g,store:new dojo.data.ItemFileWriteStore({clearOnClose:!0,url:"projectBreakdown/"+parseInt(String(this.project.id))})})},createTenderAlternativeGrid:function(){var a=dijit.byId("editorTenderAlternativeGrid"+String(this.project.id)+"-stackContainer");a&&dijit.byId("editorTenderAlternativeGrid"+String(this.project.id)+"-stackContainer").destroyRecursive();a=this.stackContainer=new dijit.layout.StackContainer({style:"border:0px;width:100%;height:100%;",
region:"center",id:"editorTenderAlternativeGrid"+String(this.project.id)+"-stackContainer"});var b=new v,g=this,f=new D({stackContainerTitle:c.tenderAlternatives,project:this.project,workArea:this.workArea,mainContainer:this,pageId:"tender_alternative-page-"+String(this.project.id),id:"tender_alternative-page-container-"+String(this.project.id),gridOpts:{id:String(this.project.id)+"-tenderAlternative-tenderAlternativeListGrid",currencySetting:buildspace.billCurrencyAbbreviation?buildspace.billCurrencyAbbreviation:
buildspace.currencyAbbreviation,structure:[{name:"No.",field:"count",width:"30px",styles:"text-align:center;",formatter:function(d,e){return 0<d?d:""}},{name:c.description,field:"title",width:"auto",formatter:function(d,e,h){e=this.grid.getItem(e);var k=16*parseInt(String(e.level));d=null==d?"&nbsp":d;-9999==parseInt(String(e.id))&&(d="<b>"+d+"</b>");e&&0<parseInt(String(e.id))&&void 0!=e.project_revision_deleted_at&&0<String(e.project_revision_deleted_at).length&&"false"!=String(e.project_revision_deleted_at).toLowerCase()&&
h.customClasses.push("addendumDeletedItemCell");return'<div class="treeNode" style="padding-left:'+k+'px;"><div class="treeContent">'+d+"&nbsp;</div></div>"}},{name:c.overallTotal,field:"overall_total",width:"150px",styles:"text-align: right;",formatter:b.unEditableCurrencyCellFormatter}],store:new dojo.data.ItemFileWriteStore({clearOnClose:!0,url:"getTenderAlternatives/"+this.project.id}),onRowDblClick:function(d){d=this.getItem(d.rowIndex);0<parseInt(String(d.id))&&null!==String(d.title)&&""!==
String(d.title)&&g.createTenderAlternativeBillGrid(d,f)}}});b=new dijit.layout.StackController({region:"top",containerId:"editorTenderAlternativeGrid"+String(this.project.id)+"-stackContainer"});this.addChild(a);this.addChild(new dijit.layout.ContentPane({style:"padding:0px;overflow:hidden;",baseClass:"breadCrumbTrail",region:"top",id:"editorTenderAlternativeGrid"+String(this.project.id)+"-controllerPane",content:b}))},createTenderAlternativeBillGrid:function(a,b){b=new v;var g=buildspace.billCurrencyAbbreviation?
buildspace.billCurrencyAbbreviation:buildspace.currencyAbbreviation,f=[{name:"No.",field:"count",width:"30px",styles:"text-align:center;",formatter:B},{name:c.description,field:"title",width:"auto",formatter:C}];parseInt(String(this.project.has_addendum))&&f.push({name:c.addendum,field:"addendum_version",styles:"text-align: center;",width:"68px",formatter:b.addendumInfoCellFormatter,noresize:!0});dojo.forEach([{name:c.overallTotal,field:"overall_total",width:"150px",styles:"text-align: right;",formatter:b.unEditableCurrencyCellFormatter},
{name:"% "+c.project,field:"overall_total",width:"80px",styles:"text-align: center;",formatter:b.projectBreakdownJobPercentageCellFormatter}],function(d){f.push(d)});return new D({stackContainerTitle:String(a.title),project:this.project,workArea:this.workArea,mainContainer:this,tenderAlternative:a,pageId:String(a.id)+"-bill-page-"+String(this.project.id),id:String(a.id)+"-bill-page-container-"+String(this.project.id),gridOpts:{id:String(this.project.id)+"-"+String(a.id)+"-tenderAlternative-billListGrid",
currencySetting:g,structure:f,store:new dojo.data.ItemFileWriteStore({clearOnClose:!0,url:"getTenderAlternativeBills/"+parseInt(String(a.id))})}})}})});
