(function(){define("buildspace/apps/StockIn/InvoiceDeliveryOrderTab/ItemListingGrid","dojo/_base/declare dojo/_base/lang dojox/grid/enhanced/plugins/Menu dojox/grid/enhanced/plugins/Rearrange buildspace/widget/grid/plugins/FormulatedColumn dojo/request dijit/focus dijit/Toolbar dijit/form/Button dijit/DropDownMenu dijit/form/DropDownButton dijit/MenuItem dijit/layout/BorderContainer buildspace/widget/grid/cells/Formatter buildspace/widget/grid/cells/FormulaTextBox buildspace/widget/grid/Filter ./ResourceLibraryDialog ./StockInItemRemarkDialog dojo/i18n!../../../nls/StockIn".split(" "),
function(l,B,C,q,r,t,m,u,n,D,E,F,v,w,G,x,y,z,b){var A=l("buildspace.apps.StockIn.InvoiceInformation.ItemListGrid",dojox.grid.EnhancedGrid,{style:"border-top:none;",rowSelector:"0px",region:"center",invoice:null,constructor:function(a){this.rearranger=q(this,{});return this.formulatedColumn=r(this,{})},canSort:function(a){return!1},postCreate:function(){this.inherited(arguments);return this.on("RowClick",function(a){return(a=this.getItem(a.rowIndex))&&0<a.id[0]?this.disableToolbarButtons(!1):this.disableToolbarButtons(!0)})},
canEdit:function(a,e){var d,c;c=this;if(void 0!==a)if(d=this.getItem(e),0<d.id[0]){if(d.type[0]===buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER||d.type[0]===buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_N){window.setTimeout(function(){c.edit.cancel();return c.focus.setFocusIndex(e,a.index)},10);return}}else{window.setTimeout(function(){c.edit.cancel();return c.focus.setFocusIndex(e,a.index)},10);return}return this._canEdit},onRowDblClick:function(a){var e,d,c,f;d=this.getItem(a.rowIndex);
e=a.cell.field;f=this.store;return d&&d.stockInItemId&&0<d.stockInItemId[0]&&"description"===e?(c=buildspace.dialog.indeterminateProgressBar({title:b.pleaseWait+"..."}),c.show(),t.post("requestForQuotation/getRFQItemRemarkInformation",{query:{rfqItemId:d.stockInItemId[0],rfqItemRemarkId:d.stockInItemRemarkId[0]},handleAs:"json"}).then(function(a){(new z({title:""+b.itemRemarkDialogTitle,item:d,data:a,stockInItemGridStore:f})).show();return c.hide()},function(a){return c.hide()})):this.inherited(arguments)},
doApplyCellEdit:function(a,e,d){var c,f,h,g;g=this;c=this.getItem(e);return a!==c[d][0]?(f={field_name:d,invoiceId:g.invoiceId,stockInItemId:c.stockInItemId,val:a,_csrf_token:c._csrf_token?c._csrf_token:null},h=buildspace.dialog.indeterminateProgressBar({title:b.savingData+". "+b.pleaseWait+"..."}),h.show(),f={url:"stockIn/updateItemInformation",content:f,handleAs:"json",load:function(a){var b,f,p,k;if(a.success)for(k=a.items,f=0,p=k.length;f<p;f++)a=k[f],g.updateStore(c,a);b=g.getCellByField(d);
window.setTimeout(function(){return g.focus.setFocusIndex(e,b.index)},10);return h.hide()},error:function(a){return h.hide()}},dojo.xhrPost(f)):g.inherited(arguments)},updateStore:function(a,e){var d,c,b;c=this.store;b=[];for(d in e)a.hasOwnProperty(d)&&d!==c._getIdentifierAttribute()?b.push(c.setValue(a,d,e[d])):b.push(void 0);return b},deleteRow:function(a){var e,d,c,f,h,g;c=this;e=this.getItem(a);f=c.store;d=buildspace.dialog.indeterminateProgressBar({title:b.deleting+". "+b.pleaseWait+"..."});
m.curNode.blur();m.curNode=null;d.show();g={url:"stockIn/deleteInvoiceItem",content:{invoiceId:c.invoiceId,resourceItemId:e.id,_csrf_token:e._csrf_token},handleAs:"json",load:function(b){var e,g,h;if(b.success){f=c.store;if(void 0!==b.affected_nodes)for(e=b.affected_nodes,g=0,h=e.length;g<h;g++)b=e[g],f.fetchItemByIdentity({identity:b.id,onItem:function(a){if(a)return f.deleteItem(a),f.save()}});d.hide();c.selection.clear();return window.setTimeout(function(){return c.focus.setFocusIndex(a,0)},10)}},
error:function(a){c.selection.clear();return d.hide()}};e.type[0]===buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER||e.type[0]===buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_N?(h=b.deleteHeadDialogBoxTitle,e=b.deleteHeadDialogBoxMsg):(h=b.deleteItemDialogBoxTitle,e=b.deleteItemDialogBoxMsg);return new buildspace.dialog.confirm(h,e,80,320,function(){return dojo.xhrPost(g)},function(){return d.hide()})},disableToolbarButtons:function(a){var b=dijit.byId("deleteItemListFromStockInInvoice-"+
this.invoice.id[0]);b&&b.set("disabled",a)},refreshGrid:function(){this.store.save();this.store.close();return this.setStore(this.store)}});return l("buildspace.apps.StockIn.InvoiceInformation.ItemListContainer",v,{invoice:null,style:"height:100%;width:100%;padding:0;margin:0;",gutters:!1,postCreate:function(){var a,e,d,c;this.inherited(arguments);d=this;a=new dojo.data.ItemFileWriteStore({url:"stockIn/getInvoiceItemListings/invoiceId/"+this.invoice.id[0],clearOnClose:!0,urlPreventCache:!0});e=new A({structure:d.getGridLayout(),
store:a,invoice:this.invoice,invoiceId:this.invoice.id[0],escapeHTMLInData:!1});c=new u({region:"top",style:"outline:none!important;padding:2px;overflow:hidden;border:none;"});c.addChild(new n({label:b.copyFromResourceLibrary,iconClass:"icon-16-container icon-16-import",onClick:function(){return(new y({title:b.copyFromResourceLibrary,invoiceId:d.invoice.id[0],itemListGrid:e})).show()}}));c.addChild(new dijit.ToolbarSeparator);c.addChild(new n({label:b["delete"],id:"deleteItemListFromStockInInvoice-"+
d.invoice.id[0],iconClass:"icon-16-container icon-16-delete",disabled:!0,onClick:function(){return e.deleteRow(e.selection.selectedIndex)}}));a=new x({region:"top",grid:e,editableGrid:!1,filterFields:[{description:b.description},{quantity:b.quantity},{uom:b.unit}]});this.addChild(a);this.addChild(c);return this.addChild(e)},getGridLayout:function(){var a=new w;return[{name:"No",field:"id",width:"30px",styles:"text-align: center;",formatter:a.rowCountCellFormatter,noresize:!0},{name:b.description,
field:"description",width:"auto",formatter:a.treeCellFormatter,noresize:!0},{name:b.quantity,field:"quantity",width:"100px",styles:"text-align: right;",cellType:"buildspace.widget.grid.cells.FormulaTextBox",editable:!0,formatter:a.rfqQuantityCellFormatter,noresize:!0},{name:b.unit,field:"uom",width:"70px",styles:"text-align: center;",formatter:a.rfqUnitCellFormatter,noresize:!0},{name:b.rate,field:"rates",styles:"text-align:right;",width:"120px",editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",
formatter:a.currencyCellFormatter,noresize:!0},{name:b.discount+" %",field:"discount_percentage",styles:"text-align:right;",width:"75px",editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:a.currencyCellFormatter,noresize:!0},{name:b.tax+" %",field:"tax_percentage",styles:"text-align:right;",width:"75px",editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:a.currencyCellFormatter,noresize:!0},{name:b.totalWithoutTax,field:"total_without_tax",styles:"text-align:right;",
width:"100px",formatter:a.unEditableCurrencyCellFormatter,noresize:!0},{name:b.totalWithTax,field:"total",styles:"text-align:right;",width:"100px",formatter:a.unEditableCurrencyCellFormatter,noresize:!0},{name:b.doQuantity,field:"doQuantity",width:"90px",styles:"text-align: right;",formatter:a.unEditableNumberCellFormatter,noresize:!0},{name:b.balanceQuantity,field:"balanceQuantity",width:"90px",styles:"text-align: right;",formatter:a.unEditableNumberCellFormatter,noresize:!0}]}})})}).call(this);
