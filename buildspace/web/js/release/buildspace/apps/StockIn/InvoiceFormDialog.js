(function(){define("buildspace/apps/StockIn/InvoiceFormDialog","dojo/_base/declare dojo/_base/lang dojo/keys dojo/parser dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/Toolbar dijit/form/Button dijit/layout/BorderContainer dijit/form/ValidationTextBox dijit/form/DateTextBox dojo/dom-style dojo/dom-form dojo/request dojox/validate/web dijit/form/FilteringSelect dojo/store/Memory dojox/form/Manager dojo/text!./templates/invoiceForm.html dojo/i18n!../../nls/StockIn".split(" "),
function(h,k,p,A,q,r,t,u,v,w,x,B,C,f,D,l,E,m,n,F,y,d){var z=h("buildspace.apps.StockIn.InvoiceForm",[q,r,t,u],{baseClass:"buildspace-form",projectId:-1,templateString:y,region:"center",style:"overflow: auto;",invoiceGridContainer:null,formInfo:null,poDropDown:null,termDropDown:null,nls:d,dialogContainer:null,invoiceId:-1,newInvoiceId:-1,postCreate:function(){this.inherited(arguments);return this.createDropdown()},startup:function(){this.inherited(arguments);return this.invoiceForm.setFormValues(this.formInfo)},
createDropdown:function(){var a=this;(new m({name:"stock_in_invoice[purchase_order_id]",store:new n({idProperty:"id",data:a.poDropDown}),labelAttr:"name",maxHeight:-1,style:"width: 180px;padding:2px!important;",selected:a.formInfo["stock_in_invoice[purchase_order_id]"],onChange:function(c){return a.updateSelectedSupplierName(c)}})).placeAt(a.purchaseOrderSelection);return(new m({name:"stock_in_invoice[term_type]",store:new n({idProperty:"id",data:a.termDropDown}),labelAttr:"name",maxHeight:-1,style:"width: 180px;padding:2px!important;",
selected:a.formInfo["stock_in_invoice[term_type]"]})).placeAt(a.termTypeSelection)},clearInputErrorMsgs:function(){var a,c,b;b={project_structure_id:null,purchase_order_id:null,term_type:null,invoice_no:null,invoice_date:null,term_type:null};for(c in b){a=this["error-"+c];if(null==a)return!1;a.innerHTML=b[c];f.set(a,"display","none")}},save:function(){var a,c,b;b=this;this.clearInputErrorMsgs();if(!this.invoiceForm.validate())return!1;a=dojo.formToObject(this.invoiceForm.id);0<b.newInvoiceId?k.mixin(a,
{invoiceId:b.newInvoiceId}):k.mixin(a,{invoiceId:b.invoiceId});c=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});c.show();return l.post("stockIn/saveInvoiceFormInformation/pId/"+b.projectId,{data:a,handleAs:"json"}).then(function(a){var e,d,g;c.hide();if(a.success&&0<a.id)return b.invoiceGridContainer.refreshGrid(),b.newInvoiceId=a.id,b.dialogContainer.hide();g=[];for(d in a.errorMsgs)e=b["error-"+d],e.innerHTML=a.errorMsgs[d],g.push(f.set(e,"display","block"));return g},function(a){return c.hide()})},
updateSelectedSupplierName:function(a,c){null==c&&(c=this);return l("stockIn/getSupplierNameBySelectedPurchaseOrder/poId/"+a,{handleAs:"json"}).then(function(a){return c.supplierDivNode.innerHTML=a.supplierName},function(a){return console.log(a)})}});return h("buildspace.apps.StockIn.InvoiceFormDialog",dijit.Dialog,{title:d.addNewInvoice,style:"padding:0px;margin:0px;",invoiceGridContainer:null,project:null,formInfo:null,poDropDown:null,termDropDown:null,buildRendering:function(){var a=this.createContent();
this.content=a;a.startup();return this.inherited(arguments)},postCreate:function(){f.set(this.containerNode,{padding:"0px",margin:"0px"});this.closeButtonNode.style.display="none";return this.inherited(arguments)},createContent:function(){var a,c,b,e;b=this;a=new x({style:"width:480px;height:220px;padding:0;margin:0;",gutters:!1});c=new z({projectId:b.project.id[0],dialogContainer:b,invoiceGridContainer:b.invoiceGridContainer,formInfo:this.formInfo,poDropDown:this.poDropDown,termDropDown:this.termDropDown});
e=new v({region:"top",style:"outline:none!important;padding:2px;overflow:hidden;"});e.addChild(new w({label:d.save,iconClass:"icon-16-container icon-16-save",onClick:function(){return c.save()}}));e.addChild(new dijit.ToolbarSeparator);e.addChild(new dijit.form.Button({label:d.close,iconClass:"icon-16-container icon-16-close",onClick:function(){return b.hide()}}));a.addChild(e);a.addChild(c);return a},_onKey:function(a){if(a.keyCode===p.ESCAPE)return dojo.stopEvent(a)},onHide:function(){return this.destroyRecursive()}})})}).call(this);
