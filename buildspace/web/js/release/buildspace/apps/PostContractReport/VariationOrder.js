define("buildspace/apps/PostContractReport/VariationOrder","dojo/_base/declare dojo/aspect dojo/currency dojo/number dojo/request dojo/store/Memory dijit/layout/ContentPane ./VariationOrder/VariationOrderGrid ./VariationOrder/VariationOrderItemContainer buildspace/widget/grid/cells/Formatter dojo/i18n!buildspace/nls/PostContract".split(" "),function(g,y,h,l,m,k,z,n,p,q,e){var r=[e.pending,e.approved],t=["false","true"],u=function(a,f,d){if(this.grid.getItem(f).id==buildspace.constants.GRID_LAST_ROW)return d.customClasses.push("disable-cell"),
"&nbsp;";if("true"==a)return d.customClasses.push("green-cell"),e.approved.toUpperCase();d.customClasses.push("yellow-cell");return e.pending.toUpperCase()},v=function(a,f,d){d.customClasses.push("disable-cell");a=l.parse(a);return 0>a?'<span style="color:#FF0000">'+h.format(a)+"</span>":0==a?"&nbsp;":'<span style="color:#42b449;">'+h.format(a)+"</span>"},x=g("buildspace.apps.PostContractReport.VariationOrderContainer",dijit.layout.BorderContainer,{style:"padding:0px;border:0px;width:100%;height:100%;",
gutters:!1,project:null,voSelectedStore:[],voItemSelectedStore:[],postCreate:function(){this.inherited(arguments);this.voSelectedStore=new k({idProperty:"id"});this.voItemSelectedStore=new k({idProperty:"id"});var a=this,f=new q,d=dojo.data.ItemFileWriteStore({url:"variationOrder/getVariationOrderList/pid/"+a.project.id,clearOnClose:!0}),f=new n({id:"variation_order-"+a.project.id,stackContainerTitle:e.scheduleOfRates,pageId:"variation_order-"+a.project.id,project:a.project,type:"vo",gridOpts:{type:"vo",
gridContainer:a,store:d,structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:f.rowCountCellFormatter},{name:e.description,field:"description",width:"auto"},{name:e.omission,field:"omission",width:"150px",styles:"text-align:right;color:#FF0000;",formatter:f.unEditableCurrencyCellFormatter},{name:e.addition,field:"addition",width:"150px",styles:"text-align:right;",formatter:f.unEditableCurrencyCellFormatter},{name:e.nettOmissionAddition,field:"nett_omission_addition",
width:"150px",styles:"text-align:right;",formatter:v},{name:e.upToDateClaim,field:"total_claim",width:"150px",styles:"text-align:right;",formatter:f.unEditableCurrencyCellFormatter},{name:e.status,field:"is_approved",width:"80px",styles:"text-align:center;",type:"dojox.grid.cells.Select",options:r,values:t,formatter:u},{name:e.lastUpdated,field:"updated_at",width:"120px",styles:"text-align: center;"}],onRowDblClick:function(b){b=this.getItem(b.rowIndex);0<b.id&&null!==b.description[0]&&0<b.description[0].length&&
new p({gridContainer:a,stackContainerTitle:b.description,project:a.project,variationOrder:b,id:"variation_order_items-"+b.id+"-"+a.project.id,pageId:"variation_order_items-"+b.id+"-"+a.project.id+"-page"})},singleCheckBoxSelection:function(a){var c=a.rowIndex;a=this.selection.selected[c];c=this.getItem(c);this.removedIds=[];if(a)return this.gridContainer.voSelectedStore.put({id:c.id[0]}),this.getAffectedItemsByVO(c,"add");this.gridContainer.voSelectedStore.remove(c.id[0]);this.removedIds.push(c.id[0]);
return this.getAffectedItemsByVO(c,"remove")},toggleAllSelection:function(a){var c=this,b=this.selection;c.removedIds=[];if(a)return b.selectRange(0,c.rowCount-1),c.store.fetch({onComplete:function(a){dojo.forEach(a,function(a,b){0<a.id&&c.gridContainer.voSelectedStore.put({id:a.id[0]})})}}),c.getAffectedItemsByVO(null,"add");b.deselectAll();c.store.fetch({onComplete:function(a){dojo.forEach(a,function(a,b){0<a.id&&(c.gridContainer.voSelectedStore.remove(a.id[0]),c.removedIds.push(a.id[0]))})}});
return c.getAffectedItemsByVO(null,"remove")},getAffectedItemsByVO:function(a,c){var b=this,d=[],f=buildspace.dialog.indeterminateProgressBar({title:e.pleaseWait+"..."});f.show();if("add"===c)b.gridContainer.voSelectedStore.query().forEach(function(a){d.push(a.id)});else for(var w in b.removedIds)d.push(b.removedIds[w]);m.post("variationOrderReporting/getAffectedItems",{handleAs:"json",data:{pid:b.project.id,vo_ids:JSON.stringify(b.gridContainer.arrayUnique(d))}}).then(function(a){if("add"===c)for(var d in a)for(var e in a[d])b.gridContainer.voItemSelectedStore.put({id:a[d][e]});
else for(d in a){for(e in a[d])b.gridContainer.voItemSelectedStore.remove(a[d][e]);b.store.fetchItemByIdentity({identity:d,onItem:function(a){if(a)return b.gridContainer.voSelectedStore.remove(d),b.rowSelectCell.toggleRow(a._0,!1)}})}f.hide()},function(a){f.hide();console.log(a)})}}});this.addChild(this.makeGridContainer(f,e.variationOrders))},makeGridContainer:function(a,f){var d=this.project.id,b=dijit.byId("variationOrder-"+d+"-stackContainer");b&&dijit.byId("variationOrder-"+d+"-stackContainer").destroyRecursive();
var b=new dijit.layout.StackContainer({style:"width:100%;height:100%;border:0px;",region:"center",id:"variationOrder-"+d+"-stackContainer"}),c=new dijit.layout.ContentPane({title:f,content:a,grid:a.grid});b.addChild(c);var c=new dijit.layout.StackController({region:"top",containerId:"variationOrder-"+d+"-stackContainer"}),c=new dijit.layout.ContentPane({style:"padding:0px;overflow:hidden;","class":"breadCrumbTrail",region:"top",content:c}),e=new dijit.layout.BorderContainer({style:"padding:0px;width:100%;height:100%;border:0px;",
gutters:!1,region:"center"});e.addChild(b);e.addChild(c);dojo.subscribe("variationOrder-"+d+"-stackContainer-selectChild","",function(a){var b=dijit.byId("variationOrder-"+d+"-stackContainer");if(b){var c=b.getChildren();for(a=dojo.indexOf(c,a);c.length>a+1;)a+=1,b.removeChild(c[a]),c[a].destroyRecursive()}});return e},markedCheckBoxObject:function(a,e){var d=a.store;e.query().forEach(function(b){b.id!=buildspace.constants.GRID_LAST_ROW&&d.fetchItemByIdentity({identity:b.id,onItem:function(b){if(b)return a.rowSelectCell.toggleRow(b._0,
!0)}})})},arrayUnique:function(a){return a.reverse().filter(function(a,d,b){return-1===b.indexOf(a,d+1)}).reverse()}});return g("buildspace.apps.PostContractReport.VariationOrder",dijit.layout.BorderContainer,{region:"center",rootProject:null,style:"padding:0px;border:0px;margin:0px;width:100%;height:100%;",postCreate:function(){this.inherited(arguments);var a=x({project:this.rootProject,region:"center"});this.addChild(a)}})});
