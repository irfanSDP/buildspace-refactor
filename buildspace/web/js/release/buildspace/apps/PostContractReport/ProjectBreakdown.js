define("buildspace/apps/PostContractReport/ProjectBreakdown","dojo/_base/declare dojo/number dojox/grid/EnhancedGrid buildspace/widget/grid/cells/Formatter dijit/DropDownMenu dijit/form/DropDownButton dijit/MenuItem dojo/request ./PrintProjectClaimReportFormDialog dojo/i18n!buildspace/nls/PostContract".split(" "),function(l,m,q,r,n,p,h,t,u,c){var v=l("buildspace.apps.PostContractReport.ProjectBreakdownGrid",q,{rootProject:null,style:"border:none;",region:"center",keepSelection:!0,workArea:null,rowSelector:"0px",
constructor:function(a){var b=new r;this.currencySetting=buildspace.billCurrencyAbbreviation?buildspace.billCurrencyAbbreviation:buildspace.currencyAbbreviation;this.structure={noscroll:!1,cells:[[{name:"No.",field:"count",width:"30px",styles:"text-align:center;",formatter:k.rowCountCellFormatter,rowSpan:2},{name:c.description,field:"title",width:"auto",formatter:k.treeCellFormatter,rowSpan:2},{name:c.overallTotal,field:"overall_total_after_markup",width:"150px",rowSpan:2,styles:"text-align:right;",
formatter:b.unEditableCurrencyCellFormatter},{name:c.percent,field:"up_to_date_percentage",width:"80px",formatter:k.unEditablePercentageCellFormatter,styles:"text-align: right;"},{name:c.amount,field:"up_to_date_amount",width:"160px",formatter:b.unEditableCurrencyCellFormatter,styles:"text-align: right;"}],[{name:c.upToDateClaim,styles:"text-align:center;",headerClasses:"staticHeader",colSpan:2}]]};this.inherited(arguments)},canSort:function(){return!1},postCreate:function(){this.inherited(arguments);
this.on("RowClick",function(a){a=this.getItem(a.rowIndex);this.disableToolbarButtons(!0);a&&0<a.id&&a.type[0]==buildspace.apps.PostContractReport.ProjectStructureConstants.TYPE_BILL&&this.disableToolbarButtons(!1)},!0)},dodblclick:function(a){this.onRowDblClick(a)},onStyleRow:function(a){this.inherited(arguments);if(a.node.children[0]&&2<=a.node.children[0].children[0].rows.length){var b=a.node.children[0].children[0].rows[1],c=a.node.children[0].children[0].rows[0].children;b.parentNode.removeChild(b);
dojo.forEach(c,function(a,b){b=dojo.attr(a,"rowSpan");(!b||2>b)&&dojo.attr(a,"rowSpan",2)})}},onRowDblClick:function(a){a=this.getItem(a.rowIndex);switch(parseInt(a.type)){case buildspace.apps.PostContractReport.ProjectStructureConstants.BILL_TYPE_PRELIMINARY:var b={billId:a.id,billLayoutSettingId:a.billLayoutSettingId,workArea:this.workArea,rootProject:this.rootProject};this.workArea.initTab(a,b);break;case buildspace.apps.PostContractReport.ProjectStructureConstants.TYPE_VARIATION_ORDER:b={rootProject:this.rootProject};
this.workArea.initTab(a,b);break;case buildspace.apps.PostContractReport.ProjectStructureConstants.TYPE_MATERIAL_ON_SITE:this.workArea.initTab(a,{rootProject:this.rootProject})}},disableToolbarButtons:function(a,b){if(a&&b instanceof Array){var c=this;dojo.forEach(b,function(a){(a=dijit.byId(c.rootProject.id+a+"Row-button"))&&a._setDisabledAttr(!1)})}},reload:function(){this.store.close();this._refresh()}}),k={rowCountCellFormatter:function(a,b,c){b=this.grid.getItem(b);void 0!=b.type&&1>b.type&&
c.customClasses.push("invalidTypeItemCell");return 0<a?a:""},unEditablePercentageCellFormatter:function(a,b,c){a=m.parse(a);b=this.grid.getItem(b);void 0!=b.type&&1>b.type?c.customClasses.push("invalidTypeItemCell"):c.customClasses.push("disable-cell");isNaN(a)||0==a||null==a?a="&nbsp;":(c=m.format(a,{places:2})+"%",a=0<=a?'<span style="color:blue;">'+c+"</span>":'<span style="color:#FF0000">'+c+"</span>");return a},treeCellFormatter:function(a,b,c){b=this.grid.getItem(b);var e=16*b.level;a=null==
a?"&nbsp":a;void 0!=b.type&&1>b.type?c.customClasses.push("invalidTypeItemCell"):a='<div class="treeNode" style="padding-left:'+e+'px;"><div class="treeContent">'+a+"&nbsp;</div></div>";return a}};return l("buildspace.apps.PostContractReport.ProjectBreakdown",dijit.layout.BorderContainer,{region:"center",style:"padding:0px;width:100%;height:100%;",gutters:!1,rootProject:null,workArea:null,grid:null,postCreate:function(){this.inherited(arguments);var a=this,b=new dojo.data.ItemFileWriteStore({clearOnClose:!0,
url:"postContract/getProjectBreakdown/id/"+this.rootProject.id}),g=this.grid=v({rootProject:this.rootProject,store:b,workArea:this.workArea});b=new dijit.Toolbar({region:"top",style:"outline:none!important;border-bottom:none;padding:2px;width:100%;"});var e=new n({style:"display: none;"}),f=new n({style:"display: none;"});dojo.forEach(["allItems","provisionalItems"],function(b){var d=new h({id:b+"-"+a.rootProject.id+"-menuItem",label:c[b],onClick:function(){buildspace.app.launch({__children:[],icon:"project_analyzer",
id:a.rootProject.id+"-postcontract_remeasurement",is_app:!0,level:0,sysname:"PostContractRemeasurementReport",title:c.remeasureProvisional},{type:buildspace.constants.STATUS_PRETENDER,opt:b,project:a.rootProject})}});e.addChild(d)});b.addChild(new p({label:c.remeasureProvisional,id:a.rootProject.id+"RemeasureProvisionalRow-button",iconClass:"icon-16-container icon-16-ruler_square",dropDown:e}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({id:a.rootProject.id+"ViewSubPackageRow-button",
label:c.subPackages,iconClass:"icon-16-container icon-16-file",onClick:function(){buildspace.app.launch({__children:[],icon:"view_subpackage",id:a.rootProject.id+"-view_subpackage_report",is_app:!0,level:0,sysname:"PostContractSubPackageReport",title:c.subPackages},{project:a.rootProject})}}));b.addChild(new dijit.ToolbarSeparator);var d=new h({label:c.claimSummary,onClick:function(){a.openPrintClaimSummaryDialog(null,"claimSummary")}});f.addChild(d);d=new h({label:c.claimSummaryWithSubPackages,onClick:function(){a.openPrintClaimSummaryDialog(null,
"claimSummaryWithSubPackages")}});f.addChild(d);b.addChild(new p({label:c.print,iconClass:"icon-16-container icon-16-print",dropDown:f}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({id:a.rootProject.id+"-wastageReport-button",label:c.wastageReport,iconClass:"icon-16-container icon-16-project_analyzer",onClick:function(b){buildspace.app.launch({__children:[],icon:"project_analyzer",id:a.rootProject.id+"-project_analyzer",is_app:!0,level:0,sysname:"ProjectAnalyzerReport",
title:c.projectAnalyzer},{type:buildspace.constants.STATUS_POSTCONTRACT,opt:"resourceAnalysis",project:a.rootProject})}}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({id:a.rootProject.id+"ReloadGridRow-button",label:c.reload,iconClass:"icon-16-container icon-16-reload",onClick:function(){g.reload()}}));this.addChild(b);this.addChild(new dijit.layout.ContentPane({style:"width:100%",content:g,region:"center"}))},openPrintClaimSummaryDialog:function(a,b){var g=c.print+" "+
c.claimSummary,e="postContractReport/printProjectClaimSummary",f="postContractReport/exportExcelProjectClaimReport";null==a&&(a=this);var d=buildspace.dialog.indeterminateProgressBar({title:c.pleaseWait+"..."});d.show();"claimSummaryWithSubPackages"===b&&(g=c.print+" "+c.claimSummaryWithSubPackages,e="postContractReport/printProjectClaimSummaryWithSubPackages",f="postContractReport/exportExcelProjectClaimSummaryWithSubPackages");return t.get("viewTendererReporting/getPrintingInformation",{handleAs:"json"}).then(function(b){b=
new u({projectId:a.rootProject.id,title:g,projectTitle:a.rootProject.title[0],printURL:e,exportURL:f,_csrf_token:b._csrf_token});d.hide();return b.show()},function(){return d.hide()})}})});
