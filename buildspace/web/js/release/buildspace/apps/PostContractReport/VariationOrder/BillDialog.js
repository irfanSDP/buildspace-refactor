define("buildspace/apps/PostContractReport/VariationOrder/BillDialog","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/aspect dojo/html dojo/dom dojo/keys dojo/dom-style dojox/grid/EnhancedGrid dojox/grid/enhanced/plugins/IndirectSelection buildspace/widget/grid/cells/Formatter dojo/i18n!buildspace/nls/PostContract".split(" "),function(k,m,l,n,u,v,p,q,r,w,f,e){var t=k("buildspace.apps.PostContractReport.VariationOrder.BillGrid",r,{type:null,style:"border-top:none;",rowSelector:"0px",region:"center",
locked:!1,variationOrder:null,variationOrderItem:null,variationOrderItemGrid:null,bill:null,dialogWidget:null,updateUrl:null,initialCheckboxSelection:!1,constructor:function(a){this.selectedItemIds=[];this.unSelectedItemIds=[];this.connects=[];a.locked||"update_total_unit-type_reference"!=a.type&&"omit_from_bill-bill_item"!=a.type||(this.plugins={indirectSelection:{headerSelector:!0,width:"20px",styles:"text-align:center;"}});this.inherited(arguments)},canSort:function(a){return!1},dodblclick:function(a){this.onRowDblClick(a)},
doclick:function(a){if(this.locked&&("update_total_unit-type_reference"==this.type||"omit_from_bill-bill_item"==this.type))return!1;this.inherited(arguments)},postCreate:function(){var a=this;a.inherited(arguments);"update_total_unit-type_reference"!=this.type&&"omit_from_bill-bill_item"!=this.type||n.after(this,"_onFetchComplete",function(){a.initialCheckboxSelection||(this.store.fetch({query:{selected:!0},queryOptions:{ignoreCase:!0},onComplete:this.markSelectedCheckBoxes,scope:this}),a.initialCheckboxSelection=
!0)});this.locked||(this._connects.push(l.connect(this,"onCellClick",function(b){a.selectItem(b)})),this._connects.push(l.connect(this.rowSelectCell,"toggleAllSelection",function(b){a.toggleAllSelection(b)})))},markSelectedCheckBoxes:function(a,b){for(var c=0;c<a.length;c++){var d=a[c]._0;this.pushItemIdIntoGridArray(a[c],!0);this.selection.setSelected(d,!0)}},selectItem:function(a){var b=a.rowIndex;a=this.selection.selected[b];((b=this.getItem(b))&&"update_total_unit-type_reference"==this.type&&
0<b.level[0]||"omit_from_bill-bill_item"==this.type&&b.type[0]!=buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER&&b.type[0]!=buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_N&&b.type[0]!=buildspace.widget.grid.constants.HIERARCHY_TYPE_NOID&&b.type[0]!=buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_PC_RATE)&&this.pushItemIdIntoGridArray(b,a)},pushItemIdIntoGridArray:function(a,b){var c=dojo.indexOf(this.selectedItemIds,a.id[0]),d=dojo.indexOf(this.unSelectedItemIds,a.id[0]);b?(-1==
c&&this.selectedItemIds.push(a.id[0]),-1!=d&&this.unSelectedItemIds.splice(d,1)):(-1!=c&&this.selectedItemIds.splice(c,1),-1==d&&this.unSelectedItemIds.push(a.id[0]))},toggleAllSelection:function(a){var b=this,c=b.selection;a?(c.selectRange(0,b.rowCount-1),b.selectedItemIds=[],b.store.fetch({onComplete:function(a){dojo.forEach(a,function(a,c){(a&&"update_total_unit-type_reference"==b.type&&0<a.level[0]||"omit_from_bill-bill_item"==b.type&&a.type[0]!=buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER&&
a.type[0]!=buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_N&&a.type[0]!=buildspace.widget.grid.constants.HIERARCHY_TYPE_NOID&&a.type[0]!=buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_PC_RATE)&&b.selectedItemIds.push(a.id[0])})}}),b.unSelectedItemIds=[]):(b.unSelectedItemIds=[],b.store.fetch({onComplete:function(a){dojo.forEach(a,function(a,c){(a&&"update_total_unit-type_reference"==b.type&&0<a.level[0]||"omit_from_bill-bill_item"==b.type&&a.type[0]!=buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER&&
a.type[0]!=buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_N&&a.type[0]!=buildspace.widget.grid.constants.HIERARCHY_TYPE_NOID&&a.type[0]!=buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_PC_RATE)&&b.unSelectedItemIds.push(a.id[0])})}}),c.deselectAll(),b.selectedItemIds=[])},destroy:function(){this.inherited(arguments);dojo.forEach(this._connects,l.disconnect);delete this._connects}}),h=k("buildspace.apps.PostContractReport.VariationOrder.BillGridContainer",dijit.layout.BorderContainer,
{stackContainerTitle:"",style:"padding:0px;width:100%;height:100%;",gutters:!1,variationOrder:null,variationOrderItem:null,variationOrderItemGrid:null,bill:null,typeUnit:null,dialogWidget:null,gridOpts:{},locked:!1,type:null,pageId:0,postCreate:function(){this.inherited(arguments);m.mixin(this.gridOpts,{type:this.type,variationOrder:this.variationOrder,variationOrderItem:this.variationOrderItem,bill:this.bill,dialogWidget:this.dialogWidget,variationOrderItemGrid:this.variationOrderItemGrid,locked:this.locked});
var a=this.grid=new t(this.gridOpts),b=new dijit.Toolbar({region:"top",style:"padding:2px;border-bottom:none;width:100%;"});b.addChild(new dijit.form.Button({label:e.close,iconClass:"icon-16-container icon-16-close",onClick:dojo.hitch(this.dialogWidget,"hide")}));this.addChild(b);this.addChild(new dijit.layout.ContentPane({style:"width:100%",content:a,region:"center"}));if(b=dijit.byId("variationOrderBillGrid-"+this.variationOrderItem.id+"-stackContainer")){var c=document.createElement("div"),c=new dojox.layout.ContentPane({title:buildspace.truncateString(this.stackContainerTitle,
60),id:this.pageId,executeScripts:!0},c);b.addChild(c);c.set("content",this);m.mixin(c,{grid:a});b.selectChild(this.pageId)}}});return k("buildspace.apps.PostContractReport.VariationOrder.BillDialog",dijit.Dialog,{style:"padding:0px;margin:0px;",title:e.updateTotalUnit,variationOrder:null,variationOrderItem:null,variationOrderItemGrid:null,type:null,locked:!1,buildRendering:function(){this.title="update_total_unit"==this.type?e.updateTotalUnit:e.omitFromBills;var a=this,b,c,d;d=new f;var g=function(a){};
"update_total_unit"==this.type&&0<this.variationOrderItem.bill_item_id[0]?(c=dojo.data.ItemFileWriteStore({url:"variationOrder/getVariationOrderItemUnitList/vid/"+this.variationOrderItem.id,clearOnClose:!0}),b=this.type+"-type_reference",d=[{name:"No",field:"id",styles:"text-align:center;",width:"30px",formatter:d.rowCountCellFormatter},{name:e.description,field:"description",width:"auto",formatter:d.typeListTreeCellFormatter},{name:e.renameDescription,field:"new_name",width:"150px",styles:"text-align:center;",
formatter:d.typeListLevelFormatter}]):(c=dojo.data.ItemFileWriteStore({url:"variationOrder/getBillList/vid/"+this.variationOrderItem.id+"/void/"+this.variationOrder.id,clearOnClose:!0}),b=this.type,d=[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:d.rowCountCellFormatter},{name:e.title,field:"title",width:"auto"}],g=function(b){b=this.getItem(b.rowIndex);0<b.id&&a.createTypeReferenceGrid(b)});b=new h({type:b,variationOrderItem:this.variationOrderItem,variationOrderItemGrid:this.variationOrderItemGrid,
dialogWidget:this,locked:this.locked,gridOpts:{store:c,structure:d,onRowDblClick:g}});b=this.makeGridContainer(b,e.bills);b.startup();this.content=b;this.inherited(arguments)},postCreate:function(){q.set(this.containerNode,{padding:"0px",margin:"0px"});this.closeButtonNode.style.display="none";this.inherited(arguments)},_onKey:function(a){key=a.keyCode;key==p.ESCAPE&&dojo.stopEvent(a)},onHide:function(){this.destroyRecursive()},createTypeReferenceGrid:function(a){var b=this,c=new f,d=dojo.data.ItemFileWriteStore({url:"variationOrder/getTypeReferenceList/vid/"+
this.variationOrderItem.id+"/bid/"+a.id,clearOnClose:!0});new h({stackContainerTitle:a.title,type:this.type+"-type_reference",variationOrderItem:this.variationOrderItem,variationOrderItemGrid:this.variationOrderItemGrid,bill:a,dialogWidget:this,locked:this.locked,pageId:"variationOrderTypeReference-"+this.variationOrderItem+"_"+a.id,gridOpts:{store:d,updateUrl:"variationOrder/renameUnit",structure:[{name:"No",field:"id",styles:"text-align:center;",width:"30px",formatter:c.rowCountCellFormatter},{name:e.description,
field:"description",width:"auto",formatter:c.typeListTreeCellFormatter},{name:e.renameDescription,field:"new_name",width:"150px",styles:"text-align:center;",formatter:c.typeListLevelFormatter}],onRowDblClick:function(c){"omit_from_bill"==b.type&&(c=this.getItem(c.rowIndex),0<c.level&&b.createBillElementGrid(c,a))}}})},createBillElementGrid:function(a,b){var c=this,d=new f,g=dojo.data.ItemFileWriteStore({url:"variationOrder/getBillElementList/bid/"+b.id+"/tid/"+a.id,clearOnClose:!0});new h({stackContainerTitle:a.description,
type:this.type+"-bill_element",variationOrderItem:this.variationOrderItem,bill:b,dialogWidget:this,locked:this.locked,pageId:"variationOrderBillElement-"+this.variationOrderItem+"_"+b.id,gridOpts:{store:g,structure:[{name:"No",field:"id",styles:"text-align:center;",width:"30px",formatter:d.rowCountCellFormatter},{name:e.description,field:"description",width:"auto"}],onRowDblClick:function(d){d=this.getItem(d.rowIndex);0<d.id&&c.createBillItemGrid(b,d,a)}}})},createBillItemGrid:function(a,b,c){var d=
new f,g=dojo.data.ItemFileWriteStore({url:"variationOrder/getBillItemList/eid/"+b.id+"/tid/"+c.id+"/void/"+this.variationOrder.id+"/vid/"+this.variationOrderItem.id,clearOnClose:!0});new h({stackContainerTitle:b.description,type:this.type+"-bill_item",variationOrder:this.variationOrder,variationOrderItem:this.variationOrderItem,variationOrderItemGrid:this.variationOrderItemGrid,bill:a,typeUnit:c,dialogWidget:this,locked:this.locked,pageId:"variationOrderBillItem-"+this.variationOrderItem+"_"+a.id,
gridOpts:{store:g,updateUrl:"variationOrder/renameUnit",structure:[{name:e.billReference,field:"bill_ref",styles:"text-align:center;color:red;",width:"80px",formatter:d.unEditableCellFormatter},{name:e.description,field:"description",width:"auto",formatter:d.treeCellFormatter},{name:e.type,field:"type",width:"70px",styles:"text-align:center;",formatter:d.typeCellFormatter},{name:e.unit,field:"uom_id",width:"70px",styles:"text-align:center;",formatter:d.unitIdCellFormatter},{name:e.qty,field:"qty_per_unit-value",
width:"90px",styles:"text-align:right;",formatter:d.billQuantityCellFormatter},{name:e.rate,field:"rate",width:"120px",styles:"text-align:right;",formatter:d.unEditableCurrencyCellFormatter}]}})},makeGridContainer:function(a,b){var c=this.variationOrderItem.id,d=dijit.byId("variationOrderBillGrid-"+c+"-stackContainer");d&&dijit.byId("variationOrderBillGrid-"+c+"-stackContainer").destroyRecursive();var d=new dijit.layout.StackContainer({style:"width:100%;height:100%;border:0px;",region:"center",id:"variationOrderBillGrid-"+
c+"-stackContainer"}),e=new dijit.layout.ContentPane({title:b,content:a,grid:a.grid});d.addChild(e);var e=new dijit.layout.StackController({region:"top",containerId:"variationOrderBillGrid-"+c+"-stackContainer"}),e=new dijit.layout.ContentPane({style:"padding:0px;overflow:hidden;","class":"breadCrumbTrail",region:"top",content:e}),f=new dijit.layout.BorderContainer({style:"padding:0px;width:"+("omit_from_bill"==this.type?"950px":"850px")+";height:450px;border:0px;",gutters:!1});f.addChild(d);f.addChild(e);
dojo.subscribe("variationOrderBillGrid-"+c+"-stackContainer-selectChild","",function(a){var b=dijit.byId("variationOrderBillGrid-"+c+"-stackContainer");if(b){var d=b.getChildren();for(a=dojo.indexOf(d,a);d.length>a+1;)a+=1,b.removeChild(d[a]),d[a].destroyRecursive()}});return f}})});
