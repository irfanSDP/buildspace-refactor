define("buildspace/apps/PostContractReport/ClaimCertificateContainer","dojo/_base/declare dojo/_base/lang dojo/aspect dojo/html dojo/on dojo/dom dojo/currency dojo/number dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!../PostContract/templates/claimCertificateViewForm.html dojox/grid/EnhancedGrid buildspace/widget/grid/cells/Formatter dojo/i18n!buildspace/nls/PostContract".split(" "),function(f,k,l,g,x,y,z,A,m,n,p,q,r,t,d){var v=f("buildspace.apps.PostContractReport.ClaimCertificateViewForm",
[m,n,p],{templateString:q,baseClass:"buildspace-form",claimCertificate:null,claimCertificateContainer:null,nls:d,startup:function(){this.inherited(arguments);var a=this,b=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."}),c={id:this.claimCertificate.id};b.show().then(function(){dojo.xhrGet({url:"postContract/claimCertificateInfo",handleAs:"json",content:c,load:function(c){a.claimCertificateViewForm.setFormValues(c);g.set(a.accRemarksNode,c.acc_remarks);g.set(a.qsRemarksNode,c.qs_remarks);
b.hide()},error:function(a){b.hide()}})})},postCreate:function(){this.inherited(arguments)}}),w=f("buildspace.apps.PostContractReport.ClaimCertificateGrid",r,{style:"border:none;",region:"center",keepSelection:!0,rowSelector:"0px",claimCertificateContainer:null,constructor:function(a){var b=new t;this.structure={noscroll:!1,cells:[[{name:d.claimNumber,field:"version",width:"80px",styles:"text-align:center;"},{name:d.nettPayableAmount,field:"nett_payable_amount",width:"160px",styles:"text-align:right;",
formatter:b.unEditableCurrencyCellFormatter},{name:d.status,field:"status_txt",width:"150px",styles:"text-align:center;"},{name:d.paidAmount,field:"paid_amount",width:"160px",styles:"text-align:right;",formatter:b.unEditableCurrencyCellFormatter},{name:d.balanceAmount,field:"balance_amount",width:"160px",styles:"text-align:right;",formatter:b.unEditableCurrencyCellFormatter},{name:d.approvalDate,field:"approval_date",width:"120px",styles:"text-align:center;"},{name:d.created_at,field:"created_at",
width:"120px",styles:"text-align:center;"},{name:d.currentPrintingRevision,field:"current_selected_revision",width:"auto",styles:"text-align:center;",formatter:{currentViewingCellFormatter:function(a,b){var c=this.grid.getItem(b);a="&nbsp;";c&&!isNaN(parseInt(c.id[0]))&&(a=c.current_selected_revision[0]?'<div style="margin:auto;" class="icon-16-container icon-16-checkmark2"></div>':'<a href="#" onclick="return false;">'+d.printThisRevision+"</a>");return a}}.currentViewingCellFormatter}]]};this.inherited(arguments)},
canSort:function(a){return!1},postCreate:function(){this.inherited(arguments);this.on("RowClick",function(a){var b=this.getItem(a.rowIndex);"current_selected_revision"!=(a.cell?a.cell.field:null)||isNaN(parseInt(b.id[0]))||b.current_selected_revision[0]||this.setSelectedRevision(b)})},dodblclick:function(a){this.onRowDblClick(a)},onRowDblClick:function(a){this.inherited(arguments);var b=this.getItem(this.selection.selectedIndex),c=a.cell?a.cell.field:null;-1<this.selection.selectedIndex&&b&&!isNaN(parseInt(b.id[0]))&&
"current_selected_revision"!=c&&this.claimCertificateContainer.openClaimCertificateViewForm(b)},setSelectedRevision:function(a){var b=buildspace.dialog.indeterminateProgressBar({title:d.savingData+". "+d.pleaseWait+"..."}),c={id:a.id,_csrf_token:a._csrf_token},u=this,h=this.store;b.show().then(function(){dojo.xhrPost({url:"postContract/claimCertificateSetSelectedRevision",content:c,handleAs:"json",load:function(a){a.success&&(dojo.forEach(a.items,function(a){h.fetchItemByIdentity({identity:a.id,onItem:function(b){h.setValue(b,
"current_selected_revision",a.current_selected_revision)}})}),h.save(),u.claimCertificateContainer.closeBillTabs(),b.hide())},error:function(a){b.hide()}})})},reload:function(){this.store.close();this._refresh()}});return f("buildspace.apps.PostContractReport.ClaimCertificateContainer",dijit.layout.BorderContainer,{style:"padding:0;width:100%;margin:0;border:none;height:100%;",gutters:!1,project:null,workArea:null,postCreate:function(){this.inherited(arguments);var a=this.project;dojo.subscribe("postContractClaimCertificate"+
a.id+"-stackContainer-selectChild","",function(b){var c=dijit.byId("postContractClaimCertificate"+a.id+"-stackContainer");if(c){var d=c.getChildren(),e=dojo.indexOf(d,dijit.byId(b)),e=e+1;if(d.length>e){for(;d.length>e;)c.removeChild(d[e]),d[e].destroyDescendants(),d[e].destroyRecursive(),e+=1;if(b.grid){var f=b.grid.selection.selectedIndex;b.grid.store.save();b.grid.store.close();var g=l.after(b.grid,"_onFetchComplete",function(){g.remove();-1<f&&(this.scrollToRow(f),this.selection.setSelected(f,
!0))});b.grid.sort()}}}});this.grid=new w({title:d.claimCertificateList,claimCertificateContainer:this,store:new dojo.data.ItemFileWriteStore({url:"postContract/getClaimCertificates/pid/"+a.id,handleAs:"json",clearOnClose:!0,urlPreventCache:!0})});var b=dijit.byId("postContractClaimCertificate"+a.id+"-stackContainer");b&&dijit.byId("postContractClaimCertificate"+a.id+"-stackContainer").destroyRecursive();b=this.stackContainer=new dijit.layout.StackContainer({style:"border:0px;width:100%;height:100%;",
region:"center",id:"postContractClaimCertificate"+a.id+"-stackContainer"});b.addChild(this.grid);var c=new dijit.layout.StackController({region:"top",containerId:"postContractClaimCertificate"+a.id+"-stackContainer"}),c=new dijit.layout.ContentPane({style:"padding:0px;overflow:hidden;",baseClass:"breadCrumbTrail",region:"top",id:"postContractClaimCertificateGrid"+a.id+"-controllerPane",content:c});this.addChild(b);this.addChild(c)},openClaimCertificateViewForm:function(a){var b=dijit.byId("postContractClaimCertificate"+
this.project.id+"-stackContainer");if(b){var c=dijit.byId("claimCertificatePage-"+this.project.id);c&&(b.removeChild(c),c.destroyRecursive());switch(Array.isArray(a.status)?a.status[0]:a.status){case buildspace.constants.CLAIM_CERTIFICATE_STATUS_APPROVED:c="#69FA72";break;case buildspace.constants.CLAIM_CERTIFICATE_STATUS_REJECTED:c="#cc1313";break;default:c="#F7D76D"}c=new dijit.layout.BorderContainer({title:d.claimCertificate+" :: "+a.version+" ( <span style='color:"+c+"!important;'>"+a.status_txt+
"</span> )",id:"claimCertificatePage-"+this.project.id,region:"center",style:"padding:0;width:100%;margin:0;border:none;height:100%;",gutters:!1});a=new v({claimCertificate:a,claimCertificateContainer:this,region:"center",style:"width:100%;border:none;height:100%;overflow:auto;"});c.addChild(a);b.addChild(c);b.selectChild("claimCertificatePage-"+this.project.id)}},removeStackContainerChildren:function(){var a=dijit.byId("postContractClaimCertificate"+this.project.id+"-stackContainer");if(a){var b=
dijit.byId("claimCertificatePage-"+this.project.id);b&&(a.removeChild(b),b.destroyRecursive())}},closeBillTabs:function(){return k.hitch(this.workArea,"removeBillTab")()}})});
