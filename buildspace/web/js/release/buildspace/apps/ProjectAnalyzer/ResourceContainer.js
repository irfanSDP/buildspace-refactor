define("buildspace/apps/ProjectAnalyzer/ResourceContainer",["dojo/_base/declare","dojo/aspect","./ResourceGrid","buildspace/widget/grid/cells/Formatter","dojo/i18n!buildspace/nls/ProjectAnalyzer"],function(l,m,h,k,b){return l("buildspace.apps.ProjectAnalyzer.ResourceContainer",dijit.layout.BorderContainer,{style:"padding:0px;width:100%;margin:0px;border:0px;height:100%;",gutters:!1,project:null,type:null,postCreate:function(){this.inherited(arguments);var c=this,d=new k,e=dojo.data.ItemFileWriteStore({url:"projectAnalyzer/getResources/pid/"+
c.project.id,clearOnClose:!0}),d=new h({id:"resource_analysis_category-"+c.project.id,stackContainerTitle:b.resources,pageId:"resource_analysis_category-"+c.project.id,project:c.project,gridOpts:{store:e,escapeHTMLInData:!1,structure:[{name:"No.",field:"id",width:"40px",styles:"text-align:center;",formatter:d.rowCountCellFormatter},{name:b.description,field:"name",width:"auto",formatter:d.analyzerDescriptionCellFormatter},{name:b.totalCost,field:"total_cost",width:"150px",styles:"text-align:right;",
formatter:d.unEditableCurrencyCellFormatter}],onRowDblClick:function(a){a=this.getItem(a.rowIndex);0<a.id&&null!==a.name[0]&&c.createTradeGrid(a)}}}),d=this.makeGridContainer(d,b.resources);this.addChild(d)},createTradeGrid:function(c){var d=this,e=k(),a=new dojo.data.ItemFileWriteStore({url:"projectAnalyzer/getResourceTrades/pid/"+d.project.id+"/id/"+c.id,clearOnClose:!0});h({id:"resource_analysis_trade-"+d.project.id,stackContainerTitle:buildspace.truncateString(c.name,60),pageId:"resource_analysis_trade-"+
d.project.id+"_"+c.id,project:d.project,gridOpts:{store:a,escapeHTMLInData:!1,structure:[{name:"No.",field:"id",width:"40px",styles:"text-align:center;",formatter:e.rowCountCellFormatter},{name:b.description,field:"description",width:"auto",formatter:e.analyzerDescriptionCellFormatter},{name:b.totalCost,field:"total_cost",width:"150px",styles:"text-align:right;",formatter:e.unEditableCurrencyCellFormatter}],onRowDblClick:function(a){a=this.getItem(a.rowIndex);("unsorted"==a.id||0<a.id)&&null!==a.description[0]&&
d.createItemGrid(a,c)}}})},createItemGrid:function(c,d){var e=this,a=k(),g=new dojo.data.ItemFileWriteStore({url:"projectAnalyzer/getResourceItems/pid/"+e.project.id+"/rid/"+d.id+"/id/"+c.id,clearOnClose:!0}),f=[{name:"No.",field:"id",width:"40px",styles:"text-align:center;",formatter:a.rowCountCellFormatter},{name:b.description,field:"description",width:"auto",formatter:a.treeCellFormatter},{name:b.unit,field:"uom_id",width:"70px",styles:"text-align:center;",formatter:a.unitIdCellFormatter},{name:b.rate,
field:"rate-value",width:"120px",styles:"text-align:right;",editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:a.analyzerRateCellFormatter},{name:b.wastage+" (%)",field:"wastage-value",width:"70px",styles:"text-align:right;",editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:a.analyzerWastageCellFormatter},{name:b.totalQty,field:"total_qty",width:"120px",styles:"text-align:right;",formatter:a.unEditableNumberCellFormatter},{name:b.totalCost,field:"total_cost",
width:"120px",styles:"text-align:right;",formatter:a.unEditableCurrencyCellFormatter}];this.type==buildspace.constants.STATUS_POSTCONTRACT&&(f.push({name:b.claimedQty,field:"claim_quantity",width:"120px",styles:"text-align:right;",formatter:a.unEditableNumberCellFormatter}),f.push({name:b.claimedAmount,field:"claim_amount",width:"120px",styles:"text-align:right;",formatter:a.unEditableCurrencyCellFormatter}));h({id:"resource_analysis_item-"+e.project.id,stackContainerTitle:buildspace.truncateString(c.description,
60),pageId:"resource_analysis_item-"+e.project.id+"_"+c.id,project:e.project,gridOpts:{store:g,type:"editable",unsorted:"unsorted"==c.id,escapeHTMLInData:!1,updateUrl:"projectAnalyzer/resourceItemUpdate",structure:f,onRowDblClick:function(a){var b=this.getItem(a.rowIndex);b.hasOwnProperty("multi-rate")&&b["multi-rate"][0]&&"rate-value"==a.cell.field||b.hasOwnProperty("multi-wastage")&&b["multi-wastage"][0]&&"wastage-value"==a.cell.field||0<b.id&&null!==b.description[0]&&b.type!=buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER&&
e.createBillGrid(b,c,d)}}})},createBillGrid:function(c,d,e){var a=k();e=new dojo.data.ItemFileWriteStore({url:"projectAnalyzer/getBills/pid/"+this.project.id+"/rid/"+e.id+"/tid/"+d.id+"/id/"+c.id,clearOnClose:!0});var g=[{name:"No.",field:"id",width:"40px",styles:"text-align:center;",formatter:a.rowCountCellFormatter},{name:b.description,field:"description",width:"auto",formatter:a.analysisTreeCellFormatter},{name:b.unit,field:"uom_id",width:"70px",styles:"text-align:center;",formatter:a.unitIdCellFormatter},
{name:b.totalQty,field:"total_qty",width:"120px",styles:"text-align:right;",formatter:a.unEditableNumberCellFormatter},{name:b.rate,field:"rate-value",width:"120px",styles:"text-align:right;",editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:a.formulaCurrencyCellFormatter},{name:b.totalCost,field:"total_cost",width:"120px",styles:"text-align:right;",formatter:a.unEditableCurrencyCellFormatter},{name:b.wastage+" (%)",field:"wastage-value",width:"70px",styles:"text-align:right;",
editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:a.formulaCurrencyCellFormatter}];this.type==buildspace.constants.STATUS_POSTCONTRACT&&(g.push({name:b.claimedQty,field:"claim_quantity",width:"120px",styles:"text-align:right;",formatter:a.unEditableNumberCellFormatter}),g.push({name:b.claimedAmount,field:"claim_amount",width:"120px",styles:"text-align:right;",formatter:a.unEditableCurrencyCellFormatter}));h({id:"resource_analysis_bill-"+this.project.id,stackContainerTitle:buildspace.truncateString(c.description,
60),pageId:"resource_analysis_bill-"+this.project.id+"_"+c.id,project:this.project,gridOpts:{type:"editable",store:e,unsorted:"unsorted"==d.id,escapeHTMLInData:!1,updateUrl:"projectAnalyzer/billItemUpdate/rid/"+c.id,structure:g}})},makeGridContainer:function(b,d){var e=this.project.id,a=dijit.byId("projectAnalyzer-resource_project_"+e+"-stackContainer");a&&dijit.byId("projectAnalyzer-resource_project_"+e+"-stackContainer").destroyRecursive();var a=new dijit.layout.StackContainer({style:"width:100%;height:100%;border:0px;",
region:"center",id:"projectAnalyzer-resource_project_"+e+"-stackContainer"}),c=new dijit.layout.ContentPane({title:d,content:b,grid:b.grid});a.addChild(c);var c=new dijit.layout.StackController({region:"top",containerId:"projectAnalyzer-resource_project_"+e+"-stackContainer"}),c=new dijit.layout.ContentPane({style:"padding:0px;overflow:hidden;","class":"breadCrumbTrail",region:"top",content:c}),f=new dijit.layout.BorderContainer({style:"padding:0px;width:100%;height:100%;border:0px;",gutters:!1,region:"center"});
f.addChild(a);f.addChild(c);dojo.subscribe("projectAnalyzer-resource_project_"+e+"-stackContainer-selectChild","",function(a){var b=dijit.byId("projectAnalyzer-resource_project_"+e+"-stackContainer");if(b){var c=b.getChildren(),d=dojo.indexOf(c,a);if(c.length>d+1){a.grid.store.save();a.grid.store.close();var f=m.after(a.grid,"_onFetchComplete",function(){f.remove();this.scrollToRow(this.selection.selectedIndex)});a.grid._refresh()}for(;c.length>d+1;)d+=1,b.removeChild(c[d]),c[d].destroyRecursive(!0)}});
return f}})});
