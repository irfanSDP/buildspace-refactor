define("buildspace/apps/ProjectAnalyzer/ScheduleOfRateContainer","dojo/_base/declare dojo/aspect dojo/when dojo/currency ./ScheduleOfRateGrid ./buildUpGrid ./buildUpRateSummary buildspace/widget/grid/cells/Formatter dojo/i18n!buildspace/nls/ProjectAnalyzer".split(" "),function(q,r,t,u,l,v,w,h,a){return q("buildspace.apps.ProjectAnalyzer.ScheduleOfRateContainer",dijit.layout.BorderContainer,{style:"padding:0px;width:100%;margin:0px;border:0px;height:100%;",gutters:!1,project:null,contractorList:null,
postCreate:function(){this.inherited(arguments);var c=this,d=new h,b=dojo.data.ItemFileWriteStore({url:"projectAnalyzer/getScheduleOfRates/pid/"+c.project.id,clearOnClose:!0}),d=new l({id:"sor_analysis_sor-"+c.project.id,stackContainerTitle:a.scheduleOfRates,pageId:"sor_analysis_sor-"+c.project.id,project:c.project,gridOpts:{store:b,structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:d.rowCountCellFormatter},{name:a.name,field:"name",width:"auto",formatter:d.analyzerDescriptionCellFormatter},
{name:a.totalCost,field:"total_cost",width:"150px",styles:"text-align:right;",formatter:d.currencyCellFormatter}],onRowDblClick:function(a){a=this.getItem(a.rowIndex);"unsorted"!=a.id&&0<a.id&&null!==a.name[0]?c.createTradeGrid(a):"unsorted"==a.id&&c.createBillElementGrid(a)}}}),d=this.makeGridContainer(d,a.scheduleOfRates);this.addChild(d)},createTradeGrid:function(c){var d=this,b=h(),g=new dojo.data.ItemFileWriteStore({url:"projectAnalyzer/getScheduleOfRateTrades/pid/"+d.project.id+"/id/"+c.id,
clearOnClose:!0});l({id:"sor_analysis_trade-"+d.project.id,stackContainerTitle:buildspace.truncateString(c.name,60),pageId:"sor_analysis_trade-"+d.project.id+"_"+c.id,project:d.project,gridOpts:{store:g,structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:b.rowCountCellFormatter},{name:a.description,field:"description",width:"auto",formatter:b.analyzerDescriptionCellFormatter},{name:a.totalCost,field:"total_cost",width:"150px",styles:"text-align:right;",formatter:b.currencyCellFormatter}],
onRowDblClick:function(a){a=this.getItem(a.rowIndex);("unsorted"==a.id||0<a.id)&&null!==a.description[0]&&d.createItemGrid(a,c)}}})},createItemGrid:function(c,d){var b=this,g=h(),e=new dojo.data.ItemFileWriteStore({url:"projectAnalyzer/getScheduleOfRateItems/pid/"+b.project.id+"/sorid/"+d.id+"/id/"+c.id,clearOnClose:!0});l({id:"sor_analysis_item-"+b.project.id,stackContainerTitle:buildspace.truncateString(c.description,60),pageId:"sor_analysis_item-"+b.project.id+"_"+c.id,project:b.project,gridOpts:{store:e,
type:"editable",unsorted:"unsorted"==c.id?!0:!1,updateUrl:"projectAnalyzer/scheduleOfRateItemUpdate",isScheduleOfRateItemGrid:!0,structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:g.rowCountCellFormatter},{name:a.description,field:"description",width:"auto",formatter:g.treeCellFormatter},{name:a.unit,field:"uom_id",width:"70px",styles:"text-align:center;",formatter:g.unitIdCellFormatter},{name:a.rate,field:"rate-value",width:"120px",styles:"text-align:right;",editable:!0,
cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:g.analyzerRateCellFormatter},{name:a.itemMarkup+" (%)",field:"item_markup-value",width:"100px",styles:"text-align:right;",editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:g.analyzerItemMarkupCellFormatter},{name:a.totalQty,field:"total_qty",width:"120px",styles:"text-align:right;",formatter:g.unEditableNumberCellFormatter},{name:a.totalCost,field:"total_cost",width:"120px",styles:"text-align:right;",formatter:g.unEditableCurrencyCellFormatter}],
onRowDblClick:function(a){var g=a.cell;a=this.getItem(a.rowIndex);0<a.id&&"item_markup-value"!=g.field&&b.createBillItemGrid(a,c,d)}}})},createBillElementGrid:function(){var c=this,d=h(),b=new dojo.data.ItemFileWriteStore({url:"projectAnalyzer/getSorBillElements/pid/"+c.project.id,clearOnClose:!0});l({id:"sor_analysis_bill_element-"+c.project.id+"_unsorted_container",stackContainerTitle:"UNSORTED",pageId:"sor_analysis_bill_element-"+c.project.id+"_unsorted",project:c.project,gridOpts:{store:b,structure:[{name:"No.",
field:"id",width:"30px",styles:"text-align:center;",formatter:d.rowCountCellFormatter},{name:a.description,field:"description",width:"auto",formatter:d.analysisTreeCellFormatter},{name:a.totalCost,field:"total_cost",width:"150px",styles:"text-align:right;",formatter:d.unEditableCurrencyCellFormatter}],onRowDblClick:function(a){a=this.getItem(a.rowIndex);0<a.id&&null!=a.description[0]&&0<a.type[0]&&c.createUnsortedBillItemGrid(a)}}})},createUnsortedBillItemGrid:function(c){var d=this,b=h(),g=new dojo.data.ItemFileWriteStore({url:"projectAnalyzer/getUnsortedSorBillItems/eid/"+
c.id,clearOnClose:!0}),e;this.contractorList&&0<this.contractorList.items.length?(e=[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:b.rowCountCellFormatter},{name:a.description,field:"description",width:1<this.contractorList.items.length?"500px":"auto",formatter:b.analysisTreeCellFormatter},{name:a.unit,field:"uom_id",width:"70px",styles:"text-align:center;",formatter:b.unitIdCellFormatter},{name:a.totalQty,field:"grand_total_quantity",width:"120px",styles:"text-align:right;",
formatter:b.unEditableNumberCellFormatter},{name:a.rate,field:"rate-value",width:"120px",styles:"text-align:right;",editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:b.formulaCurrencyCellFormatter},{name:a.total,field:"grand_total",width:"120px",styles:"text-align:right;",formatter:b.unEditableCurrencyCellFormatter},{name:a.itemMarkup+" (%)",field:"markup_percentage-value",width:"100px",styles:"text-align:right;",editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",
formatter:b.formulaPercentageCellFormatter}],dojo.forEach(this.contractorList.items,function(a){var c=a.awarded?'<p style="color:#0000FF!important;">'+buildspace.truncateString(a.name,45)+"</p>":buildspace.truncateString(a.name,45);e.push({name:c,field:"contractor_rate-"+a.id+"-value",width:"120px",styles:"text-align:right;",editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:b.formulaCurrencyCellFormatter})})):e=[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",
formatter:b.rowCountCellFormatter},{name:a.description,field:"description",width:"auto",formatter:b.analysisTreeCellFormatter},{name:a.unit,field:"uom_id",width:"70px",styles:"text-align:center;",formatter:b.unitIdCellFormatter},{name:a.totalQty,field:"grand_total_quantity",width:"120px",styles:"text-align:right;",formatter:b.unEditableNumberCellFormatter},{name:a.rate,field:"rate-value",width:"120px",styles:"text-align:right;",editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:b.formulaCurrencyCellFormatter},
{name:a.total,field:"grand_total",width:"120px",styles:"text-align:right;",formatter:b.unEditableCurrencyCellFormatter},{name:a.itemMarkup+" (%)",field:"markup_percentage-value",width:"100px",styles:"text-align:right;",editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:b.formulaPercentageCellFormatter}];l({stackContainerTitle:buildspace.truncateString(c.description,60),pageId:"sor_analysis_bill_item-"+d.project.id+"_"+c.id,project:d.project,gridOpts:{type:"editable",escapeHTMLInData:!1,
store:g,updateUrl:"projectAnalyzer/scheduleOfRateBillItemUpdate",structure:e,onRowDblClick:function(a){var b=this.getItem(a.rowIndex);b["rate-has_build_up"][0]&&"rate-value"==a.cell.field&&d.createBuildUpContainer(b,{id:-1})}}})},createBillItemGrid:function(c,d,b){var g=this,e,f=h();d=new dojo.data.ItemFileWriteStore({url:"projectAnalyzer/getSorBillItems/pid/"+g.project.id+"/sid/"+b.id+"/tid/"+d.id+"/id/"+c.id,clearOnClose:!0});this.contractorList&&0<this.contractorList.items.length?(e=[{name:"No.",
field:"id",width:"30px",styles:"text-align:center;",formatter:f.rowCountCellFormatter},{name:a.description,field:"description",width:1<this.contractorList.items.length?"500px":"auto",formatter:f.analysisTreeCellFormatter},{name:a.unit,field:"uom_id",width:"70px",styles:"text-align:center;",formatter:f.unitIdCellFormatter},{name:a.totalQty,field:"grand_total_quantity",width:"120px",styles:"text-align:right;",formatter:f.unEditableNumberCellFormatter},{name:a.rate,field:"rate-value",width:"120px",styles:"text-align:right;",
editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:f.formulaCurrencyCellFormatter},{name:a.total,field:"grand_total",width:"120px",styles:"text-align:right;",formatter:f.unEditableCurrencyCellFormatter},{name:a.itemMarkup+" (%)",field:"markup_percentage-value",width:"100px",styles:"text-align:right;",editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:f.formulaPercentageCellFormatter}],dojo.forEach(this.contractorList.items,function(a){var b=a.awarded?
'<p style="color:#0000FF!important;">'+buildspace.truncateString(a.name,45)+"</p>":buildspace.truncateString(a.name,45);e.push({name:b,field:"contractor_rate-"+a.id+"-value",width:"120px",styles:"text-align:right;",editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:f.formulaCurrencyCellFormatter})})):e=[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:f.rowCountCellFormatter},{name:a.description,field:"description",width:"auto",formatter:f.analysisTreeCellFormatter},
{name:a.unit,field:"uom_id",width:"70px",styles:"text-align:center;",formatter:f.unitIdCellFormatter},{name:a.totalQty,field:"grand_total_quantity",width:"120px",styles:"text-align:right;",formatter:f.unEditableNumberCellFormatter},{name:a.rate,field:"rate-value",width:"120px",styles:"text-align:right;",editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:f.formulaCurrencyCellFormatter},{name:a.total,field:"grand_total",width:"120px",styles:"text-align:right;",formatter:f.unEditableCurrencyCellFormatter},
{name:a.itemMarkup+" (%)",field:"markup_percentage-value",width:"100px",styles:"text-align:right;",editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:f.formulaPercentageCellFormatter}];l({id:"sor_analysis_bill_item-"+g.project.id,stackContainerTitle:buildspace.truncateString(c.description,60),pageId:"sor_analysis_bill_item-"+g.project.id+"_"+b.id,project:g.project,gridOpts:{type:"editable",escapeHTMLInData:!1,store:d,updateUrl:"projectAnalyzer/scheduleOfRateBillItemUpdate",
structure:e,onRowDblClick:function(a){var c=this.getItem(a.rowIndex);c["rate-has_build_up"][0]&&"rate-value"==a.cell.field&&g.createBuildUpContainer(c,b)}}})},createBuildUpContainer:function(c,d){var b=this,g=buildspace.billCurrencyAbbreviation?buildspace.billCurrencyAbbreviation:buildspace.currencyAbbreviation,e=new dijit.layout.BorderContainer({style:"padding:0px;width:100%;height:100%;border:0px;outline:none;",gutters:!1}),f=new dijit.layout.AccordionContainer({region:"center",style:"padding:0px;width:100%;height:100%;border:0px;outline:none;"}),
m=dojo.xhrGet({url:"projectAnalyzer/buildUpRateResourceList/id/"+c.id,handleAs:"json"}),k=new h,p=buildspace.dialog.indeterminateProgressBar({title:a.pleaseWait+"..."});p.show();t(m,function(n){var h=new w({itemId:c.id,container:e,_csrf_token:c._csrf_token});dojo.forEach(n,function(b){var d=new dojo.data.ItemFileWriteStore({url:"projectAnalyzer/getBuildUpRateItemList/id/"+c.id+"/resource_id/"+b.id,clearOnClose:!0});try{var e=new v({resource:b,billItem:c,updateUrl:"projectAnalyzer/buildUpRateItemUpdate",
store:d,buildUpSummaryWidget:h,structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:k.rowCountCellFormatter},{name:a.description,field:"description",width:"auto",formatter:k.linkedCellFormatter},{name:a.number,field:"number-value",width:"100px",styles:"text-align:right;",editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:k.formulaCurrencyCellFormatter},{name:a.constant,field:"constant-value",width:"100px",styles:"text-align:right;",editable:!0,
cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:k.formulaCurrencyCellFormatter},{name:a.qty,field:"quantity-value",width:"70px",styles:"text-align:right;",editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:k.formulaNumberCellFormatter},{name:a.unit,field:"uom_id",width:"70px",styles:"text-align:center;",formatter:k.unitIdCellFormatter},{name:a.rate,field:"rate-value",width:"110px",styles:"text-align:right;",editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",
formatter:k.formulaCurrencyCellFormatter},{name:a.total,field:"total",width:"110px",styles:"text-align:right;",formatter:k.unEditableCurrencyCellFormatter},{name:a.wastage+" (%)",field:"wastage-value",width:"70px",styles:"text-align:right;",editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:k.formulaCurrencyCellFormatter},{name:a.lineTotal,field:"line_total",width:"120px",styles:"text-align:right;",formatter:k.unEditableCurrencyCellFormatter}]});f.addChild(new dijit.layout.ContentPane({title:b.name+
'<span style="color:blue;float:right;">'+g+"&nbsp;"+u.format(b.total_build_up)+"</span>",style:"padding:0px;border:0px;",doLayout:!1,id:"accPane-"+b.id+"-"+c.id,content:e}))}catch(x){console.log(x)}});e.addChild(f);e.addChild(h);if(n=dijit.byId("projectAnalyzer-sor_project_"+b.project.id+"-stackContainer")){var m=document.createElement("div"),m=new dojox.layout.ContentPane({title:buildspace.truncateString(c.description,60),style:"padding:0px;border:0px;",id:"sor_analysis_build_up-"+b.project.id+"_"+
d.id,executeScripts:!0},m);n.addChild(m);m.set("content",e);n.selectChild("sor_analysis_build_up-"+b.project.id+"_"+d.id)}p.hide()})},makeGridContainer:function(a,d){var b=this.project.id,c=dijit.byId("projectAnalyzer-sor_project_"+b+"-stackContainer");c&&dijit.byId("projectAnalyzer-sor_project_"+b+"-stackContainer").destroyRecursive();var c=new dijit.layout.StackContainer({style:"width:100%;height:100%;border:0px;",region:"center",id:"projectAnalyzer-sor_project_"+b+"-stackContainer"}),e=new dijit.layout.ContentPane({title:d,
content:a,grid:a.grid});c.addChild(e);var e=new dijit.layout.StackController({region:"top",containerId:"projectAnalyzer-sor_project_"+b+"-stackContainer"}),e=new dijit.layout.ContentPane({style:"padding:0px;overflow:hidden;","class":"breadCrumbTrail",region:"top",content:e}),f=new dijit.layout.BorderContainer({style:"padding:0px;width:100%;height:100%;border:0px;",gutters:!1,region:"center"});f.addChild(c);f.addChild(e);dojo.subscribe("projectAnalyzer-sor_project_"+b+"-stackContainer-selectChild",
"",function(a){var c=dijit.byId("projectAnalyzer-sor_project_"+b+"-stackContainer");if(c){var d=c.getChildren(),e=dojo.indexOf(d,a);if(d.length>e+1){a.grid.store.save();a.grid.store.close();var f=r.after(a.grid,"_onFetchComplete",function(){f.remove();this.scrollToRow(this.selection.selectedIndex)});a.grid._refresh()}for(;d.length>e+1;)e+=1,c.removeChild(d[e]),d[e].destroyRecursive(!0)}});return f}})});
