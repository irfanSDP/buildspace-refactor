define("buildspace/apps/ProjectAnalyzer/buildUpGrid","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-attr dojo/_base/connect dijit/TooltipDialog dijit/popup dojox/grid/enhanced/plugins/Menu buildspace/widget/grid/plugins/FormulatedColumn dojo/_base/event dojo/keys dojo/currency dijit/focus dojo/_base/html dojo/request/xhr buildspace/widget/grid/cells/Textarea buildspace/widget/grid/cells/FormulaTextBox dojo/i18n!buildspace/nls/BuildUpGrid".split(" "),function(m,n,u,v,f,p,w,g,q,x,y,r,
z,A,B,C,D,t){return m("buildspace.apps.ProjectAnalyzer.BuildUpGrid",dojox.grid.EnhancedGrid,{resource:null,billItem:null,style:"border-top:none;",selectedItem:null,keepSelection:!0,rowSelector:"0px",updateUrl:null,pasteUrl:null,buildUpSummaryWidget:null,constructor:function(a){this.formulatedColumn=q(this,{});this.currencySetting=buildspace.billCurrencyAbbreviation?buildspace.billCurrencyAbbreviation:buildspace.currencyAbbreviation},canSort:function(a){return!1},canEdit:function(a,e){var c=this,b=
this.getItem(e);if(void 0!=a&&b.hasOwnProperty("id")&&0>b.id[0])window.setTimeout(function(){c.edit.cancel();c.focus.setFocusIndex(e,a.index)},10);else return this._canEdit},postCreate:function(){var a=null;this.inherited(arguments);this._connects.push(f.connect(this,"onCellMouseOver",function(e){var c=e.cell.field,b=e.rowIndex,d=this.getItem(b),c=c.replace("-value","");"undefined"!==typeof d[c+"-has_formula"]&&d[c+"-has_formula"][0]&&(d=d[c+"-value"][0],d=this.formulatedColumn.convertItemIdToRowIndex(d,
b),null===a&&(a=new p({content:d,onMouseLeave:function(){g.close(a)}}),g.open({popup:a,around:e.cellNode})))}));this._connects.push(f.connect(this,"onCellMouseOut",function(){null!==a&&(g.close(a),a=null)}));this._connects.push(f.connect(this,"onStartEdit",function(){null!==a&&(g.close(a),a=null)}))},doApplyCellEdit:function(a,e,c){var b=this,d=b.getItem(e),h=b.store;if(a!==d[c][0]){var f=c.replace("-value","");-1!==c.indexOf("-value")&&(a=this.formulatedColumn.convertRowIndexToItemId(a,e));var f=
{id:d.id,attr_name:f,val:a,_csrf_token:d._csrf_token?d._csrf_token:null},k=this.updateUrl;d.id==buildspace.constants.GRID_LAST_ROW&&(k=0<e?b.getItem(e-1):!1,n.mixin(f,{prev_item_id:k?k.id:0,relation_id:d.relation_id,resource_id:b.resource.id}),k=this.addUrl);var g=function(a,b){for(var c in a)d.hasOwnProperty(c)&&c!=b._getIdentifierAttribute()&&b.setValue(d,c,a[c]),dojo.forEach(a.affected_nodes,function(a){b.fetchItemByIdentity({identity:a.id,onItem:function(c){for(var e in a)d.hasOwnProperty(e)&&
e!=b._getIdentifierAttribute()&&b.setValue(c,e,a[e])}})});b.save()},l=buildspace.dialog.indeterminateProgressBar({title:t.pleaseWait+"..."});l.show();dojo.xhrPost({url:k,content:f,handleAs:"json",load:function(a){if(a.success){0<d.id?g(a.data,h):(h.deleteItem(d),h.save(),dojo.forEach(a.items,function(a){h.newItem(a)}),h.save());b.updateTotalBuildUp(a.total_build_up);var f=b.getCellByField(c);window.setTimeout(function(){b.focus.setFocusIndex(e,f.index)},10)}l.hide()},error:function(a){l.hide()}})}b.inherited(arguments)},
updateTotalBuildUp:function(a){dijit.byId("accPane-"+this.resource.id+"-"+this.billItem.id).set("title",this.resource.name+'<span style="color:blue;float:right;">'+this.currencySetting+"&nbsp;"+r.format(a)+"</span>");this.buildUpSummaryWidget.refreshTotalCost()},destroy:function(){this.inherited(arguments);dojo.forEach(this._connects,f.disconnect);delete this._connects}})});
