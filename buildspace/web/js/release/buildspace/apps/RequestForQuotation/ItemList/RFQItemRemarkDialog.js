(function(){define("buildspace/apps/RequestForQuotation/ItemList/RFQItemRemarkDialog","dojo/_base/declare dojo/_base/lang dojo/on dojo/keys dojo/parser dojo/_base/connect dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/Toolbar dijit/form/Button dijit/layout/BorderContainer dijit/layout/ContentPane dijit/form/ValidationTextBox dijit/form/SimpleTextarea dijit/registry dojo/dom-style dojo/dom-form dojo/request dojox/validate/web dijit/form/Select dijit/form/FilteringSelect dojo/store/Memory dojox/form/Manager dojo/text!./templates/rfqItemRemarkForm.html buildspace/widget/grid/cells/Formatter dojo/i18n!../../../nls/RequestForQuotation buildspace/widget/grid/Filter".split(" "),
function(h,k,u,v,E,w,x,y,z,A,n,F,m,G,H,I,J,l,K,p,L,M,N,O,P,B,C,e,D){var q,r,t;t=h("buildspace.apps.RequestForQuotation.ItemList.RFQItemRemarkGrid",dojox.grid.EnhancedGrid,{style:"border:none;",keepSelection:!0,rowSelector:"0px",newRFQItemRemarkId:-1,rfqItemRemarkId:-1,rfqItemId:-1,rfqItem:null,resourceItemId:-1,rfqItemGridStore:null,dialogContainer:null,_csrf_token:null,postCreate:function(){var a;this.inherited(arguments);a=this;this.on("RowClick",function(a){return(a=this.getItem(a.rowIndex))&&
0<a.id[0]?this.disableToolbarButtons(!1):this.disableToolbarButtons(!0)});return this._connects.push(w.connect(this,"onCellClick",function(c){var b;b=this.getItem(c.rowIndex);return"action"!==c.cell.field?!1:a.updateRFQItemDescription(b)}))},canSort:function(a){return!1},updateRFQItemDescription:function(a){var c,b;b=this;a={"rfq_item_remark[resource_item_id]":b.resourceItemId,"rfq_item_remark[description]":a.description,"rfq_item_remark[_csrf_token]":b._csrf_token};0<b.newRFQItemRemarkId?k.mixin(a,
{rfqItemRemarkId:b.newRFQItemRemarkId,rfqItemId:b.rfqItemId}):k.mixin(a,{rfqItemRemarkId:b.rfqItemRemarkId,rfqItemId:b.rfqItemId});c=buildspace.dialog.indeterminateProgressBar({title:e.pleaseWait+"..."});c.show();return p.post("requestForQuotation/updateSelectedPreviousRFQItemRemark",{data:a,handleAs:"json"}).then(function(a){var d,f,e;c.hide();if(a.success&&0<a.id){b.newRFQItemRemarkId=a.id;b.refreshGrid();a=a.data;for(d in a)b.rfqItem.hasOwnProperty(d)&&d!==b.rfqItemGridStore._getIdentifierAttribute()&&
b.rfqItemGridStore.setValue(b.rfqItem,d,a[d]);return b.dialogContainer.hide()}e=[];for(f in a.errorMsgs)d=b["error-"+f],d.innerHTML=a.errorMsgs[f],e.push(l.set(d,"display","block"));return e},function(a){return c.hide()})},deleteRow:function(a){var c,b,f;b=this;a=this.getItem(a);c=buildspace.dialog.indeterminateProgressBar({title:e.deleting+". "+e.pleaseWait+"..."});c.show();f={url:"requestForQuotation/deleteRFQItemRemark",content:{rfqItemRemarkId:a.id,_csrf_token:a._csrf_token},handleAs:"json",load:function(a){c.hide();
return a.success?b.refreshGrid():console.log(a)},error:function(a){return c.hide()}};return new buildspace.dialog.confirm(e.deleteRFQItemRemarkTitle,e.deleteRFQItemRemarkMsg,80,320,function(){return dojo.xhrPost(f)},function(){return c.hide()})},refreshGrid:function(){this.store.save();this.store.close();return this.setStore(this.store)},disableToolbarButtons:function(a,c){var b=dijit.byId("deleteRemarkFromRequestForQuotationItem");b&&b.set("disabled",a)}});q=h("buildspace.apps.RequestForQuotation.ItemList.RFQItemRemarkForm",
[x,y,z,A],{baseClass:"buildspace-form",style:"overflow: auto;",item:null,rfqId:-1,rfqItemId:-1,resourceItemId:-1,rfqItemRemarkId:-1,newRFQItemRemarkId:-1,templateString:B,region:"center",style:"overflow: auto;",formInfo:null,nls:e,dialogContainer:null,rfqItemGridStore:null,_csrf_token:null,postCreate:function(){var a;this.inherited(arguments);a=this;return u(this.rfqItemRemarkFormSaveButton,"click",function(c){return a.save()})},startup:function(){this.inherited(arguments);return this.rfqItemRemarkForm.setFormValues(this.formInfo)},
clearInputErrorMsgs:function(){var a,c,b,f;b={description:null};f=[];for(c in b)a=this["error-"+c],a.innerHTML=b[c],f.push(l.set(a,"display","none"));return f},save:function(){var a,c,b;b=this;this.clearInputErrorMsgs();if(!this.rfqItemRemarkForm.validate())return!1;a=dojo.formToObject(this.rfqItemRemarkForm.id);c=buildspace.dialog.indeterminateProgressBar({title:e.pleaseWait+"..."});0<b.newRFQItemRemarkId?k.mixin(a,{rfqItemRemarkId:b.newRFQItemRemarkId,rfqItemId:b.rfqItemId,resourceItemId:b.resourceItemId}):
k.mixin(a,{rfqItemRemarkId:b.rfqItemRemarkId,rfqItemId:b.rfqItemId,resourceItemId:b.resourceItemId});c.show();return p.post("requestForQuotation/updateRFQItemRemark",{data:a,handleAs:"json"}).then(function(a){var d,e,f;c.hide();if(a.success&&0<a.id)return b.newRFQItemRemarkId=a.id,b.rfqItemRemarkForm.reset(),b.grid.refreshGrid();f=[];for(e in a.errorMsgs)d=b["error-"+e],d.innerHTML=a.errorMsgs[e],f.push(l.set(d,"display","block"));return f},function(a){return c.hide()})}});r=h("buildspace.apps.RequestForQuotation.ItemList.RFQItemRemarkFormContainer",
m,{gutters:!1,style:"padding:0px;margin:0px;width:750px;height:400px;overflow:hidden;",item:null,rfqId:-1,dialogContainer:null,formInfo:null,rfqItemGridStore:null,_csrf_token:null,postCreate:function(){var a,c,b,f,d,g;this.inherited(arguments);d=this;c=d.item.rfqItemId[0];a=d.item.id[0];f=d.item.rfqItemRemarkId;g=new dojo.data.ItemFileWriteStore({url:"requestForQuotation/getPreviousRFQItemRemarks/rfqItemId/"+c+"/resourceItemId/"+a,clearOnClose:!0,urlPreventCache:!0});b=new t({rfqItemId:c,rfqItemRemarkId:f,
structure:d.getRemarksGridLayout(),store:g,rfqItem:d.item,resourceItemId:a,rfqItemGridStore:d.rfqItemGridStore,dialogContainer:d.dialogContainer,_csrf_token:d._csrf_token,region:"center"});c=new q({item:d.item,rfqId:d.rfqId,rfqItemId:c,resourceItemId:a,rfqItemRemarkId:f,dialogContainer:d.dialogContainer,formInfo:d.formInfo,rfqItemGridStore:d.rfqItemGridStore,_csrf_token:d._csrf_token,grid:b});a=new n({region:"top",style:"outline:none!important;padding:2px;overflow:hidden;"});a.addChild(new dijit.form.Button({label:e.close,
iconClass:"icon-16-container icon-16-close",onClick:function(){return d.dialogContainer.hide()}}));f=new n({region:"top",style:"outline:none!important;padding:2px;overflow:hidden;border-bottom:none;"});f.addChild(new dijit.form.Button({label:e["delete"],id:"deleteRemarkFromRequestForQuotationItem",iconClass:"icon-16-container icon-16-delete",disabled:!0,onClick:function(){return b.deleteRow(b.selection.selectedIndex)}}));g=new m({gutters:!1,style:"width:100%;height:200px;margin:0;padding:0;overflow:hidden;",
region:"top"});g.addChild(a);g.addChild(c);this.addChild(g);a=new m({gutters:!1,style:"width:100%;height:200px;margin:0;padding:0;overflow:hidden;",region:"center"});a.addChild(new D({region:"top",grid:b,editableGrid:!1,filterFields:[{description:e.description}]}));a.addChild(f);a.addChild(b);this.addChild(a)},getRemarksGridLayout:function(){return[{name:"No",field:"id",width:"30px",styles:"text-align: center;",formatter:(new C).rowCountCellFormatter},{name:e.description,field:"description",width:"auto"},
{name:e.action,field:"action",width:"100px",styles:"text-align: center;",formatter:function(a,c,b){a=this.grid.getItem(c);c=a.id;0<c?(a=a.selected[0]?e.selected:e.select,c='<a href="javascript:void(0);">'+a+"</a>"):c="&nbsp;";return c}}]}});return h("buildspace.apps.RequestForQuotation.ItemList.RFQItemRemarkDialog",dijit.Dialog,{style:"padding:0px;margin:0px;width:750px;height:420px;",item:null,rfqId:-1,data:null,rfqItemGridStore:null,buildRendering:function(){var a=this.createContent();this.content=
a;a.startup();return this.inherited(arguments)},postCreate:function(){l.set(this.containerNode,{padding:"0px",margin:"0px"});this.closeButtonNode.style.display="none";return this.inherited(arguments)},createContent:function(){return new r({item:this.item,rfqId:this.rfqId,dialogContainer:this,formInfo:this.data.rfqItemRemarkForm,_csrf_token:this.data.rfqItemRemarkForm._csrf_token,rfqItemGridStore:this.rfqItemGridStore})},_onKey:function(a){if(a.keyCode===v.ESCAPE)return dojo.stopEvent(a)},onHide:function(){return this.destroyRecursive()}})})}).call(this);
