(function(){define("buildspace/apps/RequestForQuotation/SupplierList/SupplierListContainer","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/aspect dojo/dom-attr buildspace/widget/grid/plugins/FormulatedColumn dojox/grid/enhanced/plugins/Menu dojox/grid/enhanced/plugins/Selector dojox/grid/enhanced/plugins/Rearrange dojo/_base/event dojo/keys dojo/dom-style dijit/focus dojo/_base/html dojo/request/xhr dijit/Toolbar dijit/form/Button dijit/form/DropDownButton dijit/DropDownMenu dijit/MenuItem dijit/PopupMenuItem dojo/request dijit/layout/BorderContainer buildspace/widget/grid/cells/Textarea buildspace/widget/grid/cells/Formatter buildspace/widget/grid/cells/FormulaTextBox ./SupplierSelectionGridDialog ./SupplierExcelExport ./SupplierRatesImportDialog ../../CompanyDirectories/CompanyDirectoriesDialog buildspace/widget/grid/Filter dojo/i18n!../../../nls/RequestForQuotation".split(" "),
function(m,H,I,J,K,w,L,M,n,x,N,O,P,y,Q,p,l,z,A,B,R,k,C,S,q,T,D,E,F,G,r,e){var t,u;t=m("buildspace.apps.RequestForQuotation.SupplierList.SupplierItemRatesGrid",dojox.grid.EnhancedGrid,{style:"border-top:none;",keepSelection:!0,rowSelector:"0px",region:"center",rfqId:-1,supplierId:-1,supplierListContainer:null,constructor:function(a){this.rearranger=n(this,{});return this.formulatedColumn=w(this,{})},canSort:function(a){return!1},canEdit:function(a,b){var c,d;d=this;if(void 0!==a)if(c=this.getItem(b),
0<c.id[0]){if(c.type[0]===parseInt(buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER)||c.type[0]===parseInt(buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_N)){window.setTimeout(function(){d.edit.cancel();return d.focus.setFocusIndex(b,a.index)},10);return}}else{window.setTimeout(function(){d.edit.cancel();return d.focus.setFocusIndex(b,a.index)},10);return}return this._canEdit},doApplyCellEdit:function(a,b,c){var d,f,g,h;h=this;d=this.getItem(b);f=d.rfqItemId;return a!==d[c][0]?(f={rfqId:h.rfqId,
supplierId:h.supplierId,rateId:d.rateId,rfqItemId:f,val:a,_csrf_token:d._csrf_token?d._csrf_token:null},g=buildspace.dialog.indeterminateProgressBar({title:e.savingData+". "+e.pleaseWait+"..."}),g.show(),f={url:"requestForQuotation/updateRFQSupplierItemRate",content:f,handleAs:"json",load:function(a){var f,e,v,k;if(a.success)for(k=a.items,e=0,v=k.length;e<v;e++)a=k[e],h.updateStore(d,a);f=h.getCellByField(c);window.setTimeout(function(){return h.focus.setFocusIndex(b,f.index)},10);return g.hide()},
error:function(a){return g.hide()}},dojo.xhrPost(f)):h.inherited(arguments)},updateStore:function(a,b){var c,d,e;d=this.store;e=[];for(c in b)a.hasOwnProperty(c)&&c!==d._getIdentifierAttribute()?e.push(d.setValue(a,c,b[c])):e.push(void 0);return e},updateSupplierStatus:function(a,b,c){var d,f,g;f=this;switch(a){case "pending":g=1;break;case "sent":g=2;break;case "closed":g=4}d=buildspace.dialog.indeterminateProgressBar({title:e.pleaseWait+"..."});d.show();return k.post("requestForQuotation/updateSupplierStatus",
{data:{rfqId:f.rfqId,supplierId:f.supplierId,status:g,_csrf_token:c},handleAs:"json"}).then(function(a){var c;d.hide();return a.success&&0<a.id?((c=dijit.byId("updateSupplierStatusLabel-"+b))&&c.set("label",e.currentSupplierStatus+': <strong style="color: blue;">'+a.status+"</strong>"),f.supplierListContainer.grid.refreshGrid()):console.log("Error")},function(a){return d.hide()})}});u=m("buildspace.apps.RequestForQuotation.SupplierList.SupplierListGrid",dojox.grid.EnhancedGrid,{style:"border-top:none;",
keepSelection:!0,rowSelector:"0px",region:"center",supplierListContainer:null,rfq:null,constructor:function(a){return this.rearranger=n(this,{})},canSort:function(a){return!1},noDataMessage:e.noSupplierAvailableInGrid,postCreate:function(){this.inherited(arguments);this.on("RowClick",function(a){return(a=this.getItem(a.rowIndex))&&0<a.id[0]?this.disableToolbarButtons(!1):this.disableToolbarButtons(!0)});return this.on("RowContextMenu",function(a){var b;this.selection.clear();b=this.getItem(a.rowIndex);
this.selection.setSelected(a.rowIndex,!0);this.contextMenu(a);return b?this.disableToolbarButtons(!1):this.disableToolbarButtons(!0)})},onRowDblClick:function(a){var b,c,d;c=this;d=this.getItem(a.rowIndex);if(0<d.id[0])return b=new buildspace.dialog.indeterminateProgressBar({title:e.processing+"..."}),b.show(),k.get("requestForQuotation/getRFQSupplierItemRates",{query:{rfqId:c.rfq.id[0],supplierId:d.id},handleAs:"json"}).then(function(a){b.hide();return c.createRFQItemRatesViewForSupplier(d,a)},function(a){return b.hide()})},
createRFQItemRatesViewForSupplier:function(a,b){var c,d,f,g,h;g=this;f=new A({style:"display: none;"});c=new dojo.data.ItemFileWriteStore({data:b,clearOnClose:!0,urlPreventCache:!0});d=new t({rfqId:g.rfq.id,supplierId:a.id,store:c,structure:g.getRFQItemRatesViewGridLayout(),supplierListContainer:g.supplierListContainer});h=new p({region:"top",style:"outline:none!important;padding:2px;overflow:hidden;border-bottom:none;"});h.addChild(new l({label:e.rfqViewSupplierInformation,iconClass:"icon-16-container icon-16-zoom_in",
onClick:function(){var b;b=new buildspace.dialog.indeterminateProgressBar({title:e.processing+"..."});b.show();return k.get("companyDirectories/getCompanyInformation",{query:{companyId:a.supplier_id[0]},handleAs:"json"}).then(function(c){b.hide();return(new G({title:e.supplierInformation+" ("+a.supplier_name+")",companyId:a.supplier_id[0],data:c,companyDirectoriesGrid:g,editable:!1})).show()},function(a){return b.hide()})}}));h.addChild(new dijit.ToolbarSeparator);dojo.forEach(["pending","sent","closed"],
function(b){var c;c=new B({label:e[b],onClick:function(){return d.updateSupplierStatus(b,a.id,a._csrf_token)}});return f.addChild(c)});h.addChild(new z({id:"updateSupplierStatusLabel-"+a.id,label:e.currentSupplierStatus+': <strong style="color: blue;">'+a.status[0]+"</strong>",name:"updateSupplierStatus",dropDown:f}));c=new dijit.layout.BorderContainer({style:"padding:0px;width:100%;height:100%;",baseClass:"form",gutters:!1,region:"center"});c.addChild(new r({region:"top",grid:d,editableGrid:!1,filterFields:[{description:e.description},
{quantity:e.quantity},{uom:e.unit},{rate:e.rate},{remarks:e.remarks}]}));c.addChild(h);c.addChild(new dijit.layout.ContentPane({style:"width:100%",content:d,region:"center"}));return g.supplierListContainer.makePane(a.supplier_name,c)},exportDialog:function(a){var b,c,d;d=this;b=this.getItem(a);c=new buildspace.dialog.indeterminateProgressBar({title:e.processing+"..."});c.show();return k.get("requestForQuotationExportFile/getExcelFileNameFormToken",{query:{rfqId:d.rfq.id[0],rfqSupplierId:b.id},handleAs:"json"}).then(function(a){(new E({rfqId:d.rfq.id[0],
rfqSupplierId:b.id,rfqSupplierName:b.supplier_name[0],formInfo:a})).show();return c.hide()},function(a){return c.hide()})},importDialog:function(a){var b,c,d;d=this;b=this.getItem(a);c=new buildspace.dialog.indeterminateProgressBar({title:e.processing+"..."});c.show();return k.get("requestForQuotationExportFile/getImportExcelToken",{query:{rfqId:d.rfq.id[0],rfqSupplierId:b.id},handleAs:"json"}).then(function(a){(new F({rfqId:d.rfq.id[0],rfqSupplierId:b.id,rfqSupplierName:b.supplier_name[0],formInfo:a,
supplierListGrid:d})).show();return c.hide()},function(a){return c.hide()})},deleteRow:function(a){var b,c,d;c=this;a=this.getItem(a);b=buildspace.dialog.indeterminateProgressBar({title:e.deleting+". "+e.pleaseWait+"..."});b.show();d={url:"requestForQuotation/deleteSupplierInfo",content:{rfqId:c.rfq.id,supplierId:a.id,_csrf_token:a._csrf_token},handleAs:"json",load:function(a){b.hide();return a.success?c.refreshGrid():console.log(a)},error:function(a){return b.hide()}};return new buildspace.dialog.confirm(e.deleteSupplierTitle,
e.deleteSupplierMsg,80,320,function(){return dojo.xhrPost(d)},function(){return b.hide()})},refreshGrid:function(){this.store.save();this.store.close();return this.setStore(this.store)},contextMenu:function(a){var b,c,d;d=this.rowCtxMenu=new dijit.Menu;this.contextMenuItems(a);b={target:a.target};c=this.getItem(a.rowIndex);d&&c&&(this.selection.isSelected(a.rowIndex)||a.rowNode&&y.hasClass(a.rowNode,"dojoxGridRowbar"))&&(d._openMyself(b),x.stop(a))},contextMenuItems:function(a){var b;b=this;if(0<
this.getItem(a.rowIndex).id)return b.rowCtxMenu.addChild(new dijit.MenuItem({label:e.addSupplierToRFQ,iconClass:"icon-16-container icon-16-add",onClick:function(){return b.supplierListContainer.generateAddSupplierDialog()}})),b.rowCtxMenu.addChild(new dijit.MenuItem({label:e["delete"],iconClass:"icon-16-container icon-16-delete",disabled:-1<a.rowIndex?!1:!0,onClick:function(){return b.deleteRow(a.rowIndex)}}))},disableToolbarButtons:function(a,b){var c,d,e;c=dijit.byId("deleteSupplierFromRequestForQuotation");
d=dijit.byId("rfqExportExcelBasedOnSupplier");e=dijit.byId("rfqImportExcelBasedOnSupplier");c.set("disabled",a);d.set("disabled",a);return e.set("disabled",a)},getRFQItemRatesViewGridLayout:function(){var a=new q;return[{name:"No",field:"id",width:"30px",styles:"text-align: center;",formatter:a.rowCountCellFormatter},{name:e.description,field:"description",width:"auto",formatter:a.treeCellFormatter},{name:e.quantity,field:"quantity",width:"90px",styles:"text-align: right;",cellType:"buildspace.widget.grid.cells.FormulaTextBox",
formatter:a.rfqQuantityCellFormatter},{name:e.unit,field:"uom",width:"70px",styles:"text-align: center;",formatter:a.rfqUnitCellFormatter},{name:e.rate,field:"rate",width:"90px",styles:"text-align: right;",cellType:"buildspace.widget.grid.cells.FormulaTextBox",editable:!0,formatter:a.rfqQuantityCellFormatter},{name:e.remarks,field:"remarks",width:"280px",formatter:a.rfqSupplierRemarkCellFormatter}]}});return m("buildspace.apps.RequestForQuotation.SupplierList.SupplierListContainer",C,{rfq:null,style:"padding:0px;width:100%;height:100%;",
title:e.rfqSupplierListTabDesc,gutters:!1,formInfo:null,postCreate:function(){var a,b,c,d,f;this.inherited(arguments);c=this;(d=dijit.byId("requestForQuotationSupplierMaintenance-stackContainer"))&&dijit.byId("requestForQuotationSupplierMaintenance-stackContainer").destroyRecursive();d=c.stackContainer=new dijit.layout.StackContainer({style:"width:100%;height:100%;",region:"center",id:"requestForQuotationSupplierMaintenance-stackContainer"});a=new dojo.data.ItemFileWriteStore({url:"requestForQuotation/getRFQSupplierListing/rfqId/"+
c.rfq.id[0],clearOnClose:!0,urlPreventCache:!0});b=this.grid=new u({id:"supplier-list-container-"+c.rfq.id[0],structure:c.getGridLayout(),store:a,rfq:this.rfq,supplierListContainer:c});f=new p({region:"top",style:"outline:none!important;padding:2px;border:none;width:100%;"});f.addChild(new l({label:e.addSupplierToRFQ,iconClass:"icon-16-container icon-16-add",onClick:function(){return c.generateAddSupplierDialog()}}));f.addChild(new dijit.ToolbarSeparator);f.addChild(new l({label:e["delete"],id:"deleteSupplierFromRequestForQuotation",
iconClass:"icon-16-container icon-16-delete",disabled:!0,onClick:function(){return b.deleteRow(b.selection.selectedIndex)}}));f.addChild(new dijit.ToolbarSeparator);f.addChild(new l({id:"rfqExportExcelBasedOnSupplier",label:e.exportItems,iconClass:"icon-16-container icon-16-export",disabled:!0,onClick:function(){return b.exportDialog(b.selection.selectedIndex)}}));f.addChild(new dijit.ToolbarSeparator);f.addChild(new l({id:"rfqImportExcelBasedOnSupplier",label:e.importSupplierRates,iconClass:"icon-16-container icon-16-import",
disabled:!0,onClick:function(){return b.importDialog(b.selection.selectedIndex)}}));a=new dijit.layout.BorderContainer({region:"top",gutters:!1});a.addChild(new r({region:"top",editableGrid:!1,grid:b,filterFields:[{supplier_name:e.supplier,registration_no:e.registrationNo,status:e.status}]}));a.addChild(f);a.addChild(new dijit.layout.ContentPane({style:"width:100%",content:b,region:"center"}));a=new dijit.layout.ContentPane({title:e.rfqSupplierListTabDesc,content:a});d.addChild(a);a=new dijit.layout.StackController({region:"top",
containerId:"requestForQuotationSupplierMaintenance-stackContainer"});a=new dijit.layout.ContentPane({style:"padding: 0px; overflow: hidden;",baseClass:"breadCrumbTrail",region:"top",content:a});this.addChild(d);this.addChild(a);return dojo.subscribe("requestForQuotationSupplierMaintenance-stackContainer-selectChild","",function(a){var b,c,d;if(c=dijit.byId("requestForQuotationSupplierMaintenance-stackContainer")){b=c.getChildren();a=dojo.indexOf(b,dijit.byId(a.id));a+=1;for(d=[];b.length>a;)c.removeChild(b[a]),
b[a].destroyRecursive(),d.push(a+=1);return d}})},generateAddSupplierDialog:function(){var a,b;b=this;a=buildspace.dialog.indeterminateProgressBar({title:e.pleaseWait+"..."});a.show();return k.get("requestForQuotation/getCompanyListing",{query:{rfqId:b.rfq.id},handleAs:"json"}).then(function(c){(new D({title:e.addSupplierToRFQ,rfqId:b.rfq.id,supplierListContainer:b,data:c})).show();return a.hide()},function(b){return a.hide()})},makePane:function(a,b){var c=dijit.byId("requestForQuotationSupplierMaintenance-stackContainer"),
d=new dijit.layout.ContentPane({title:a,content:b});c.addChild(d);return c.selectChild(d)},getGridLayout:function(){return[{name:"No",field:"id",width:"30px",styles:"text-align: center;",formatter:(new q).rowCountCellFormatter},{name:e.supplier,field:"supplier_name",width:"auto"},{name:e.registrationNo,field:"registration_no",width:"120px",styles:"text-align: center;"},{name:e.status,field:"status",width:"120px",styles:"text-align: center;"},{name:e.updatedAt,field:"updated_at",width:"120px",styles:"text-align: center;"}]}})})}).call(this);
