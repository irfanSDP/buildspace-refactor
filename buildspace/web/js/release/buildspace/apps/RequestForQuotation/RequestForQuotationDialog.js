(function(){define("buildspace/apps/RequestForQuotation/RequestForQuotationDialog","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/on dojo/request dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/html dojo/dom dojo/dom-attr dojo/keys dojo/dom-style dijit/layout/TabContainer dijit/layout/ContentPane dijit/layout/BorderContainer dijit/Toolbar dijit/form/FilteringSelect dijit/form/Select dijit/form/Button dojo/store/Memory dojox/form/Manager dojo/text!./templates/requestForQuotationForm.html ./AssignProjectGrid dojo/i18n!../../nls/RequestForQuotation".split(" "),
function(h,k,D,l,m,r,t,u,v,E,F,e,w,f,G,H,x,y,n,z,p,A,I,B,C,g){var q;q=h("buildspace.apps.RequestForQuotation.RequestForQuotationForm",[r,t,u,v],{baseClass:"buildspace-form",rfqId:-1,newRFQId:-1,stateValue:-1,templateString:B,region:"center",style:"overflow: auto;",formInfo:null,dialogContainer:null,requestForQuotationGrid:null,rfqTypeSelections:null,rfqStatusSelections:null,currentRFQNo:null,nls:g,postCreate:function(){var a;this.inherited(arguments);a=this;l(this.assignProjectGridAction,"click",
function(b){return(new C({rfqId:a.newRFQId,rfqForm:a})).show()});l(this.rfqPrefix,"change",function(b){return a.updateFormView()});this.createDropdown();return this.setRequiredFields()},startup:function(){this.inherited(arguments);this["rfqForm-"+this.rfqId].setFormValues(this.formInfo);return this.toggleProjectInformationContainer()},createDropdown:function(){var a,b,c;b=this;(new z({name:"rfq[type]",store:new A({idProperty:"id",data:b.rfqTypeSelections}),labelAttr:"name",style:"width: 180px;padding:2px!important;",
selected:b.formInfo["rfq[type]"],required:!0,onChange:function(a){var c;b.toggleProjectInformationContainer(a);b.setRequiredFields(a);c=e.get(b.projectStructureIdInput,"value");b.currentRFQNo=null;b.countrySelect.set("value",0);b.stateValue=0;if(a===buildspace.constants.RFQ_TYPE_RESOURCE)return b.updateResourceRFQNo();if(null==c||!c.length)return a=dijit.byId("rfq-form-button-save"),a.set("disabled",!0)}})).placeAt(b.typeSelectDivNode);a=new dojo.data.ItemFileReadStore({url:"projectBuilder/getCountry"});
this.stateSelectStore=c=new dojo.data.ItemFileReadStore({url:"projectBuilder/getStateByCountry/regionId/"+b.formInfo["rfq[region_id]"]});this.countrySelect=(new n({name:"rfq[region_id]",store:a,style:"width: 180px;padding:2px!important;",searchAttr:"name",value:b.formInfo["rfq[region_id]"],required:!0,onChange:function(a){return b.updateStateSelectStore(a)}})).placeAt(b.countrySelectDivNode);return this.stateSelect=(new n({name:"rfq[sub_region_id]",store:c,style:"width: 180px;padding:2px!important;",
searchAttr:"name",readOnly:0<b.formInfo["rfq[sub_region_id]"]?!1:!0,value:b.formInfo["rfq[sub_region_id]"],required:!0})).placeAt(b.stateSelectDivNode)},updateStateSelectStore:function(a){null==a&&(a=0);a||(a=0);this.stateSelectStore=new dojo.data.ItemFileReadStore({url:"projectBuilder/getStateByCountry/regionId/"+a,clearOnClose:!0});this.stateSelect.store.close();this.stateSelect.set("store",this.stateSelectStore);if(this.stateValue)return this.stateSelect.set("value",this.stateValue)},clearInputErrorMsgs:function(){var a,
b,c,d;c={name:null,registration_no:null,about:null,contact_person_name:null,contact_person_email:null,contact_person_direct_line:null,contact_person_mobile:null,phone_number:null,fax_number:null,address:null,postcode:null,website:null};d=[];for(b in c)a=this["error-"+b],a.innerHTML=c[b],d.push(f.set(a,"display","none"));return d},save:function(){var a,b,c;c=this;if(!this["rfqForm-"+this.rfqId].validate())return!1;a=dojo.formToObject(this["rfqForm-"+this.rfqId].id);b=buildspace.dialog.indeterminateProgressBar({title:g.pleaseWait+
"..."});0<c.newRFQId?k.mixin(a,{rfqId:c.newRFQId}):k.mixin(a,{rfqId:c.rfqId});b.show();return m.post("requestForQuotation/updateRFQInformation",{data:a,handleAs:"json"}).then(function(a){var d,e;if(a.success&&0<a.id)c.newRFQId=a.id,c.requestForQuotationGrid.refreshGrid(),c.dialogContainer.hide();else for(e in a.errorMsgs)"username"!==e&&(d=c["error-"+e],d.innerHTML=a.errorMsgs[e],f.set(d,"display","block"));return b.hide()},function(a){return b.hide()})},toggleProjectInformationContainer:function(a){null==
a&&(a=1);if(a===buildspace.constants.RFQ_TYPE_PROJECT)return f.set(this.projectNameContainer,"display","table-row"),f.set(this.projectSiteAddressContainer,"display","table-row");f.set(this.projectNameContainer,"display","none");return f.set(this.projectSiteAddressContainer,"display","none")},setRequiredFields:function(a){var b,c,d;null==a&&(a=1);c=this.rfqPrefix;b=this.countrySelect;d=this.stateSelect;if(a===buildspace.constants.RFQ_TYPE_PROJECT)return c.set("required",!0),b.set("required",!1),d.set("required",
!1),b.set("readOnly",!0),d.set("readOnly",!0);c.set("required",!1);b.set("required",!0);d.set("required",!0);b.set("readOnly",!1);return d.set("readOnly",!1)},updateResourceRFQNo:function(){var a;a=this;return m.get("requestForQuotation/getResourceRFQNo",{handleAs:"json"}).then(function(b){a.currentRFQNo=b.rfqCount;dijit.byId("rfq-form-button-save").set("disabled",!1);a.assignProjectTitle.innerHTML=null;a.projectSiteAddress.innerHTML=null;e.set(a.projectStructureIdInput,"value",null);e.set(a.rfqCountInput,
"value",b.rfqCount);a.rfqPrefix.set("value",null);a.rfqPrefix.set("readOnly",!1);return a.updateFormView()},function(a){return console.log(a)})},updateFormView:function(){var a;a=e.get(this.rfqPrefix,"value");return this.rfqNoContainer.innerHTML=null!==this.currentRFQNo?a?""+a+this.currentRFQNo:this.currentRFQNo:"undefined"!==typeof typeId&&null!==typeId&&typeId===buildspace.constants.RFQ_TYPE_RESOURCE?this.currentRFQNo:null}});return h("buildspace.apps.RequestForQuotation.RequestForQuotationDialog",
dijit.Dialog,{rfqId:-1,style:"padding:0px;margin:0px;width:560px;height:320px;",billId:null,data:null,requestForQuotationGrid:null,buildRendering:function(){var a;this.content=a=this.createContent();a.startup();return this.inherited(arguments)},postCreate:function(){f.set(this.containerNode,{padding:"0px",margin:"0px"});this.closeButtonNode.style.display="none";return this.inherited(arguments)},createContent:function(){var a,b,c,d;c=this;b=new q({rfqId:c.rfqId,dialogContainer:c,formInfo:c.data.requestForQuotationForm,
rfqTypeSelections:c.data.rfqTypeSelections,rfqStatusSelections:c.data.rfqStatusSelections,requestForQuotationGrid:c.requestForQuotationGrid});d=new y({region:"top",style:"outline:none!important;padding:2px;overflow:hidden;"});d.addChild(new p({label:g.save,iconClass:"icon-16-container icon-16-save",onClick:function(){return b.save()},id:"rfq-form-button-save",disabled:!0}));d.addChild(new dijit.ToolbarSeparator);d.addChild(new p({label:g.close,iconClass:"icon-16-container icon-16-close",onClick:function(){return c.hide()}}));
a=new x({style:"width:560px;height:320px;padding:0;margin:0;",gutters:!1});a.addChild(d);a.addChild(b);return a},_onKey:function(a){if(a.keyCode===w.ESCAPE)return dojo.stopEvent(a)},onHide:function(){return this.destroyRecursive()}})})}).call(this);
