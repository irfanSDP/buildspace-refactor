(function(){define("buildspace/apps/StockOutReport/StockOutItemGridContainer","dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/aspect dojox/grid/enhanced/plugins/Selector dojox/grid/enhanced/plugins/Rearrange buildspace/widget/grid/Filter dijit/Toolbar dijit/form/Button dijit/form/DropDownButton dojo/_base/event dijit/layout/BorderContainer dojo/keys dijit/focus dojo/request dijit/Menu dijit/DropDownMenu dijit/MenuItem buildspace/widget/grid/cells/Formatter dojox/grid/enhanced/plugins/IndirectSelection dojo/store/Memory dojo/i18n!../../nls/StockOut".split(" "),
function(g,m,x,p,y,q,k,z,A,r,B,t,C,D,u,E,v,w,f,F,n,b){var h=g("buildspace.apps.StockOutReport.StockOutItemGrid",dojox.grid.EnhancedGrid,{project:null,resource:null,resourceTrade:null,type:null,escapeHTMLInData:!1,style:"border-top:none;",keepSelection:!0,rowSelector:"0px",region:"center",gridContainer:null,stockOutWorkAreaContainer:null,constructor:function(a){this.rearranger=q(this,{});if(null!=a.type&&"item"===a.type)return this.type=a.type,this.plugins={indirectSelection:{headerSelector:!0,width:"40px",
styles:"text-align: center;"}}},postCreate:function(){this.inherited(arguments);var a=this;if("item"===this.type)return p.after(this,"_onFetchComplete",function(){return a.markedCheckBoxObject(a,a.stockOutWorkAreaContainer.resourceTradeItemStore[a.resource.id[0]][a.resourceTrade.id[0]])}),this._connects.push(m.connect(this,"onCellClick",function(b){if(""===b.cell.name)return a.singleCheckBoxSelection(b)})),this._connects.push(m.connect(this.rowSelectCell,"toggleAllSelection",function(b){return a.toggleAllSelection(b)}))},
canSort:function(a){return!1},refreshGrid:function(){this.store.save();this.store.close();return this.setStore(this.store)},arrayUnique:function(a){return a.reverse().filter(function(a,b,e){return-1===e.indexOf(a,b+1)}).reverse()},markedCheckBoxObject:function(a,b){var c=a.store;return b.query().forEach(function(b){return 0>b.id[0]?!1:c.fetchItemByIdentity({identity:b.id,onItem:function(b){return b?a.rowSelectCell.toggleRow(b._0,!0):!1}})})}});return g("buildspace.apps.StockOutReport.StockOutItemGridContainer",
t,{stockOutWorkAreaContainer:null,project:null,resource:null,resourceTrade:null,style:"height:100%;width:100%;padding:0;margin:0;",gutters:!1,postCreate:function(){this.inherited(arguments);var a=this;var d=new dojo.data.ItemFileWriteStore({url:"stockOut/getItemListingsWithDeliveryOrder/projectId/"+a.project.id[0]+"/resourceTradeId/"+a.resourceTrade.id[0],clearOnClose:!0,urlPreventCache:!0});var c=new h({type:"item",project:this.project,resource:this.resource,resourceTrade:this.resourceTrade,gridContainer:a,
stockOutWorkAreaContainer:a.stockOutWorkAreaContainer,structure:a.getResourceItemGridLayout(),store:d,onRowDblClick:function(b){a=this;var c=b.cell.field;b=this.getItem(b.rowIndex);if(0>b.id[0])return!1;if("total_cost"===c)return a.gridContainer.createViewTotalCostItemGridInDepthInformationGrid(b);if("do_quantity"===c)return a.gridContainer.createViewDeliveryOrderQuantityItemGridInDepthInformationGrid(b);if("stock_out_quantity"===c)return a.gridContainer.createViewStockOutQuantityItemGridInDepthInformationGrid(b)},
singleCheckBoxSelection:function(a){void 0===this.stockOutWorkAreaContainer.resourceTradeItemStore[this.resource.id[0]][this.resourceTrade.id[0]]&&(this.stockOutWorkAreaContainer.resourceTradeItemStore[this.resource.id[0]][this.resourceTrade.id[0]]=new n({idProperty:"id"}));var b=a.rowIndex;a=this.selection.selected[b];b=this.getItem(b);return a?this.getAffectedResourceTradeByResourceItem(b,"add"):this.getAffectedResourceTradeByResourceItem(b,"remove")},toggleAllSelection:function(b){void 0===this.stockOutWorkAreaContainer.resourceTradeItemStore[this.resource.id[0]][this.resourceTrade.id[0]]&&
(this.stockOutWorkAreaContainer.resourceTradeItemStore[this.resource.id[0]][this.resourceTrade.id[0]]=new n({idProperty:"id"}));a=this;d=this.store;var c=this.selection;var e=this.stockOutWorkAreaContainer.resourceTradeItemStore[this.resource.id[0]][this.resourceTrade.id[0]];if(b)return c.selectRange(0,a.rowCount-1),d.fetch({onComplete:function(a){return dojo.forEach(a,function(a,b){if(0<a.id[0])return e.put({id:a.id[0]})})}}),a.getAffectedResourceTradeByResourceItem(null,"add");c.deselectAll();return a.getAffectedResourceTradeByResourceItem(null,
"remove")},getAffectedResourceTradeByResourceItem:function(c,d){a=this;var e=this.stockOutWorkAreaContainer.resourceTradeItemStore[a.resource.id[0]][a.resourceTrade.id[0]];var f=[];var g=buildspace.dialog.indeterminateProgressBar({title:b.pleaseWait+"..."});g.show();if(c){if(0>c.id[0])return g.hide(),!1;e.put({id:c.id[0]});f.push(c.id[0])}else e.query().forEach(function(a){return f.push(a.id)});return u.post("stockOutReporting/getAffectedResourceTradeByItem",{handleAs:"json",data:{projectId:a.project.id[0],
resourceTradeId:a.resourceTrade.id[0],resource_item_ids:JSON.stringify(a.arrayUnique(f))}}).then(function(b){var c,e;var f=dijit.byId("stockOutReport-resourceTrade-container-"+a.project.id[0]+"-"+a.resource.id[0]);for(c in b){var k=b[c];var h=0;for(e=k.length;h<e;h++){var l=k[h];"add"===d?(f.store.fetchItemByIdentity({identity:c,onItem:function(b){if(b)return a.stockOutWorkAreaContainer.resourceTradePreviewStore[a.resource.id[0]].put({id:c}),f.rowSelectCell.toggleRow(b._0,!0)}}),a.stockOutWorkAreaContainer.resourceTradeItemStore[a.resource.id[0]][c].put({id:l}),
a.stockOutWorkAreaContainer.resourceAllTradeItemStore[a.resource.id[0]].put({id:l})):(a.stockOutWorkAreaContainer.resourceTradeItemStore[a.resource.id[0]][c].remove(l),a.stockOutWorkAreaContainer.resourceAllTradeItemStore[a.resource.id[0]].remove(l),f.store.fetchItemByIdentity({identity:c,onItem:function(b){if(b&&0===a.stockOutWorkAreaContainer.resourceTradeItemStore[a.resource.id[0]][c].data.length)return a.stockOutWorkAreaContainer.resourceTradePreviewStore[a.resource.id[0]].remove(c),f.rowSelectCell.toggleRow(b._0,
!1)}}))}}return g.hide()},function(a){console.log(a);return g.hide()})}});var e=new k({region:"top",grid:c,editableGrid:!1,filterFields:[{description:b.description},{unit:b.unit}]});var f=new v({style:"display: none;"});f.addChild(new w({label:b.printItemsByResourceTrade,iconClass:"icon-16-container icon-16-print",onClick:function(){return a.stockOutWorkAreaContainer.openBillPreviewDialogForSelectedItems(a.resource)}}));var g=new dijit.Toolbar({style:"outline:none!important; border-bottom:none; padding:2px; width:100%;",
region:"top"});g.addChild(new r({label:b.print,id:"stockOutReport-resourceTrade-printButton-"+a.project.id[0]+"-"+a.resource.id[0]+"-"+a.resourceTrade.id[0],iconClass:"icon-16-container icon-16-print",dropDown:f}));this.addChild(e);this.addChild(g);return this.addChild(new dijit.layout.ContentPane({style:"width:100%",content:c,region:"center"}))},createViewTotalCostItemGridInDepthInformationGrid:function(a,d){null==d&&(d=this);var c=new dojo.data.ItemFileWriteStore({url:"stockOut/getInvoiceCostingsByResourceItem/projectId/"+
this.project.id[0]+"/resourceItemId/"+a.id[0],clearOnClose:!0,urlPreventCache:!0});var e=new h({project:this.project,resourceItem:a,store:c,structure:d.getInvoiceGridLayout()});c=new dijit.layout.BorderContainer({style:"padding:0px;width:100%;height:100%;",baseClass:"form",gutters:!1,region:"center"});c.addChild(new k({region:"top",grid:e,editableGrid:!1,filterFields:[{invoice_no:b.invoiceNo},{supplier_name:b.supplier},{issued_by:b.issued_by}]}));c.addChild(new dijit.layout.ContentPane({style:"width:100%",
content:e,region:"center"}));return d.stockOutWorkAreaContainer.makePane(this.resource,a.description[0],c)},createViewDeliveryOrderQuantityItemGridInDepthInformationGrid:function(a,d){null==d&&(d=this);var c=new dojo.data.ItemFileWriteStore({url:"stockOut/getDeliveryOrderCostingsByResourceItem/projectId/"+this.project.id[0]+"/resourceItemId/"+a.id[0],clearOnClose:!0,urlPreventCache:!0});var e=new h({project:this.project,resourceItem:a,store:c,structure:d.getDeliveryOrderGridLayout()});c=new dijit.layout.BorderContainer({style:"padding:0px;width:100%;height:100%;",
baseClass:"form",gutters:!1,region:"center"});c.addChild(new k({region:"top",grid:e,editableGrid:!1,filterFields:[{invoice_no:b.invoiceNo},{delivery_order_no:b.doNo},{supplier_name:b.supplier}]}));c.addChild(new dijit.layout.ContentPane({style:"width:100%",content:e,region:"center"}));return d.stockOutWorkAreaContainer.makePane(this.resource,a.description[0],c)},createViewStockOutQuantityItemGridInDepthInformationGrid:function(a,d){null==d&&(d=this);var c=new dojo.data.ItemFileWriteStore({url:"stockOut/getStockOutQtyByResourceItem/projectId/"+
this.project.id[0]+"/resourceItemId/"+a.id[0],clearOnClose:!0,urlPreventCache:!0});var e=new h({project:this.project,resourceItem:a,store:c,structure:d.getStockOutGridLayout()});c=new dijit.layout.BorderContainer({style:"padding:0px;width:100%;height:100%;",baseClass:"form",gutters:!1,region:"center"});c.addChild(new k({region:"top",grid:e,editableGrid:!1,filterFields:[{running_number:b.stockOutNo},{creator_name:b.created_by}]}));c.addChild(new dijit.layout.ContentPane({style:"width:100%",content:e,
region:"center"}));return d.stockOutWorkAreaContainer.makePane(this.resource,a.description[0],c)},getResourceItemGridLayout:function(){var a=new f;return[{name:"No",field:"id",width:"30px",styles:"text-align: center;",formatter:a.rowCountCellFormatter,noresize:!0},{name:b.description,field:"description",width:"auto",formatter:a.treeCellFormatter,noresize:!0},{name:b.unit,field:"uom_id",styles:"text-align: center;",width:"70px",formatter:a.unitIdCellFormatter,noresize:!0},{name:b.totalCostWithTax,
field:"total_cost",styles:"text-align:right;color:blue;",width:"140px",formatter:a.unEditableCurrencyCellFormatter,noresize:!0},{name:b.doQuantity,field:"do_quantity",styles:"text-align:right;color:blue;",width:"120px",formatter:a.unEditableCurrencyCellFormatter,noresize:!0},{name:b.stockOutQuantity,field:"stock_out_quantity",styles:"text-align:right;color:blue;",width:"120px",formatter:a.unEditableCurrencyCellFormatter,noresize:!0},{name:b.balanceQuantity,field:"balance_quantity",styles:"text-align:right;",
width:"120px",formatter:a.unEditableCurrencyCellFormatter,noresize:!0}]},getInvoiceGridLayout:function(){var a=new f;return[{name:"No",field:"id",width:"30px",styles:"text-align: center;",formatter:a.rowCountCellFormatter,noresize:!0},{name:b.invoiceNo,field:"invoice_no",styles:"text-align: center; color: red;",width:"140px",noresize:!0},{name:b.supplier,field:"supplier_name",styles:"text-align: center;",width:"auto",noresize:!0},{name:b.rate,field:"rates",styles:"text-align:right;",width:"75px",
formatter:a.unEditableCurrencyCellFormatter,noresize:!0},{name:b.discount+" %",field:"discount_percentage",styles:"text-align:right;",width:"75px",formatter:a.unEditableCurrencyCellFormatter,noresize:!0},{name:b.tax+" %",field:"tax_percentage",styles:"text-align:right;",width:"75px",formatter:a.unEditableCurrencyCellFormatter,noresize:!0},{name:b.quantity,field:"quantity",width:"90px",styles:"text-align: right;",formatter:a.unEditableCurrencyCellFormatter,noresize:!0},{name:b.totalWithoutTax,field:"total_without_tax",
styles:"text-align:right;",width:"120px",formatter:a.unEditableCurrencyCellFormatter,noresize:!0},{name:b.totalWithTax,field:"total",styles:"text-align:right;",width:"120px",formatter:a.unEditableCurrencyCellFormatter,noresize:!0},{name:b.issued_by,field:"issued_by",styles:"text-align:center;",width:"140px",noresize:!0},{name:b.invoiceDate,field:"invoice_date",styles:"text-align:center;",width:"160px",noresize:!0}]},getDeliveryOrderGridLayout:function(){var a=new f;return[{name:"No",field:"id",width:"30px",
styles:"text-align: center;",formatter:a.rowCountCellFormatter,noresize:!0},{name:b.invoiceNo,field:"invoice_no",styles:"text-align: center; color: red;",width:"140px",noresize:!0},{name:b.doNo,field:"delivery_order_no",styles:"text-align: center; color: red;",width:"140px",noresize:!0},{name:b.doQuantity,field:"quantity",width:"90px",styles:"text-align: right;",formatter:a.unEditableCurrencyCellFormatter,noresize:!0},{name:b.remarks,field:"remark",styles:"color: blue;",width:"380px",noresize:!0},
{name:b.supplier,field:"supplier_name",styles:"text-align: center;",width:"auto",noresize:!0},{name:b.date_of_delivery_order,field:"delivery_order_date",styles:"text-align:center;",width:"160px",noresize:!0}]},getStockOutGridLayout:function(){var a=new f;return[{name:"No",field:"id",width:"30px",styles:"text-align: center;",formatter:a.rowCountCellFormatter,noresize:!0},{name:b.stockOutNo,field:"running_number",styles:"text-align: center; color: red;",width:"160px",noresize:!0},{name:b.stockOutQuantity,
field:"quantity",width:"90px",styles:"text-align: right;",formatter:a.unEditableCurrencyCellFormatter,noresize:!0},{name:b.created_by,field:"creator_name",styles:"text-align: center;",width:"auto",noresize:!0},{name:b.stock_out_date,field:"stock_out_date",styles:"text-align:center;",width:"160px",noresize:!0}]}})})}).call(this);
