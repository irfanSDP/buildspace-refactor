define("buildspace/apps/TenderingReport/BillManager/BillGrid","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/dom-attr dijit/TooltipDialog dijit/popup dijit/Menu dojo/aspect dojo/number dijit/CheckedMenuItem dojox/grid/enhanced/plugins/Menu dojox/grid/enhanced/plugins/Selector dojox/grid/enhanced/plugins/Rearrange buildspace/widget/grid/plugins/FormulatedColumn dojo/_base/event dojo/keys dijit/focus dojo/_base/html dojo/request dijit/form/Button dijit/form/DropDownButton dijit/DropDownMenu dijit/MenuItem dijit/PopupMenuItem dijit/MenuSeparator ./PrintPreviewFormDialog dojox/grid/enhanced/plugins/IndirectSelection buildspace/widget/grid/cells/Formatter ./PrintPreviewDialog/PrintSelectedItemWithBuildUpQtyGridDialog ./PrintPreviewDialog/PrintSelectedItemWithBuildUpRatesGridDialog ./PrintPreviewDialog/PrintSelectedItemQtyIncludingQty2GridDialog ./PrintPreviewDialog/PrintSelectedItemAmountIncludingQty2GridDialog dojo/i18n!buildspace/nls/Tendering dojox/grid/_Grid".split(" "),
function(q,r,n,G,H,u,p,I,v,J,K,L,M,w,x,N,O,P,Q,l,R,y,z,m,S,T,A,U,B,C,t,D,E,c){var F=q("buildspace.apps.TenderingReport.BillManager.BillGrid",dojox.grid.EnhancedGrid,{type:null,billId:-1,elementId:0,itemId:-1,style:"border-top:none;",selectedItem:null,borderContainerWidget:null,keepSelection:!0,rowSelector:"0px",headerMenu:null,typeColumns:null,markupSettings:null,parentGrid:null,elementGridStore:null,currentBillLockedStatus:!1,currentBillVersion:0,currentPrintableVersion:0,currentGridType:"element",
currentBillType:null,ORIGINAL_BILL_VERSION:0,typeColumsToQtyUsed:[],constructor:function(a){this.type=a.type;this.hierarchyTypes=a.hierarchyTypes;this.hierarchyTypesForHead=a.hierarchyTypesForHead;this.unitOfMeasurements=a.unitOfMeasurements;this.columnGroup=a.columnGroup;this.typeColumns=a.typeColumns;this.markupSettings=a.markupSettings;this.currencySetting=buildspace.billCurrencyAbbreviation?buildspace.billCurrencyAbbreviation:buildspace.currencyAbbreviation;this.currentBillLockedStatus=a.currentBillLockedStatus;
this.currentBillVersion=a.currentBillVersion;this.currentPrintableVersion=a.currentPrintableVersion;this.currentGridType=a.currentGridType;a=this.formatter=new B;this.typeColumnChildren="tree"!=this.type?[{name:"% "+c.job,field_name:"total",width:"60px",styles:"text-align:right;",formatter:a.elementTypeJobPercentageCellFormatter},{name:c.costPerMetreSquare,field_name:"total_cost",width:"100px",styles:"text-align:right;",formatter:a.unEditableCurrencyCellFormatter},{name:c.total+"/"+c.unit,field_name:"total_per_unit",
width:"100px",styles:"text-align:right;",formatter:a.elementTotalPerUnitCellFormatter},{name:c.estimated+" "+c.costPerMetreSquare,field_name:"estimated_cost_per_metre_square",width:"100px",styles:"text-align:right;",formatter:a.numberCellFormatter},{name:c.estimated+" "+c.totalCost,field_name:"estimated_cost",width:"100px",styles:"text-align:right;",formatter:a.unEditableCurrencyCellFormatter}]:[{name:c.include,field_name:"include",width:"60px",styles:"text-align:center;",formatter:a.yesNoCellFormatter},
{name:c.qty+"/"+c.unit,field_name:"quantity_per_unit-value",width:"70px",styles:"text-align:right;",formatter:a.billQuantityCellFormatter},{name:c.qty+"/"+c.unit+" (2)",field_name:"quantity_per_unit_remeasurement-value",width:"70px",styles:"text-align:right;",formatter:a.billQuantityCellFormatter},{name:c.difference+" (%)",field_name:"quantity_per_unit_difference",width:"85px",styles:"text-align:right;color:blue;",formatter:a.unEditablePercentageCellFormatter},{name:c.total+"/"+c.unit,field_name:"total_per_unit",
width:"100px",styles:"text-align:right;",formatter:a.itemTotalPerUnitCellFormatter}];this.rearranger=w(this,{});this.formulatedColumn=x(this,{});this.setColumnStructure();this.createHeaderCtxMenu();this.plugins={indirectSelection:{headerSelector:!0,width:"40px",styles:"text-align: center;"}}},postCreate:function(){this.inherited(arguments);var a=this,b=null;"tree"===a.type&&v.after(a,"_onFetchComplete",function(){a.gridContainer.markedCheckBoxObject(a,a.gridContainer.selectedItemStore)});if("item"===
a.currentGridType){var c={"quantity_per_unit-value":1,"rate-value":1};this._connects.push(n.connect(this,"onCellMouseOver",function(a){var e=a.cell.field,d=a.cell.field_name,k=a.rowIndex,h=this.getItem(k);"undefined"!==typeof c[d]&&(e=e.replace("-value",""),"undefined"!==typeof h[e+"-has_formula"]&&h[e+"-has_formula"][0]&&(h=h[e+"-value"][0],h=this.formulatedColumn.convertItemIdToRowIndex(h,k),null===b&&(b=new u({content:h,onMouseLeave:function(){p.close(b)}}),p.open({popup:b,around:a.cellNode}))))}));
this._connects.push(n.connect(this,"onCellMouseOut",function(){null!==b&&(p.close(b),b=null)}));this._connects.push(n.connect(this,"onStartEdit",function(){null!==b&&(p.close(b),b=null)}))}},startup:function(){var a=this;a.inherited(arguments);this._connects.push(n.connect(this,"onCellClick",function(b){""===b.cell.name&&a.singleCheckBoxSelection(b)}));this._connects.push(n.connect(this.rowSelectCell,"toggleAllSelection",function(b){a.toggleAllSelection(b)}))},canSort:function(a){return!1},doCancelEdit:function(a){this.inherited(arguments);
this.views.renormalizeRow(a);this.scroller.rowHeightChanged(a,!0)},setColumnStructure:function(){var a=this.formatter,b="auto";if(1<this.typeColumns.length||this.markupSettings.bill_markup_enabled||this.markupSettings.element_markup_enabled||this.markupSettings.item_markup_enabled)b="500px";if("tree"==this.type){b=this.fixedColumns={noscroll:!1,width:57.8,cells:[[{name:"No",field:"id",styles:"text-align:center;",width:"30px",formatter:a.rowCountCellFormatter,noresize:!0,rowSpan:2,showInCtxMenu:!0},
{name:c.billReference,field:"bill_ref",styles:"text-align:center; color: red;",width:"80px",noresize:!0,hidden:!0,rowSpan:2,showInCtxMenu:!0,formatter:a.billRefCellFormatter},{name:c.description,field:"description",width:b,formatter:a.treeCellFormatter,noresize:!0,rowSpan:2,showInCtxMenu:!0},{name:c.type,field:"type",width:"70px",styles:"text-align:center;",formatter:a.typeCellFormatter,noresize:!0,rowSpan:2,showInCtxMenu:!0},{name:c.unit,field:"uom_id",width:"70px",styles:"text-align:center;",formatter:a.unitIdCellFormatter,
noresize:!0,rowSpan:2,showInCtxMenu:!0},{name:c.grandTotalQty,field:"grand_total_quantity",styles:"text-align:right;color:blue;",width:"90px",formatter:a.unEditableNumberCellFormatter,noresize:!0,hidden:!0,rowSpan:2,showInCtxMenu:!0}]]};var d=!0;if(this.markupSettings.bill_markup_enabled||this.markupSettings.element_markup_enabled||this.markupSettings.item_markup_enabled)d=!1;d=[{name:c.rate,field:"rate-value",field_name:"rate-value",styles:"text-align:right;",width:"75px",formatter:a.formulaCurrencyCellFormatter,
noresize:!0,rowSpan:2},{name:c.originalGrandTotal,field:"grand_total",styles:"text-align:right;color:blue;",width:"100px",formatter:a.unEditableCurrencyCellFormatter,noresize:!0,hidden:d,rowSpan:2,showInCtxMenu:!0}];var e=this.constructTypeColumnStructure(b)}else{d=!0;if(this.markupSettings.bill_markup_enabled||this.markupSettings.element_markup_enabled||this.markupSettings.item_markup_enabled)d=!1;b="auto";if(1<this.typeColumns.length||this.markupSettings.bill_markup_enabled||this.markupSettings.element_markup_enabled||
this.markupSettings.item_markup_enabled)b="500px";b=this.fixedColumns={noscroll:!1,width:"50",cells:[[{name:"No",field:"id",styles:"text-align:center;",width:"30px",formatter:a.rowCountCellFormatter,noresize:!0,rowSpan:2},{name:c.description,field:"description",width:b,formatter:a.treeCellFormatter,noresize:!0,rowSpan:2}]]};d=[{name:c.grandTotal,field:"grand_total",styles:"text-align:right;color:blue;",width:"100px",formatter:a.unEditableCurrencyCellFormatter,hidden:d,rowSpan:2,noresize:!0,showInCtxMenu:!0}];
e=this.constructTypeColumnStructure(b)}dojo.forEach(d,function(a){e.cells[0].push(a)});if("tree"==this.type&&this.markupSettings.item_markup_enabled||"tree"!=this.type&&this.markupSettings.element_markup_enabled)b=[{name:c.markup+" (%)",field:"markup_percentage-value",width:"80px",styles:"text-align:right;",formatter:a.formulaPercentageCellFormatter,noresize:!0},{name:c.markup+" ("+this.currencySetting+")",field:"markup_amount-value",width:"100px",styles:"text-align:right;",formatter:a.formulaCurrencyCellFormatter,
noresize:!0}],dojo.forEach(b,function(a){e.cells[0].push(a)}),e.cells[1].push({name:"tree"==this.type?c.item+" "+c.markup:c.element+" "+c.markup,styles:"text-align:center;",headerClasses:"staticHeader",colSpan:b.length});if(this.markupSettings.bill_markup_enabled||this.markupSettings.element_markup_enabled||this.markupSettings.item_markup_enabled){var f=[];"tree"==this.type&&f.push({name:c.rateAfterMarkup,field:"rate_after_markup",width:"100px",styles:"text-align:right;",headerClasses:"typeHeader1",
formatter:a.rateAfterMarkupCellFormatter,noresize:!0});dojo.forEach([{name:c.total+" (%) "+c.markup,field:"tree"==this.type?"grand_total":"original_grand_total",formatter:"tree"==this.type?a.itemTotalMarkupPercentageCellFormatter:a.elementTotalMarkupPercentageCellFormatter},{name:c.total+" ("+this.currencySetting+") "+c.markup,field:"tree"==this.type?"grand_total":"original_grand_total",formatter:"tree"==this.type?a.itemTotalMarkupAmountCellFormatter:a.elementTotalMarkupAmountCellFormatter},{name:c.overallTotalAfterMarkup,
field:"tree"==this.type?"grand_total_after_markup":"overall_total_after_markup",formatter:"tree"==this.type?a.itemOverallTotalAfterMarkupCellFormatter:a.elementOverallTotalAfterMarkupCellFormatter}],function(a){f.push({name:a.name,field:a.field,width:"100px",styles:"text-align:right;",headerClasses:"typeHeader1",formatter:a.formatter,noresize:!0})});"tree"!=this.type&&f.push({name:"% "+c.job,field:"overall_total_after_markup",styles:"text-align:right;",headerClasses:"typeHeader1",width:"70px",formatter:a.elementJobPercentageCellFormatter,
noresize:!0});dojo.forEach(f,function(a){e.cells[0].push(a)});a=[];this.markupSettings.item_markup_enabled&&a.push(c.item);this.markupSettings.element_markup_enabled&&a.push(c.element);this.markupSettings.bill_markup_enabled&&a.push(c.bill);e.cells[1].push({name:'<div style="font-weight:normal;">('+a.toString()+")</div>"+c.markupSummary,styles:"text-align:center;",headerClasses:"staticHeader typeHeader1",colSpan:f.length})}this.structure=e},constructTypeColumnStructure:function(a){var b=this,d=this.typeColumnChildren,
e=[],f=0;dojo.forEach(this.typeColumns,function(g){b.typeColumsToQtyUsed[g.id]=g.use_original_quantity;var k=g.remeasurement_quantity_enabled||"tree"!=b.type?d.length:d.length-2;f++;if("tree"!=b.type){d[1].name=g.floor_area_display_metric?c.costPerMetreSquare:c.costPerSquareFeet;if(g.show_estimated_total_cost)var h=!1;else h=!0,k-=2;d[3].hidden=h;d[4].hidden=h}e.push({name:g.name+"<br>"+c.totalUnit+":"+g.quantity,styles:"text-align:center;",headerClasses:"staticHeader typeHeader"+f,colSpan:k,headerId:g.id,
hidden:g.is_hidden});for(i=0;i<d.length;i++)if(k=g.id+"-"+d[i].field_name,g.remeasurement_quantity_enabled||"tree"!=b.type||"quantity_per_unit_remeasurement-value"!=d[i].field_name&&"quantity_per_unit_difference"!=d[i].field_name)k={field:k,columnType:"typeColumn",billColumnSettingId:g.id,hidden:g.is_hidden,headerClasses:"typeHeader"+f},r.mixin(k,d[i]),a.cells[0].push(k)});a.cells.push(e);return a},createHeaderCtxMenu:function(){if("undefined"!==typeof this.fixedColumns){var a=this.fixedColumns.cells[0],
b=this,c=new dijit.Menu;dojo.forEach(a,function(a,d){a.showInCtxMenu&&c.addChild(new dijit.CheckedMenuItem({label:a.name,checked:"undefined"===typeof a.hidden||!1===a.hidden?!0:!1,onChange:function(a){var c=!1;a&&(c=!0);b.showHideMergedColumn(c,d)}}))})}},showHideMergedColumn:function(a,b){this.beginUpdate();this.layout.setColumnVisibility(b,a);this.endUpdate()},refreshGrid:function(){this.beginUpdate();this.set("structure",this.structure);this.set("headerMenu",this.createHeaderCtxMenu());this.store.close();
this.pluginMgr=new this._pluginMgrClass(this);this.pluginMgr.preInit();this.pluginMgr.postInit();this.pluginMgr.startup();this._refresh();this.endUpdate()},editableCellDblClick:function(a){var b=1<this._click.length&&has("ie")?this._click[1]:1<this._click.length&&this._click[0].rowIndex!=this._click[1].rowIndex?this._click[0]:a;this.focus.setFocusCell(b.cell,b.rowIndex);this.onRowClick(b);this.onRowDblClick(a)},dodblclick:function(a){if(a.cellNode)if(a.cell.editable)this.editableCellDblClick(a);else this.onCellDblClick(a);
else this.onRowDblClick(a)},onHeaderCellClick:function(a){dojo.hasClass(a.cell.id,"staticHeader")||(a.grid.setSortIndex(a.cell.index),a.grid.onHeaderClick(a))},onHeaderCellMouseOver:function(a){dojo.hasClass(a.cell.id,"staticHeader")||dojo.addClass(a.cellNode,this.cellOverClass)},onStyleRow:function(a){this.inherited(arguments);if(a.node.children[0]&&2<=a.node.children[0].children[0].rows.length){var b=a.node.children[0].children[0].rows[1],c=a.node.children[0].children[0].rows[0].children;b.parentNode.removeChild(b);
dojo.forEach(c,function(a,b){b=dojo.attr(a,"rowSpan");(!b||2>b)&&dojo.attr(a,"rowSpan",2)})}}});return q("buildspace.apps.TenderingReport.BillManager.BillGridBuilder",dijit.layout.BorderContainer,{pageId:"page-00",style:"padding:0px;width:100%;height:100%;",gutters:!1,stackContainerTitle:"",rootProject:null,billId:-1,elementId:0,itemId:-1,rowSelector:null,gridOpts:{},type:null,postCreate:function(){var a=this;a.inherited(arguments);r.mixin(a.gridOpts,{billId:a.billId,elementId:a.elementId,type:a.type,
region:"center",borderContainerWidget:a});var b=this.grid=new F(a.gridOpts),d=new dijit.Toolbar({region:"top",style:"outline:none!important; border-bottom:none; padding:2px; width:100%;"}),e=new z({style:"display: none;"});if("tree"!==a.type){var f=new m({label:c.projectElementEstimateSummary,onClick:function(){a.openSelectedElementsPrintingFormDialog()}});e.addChild(f)}f=new m({label:c.itemsWithBuildUpQtyPrintPreview,onClick:function(){a.openSelectedItemsBuildUpQtyPrintPreviewDialog()}});e.addChild(f);
f=new m({label:c.itemsWithBuildUpRatePrintPreview,onClick:function(){a.openSelectedItemsBuildUpRatesPrintPreviewDialog()}});e.addChild(f);f=new m({label:c.itemsWithMarkupBuildUpRatePrintPreview,onClick:function(){a.openSelectedItemsWithMarkupBuildUpRatePrintPreview()}});e.addChild(f);f=new m({label:c.itemsQtyIncludingQty2,onClick:function(){a.openSelectedItemsQtyIncludingQty2PrintPreviewDialog()}});e.addChild(f);f=new m({label:c.itemsAmountIncludingQty2,onClick:function(){a.openSelectedItemsAmountIncludingQty2PrintPreviewDialog()}});
e.addChild(f);d.addChild(new y({label:c.print,iconClass:"icon-16-container icon-16-print",dropDown:e}));a.addChild(d);a.addChild(new dijit.layout.ContentPane({style:"width:100%",content:b,region:"center"}));(b=dijit.byId("add_resource_category_"+this.billId+"-btn"))&&b.destroy();if(b=dijit.byId("tenderingReportBillGrid"+this.billId+"-stackContainer"))d=document.createElement("div"),d=new dojox.layout.ContentPane({title:buildspace.truncateString(a.stackContainerTitle,60),id:a.pageId},d),b.addChild(d),
d.set("content",a),b.selectChild(a.pageId)},openSelectedElementsPrintingFormDialog:function(){var a=this,b=[];a.gridOpts.gridContainer.selectedElementStore.query().forEach(function(a){b.push(a.id)});var d=buildspace.dialog.indeterminateProgressBar({title:c.pleaseWait+"..."});d.show();return l.get("viewTendererReporting/getPrintingInformation",{handleAs:"json"}).then(function(e){(new A({title:c.projectElementEstimateSummary,billId:a.billId,selectedRows:b,printURL:"projectBuilderReport/printSelectedElementsEstimateSummaryByTypes",
exportURL:"projectBuilderReport/exportExcelSelectedElementsEstimateSummaryByTypes",_csrf_token:e._csrf_token})).show();d.hide()},function(a){console.log(a);d.hide()})},openSelectedItemsBuildUpQtyPrintPreviewDialog:function(){var a=this,b=[];a.gridOpts.gridContainer.selectedItemStore.query().forEach(function(a){b.push(a.id)});var d=buildspace.dialog.indeterminateProgressBar({title:c.pleaseWait+"..."});d.show();l.post("projectBuilderReport/getPrintPreviewSelectedItemsWithBuildUpQty",{handleAs:"json",
data:{bill_id:a.billId,itemIds:JSON.stringify(a.gridOpts.gridContainer.arrayUnique(b))}}).then(function(e){(new C({billId:a.billId,title:c.itemsWithBuildUpQtyPrintPreview,data:e,typeColumns:a.gridOpts.typeColumns,selectedItems:b})).show();d.hide()},function(a){console.log(a);d.hide()})},openSelectedItemsBuildUpRatesPrintPreviewDialog:function(){var a=this,b=[];a.gridOpts.gridContainer.selectedItemStore.query().forEach(function(a){b.push(a.id)});var d=buildspace.dialog.indeterminateProgressBar({title:c.pleaseWait+
"..."});d.show();l.post("projectBuilderReport/getPrintPreviewSelectedItemsWithBuildUpRates",{handleAs:"json",data:{bill_id:a.billId,itemIds:JSON.stringify(a.gridOpts.gridContainer.arrayUnique(b))}}).then(function(e){(new t({billId:a.billId,title:c.itemsWithBuildUpRatePrintPreview,data:e,selectedItems:b,printURL:"projectBuilderBuildUpItemsReports/printSelectedItemsWithBuildUpRate",exportURL:"projectBuilderBuildUpItemsReports/exportExcelSelectedItemsWithBuildUpRate"})).show();d.hide()},function(a){console.log(a);
d.hide()})},openSelectedItemsWithMarkupBuildUpRatePrintPreview:function(){var a=this,b=[];a.gridOpts.gridContainer.selectedItemStore.query().forEach(function(a){b.push(a.id)});var d=buildspace.dialog.indeterminateProgressBar({title:c.pleaseWait+"..."});d.show();l.post("projectBuilderReport/getPrintPreviewSelectedItemsWithBuildUpRates",{handleAs:"json",data:{bill_id:a.billId,itemIds:JSON.stringify(a.gridOpts.gridContainer.arrayUnique(b))}}).then(function(e){(new t({billId:a.billId,title:c.itemsWithMarkupBuildUpRatePrintPreview,
data:e,selectedItems:b,rateFieldName:"rate-after_markup",printURL:"projectBuilderBuildUpItemsReports/printSelectedItemsWithMarkupBuildUpRate",exportURL:"projectBuilderBuildUpItemsReports/exportExcelSelectedItemsWithMarkupBuildUpRate"})).show();d.hide()},function(a){console.log(a);d.hide()})},openSelectedItemsQtyIncludingQty2PrintPreviewDialog:function(){var a=this,b=[];a.gridOpts.gridContainer.selectedItemStore.query().forEach(function(a){b.push(a.id)});var d=buildspace.dialog.indeterminateProgressBar({title:c.pleaseWait+
"..."});d.show();l.post("projectBuilderReport/getPrintPreviewSelectedItemsQtyIncludingQty2",{handleAs:"json",data:{bill_id:a.billId,itemIds:JSON.stringify(a.gridOpts.gridContainer.arrayUnique(b))}}).then(function(e){(new D({billId:a.billId,title:c.itemsQtyIncludingQty2,data:e,typeColumns:a.gridOpts.typeColumns,selectedItems:b})).show();d.hide()},function(a){console.log(a);d.hide()})},openSelectedItemsAmountIncludingQty2PrintPreviewDialog:function(){var a=this,b=[];a.gridOpts.gridContainer.selectedItemStore.query().forEach(function(a){b.push(a.id)});
var d=buildspace.dialog.indeterminateProgressBar({title:c.pleaseWait+"..."});d.show();l.post("projectBuilderReport/getPrintPreviewSelectedItemsQtyIncludingQty2",{handleAs:"json",data:{bill_id:a.billId,itemIds:JSON.stringify(a.gridOpts.gridContainer.arrayUnique(b))}}).then(function(e){(new E({billId:a.billId,title:c.itemsAmountIncludingQty2,data:e,typeColumns:a.gridOpts.typeColumns,selectedItems:b})).show();d.hide()},function(a){console.log(a);d.hide()})}})});
