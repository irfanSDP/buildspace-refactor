define("buildspace/apps/Tendering/BillManager/AddResourceCategoryDialog","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/when dojo/html dojo/dom dojo/keys dojo/dom-style dojo/currency ./buildUpGrid ./buildUpRateSummary buildspace/widget/grid/cells/Formatter dojo/i18n!buildspace/nls/AddResourceCategoryDialog".split(" "),function(c,w,x,y,z,A,m,n,p,q,r,t,d){var u=c("buildspace.apps.Tendering.BillManager.AddResourceCategoryGrid",dojox.grid.EnhancedGrid,{billId:0,billItem:null,currencyAbbr:null,
billGridStore:null,baseContainer:null,region:"center",style:"border-top:none;",canSort:function(a){return!1},postCreate:function(){var a=this;a.inherited(arguments);this.on("RowClick",function(b){var g=a.getItem(b.rowIndex),h=a.store;if("resource_library_exists"==b.cell.field&&0<g.id){var k=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});if(g.resource_library_exists[0])c={url:"billBuildUpRate/resourceCategoryDelete",content:{bid:a.billItem.id,rid:g.id,_csrf_token:g._csrf_token},
handleAs:"json",load:function(l){if(l.success){h.setValue(g,"resource_library_exists",!1);h.save();var b=dijit.byId("accPane-"+l.rid+"-"+a.billItem.id),c=dijit.byId("accordian_"+a.billId+"_"+a.billItem.id+"-container"),e=dijit.byId("buildUpRateSummary-"+a.billItem.id);c&&b&&(c.removeChild(b),b.destroyRecursive());e&&(l.is_last_resource?(a.baseContainer.removeChild(e),e.destroyRecursive(),c.addChild(new dijit.layout.ContentPane({title:d.emptyResourceCategoryTitle,style:"padding:0px;border:0px;",doLayout:!1,
id:"accPane-empty_resource-"+a.billItem.id,content:'<div style="text-align:center;"><p><h1>'+d.emptyResourceCategory+"</h1></p></div> "})),dojo.xhrGet({url:"billBuildUpRate/getBuildUpSummary",content:{id:a.billItem.id},handleAs:"json",load:function(a){},error:function(a){}})):e.refreshTotalCost())}k.hide()},error:function(a){k.hide()}},buildspace.dialog.confirm(d.confirmation,"<div>"+d.areYouSureDeleteResourceCategory+"</div>",60,280,function(){k.show();dojo.xhrPost(c)});else{k.show();var c={url:"billBuildUpRate/resourceCategoryAdd",
content:{bid:a.billItem.id,rid:g.id,_csrf_token:g._csrf_token},handleAs:"json",load:function(b){if(b.success){h.setValue(g,"resource_library_exists",b.resource_library_exists);h.save();var c=dijit.byId("buildUpRateSummary-"+a.billItem.id);c||(c=new r({id:"buildUpRateSummary-"+a.billItem.id,itemId:a.billItem.id,container:a.baseContainer,billGridStore:a.billGridStore,_csrf_token:g._csrf_token,currentBillLockedStatus:b.bill_locked_status,currentBillVersion:b.bill_version,currentItemVersion:a.billItem.version[0]}),
a.baseContainer.addChild(c));var l=dijit.byId("accordian_"+a.billId+"_"+a.billItem.id+"-container"),e=b.resource,f=new t,m=new dojo.data.ItemFileWriteStore({url:"billBuildUpRate/getBuildUpRateItemList/bill_item_id/"+a.billItem.id+"/resource_id/"+e.id,clearOnClose:!0});b=new q({resource:e,BQItem:a.billItem,gridOpts:{itemId:a.billItem.id,addUrl:"billBuildUpRate/buildUpRateItemAdd",updateUrl:"billBuildUpRate/buildUpRateItemUpdate",deleteUrl:"billBuildUpRate/buildUpRateItemDelete",pasteUrl:"billBuildUpRate/buildUpRateItemPaste",
store:m,buildUpSummaryWidget:c,structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:f.rowCountCellFormatter},{name:d.description,field:"description",width:"auto",formatter:f.linkedCellFormatter},{name:d.number,field:"number-value",width:"100px",styles:"text-align:right;",formatter:f.formulaCurrencyCellFormatter},{name:d.constant,field:"constant-value",width:"100px",styles:"text-align:right;",formatter:f.formulaCurrencyCellFormatter},{name:d.qty,field:"quantity-value",
width:"70px",styles:"text-align:right;",formatter:f.formulaNumberCellFormatter},{name:d.unit,field:"uom_id",width:"70px",styles:"text-align:center;",formatter:f.linkedUnitIdCellFormatter},{name:d.rate,field:"rate-value",width:"120px",styles:"text-align:right;",formatter:f.formulaCurrencyCellFormatter},{name:d.total,field:"total",width:"120px",styles:"text-align:right;",formatter:f.linkedCurrencyCellFormatter},{name:d.wastage+" (%)",field:"wastage-value",width:"70px",styles:"text-align:right;",formatter:f.formulaCurrencyCellFormatter},
{name:d.lineTotal,field:"line_total",width:"120px",styles:"text-align:right;",formatter:f.linkedCurrencyCellFormatter}],currentBillLockedStatus:b.bill_locked_status,currentBillVersion:b.bill_version,currentItemVersion:a.billItem.version[0]}});e=new dijit.layout.ContentPane({title:e.name+'<span style="color:blue;float:right;">'+a.currencyAbbr+"&nbsp;"+p.format(0)+"</span>",style:"padding:0px;border:0px;",doLayout:!1,id:"accPane-"+e.id+"-"+a.billItem.id,content:b});l.addChild(e);l.selectChild(e);if(e=
dijit.byId("accPane-empty_resource-"+a.billItem.id))l.removeChild(e),e.destroyRecursive()}k.hide()},error:function(a){k.hide()}};dojo.xhrPost(c)}}})},dodblclick:function(a){this.onRowDblClick(a)}}),v=c("buildspace.apps.Tendering.BillManager.AddResourceCategoryGrid.CellFormatter",null,{rowCountCellFormatter:function(a,b,d){return 0<this.grid.getItem(b).id?parseInt(b)+1:"&nbsp;"},actionCellFormatter:function(a,b){var c=a?d.remove:d.add,h=this.grid.getItem(b),k=Math.round((new Date).getTime()/1E3);return 0<
h.id?'<a href="#'+k+'" onclick="return false;">'+c+"</a>":null}});return c("buildspace.apps.Tendering.BillManager.AddResourceCategoryDialog",dijit.Dialog,{style:"padding:0px;margin:0px;",title:d.addResourceCategory,billId:null,billItem:null,currencyAbbr:null,billGridStore:null,baseContainer:null,buildRendering:function(){var a=this.createContent();a.startup();this.content=a;this.inherited(arguments)},postCreate:function(){n.set(this.containerNode,{padding:"0px",margin:"0px"});this.closeButtonNode.style.display=
"none";this.inherited(arguments)},_onKey:function(a){key=a.keyCode;key==m.ESCAPE&&dojo.stopEvent(a)},onHide:function(){this.destroyRecursive()},createContent:function(){var a=new dijit.layout.BorderContainer({style:"padding:0px;width:500px;height:250px;",gutters:!1}),b=new dijit.Toolbar({region:"top",style:"outline:none!important;padding:2px;overflow:hidden;border:0px;"});b.addChild(new dijit.form.Button({label:d.close,iconClass:"icon-16-container icon-16-close",style:"outline:none!important;",onClick:dojo.hitch(this,
"hide")}));var c=new v,h=dojo.data.ItemFileWriteStore({url:"billBuildUpRate/getResourceList/item_id/"+this.billItem.id}),c=u({billId:this.billId,billItem:this.billItem,currencyAbbr:this.currencyAbbr,billGridStore:this.billGridStore,baseContainer:this.baseContainer,store:h,structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:c.rowCountCellFormatter},{name:d.name,field:"name",width:"auto"},{name:d.action,field:"resource_library_exists",width:"80px",styles:"text-align:center;",
formatter:c.actionCellFormatter}]});a.addChild(b);a.addChild(c);return a}})});
