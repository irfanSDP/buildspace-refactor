define("buildspace/apps/CostData/PrimeCostRateLinkBillItems/LinkBillItemsGrid","dojo/_base/declare dojo/aspect dojo/number dojo/currency dojo/_base/array dojo/_base/connect dojox/grid/EnhancedGrid buildspace/widget/grid/cells/Formatter dojox/grid/enhanced/plugins/IndirectSelection dojo/i18n!buildspace/nls/CostData".split(" "),function(k,m,n,p,l,f,q,r,w,e){var t=k("buildspace.apps.CostData.PrimeCostRateLinkBillItems.LinkBillItemsGrid",q,{style:"border:none;",region:"center",keepSelection:!0,rowSelector:"0px",
escapeHTMLInData:!1,costData:null,item:null,selectedItemIds:[],deselectedItemIds:[],constructor:function(a){this.plugins={indirectSelection:{headerSelector:!0,width:"20px",styles:"text-align:center;"}};this.inherited(arguments)},canSort:function(){return!1},postCreate:function(){var a=this;this.inherited(arguments);m.after(this,"_onFetchComplete",function(){a.markedCheckBoxObject(a.selectedItemIds,!0)});this._connects.push(f.connect(this,"onSelected",function(b){(b=a.getItem(b))&&0<b.id[0]&&a.pushItemIdIntoGridArray(b,
!0)}));this._connects.push(f.connect(this,"onDeselected",function(b){(b=a.getItem(b))&&0<b.id[0]&&a.pushItemIdIntoGridArray(b,!1)}));this._connects.push(f.connect(this.rowSelectCell,"toggleAllSelection",function(b){a.toggleAllSelection(b)}))},markedCheckBoxObject:function(a,b){var c=this,d=this.store;l.forEach(a,function(g){d.fetchItemByIdentity({identity:g,onItem:function(h){h&&(c.pushItemIdIntoGridArray(h,b),c.rowSelectCell.toggleRow(h._0,b))}})})},pushItemIdIntoGridArray:function(a,b){var c=dojo.indexOf(this.selectedItemIds,
a.id[0]),d=dojo.indexOf(this.deselectedItemIds,a.id[0]);b?(-1===c&&this.selectedItemIds.push(a.id[0]),-1!==d&&this.deselectedItemIds.splice(d,1)):(-1!==c&&this.selectedItemIds.splice(c,1),-1===d&&this.deselectedItemIds.push(a.id[0]))},toggleAllSelection:function(a){var b=this;var c=b.selection;a?c.selectRange(0,b.rowCount-1):c.deselectAll();return b.store.fetch({onComplete:function(d){dojo.forEach(d,function(g,h){0<g.id&&b.pushItemIdIntoGridArray(g,a)})}})},refreshGrid:function(){this.selection.deselectAll();
this.beginUpdate();this.store.close();this._refresh();this.endUpdate()},destroy:function(){this.inherited(arguments);l.forEach(this._connects,f.disconnect);return delete this._connects}}),u=function(a,b){return parseInt(b)+1},v=function(a,b,c){b=n.parse(a);c.customClasses.push("disable-cell");return a=isNaN(b)||0==b||null==b?"&nbsp;":p.format(a)};return k("buildspace.apps.CostData.PrimeCostRateLinkBillItems.LinkBillItemsContainer",dijit.layout.BorderContainer,{region:"center",title:"",style:"padding:0px;border:none;width:100%;height:100%;",
gutters:!1,costData:null,item:null,grid:null,moduleContainer:null,postCreate:function(){this.inherited(arguments);this.addToolbar();this.addBreakdownGrid()},getGridStructure:function(){this.gridFormatter=new r;return[{name:"No",field:"id",width:"30px",styles:"text-align: center;",formatter:u},{name:e.description,field:"description",width:"auto"},{name:e.unit,field:"uom_id",width:"70px",styles:"text-align: center;",formatter:this.gridFormatter.unitCellFormatter},{name:e.rate,field:"rate",width:"140px",
styles:"text-align: right;",formatter:v}]},addToolbar:function(){var a=this,b=new dijit.Toolbar({region:"top",style:"outline:none!important;padding:2px;width:100%;"});b.addChild(new dijit.form.Button({label:e.save,iconClass:"icon-16-container icon-16-save",onClick:function(){a.save()}}));a.addChild(b)},addBreakdownGrid:function(){var a=this.grid=t({costData:this.costData,item:this.item,structure:this.getGridStructure(),selectedItemIds:this.moduleContainer.selectedItemIds,store:new dojo.data.ItemFileWriteStore({clearOnClose:!0,
url:"costData/getBillItemList/costData/"+this.costData.id+"/id/"+this.item.id})});a=new dijit.layout.ContentPane({style:"padding:0px;border:none;width:100%;height:100%;",region:"center",content:a,grid:a});this.addChild(a)},save:function(){var a=this,b=buildspace.dialog.indeterminateProgressBar({title:e.pleaseWait+"..."});b.show().then(function(){dojo.xhrPost({url:a.moduleContainer.updateUrl,handleAs:"json",content:{cost_data_id:a.costData.id,selectedIds:a.grid.selectedItemIds.join(),deselectedIds:a.grid.deselectedItemIds.join(),
_csrf_token:a._csrf_token},load:function(c){a.moduleContainer.selectedItemIds=c.bill_item_ids;a.moduleContainer.deselectedItemIds=[];a.grid.refreshGrid();a.grid.selectedItemIds=a.moduleContainer.selectedItemIds;a.grid.deselectedItemIds=a.moduleContainer.deselectedItemIds;a.grid.markedCheckBoxObject(a.grid.selectedItemIds,!0);if(a.moduleContainer.onSave)a.moduleContainer.onSave();b.hide()},error:function(c){b.hide()}})})}})});
