define("buildspace/apps/CostData/WorkCategoryGrid","dojo/_base/declare dojo/number dojo/currency dojox/grid/EnhancedGrid buildspace/widget/grid/cells/Formatter ./ElementGrid ./ComparisonReport/ComparisonReportDialog ./TenderComparisonReport/TenderComparisonReportDialog ./RowInclusion/RowInclusionDialog dojo/i18n!buildspace/nls/CostData".split(" "),function(u,m,q,v,w,x,y,z,A,e){var C=u("buildspace.apps.CostData.WorkCategoryGrid",v,{style:"border:none;",region:"center",keepSelection:!0,rowSelector:"0px",
escapeHTMLInData:!1,costData:null,projectCostingItem:null,container:null,addUrl:"costData/addNewWorkCategory",updateUrl:"costData/updateItem",constructor:function(a){this.inherited(arguments);this.createHeaderCtxMenu()},canSort:function(a){return!1},postCreate:function(){this.inherited(arguments);this.createHeaderCtxMenuItems()},onStyleRow:function(a){this.inherited(arguments);if(a.node.children[0]&&2<=a.node.children[0].children[0].rows.length){var b=a.node.children[0].children[0].rows[1],d=a.node.children[0].children[0].rows[0].children;
b.parentNode.removeChild(b);dojo.forEach(d,function(c,f){f=dojo.attr(c,"rowSpan");(!f||2>f)&&dojo.attr(c,"rowSpan",2)})}},dodblclick:function(a){this.onRowDblClick(a)},focusCell:function(a,b){var d=this,c=d.getCellByField(b);window.setTimeout(function(){d.focus.setFocusIndex(a,c.index)},10)},updateRecord:function(a,b,d){var c=this,f=c.getItem(b),h=c.store,g=buildspace.dialog.indeterminateProgressBar({title:e.savingData+". "+e.pleaseWait+"..."}),B=function(l,k){for(var n in l)f.hasOwnProperty(n)&&
n!=k._getIdentifierAttribute()&&k.setValue(f,n,l[n]);k.save()};a={url:"costData/updateItem",content:{id:f.id,attr_name:d,val:a,cost_data_id:c.costData.id,item_id:f.id,_csrf_token:f._csrf_token?f._csrf_token:null},handleAs:"json",load:function(l){l.success&&(0<f.id&&B(l.data,h),c.focusCell(b,d),dojo.forEach(c.container.stackContainer.getChildren(),function(k,n){k.grid.id!=c.id&&k.grid&&k.grid.reload()}));g.hide()},error:function(l){g.hide()}};g.show();dojo.xhrPost(a)},doApplyCellEdit:function(a,b,
d){var c=this,f=c.getItem(b),h=c.store,g=f[d][0];a!==f[d][0]&&("approved_cost"==d&&f.approved_cost_derived[0]||"awarded_cost"==d&&f.awarded_cost_derived[0]||"variation_order_cost"==d&&f.variation_order_cost_derived[0]?buildspace.dialog.confirm(e.confirmation,e.itemBreakdownWillBeLost+"<br/>"+e.cannotBeUndone,60,280,function(){c.updateRecord(a,b,d)},function(){h.setValue(f,d,g);h.save();c.focusCell(b,d)}):c.updateRecord(a,b,d));c.inherited(arguments)},canEdit:function(a,b){return void 0!=a?0<this.getItem(b).id[0]:
this._canEdit},createHeaderCtxMenu:function(){this.plugins={menus:{headerMenu:new dijit.Menu}}},createHeaderCtxMenuItems:function(){menusObject=this.plugins.menus;if("undefined"!==typeof this.structure){var a=this;dojo.forEach(this.structure.cells[0],function(b,d){if(b.showInCtxMenu){var c=b.name,f=b.field;switch(f){case "approved_cost":c=e.budget;break;case "awarded_cost":c=e.contractSum;break;case "adjusted_cost":c=e.adjustedSum;break;default:c=b.name}menusObject.headerMenu.addChild(new dijit.CheckedMenuItem({label:c,
checked:"undefined"===typeof b.hidden||!1===b.hidden?!0:!1,onChange:function(h){var g=!1;h&&(g=!0);a.showHideColumn(g,d,f);setCookie("CostData.hiddenColumns."+f,!g)}}))}})}},getCellIndexesByAttribute:function(a,b){var d=[];dojo.forEach(this.layout.cells,function(c,f){c[a]&&c[a]==b&&d.push(f)});return d},showHideColumn:function(a,b,d){this.beginUpdate();var c=[];switch(d){case "approved_cost":c=this.getCellIndexesByAttribute("showHideGroup","show_hide_group_approved");break;case "awarded_cost":c=this.getCellIndexesByAttribute("showHideGroup",
"show_hide_group_awarded");break;case "adjusted_cost":c=this.getCellIndexesByAttribute("showHideGroup","show_hide_group_adjusted")}c.push(b);for(var f in c)this.layout.setColumnVisibility(c[f],a);this.endUpdate()},reload:function(){this.store.close();this._refresh();this.setStructure(this.container.getGridStructure())}}),D=function(a,b,d){return"summary"==this.grid.getItem(b).type?(d.customClasses.push("disable-cell"),null):parseInt(b)+1},E=function(a,b,d){"summary"==this.grid.getItem(b).type&&(d.customClasses.push("disable-cell"),
d.customClasses.push("pull-right"),a="<strong>"+a+"</strong>");return a},F=function(a,b,d){"summary"==this.grid.getItem(b).type&&d.customClasses.push("disable-cell");a||(a="&nbsp;");return a},G=function(a,b,d){this.grid.getItem(b);a=m.parse(a);a=isNaN(a)||0==a||null==a?"&nbsp;":q.format(a);d.customClasses.push("disable-cell");return a},r=function(a,b,d){a=m.parse(a);d.customClasses.push("disable-cell");a=isNaN(a)||0==a||null==a?"&nbsp;":m.format(a,{places:2})+"%";return'<span style="color: blue;">'+
a+"</span>"},t=function(a,b,d){b=this.grid.getItem(b);var c=m.parse(a);"summary"==b.type&&d.customClasses.push("disable-cell");a=isNaN(c)||0==c||null==c?"&nbsp;":q.format(a);c=!1;"approved_cost"==this.field&&b.approved_cost_derived&&b.approved_cost_derived[0]?c=!0:"awarded_cost"==this.field&&b.awarded_cost_derived&&b.awarded_cost_derived[0]?c=!0:"variation_order_cost"==this.field&&b.variation_order_cost_derived&&b.variation_order_cost_derived[0]&&(c=!0);c&&(a='<span style="color: blue;"><strong>'+
a+"</strong></span>",d.customClasses.push("light-blue-cell"));return a},p=function(a,b,d){b=m.parse(a);d.customClasses.push("disable-cell");return a=isNaN(b)||0==b||null==b?"&nbsp;":q.format(a)};return u("buildspace.apps.CostData.WorkCategoriesContainer",dijit.layout.BorderContainer,{region:"center",title:"",style:"padding:0px;border:none;width:100%;height:100%;",gutters:!1,costData:null,projectCostingItem:null,projectParticulars:[],grid:null,stackContainer:null,hideColumnGroup:[],editable:!1,postCreate:function(){this.inherited(arguments);
var a=this,b=buildspace.dialog.indeterminateProgressBar({title:e.pleaseWait+"..."}),d={url:"costData/getWorkCategoryParticulars",content:{cost_data_id:this.costData.id,id:this.projectCostingItem.id},handleAs:"json",load:function(c){c.success&&(a.projectParticulars=c.data,c=a.createBreakdownGrid(),c=new dijit.layout.ContentPane({style:"padding:0px;border:none;width:100%;height:100%;",region:"center",content:c,grid:c}),a.addChild(a.createToolbar()),a.addChild(c),b.hide())},error:function(c){b.hide()}};
b.show();dojo.xhrPost(d)},createToolbar:function(){var a=this,b=new dijit.Toolbar({region:"top",style:"outline:none!important;border:none;padding:2px;width:100%;"});b.addChild(new dijit.form.Button({id:this.costData.id+"work-category-refresh-button",label:e.refresh,iconClass:"icon-16-container icon-16-reload",style:"outline:none!important;",onClick:function(){a.grid.reload()}}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({label:e.comparisonReport,iconClass:"icon-16-container icon-16-print",
style:"outline:none!important;",onClick:function(){a.createComparisonReportDialog()}}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({label:e.tenderComparisonReport,iconClass:"icon-16-container icon-16-print",style:"outline:none!important;",onClick:function(){a.createTenderComparisonReportDialog()}}));a.editable&&(b.addChild(new dijit.ToolbarSeparator),b.addChild(new dijit.form.Button({id:this.costData.id+"-work-category-row-inclusion-button",label:e.showHideRows,iconClass:"icon-16-container icon-16-dial",
style:"outline:none!important;",onClick:function(){a.createRowVisibilityDialog()}})));return b},getGridStructure:function(){new w;var a=[{name:"No.",field:"count",width:"30px",rowSpan:2,styles:"text-align:center;",formatter:D},{name:e.description,field:"description",width:"500px",rowSpan:2,formatter:E}],b=[],d=[],c=[],f=[],h=2+this.projectParticulars.length,g;for(g in this.projectParticulars)a.push({name:this.projectParticulars[g].description,field:"column-"+this.projectParticulars[g].id,width:"120px",
styles:"text-align:right;",rowSpan:2,formatter:p}),b.push({name:e.cost+"/"+this.projectParticulars[g].description,field:"approved_column-"+this.projectParticulars[g].id,showHideGroup:"show_hide_group_approved",width:"120px",styles:"text-align:right;",hidden:getCookieBoolean("CostData.hiddenColumns.approved_cost"),formatter:p}),d.push({name:e.cost+"/"+this.projectParticulars[g].description,field:"awarded_column-"+this.projectParticulars[g].id,width:"120px",styles:"text-align:right;",showHideGroup:"show_hide_group_awarded",
hidden:getCookieBoolean("CostData.hiddenColumns.awarded_cost"),formatter:p}),c.push({name:e.cost+"/"+this.projectParticulars[g].description,field:"adjusted_column-"+this.projectParticulars[g].id,width:"120px",styles:"text-align:right;",showHideGroup:"show_hide_group_adjusted",hidden:getCookieBoolean("CostData.hiddenColumns.adjusted_cost"),formatter:p});a.push({name:e.amount,field:"approved_cost",width:"140px",styles:"text-align:right;",editable:this.editable,showInCtxMenu:!0,showHideGroup:"show_hide_group_approved",
hidden:getCookieBoolean("CostData.hiddenColumns.approved_cost"),cellType:"buildspace.widget.grid.cells.Textarea",formatter:t});a=a.concat(b);a.push({name:e.percentage,field:"approved_percentage",width:"70px",styles:"text-align:right;",showHideGroup:"show_hide_group_approved",hidden:getCookieBoolean("CostData.hiddenColumns.approved_cost"),formatter:r});a.push({name:e.amount,field:"awarded_cost",width:"140px",styles:"text-align:right;",editable:this.editable,showInCtxMenu:!0,showHideGroup:"show_hide_group_awarded",
hidden:getCookieBoolean("CostData.hiddenColumns.awarded_cost"),cellType:"buildspace.widget.grid.cells.Textarea",formatter:t});a=a.concat(d);a.push({name:e.percentage,field:"awarded_percentage",width:"70px",styles:"text-align:right;",showHideGroup:"show_hide_group_awarded",hidden:getCookieBoolean("CostData.hiddenColumns.awarded_cost"),formatter:r});a.push({name:e.amount,field:"adjusted_cost",width:"140px",styles:"text-align:right;",showInCtxMenu:!0,showHideGroup:"show_hide_group_adjusted",hidden:getCookieBoolean("CostData.hiddenColumns.adjusted_cost"),
formatter:G});a=a.concat(c);a.push({name:e.percentage,field:"adjusted_percentage",width:"70px",styles:"text-align:right;",showHideGroup:"show_hide_group_adjusted",hidden:getCookieBoolean("CostData.hiddenColumns.adjusted_cost"),formatter:r});a.push({name:e.variationOrderCost,field:"variation_order_cost",width:"140px",rowSpan:2,cellType:"buildspace.widget.grid.cells.Textarea",editable:this.editable,showInCtxMenu:!0,hidden:getCookieBoolean("CostData.hiddenColumns.variation_order_cost"),styles:"text-align:right;",
formatter:t},{name:e.remarks,field:"remarks",width:"300px",rowSpan:2,cellType:"buildspace.widget.grid.cells.Textarea",editable:this.editable,showInCtxMenu:!0,hidden:getCookieBoolean("CostData.hiddenColumns.remarks"),formatter:F});f=f.concat([{name:this.costData.approved_date?e.budget+" ("+this.costData.approved_date+")":e.budget,styles:"text-align:center;",headerClasses:"staticHeader",showHideGroup:"show_hide_group_approved",hidden:getCookieBoolean("CostData.hiddenColumns.approved_cost"),colSpan:h},
{name:this.costData.awarded_date?e.contractSum+" ("+this.costData.awarded_date+")":e.contractSum,styles:"text-align:center;",headerClasses:"staticHeader",showHideGroup:"show_hide_group_awarded",hidden:getCookieBoolean("CostData.hiddenColumns.awarded_cost"),colSpan:h},{name:this.costData.adjusted_date?e.adjustedSum+" ("+this.costData.adjusted_date+")":e.adjustedSum,styles:"text-align:center;",headerClasses:"staticHeader",showHideGroup:"show_hide_group_adjusted",hidden:getCookieBoolean("CostData.hiddenColumns.adjusted_cost"),
colSpan:h}]);return{noscroll:!1,cells:[a,f]}},createBreakdownGrid:function(){var a=this;a.grid=C({id:"costData-workCategoryGrid",costData:a.costData,projectCostingItem:a.projectCostingItem,container:a,structure:a.getGridStructure(),onRowDblClick:function(b){b=this.getItem(b.rowIndex);0<b.id[0]&&a.createElementGrid(b)},store:new dojo.data.ItemFileWriteStore({clearOnClose:!0,url:"costData/getWorkCategoryList/costData/"+this.costData.id+"/id/"+this.projectCostingItem.id})});return a.grid},createComparisonReportDialog:function(){(new y({gridUrl:"costData/getCostDataList/costData/"+
this.costData.id,title:e.comparisonReport,exportUrl:"comparisonReport/export/costData/"+this.costData.id+"/parent_id/"+this.projectCostingItem.id+"/level/"+buildspace.apps.CostData.Levels.workCategory+"/_csrf_token/"+this.costData._csrf_token,costData:this.costData,level:buildspace.apps.CostData.Levels.workCategory,parentItemId:this.projectCostingItem.id,type:buildspace.apps.CostData.ItemTypes.STANDARD})).show()},createTenderComparisonReportDialog:function(){(new z({exportUrl:"tenderComparison/export/costData/"+
this.costData.id+"/parent_id/"+this.projectCostingItem.id+"/level/"+buildspace.apps.CostData.Levels.workCategory,costData:this.costData,parentItemId:this.projectCostingItem.id,level:buildspace.apps.CostData.Levels.workCategory})).show()},createRowVisibilityDialog:function(){var a=this,b=[];dojo.forEach(a.grid.store._arrayOfAllItems,function(d,c){0<d.id[0]&&b.push(d.id[0])});(new A({title:e.showHideRows,gridUrl:"costData/getAllCostDataItemRecords/costData/"+a.costData.id+"/parent_id/"+a.projectCostingItem.id,
saveUrl:"costData/updateItemVisibility/costData/"+a.costData.id+"/_csrf_token/"+a.projectCostingItem._csrf_token,selectedItemIds:b,deselectedItemIds:[],onSave:function(){a.grid.reload()}})).show()},createElementGrid:function(a){a=new x({title:buildspace.truncateString(a.description,60),stackContainer:this.stackContainer,editable:this.editable,costData:this.costData,workCategory:a});this.stackContainer.addChild(a);this.stackContainer.selectChild(a)}})});
