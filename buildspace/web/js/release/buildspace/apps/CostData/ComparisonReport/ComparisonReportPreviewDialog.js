define("buildspace/apps/CostData/ComparisonReport/ComparisonReportPreviewDialog","dojo/_base/declare dojo/dom-style dojo/number dojo/currency dojox/grid/EnhancedGrid buildspace/widget/grid/cells/Formatter dojo/i18n!buildspace/nls/CostData".split(" "),function(w,z,n,t,C,A,c){var p=w("buildspace.apps.CostData.ComparisonReportPreview.Grid",dojox.grid.EnhancedGrid,{region:"center",style:"border-top:none;",canSort:function(a){return!1},onStyleRow:function(a){this.inherited(arguments);if(a.node.children[0]&&
2<=a.node.children[0].children[0].rows.length){var b=a.node.children[0].children[0].rows[1],f=a.node.children[0].children[0].rows[0].children;b.parentNode.removeChild(b);dojo.forEach(f,function(h,d){d=dojo.attr(h,"rowSpan");(!d||2>d)&&dojo.attr(h,"rowSpan",2)})}}}),B=function(a,b,f){a=this.grid.getItem(b);"summary"==a.type&&f.customClasses.push("disable-cell");return 0<a.id[0]||a.id[0]==buildspace.constants.GRID_LAST_ROW?parseInt(b):null},u=function(a,b,f){a=this.grid.getItem(b);"summary"==a.type&&
f.customClasses.push("disable-cell");return 0<a.id[0]||a.id[0]==buildspace.constants.GRID_LAST_ROW?parseInt(b)+1:null},q=function(a,b,f){b=this.grid.getItem(b);"row_separator"==b.id[0]&&f.customClasses.push("invalidTypeItemCell");"summary"==b.type&&(f.customClasses.push("disable-cell"),f.customClasses.push("pull-right"),a="<strong>"+a+"</strong>");return a},v=function(a,b,f){b=this.grid.getItem(b);"row_separator"==b.id[0]&&f.customClasses.push("invalidTypeItemCell");"summary"==b.type&&f.customClasses.push("disable-cell");
a||(a="&nbsp;");return a},x=function(a,b,f){b=this.grid.getItem(b);a=n.parse(a);a=isNaN(a)||0==a||null==a?"&nbsp;":t.format(a);void 0!=b.type&&1>b.type?f.customClasses.push("invalidTypeItemCell"):f.customClasses.push("disable-cell");return a},m=function(a,b,f){a=n.parse(a);b=this.grid.getItem(b);void 0!=b.type&&1>b.type?f.customClasses.push("invalidTypeItemCell"):f.customClasses.push("disable-cell");a=isNaN(a)||0==a||null==a?"&nbsp;":n.format(a,{places:2})+"%";return'<span style="color: blue;">'+
a+"</span>"},l=function(a,b,f){b=this.grid.getItem(b);"summary"==b.type&&f.customClasses.push("disable-cell");return a=(0<b.id||"provisional_sum"==b.id||"summary"==b.type)&&0!=a&&a&&!isNaN(a)?t.format(a):"&nbsp;"},r=function(a,b,f){b=n.parse(a);f.customClasses.push("disable-cell");return a=isNaN(b)||0==b||null==b?"&nbsp;":t.format(a)};return w("buildspace.apps.CostData.ComparisonReportPreview.Dialog",dijit.Dialog,{style:"padding:0px;margin:0px;",title:c.comparisonReport,exportUrl:null,gridUrl:null,
costData:this.costData,selectedCostDataInfo:{},selectedItemIds:[],parent:null,parentItemId:null,level:null,type:null,projectParticulars:[],costComparisonProjectParticulars:[],buildRendering:function(){var a=this.createContent();a.startup();this.content=a;this.inherited(arguments)},postCreate:function(){z.set(this.containerNode,{padding:"0px",margin:"0px"});this.closeButtonNode.style.display="none";this.inherited(arguments)},onHide:function(){this.destroyRecursive()},createToolbar:function(){var a=
this,b=new dijit.Toolbar({region:"top",style:"outline:none!important;padding:2px;width:100%;"});b.addChild(new dijit.form.Button({label:c.close,iconClass:"icon-16-container icon-16-close",onClick:function(){a.hide()}}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({label:c.export,iconClass:"icon-16-container icon-16-print",onClick:function(){a.parent.export()}}));return b},createContent:function(){this.formatter=new A;var a=new dijit.layout.BorderContainer({style:"padding:0px;width:1200px;height:450px;",
gutters:!1});a.addChild(this.createToolbar());if(this.type==buildspace.apps.CostData.ItemTypes.STANDARD)switch(this.level){case buildspace.apps.CostData.Levels.overallProjectCosting:a.addChild(this.createOverallProjectCostingPreviewGrid());break;case buildspace.apps.CostData.Levels.workCategory:a.addChild(this.createWorkCategoryPreviewGrid());break;default:a.addChild(this.createElementPreviewGrid())}else this.type==buildspace.apps.CostData.ItemTypes.PRIME_COST_RATE&&a.addChild(this.createPrimeCostRatePreviewGrid());
return a},getOverallProjectCostingGridStructure:function(){var a=[{name:"No.",field:"count",width:"30px",styles:"text-align:center;",formatter:B},{name:c.description,field:"description",width:"500px",formatter:q}],b=[],f=[],h=[],d=[this.costData.id].concat(this.selectedItemIds),e;for(e in d)b=b.concat([{name:c.amount,field:d[e]+"_approved_cost",width:"150px",styles:"text-align: right;",formatter:l},{name:c.percentageOfTotalCost,field:d[e]+"_approved_percentage",width:"150px",styles:"text-align: right;",
formatter:m},{name:c.amount,field:d[e]+"_awarded_cost",width:"150px",styles:"text-align: right;",formatter:l},{name:c.percentageOfTotalCost,field:d[e]+"_awarded_percentage",width:"150px",styles:"text-align: right;",formatter:m},{name:c.amount,field:d[e]+"_adjusted_cost",width:"140px",styles:"text-align:right;",formatter:x},{name:c.percentageOfTotalCost,field:d[e]+"_adjusted_percentage",width:"140px",styles:"text-align:right;",formatter:m},{name:c.variationOrderCost,field:d[e]+"_variation_order_cost",
width:"140px",rowSpan:3,styles:"text-align:right;",formatter:l},{name:c.remarks,field:d[e]+"_remarks",width:"300px",rowSpan:3,formatter:v}]),f=f.concat([{name:this.selectedCostDataInfo[d[e]].approved_date?c.budget+" ("+this.selectedCostDataInfo[d[e]].approved_date+")":c.budget,styles:"text-align:center;",headerClasses:"staticHeader",colSpan:2},{name:this.selectedCostDataInfo[d[e]].awarded_date?c.contractSum+" ("+this.selectedCostDataInfo[d[e]].awarded_date+")":c.contractSum,styles:"text-align:center;",
headerClasses:"staticHeader",colSpan:2},{name:this.selectedCostDataInfo[d[e]].adjusted_date?c.adjustedSum+" ("+this.selectedCostDataInfo[d[e]].adjusted_date+")":c.adjustedSum,styles:"text-align:center;",headerClasses:"staticHeader",colSpan:2}]),h=h.concat([{name:this.selectedCostDataInfo[d[e]].name,styles:"text-align:center;",headerClasses:"staticHeader",colSpan:8}]);return[{noscroll:!0,cells:a},{noscroll:!1,cells:[b,f,h]}]},getWorkCategoryGridStructure:function(){var a=[{name:"No.",field:"count",
width:"30px",styles:"text-align:center;",formatter:u},{name:c.description,field:"description",width:"500px",formatter:q}],b=[],f=[],h=[],d=[this.costData.id].concat(this.selectedItemIds);columnGroups=["approved","awarded","adjusted"];var e=2+this.projectParticulars.length,g;for(g in d){for(var k in columnGroups){b.push({name:c.amount,field:d[g]+"_"+columnGroups[k]+"_cost",width:"140px",styles:"text-align:right;",formatter:l});for(var y in this.projectParticulars)b.push({name:c.cost+"/"+this.projectParticulars[y].description,
field:d[g]+"_"+columnGroups[k]+"_"+this.projectParticulars[y].id,width:"120px",styles:"text-align:right;",formatter:r});b.push({name:c.percentage,field:d[g]+"_"+columnGroups[k]+"_percentage",width:"70px",styles:"text-align:right;",formatter:m})}b.push({name:c.variationOrderCost,field:d[g]+"_variation_order_cost",width:"140px",rowSpan:3,styles:"text-align:right;",formatter:l});f=f.concat([{name:this.selectedCostDataInfo[d[g]].approved_date?c.budget+" ("+this.selectedCostDataInfo[d[g]].approved_date+
")":c.budget,styles:"text-align:center;",headerClasses:"staticHeader",colSpan:e},{name:this.selectedCostDataInfo[d[g]].awarded_date?c.contractSum+" ("+this.selectedCostDataInfo[d[g]].awarded_date+")":c.contractSum,styles:"text-align:center;",headerClasses:"staticHeader",colSpan:e},{name:this.selectedCostDataInfo[d[g]].adjusted_date?c.adjustedSum+" ("+this.selectedCostDataInfo[d[g]].adjusted_date+")":c.adjustedSum,styles:"text-align:center;",headerClasses:"staticHeader",colSpan:e}]);h=h.concat([{name:this.selectedCostDataInfo[d[g]].name,
styles:"text-align:center;",headerClasses:"staticHeader",colSpan:3*e+1}])}return[{noscroll:!0,cells:a},{noscroll:!1,cells:[b,f,h]}]},getElementGridStructure:function(){var a=2+this.costComparisonProjectParticulars.length,b=[{name:"No.",field:"count",width:"30px",styles:"text-align:center;",formatter:u},{name:c.description,field:"description",width:"500px",formatter:q}],f=[],h=[],d=[],e=[this.costData.id].concat(this.selectedItemIds),g;for(g in e){f.push({name:c.amount,field:e[g]+"_approved_cost",
width:"150px",styles:"text-align: right;",formatter:l});for(var k in this.costComparisonProjectParticulars)f.push({name:c.elementalCost+"/"+this.costComparisonProjectParticulars[k].description+" ("+this.costComparisonProjectParticulars[k].uom_symbol+")",field:e[g]+"_approved_"+this.costComparisonProjectParticulars[k].id,width:"120px",styles:"text-align:right;",formatter:r});f.push({name:c.percentageOfTotalCost,field:e[g]+"_approved_percentage",width:"150px",styles:"text-align: right;",formatter:m});
f.push({name:c.amount,field:e[g]+"_awarded_cost",width:"150px",styles:"text-align: right;",formatter:l});for(k in this.costComparisonProjectParticulars)f.push({name:c.elementalCost+"/"+this.costComparisonProjectParticulars[k].description+" ("+this.costComparisonProjectParticulars[k].uom_symbol+")",field:e[g]+"_awarded_"+this.costComparisonProjectParticulars[k].id,width:"120px",styles:"text-align:right;",formatter:r});f.push({name:c.percentageOfTotalCost,field:e[g]+"_awarded_percentage",width:"150px",
styles:"text-align: right;",formatter:m});f.push({name:c.amount,field:e[g]+"_adjusted_cost",width:"140px",styles:"text-align:right;",formatter:x});for(k in this.costComparisonProjectParticulars)f.push({name:c.elementalCost+"/"+this.costComparisonProjectParticulars[k].description+" ("+this.costComparisonProjectParticulars[k].uom_symbol+")",field:e[g]+"_adjusted_"+this.costComparisonProjectParticulars[k].id,width:"120px",styles:"text-align:right;",formatter:r});f.push({name:c.percentageOfTotalCost,
field:e[g]+"_adjusted_percentage",width:"140px",styles:"text-align:right;",formatter:m});f.push({name:c.variationOrderCost,field:e[g]+"_variation_order_cost",width:"140px",rowSpan:3,styles:"text-align:right;",formatter:l});h=h.concat([{name:this.selectedCostDataInfo[e[g]].approved_date?c.budget+" ("+this.selectedCostDataInfo[e[g]].approved_date+")":c.budget,styles:"text-align:center;",headerClasses:"staticHeader",colSpan:a},{name:this.selectedCostDataInfo[e[g]].awarded_date?c.contractSum+" ("+this.selectedCostDataInfo[e[g]].awarded_date+
")":c.contractSum,styles:"text-align:center;",headerClasses:"staticHeader",colSpan:a},{name:this.selectedCostDataInfo[e[g]].adjusted_date?c.adjustedSum+" ("+this.selectedCostDataInfo[e[g]].adjusted_date+")":c.adjustedSum,styles:"text-align:center;",headerClasses:"staticHeader",colSpan:a}]);d=d.concat([{name:this.selectedCostDataInfo[e[g]].name,styles:"text-align:center;",headerClasses:"staticHeader",colSpan:3*a+1}])}return[{noscroll:!0,cells:b},{noscroll:!1,cells:[f,h,d]}]},getPrimeCostRateGridStructure:function(){var a=
[{name:"No.",field:"count",width:"30px",styles:"text-align:center;",formatter:u},{name:c.description,field:"description",width:"500px",formatter:q},{name:c.unit,field:"uom_id",width:"70px",styles:"text-align:center;",hidden:3!=this.level,formatter:this.formatter.unEditableUnitCellFormatter}],b=[],f=[],h=[],d=[this.costData.id].concat(this.selectedItemIds),e;for(e in d)b.push({name:3!=this.level?c.totalUnits:c.qty,field:d[e]+"_units",width:"150px",styles:"text-align: right;",rowSpan:2,formatter:l}),
b.push({name:3!=this.level?c.amountPerUnit:c.unitRate,field:d[e]+"_approved_value",width:"150px",styles:"text-align: right;",formatter:l}),b.push({name:c.totalAmount,field:d[e]+"_approved_total",width:"150px",styles:"text-align: right;",formatter:l}),3==this.level&&b.push({name:c.brand,field:d[e]+"_approved_brand",width:"150px",styles:"text-align: center;",formatter:v}),b.push({name:3!=self.level?c.amountPerUnit:c.unitRate,field:d[e]+"_awarded_value",width:"150px",styles:"text-align: right;",formatter:l}),
b.push({name:c.totalAmount,field:d[e]+"_awarded_total",width:"150px",styles:"text-align: right;",formatter:l}),3==this.level&&b.push({name:c.brand,field:d[e]+"_awarded_brand",width:"150px",styles:"text-align: center;",formatter:v}),f.push({name:this.selectedCostDataInfo[d[e]].approved_date?c.budget+" ("+this.selectedCostDataInfo[d[e]].approved_date+")":c.budget,styles:"text-align:center;",headerClasses:"staticHeader",colSpan:3!=this.level?2:3}),f.push({name:this.selectedCostDataInfo[d[e]].awarded_date?
c.contractSum+" ("+this.selectedCostDataInfo[d[e]].awarded_date+")":c.contractSum,styles:"text-align:center;",headerClasses:"staticHeader",colSpan:3!=this.level?2:3}),h.push({name:this.selectedCostDataInfo[d[e]].name,styles:"text-align:center;",headerClasses:"staticHeader",colSpan:3!=this.level?5:7});return[{noscroll:!0,cells:a},{noscroll:!1,cells:[b,f,h]}]},createOverallProjectCostingPreviewGrid:function(){var a="comparisonReport/overallProjectCostingPreview/cost_data_id/"+this.costData.id;0<this.selectedItemIds.length&&
(a+="?selected_ids="+this.selectedItemIds.join());var b=new dijit.layout.BorderContainer({region:"center",style:"padding:0px;border:none;width:100%;height:100%;",gutters:!1});a=p({structure:this.getOverallProjectCostingGridStructure(),store:dojo.data.ItemFileWriteStore({url:a,clearOnClose:!0})});b.addChild(a);return b},createWorkCategoryPreviewGrid:function(){var a=this,b=new dijit.layout.BorderContainer({region:"center",style:"padding:0px;border:none;width:100%;height:100%;",gutters:!1}),f=buildspace.dialog.indeterminateProgressBar({title:c.pleaseWait+
"..."}),h={url:"costData/getWorkCategoryParticulars",content:{cost_data_id:a.costData.id,id:a.parentItemId},handleAs:"json",load:function(d){d.success&&(a.projectParticulars=d.data,d="comparisonReport/workCategoryPreview/cost_data_id/"+a.costData.id+"/parent_id/"+a.parentItemId,0<a.selectedItemIds.length&&(d+="?selected_ids="+a.selectedItemIds.join()),d=p({structure:a.getWorkCategoryGridStructure(),store:dojo.data.ItemFileWriteStore({url:d,clearOnClose:!0})}),b.addChild(d));f.hide()},error:function(d){f.hide()}};
f.show().then(function(){dojo.xhrPost(h)});return b},createElementPreviewGrid:function(){var a=this,b="comparisonReport/elementPreview/cost_data_id/"+this.costData.id+"/parent_id/"+this.parentItemId;0<this.selectedItemIds.length&&(b+="?selected_ids="+this.selectedItemIds.join());var f=new dijit.layout.BorderContainer({region:"center",style:"padding:0px;border:none;width:100%;height:100%;",gutters:!1}),h=buildspace.dialog.indeterminateProgressBar({title:c.pleaseWait+"..."}),d={url:"costData/getCostComparisonProjectParticulars",
content:{cost_data_id:a.costData.id},handleAs:"json",load:function(e){e.success&&(a.costComparisonProjectParticulars=e.data,e=p({structure:a.getElementGridStructure(),store:dojo.data.ItemFileWriteStore({url:b,clearOnClose:!0})}),f.addChild(e));h.hide()},error:function(e){h.hide()}};h.show().then(function(){dojo.xhrPost(d)});return f},createPrimeCostRatePreviewGrid:function(){var a="comparisonReport/primeCostRatePreview/cost_data_id/"+this.costData.id+"/parent_id/"+this.parentItemId+"/level/"+this.level;
0<this.selectedItemIds.length&&(a+="?selected_ids="+this.selectedItemIds.join());var b=new dijit.layout.BorderContainer({region:"center",style:"padding:0px;border:none;width:100%;height:100%;",gutters:!1});a=p({structure:this.getPrimeCostRateGridStructure(),store:dojo.data.ItemFileWriteStore({url:a,clearOnClose:!0})});b.addChild(a);return b}})});
