define("buildspace/apps/CostData/Breakdown","dojo/_base/declare dojo/number dojo/currency dojo/_base/array dojox/grid/EnhancedGrid ./WorkCategoryGrid ./ProvisionalSumGrid ./PrimeCostSumWorkArea ./PrimeCostRateGrid ./ComparisonReport/ComparisonReportDialog ./TenderComparisonReport/TenderComparisonReportDialog ./RowInclusion/RowInclusionDialog buildspace/widget/grid/cells/Textarea dojo/i18n!buildspace/nls/CostData".split(" "),function(t,n,u,G,v,w,x,y,z,A,B,C,H,f){var D=t("buildspace.apps.CostData.BreakdownGrid",
v,{style:"border:none;",region:"center",keepSelection:!0,rowSelector:"0px",escapeHTMLInData:!1,costData:null,borderContainerWidget:null,constructor:function(a){this.inherited(arguments);this.createHeaderCtxMenu()},canSort:function(a){return!1},postCreate:function(){this.inherited(arguments);this.createHeaderCtxMenuItems()},onStyleRow:function(a){this.inherited(arguments);if(a.node.children[0]&&2<=a.node.children[0].children[0].rows.length){var b=a.node.children[0].children[0].rows[1],c=a.node.children[0].children[0].rows[0].children;
b.parentNode.removeChild(b);dojo.forEach(c,function(d,e){e=dojo.attr(d,"rowSpan");(!e||2>e)&&dojo.attr(d,"rowSpan",2)})}},dodblclick:function(a){this.onRowDblClick(a)},focusCell:function(a,b){var c=this,d=c.getCellByField(b);window.setTimeout(function(){c.focus.setFocusIndex(a,d.index)},10)},updateRecord:function(a,b,c){var d=this,e=d.getItem(b),g=d.store,h=buildspace.dialog.indeterminateProgressBar({title:f.savingData+". "+f.pleaseWait+"..."});a={url:"costData/updateItem",content:{id:e.id,attr_name:c,
val:a,cost_data_id:d.costData.id,item_id:e.id,_csrf_token:e._csrf_token?e._csrf_token:null},handleAs:"json",load:function(k){if(k.success){if(0<e.id){k=k.data;for(var l in k)e.hasOwnProperty(l)&&l!=g._getIdentifierAttribute()&&g.setValue(e,l,k[l]);g.save()}d.focusCell(b,c)}h.hide()},error:function(k){h.hide()}};h.show();dojo.xhrPost(a)},updateNodelessItemRemarks:function(a,b,c){var d=this,e=d.getItem(b),g=d.store,h=buildspace.dialog.indeterminateProgressBar({title:f.savingData+". "+f.pleaseWait+"..."});
a={url:"costData/updateNodelessItemRemarks",content:{cost_data_id:d.costData.id,val:a,type:c,_csrf_token:e._csrf_token?e._csrf_token:null},handleAs:"json",load:function(k){if(k.success){k=k.data;for(var l in k)e.hasOwnProperty(l)&&l!=g._getIdentifierAttribute()&&g.setValue(e,l,k[l]);g.save();d.focusCell(b,"remarks")}h.hide()},error:function(k){h.hide()}};h.show();dojo.xhrPost(a)},doApplyCellEdit:function(a,b,c){var d=this,e=d.getItem(b),g=d.store,h=e[c][0];a!==e[c][0]&&("approved_cost"==c&&e.approved_cost_derived[0]||
"awarded_cost"==c&&e.awarded_cost_derived[0]||"variation_order_cost"==c&&e.variation_order_cost_derived[0]?buildspace.dialog.confirm(f.confirmation,f.itemBreakdownWillBeLost+"<br/>"+f.cannotBeUndone,60,280,function(){d.updateRecord(a,b,c)},function(){g.setValue(e,c,h);g.save();d.focusCell(b,c)}):0<e.id[0]?d.updateRecord(a,b,c):"remarks"==c&&(e.type[0]==buildspace.apps.CostData.ItemTypes.PROVISIONAL_SUM||buildspace.apps.CostData.ItemTypes.PRIME_COST_SUM||buildspace.apps.CostData.ItemTypes.PRIME_COST_RATE)&&
d.updateNodelessItemRemarks(a,b,e.type[0]));d.inherited(arguments)},canEdit:function(a,b){return void 0!=a?(b=this.getItem(b),0<b.id[0]||"remarks"==a.field&&(b.type[0]==buildspace.apps.CostData.ItemTypes.PROVISIONAL_SUM||b.type[0]==buildspace.apps.CostData.ItemTypes.PRIME_COST_SUM||b.type[0]==buildspace.apps.CostData.ItemTypes.PRIME_COST_RATE)?!0:!1):this._canEdit},createHeaderCtxMenu:function(){this.plugins={menus:{headerMenu:new dijit.Menu}}},createHeaderCtxMenuItems:function(){menusObject=this.plugins.menus;
if("undefined"!==typeof this.structure){var a=this;dojo.forEach(this.structure.cells[0],function(b,c){if(b.showInCtxMenu){var d=b.name,e=b.field;switch(e){case "approved_cost":d=f.budget;break;case "awarded_cost":d=f.contractSum;break;case "adjusted_cost":d=f.adjustedSum;break;default:d=b.name}menusObject.headerMenu.addChild(new dijit.CheckedMenuItem({label:d,checked:"undefined"===typeof b.hidden||!1===b.hidden?!0:!1,onChange:function(g){var h=!1;g&&(h=!0);a.showHideColumn(h,c,e);setCookie("CostData.hiddenColumns."+
e,!h)}}))}})}},getCellIndexesByAttribute:function(a,b){var c=[];dojo.forEach(this.layout.cells,function(d,e){d[a]&&d[a]==b&&c.push(e)});return c},showHideColumn:function(a,b,c){this.beginUpdate();var d=[];switch(c){case "approved_cost":d=this.getCellIndexesByAttribute("showHideGroup","show_hide_group_approved");break;case "awarded_cost":d=this.getCellIndexesByAttribute("showHideGroup","show_hide_group_awarded");break;case "adjusted_cost":d=this.getCellIndexesByAttribute("showHideGroup","show_hide_group_adjusted")}d.push(b);
for(var e in d)this.layout.setColumnVisibility(d[e],a);this.endUpdate()},reload:function(){this.store.close();this._refresh();this.setStructure(this.borderContainerWidget.getBreakdownGridStructure())}}),E=function(a,b,c){a=this.grid.getItem(b);"row_separator"==a.id[0]&&c.customClasses.push("invalidTypeItemCell");"summary"==a.type&&c.customClasses.push("disable-cell");return 0<a.id[0]||a.id[0]==buildspace.constants.GRID_LAST_ROW?parseInt(b)-3:null},F=function(a,b,c){b=this.grid.getItem(b);"row_separator"==
b.id[0]&&c.customClasses.push("invalidTypeItemCell");"summary"==b.type&&(c.customClasses.push("disable-cell"),c.customClasses.push("pull-right"),a="<strong>"+a+"</strong>");return a},p=function(a,b,c){b=this.grid.getItem(b);"row_separator"==b.id[0]&&c.customClasses.push("invalidTypeItemCell");"summary"==b.type&&c.customClasses.push("disable-cell");a||(a="&nbsp;");return a},m=function(a,b,c){b=this.grid.getItem(b);a=n.parse(a);a=isNaN(a)||0==a||null==a?"&nbsp;":u.format(a);void 0!=b.type&&1>b.type?
c.customClasses.push("invalidTypeItemCell"):c.customClasses.push("disable-cell");return a},q=function(a,b,c){a=n.parse(a);b=this.grid.getItem(b);void 0!=b.type&&1>b.type?c.customClasses.push("invalidTypeItemCell"):c.customClasses.push("disable-cell");a=isNaN(a)||0==a||null==a?"&nbsp;":n.format(a,{places:2})+"%";return'<span style="color: blue;">'+a+"</span>"},r=function(a,b,c){b=this.grid.getItem(b);"row_separator"==b.id[0]&&c.customClasses.push("invalidTypeItemCell");"summary"==b.type&&c.customClasses.push("disable-cell");
a=(0<b.id||"provisional_sum"==b.id||"summary"==b.type)&&0!=a&&a&&!isNaN(a)?u.format(a):"&nbsp;";var d=!1;"approved_cost"==this.field&&b.approved_cost_derived&&b.approved_cost_derived[0]?d=!0:"awarded_cost"==this.field&&b.awarded_cost_derived&&b.awarded_cost_derived[0]?d=!0:"variation_order_cost"==this.field&&b.variation_order_cost_derived&&b.variation_order_cost_derived[0]&&(d=!0);d&&(a='<span style="color: blue;"><strong>'+a+"</strong></span>",c.customClasses.push("light-blue-cell"));return a};return t("buildspace.apps.CostData.BreakdownContainer",
dijit.layout.BorderContainer,{region:"center",style:"padding:0px;border:none;width:100%;height:100%;",gutters:!1,costData:null,grid:null,editable:!1,storeUrl:null,costComparisonProjectParticulars:[],postCreate:function(){this.inherited(arguments);var a=this,b=buildspace.dialog.indeterminateProgressBar({title:f.pleaseWait+"..."}),c={url:"costData/getCostComparisonProjectParticulars",content:{cost_data_id:this.costData.id},handleAs:"json",load:function(d){if(d.success){a.costComparisonProjectParticulars=
d.data;a.storeUrl="costData/getBreakdown/id/"+a.costData.id;d=a.createStackContainer();var e=a.createBreakdownGrid(),g=new dijit.layout.ContentPane({style:"padding:0px;border:none;width:100%;height:100%;",region:"center",content:e,grid:e});e=new dijit.layout.BorderContainer({style:"padding:0px;width:100%;height:100%;",gutters:!1,grid:e,title:buildspace.truncateString(f.overallProjectCosting,60)});e.addChild(a.createToolbar());e.addChild(g);d.addChild(e)}b.hide()},error:function(d){b.hide()}};b.show();
dojo.xhrPost(c)},createStackContainer:function(){var a="costDataBreakdown"+this.costData.id+"-stackContainer",b=this.stackContainer=new dijit.layout.StackContainer({style:"border:0px;width:100%;height:100%;",region:"center",id:a});dojo.subscribe(a+"-selectChild","",function(d){var e=dijit.byId(a);if(e){var g=e.getChildren(),h=dojo.indexOf(g,d);h+=1;if(g.length>h)for(;g.length>h;)e.removeChild(g[h]),g[h].destroyDescendants(),g[h].destroyRecursive(),h+=1;d.grid&&d.grid.reload()}});var c=new dijit.layout.StackController({region:"top",
containerId:a});c=new dijit.layout.ContentPane({style:"padding:0px;overflow:hidden;",baseClass:"breadCrumbTrail",region:"top",id:"costDataBreakdown"+this.costData.id+"-controllerPane",content:c});this.addChild(b);this.addChild(c);return b},createBreakdownGrid:function(){var a=this;a.grid=D({id:"costData-breakdownGrid",costData:a.costData,borderContainerWidget:a,structure:this.getBreakdownGridStructure(),onRowDblClick:function(b){b=this.getItem(b.rowIndex);switch(b.type[0]){case buildspace.apps.CostData.ItemTypes.STANDARD:0<
b.id[0]&&a.createWorkCategoryGrid(b);break;case buildspace.apps.CostData.ItemTypes.PROVISIONAL_SUM:a.createProvisionalSumGrid();break;case buildspace.apps.CostData.ItemTypes.PRIME_COST_SUM:a.createPrimeCostSumGrid();break;case buildspace.apps.CostData.ItemTypes.PRIME_COST_RATE:a.createPrimeCostRateGrid(b,1)}},store:new dojo.data.ItemFileWriteStore({clearOnClose:!0,url:this.storeUrl})});return a.grid},getBreakdownGridStructure:function(){var a=2+this.costComparisonProjectParticulars.length,b=[{name:"No.",
field:"count",width:"30px",rowSpan:2,styles:"text-align:center;",formatter:E},{name:f.description,field:"description",width:"500px",rowSpan:2,formatter:F},{name:f.amount,field:"approved_cost",showHideGroup:"show_hide_group_approved",width:"150px",styles:"text-align: right;",cellType:"buildspace.widget.grid.cells.Textarea",editable:this.editable,showInCtxMenu:!0,hidden:getCookieBoolean("CostData.hiddenColumns.approved_cost"),formatter:r}],c;for(c in this.costComparisonProjectParticulars)b.push({name:f.cost+
"/"+(0===this.costComparisonProjectParticulars[c].uom_symbol.trim().length?f.unit:this.costComparisonProjectParticulars[c].uom_symbol.trim()),field:"approved-"+this.costComparisonProjectParticulars[c].id,showHideGroup:"show_hide_group_approved",width:"120px",styles:"text-align:right;",hidden:getCookieBoolean("CostData.hiddenColumns.approved_cost"),formatter:m});b=b.concat([{name:f.percentageOfTotalCost,field:"percentage_of_approved_sum",showHideGroup:"show_hide_group_approved",width:"150px",styles:"text-align: right;",
hidden:getCookieBoolean("CostData.hiddenColumns.approved_cost"),formatter:q},{name:f.amount,field:"awarded_cost",showHideGroup:"show_hide_group_awarded",width:"150px",styles:"text-align: right;",cellType:"buildspace.widget.grid.cells.Textarea",editable:this.editable,showInCtxMenu:!0,hidden:getCookieBoolean("CostData.hiddenColumns.awarded_cost"),formatter:r}]);for(c in this.costComparisonProjectParticulars)b.push({name:f.cost+"/"+(0===this.costComparisonProjectParticulars[c].uom_symbol.trim().length?
f.unit:this.costComparisonProjectParticulars[c].uom_symbol.trim()),field:"awarded-"+this.costComparisonProjectParticulars[c].id,showHideGroup:"show_hide_group_awarded",width:"120px",styles:"text-align:right;",hidden:getCookieBoolean("CostData.hiddenColumns.awarded_cost"),formatter:m});b=b.concat([{name:f.percentageOfTotalCost,field:"percentage_of_awarded_sum",showHideGroup:"show_hide_group_awarded",width:"150px",styles:"text-align: right;",hidden:getCookieBoolean("CostData.hiddenColumns.awarded_cost"),
formatter:q},{name:f.amount,field:"adjusted_cost",showHideGroup:"show_hide_group_adjusted",width:"140px",styles:"text-align:right;",showInCtxMenu:!0,hidden:getCookieBoolean("CostData.hiddenColumns.adjusted_cost"),formatter:m}]);for(c in this.costComparisonProjectParticulars)b.push({name:f.cost+"/"+(0===this.costComparisonProjectParticulars[c].uom_symbol.trim().length?f.unit:this.costComparisonProjectParticulars[c].uom_symbol.trim()),field:"adjusted-"+this.costComparisonProjectParticulars[c].id,showHideGroup:"show_hide_group_adjusted",
width:"120px",styles:"text-align:right;",hidden:getCookieBoolean("CostData.hiddenColumns.adjusted_cost"),formatter:m});b=b.concat([{name:f.percentageOfTotalCost,field:"percentage_of_adjusted_sum",showHideGroup:"show_hide_group_adjusted",width:"140px",styles:"text-align:right;",hidden:getCookieBoolean("CostData.hiddenColumns.adjusted_cost"),formatter:q},{name:f.variationOrderCost,field:"variation_order_cost",width:"140px",rowSpan:2,cellType:"buildspace.widget.grid.cells.Textarea",editable:this.editable,
styles:"text-align:right;",showInCtxMenu:!0,hidden:getCookieBoolean("CostData.hiddenColumns.variation_order_cost"),formatter:r},{name:f.updatedBy,field:"updated_by",styles:"text-align: center;",width:"140px",rowSpan:2,showInCtxMenu:!0,hidden:getCookieBoolean("CostData.hiddenColumns.updated_by"),formatter:p},{name:f.updatedAt,field:"updated_at",width:"120px",styles:"text-align: center;",rowSpan:2,showInCtxMenu:!0,hidden:getCookieBoolean("CostData.hiddenColumns.updated_at"),formatter:p},{name:f.remarks,
field:"remarks",width:"300px",rowSpan:2,cellType:"buildspace.widget.grid.cells.Textarea",editable:this.editable,showInCtxMenu:!0,hidden:getCookieBoolean("CostData.hiddenColumns.remarks"),formatter:p}]);return{noscroll:!1,cells:[b,[{name:this.costData.approved_date?f.budget+" ("+this.costData.approved_date+")":f.budget,showHideGroup:"show_hide_group_approved",hidden:getCookieBoolean("CostData.hiddenColumns.approved_cost"),styles:"text-align:center;",headerClasses:"staticHeader",colSpan:a},{name:this.costData.awarded_date?
f.contractSum+" ("+this.costData.awarded_date+")":f.contractSum,showHideGroup:"show_hide_group_awarded",hidden:getCookieBoolean("CostData.hiddenColumns.awarded_cost"),styles:"text-align:center;",headerClasses:"staticHeader",colSpan:a},{name:this.costData.adjusted_date?f.adjustedSum+" ("+this.costData.adjusted_date+")":f.adjustedSum,showHideGroup:"show_hide_group_adjusted",hidden:getCookieBoolean("CostData.hiddenColumns.adjusted_cost"),styles:"text-align:center;",headerClasses:"staticHeader",colSpan:a}]]}},
createToolbar:function(){var a=this,b=new dijit.Toolbar({region:"top",style:"outline:none!important;border:none;padding:2px;width:100%;"});b.addChild(new dijit.form.Button({id:this.costData.id+"project-overall-costing-refresh-button",label:f.refresh,iconClass:"icon-16-container icon-16-reload",style:"outline:none!important;",onClick:function(){a.grid.reload()}}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({label:f.comparisonReport,iconClass:"icon-16-container icon-16-print",
style:"outline:none!important;",onClick:function(){a.createComparisonReportDialog()}}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({label:f.tenderComparisonReport,iconClass:"icon-16-container icon-16-print",style:"outline:none!important;",onClick:function(){a.createTenderComparisonReportDialog()}}));a.editable&&(b.addChild(new dijit.ToolbarSeparator),b.addChild(new dijit.form.Button({id:this.costData.id+"-row-inclusion-button",label:f.showHideRows,iconClass:"icon-16-container icon-16-dial",
style:"outline:none!important;",onClick:function(){a.createRowVisibilityDialog()}})));return b},createComparisonReportDialog:function(){(new A({gridUrl:"costData/getCostDataList/costData/"+this.costData.id,title:f.comparisonReport,exportUrl:"comparisonReport/export/costData/"+this.costData.id+"/parent_id/0/level/"+buildspace.apps.CostData.Levels.overallProjectCosting,costData:this.costData,level:buildspace.apps.CostData.Levels.overallProjectCosting,type:buildspace.apps.CostData.ItemTypes.STANDARD})).show()},
createTenderComparisonReportDialog:function(){(new B({exportUrl:"tenderComparison/export/costData/"+this.costData.id+"/level/"+buildspace.apps.CostData.Levels.overallProjectCosting,costData:this.costData,level:buildspace.apps.CostData.Levels.overallProjectCosting})).show()},createRowVisibilityDialog:function(){var a=this,b=[];dojo.forEach(a.grid.store._arrayOfAllItems,function(c,d){0<c.id[0]&&b.push(c.id[0])});(new C({title:f.showHideRows,gridUrl:"costData/getAllCostDataItemRecords/costData/"+a.costData.id+
"/parent_id/0",saveUrl:"costData/updateItemVisibility/costData/"+a.costData.id+"/_csrf_token/"+a.costData._csrf_token,selectedItemIds:b,deselectedItemIds:[],onSave:function(){a.grid.reload()}})).show()},createWorkCategoryGrid:function(a){a=new w({title:buildspace.truncateString(a.description,60),stackContainer:this.stackContainer,editable:this.editable,costData:this.costData,projectCostingItem:a});this.stackContainer.addChild(a);this.stackContainer.selectChild(a)},reloadPrimeCostSumGrid:function(){this.stackContainer.removeChild(this.primeCostSumContainer);
this.primeCostSumContainer.destroyDescendants();this.primeCostSumContainer.destroyRecursive();this.createPrimeCostSumGrid()},createPrimeCostSumGrid:function(){var a=this.primeCostSumContainer=new y({title:buildspace.truncateString(f.primeCostSum,60),stackContainer:this.stackContainer,editable:this.editable,costData:this.costData,mainBreakdownGrid:this});this.stackContainer.addChild(a);this.stackContainer.selectChild(a)},createProvisionalSumGrid:function(){var a=new x({title:buildspace.truncateString(f.provisionalSum,
60),stackContainer:this.stackContainer,editable:this.editable,costData:this.costData});this.stackContainer.addChild(a);this.stackContainer.selectChild(a)},createPrimeCostRateGrid:function(a,b){0<a.id||(a.id=0);a=new z({title:buildspace.truncateString(a.description,60),editable:this.editable,costData:this.costData,gridCreator:this,parentItem:a,level:b});this.stackContainer.addChild(a);this.stackContainer.selectChild(a)}})});
