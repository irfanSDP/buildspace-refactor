define("buildspace/apps/CostData/ElementGrid","dojo/_base/declare dojo/number dojo/currency dojox/grid/EnhancedGrid buildspace/widget/grid/cells/Textarea ./LinkBillItems/ProjectListingGrid ./LinkVariationOrderItems/ProjectListingGrid ./ComparisonReport/ComparisonReportDialog ./TenderComparisonReport/TenderComparisonReportDialog ./RowInclusion/RowInclusionDialog dojo/i18n!buildspace/nls/CostData".split(" "),function(t,n,u,v,G,w,x,y,z,A,e){var C=t("buildspace.apps.CostData.ElementGrid",v,{style:"border:none;",
region:"center",keepSelection:!0,rowSelector:"0px",escapeHTMLInData:!1,costData:null,workCategory:null,container:null,constructor:function(a){this.inherited(arguments);this.createHeaderCtxMenu()},canSort:function(a){return!1},postCreate:function(){this.inherited(arguments);this.createHeaderCtxMenuItems()},onStyleRow:function(a){this.inherited(arguments);if(a.node.children[0]&&2<=a.node.children[0].children[0].rows.length){var b=a.node.children[0].children[0].rows[1],c=a.node.children[0].children[0].rows[0].children;
b.parentNode.removeChild(b);dojo.forEach(c,function(d,f){f=dojo.attr(d,"rowSpan");(!f||2>f)&&dojo.attr(d,"rowSpan",2)})}},dodblclick:function(a){this.onRowDblClick(a)},focusCell:function(a,b){var c=this,d=c.getCellByField(b);window.setTimeout(function(){c.focus.setFocusIndex(a,d.index)},10)},updateRecord:function(a,b,c){var d=this,f=d.getItem(b),g=d.store,h=buildspace.dialog.indeterminateProgressBar({title:e.savingData+". "+e.pleaseWait+"..."}),B=function(l,k){for(var m in l)f.hasOwnProperty(m)&&
m!=k._getIdentifierAttribute()&&k.setValue(f,m,l[m]);k.save()};a={url:"costData/updateItem",content:{id:f.id,attr_name:c,val:a,cost_data_id:d.costData.id,item_id:f.id,_csrf_token:f._csrf_token?f._csrf_token:null},handleAs:"json",load:function(l){l.success&&(0<f.id&&B(l.data,g),d.focusCell(b,c),dojo.forEach(d.container.stackContainer.getChildren(),function(k,m){k.grid.id!=d.id&&k.grid&&k.grid.reload()}));h.hide()},error:function(l){h.hide()}};h.show();dojo.xhrPost(a)},doApplyCellEdit:function(a,b,
c){var d=this,f=d.getItem(b),g=d.store,h=f[c][0];a!==f[c][0]&&("approved_cost"==c&&f.approved_cost_derived[0]||"awarded_cost"==c&&f.awarded_cost_derived[0]||"variation_order_cost"==c&&f.variation_order_cost_derived[0]?buildspace.dialog.confirm(e.confirmation,e.itemBreakdownWillBeLost+"<br/>"+e.cannotBeUndone,60,280,function(){d.updateRecord(a,b,c)},function(){g.setValue(f,c,h);g.save();d.focusCell(b,c)}):d.updateRecord(a,b,c));d.inherited(arguments)},canEdit:function(a,b){return void 0!=a?0<this.getItem(b).id[0]:
this._canEdit},createHeaderCtxMenu:function(){this.plugins={menus:{headerMenu:new dijit.Menu}}},createHeaderCtxMenuItems:function(){menusObject=this.plugins.menus;if("undefined"!==typeof this.structure){var a=this;dojo.forEach(this.structure.cells[0],function(b,c){if(b.showInCtxMenu){var d=b.name,f=b.field;switch(f){case "approved_cost":d=e.budget;break;case "awarded_cost":d=e.contractSum;break;case "adjusted_cost":d=e.adjustedSum;break;default:d=b.name}menusObject.headerMenu.addChild(new dijit.CheckedMenuItem({label:d,
checked:"undefined"===typeof b.hidden||!1===b.hidden?!0:!1,onChange:function(g){var h=!1;g&&(h=!0);a.showHideColumn(h,c,f);setCookie("CostData.hiddenColumns."+f,!h)}}))}})}},getCellIndexesByAttribute:function(a,b){var c=[];dojo.forEach(this.layout.cells,function(d,f){d[a]&&d[a]==b&&c.push(f)});return c},showHideColumn:function(a,b,c){this.beginUpdate();var d=[];switch(c){case "approved_cost":d=this.getCellIndexesByAttribute("showHideGroup","show_hide_group_approved");break;case "awarded_cost":d=this.getCellIndexesByAttribute("showHideGroup",
"show_hide_group_awarded");break;case "adjusted_cost":d=this.getCellIndexesByAttribute("showHideGroup","show_hide_group_adjusted")}d.push(b);for(var f in d)this.layout.setColumnVisibility(d[f],a);this.endUpdate()},reload:function(){this.store.close();this._refresh()}}),D=function(a,b,c){return"summary"==this.grid.getItem(b).type?(c.customClasses.push("disable-cell"),null):parseInt(b)+1},E=function(a,b,c){"summary"==this.grid.getItem(b).type&&(c.customClasses.push("disable-cell"),c.customClasses.push("pull-right"),
a="<strong>"+a+"</strong>");return a},F=function(a,b,c){"summary"==this.grid.getItem(b).type&&c.customClasses.push("disable-cell");a||(a="&nbsp;");return a},p=function(a,b,c){this.grid.getItem(b);a=n.parse(a);a=isNaN(a)||0==a||null==a?"&nbsp;":u.format(a);c.customClasses.push("disable-cell");return a},q=function(a,b,c){a=n.parse(a);c.customClasses.push("disable-cell");a=isNaN(a)||0==a||null==a?"&nbsp;":n.format(a,{places:2})+"%";return'<span style="color: blue;">'+a+"</span>"},r=function(a,b,c){b=
this.grid.getItem(b);var d=n.parse(a);"summary"==b.type&&c.customClasses.push("disable-cell");a=isNaN(d)||0==d||null==d?"&nbsp;":u.format(a);d=!1;"approved_cost"==this.field&&b.approved_cost_derived&&b.approved_cost_derived[0]?d=!0:"awarded_cost"==this.field&&b.awarded_cost_derived&&b.awarded_cost_derived[0]?d=!0:"variation_order_cost"==this.field&&b.variation_order_cost_derived&&b.variation_order_cost_derived[0]&&(d=!0);d&&(a='<span style="color: #42b449;"><strong>'+a+"</strong></span>",c.customClasses.push("light-blue-cell"));
return a};return t("buildspace.apps.CostData.ElementsContainer",dijit.layout.BorderContainer,{region:"center",title:"",style:"padding:0px;border:none;width:100%;height:100%;",gutters:!1,costData:null,workCategory:null,costComparisonProjectParticulars:[],grid:null,stackContainer:null,editable:!1,postCreate:function(){this.inherited(arguments);var a=this,b=buildspace.dialog.indeterminateProgressBar({title:e.pleaseWait+"..."}),c={url:"costData/getCostComparisonProjectParticulars",content:{cost_data_id:this.costData.id},
handleAs:"json",load:function(d){d.success&&(a.costComparisonProjectParticulars=d.data,d=a.createBreakdownGrid(),d=new dijit.layout.ContentPane({style:"padding:0px;border:none;width:100%;height:100%;",region:"center",content:d,grid:d}),a.addChild(a.createToolbar()),a.addChild(d));b.hide()},error:function(d){b.hide()}};b.show();dojo.xhrPost(c)},createToolbar:function(){var a=this,b=new dijit.Toolbar({region:"top",style:"outline:none!important;border:none;padding:2px;width:100%;"});b.addChild(new dijit.form.Button({id:this.costData.id+
"element-refresh-button",label:e.refresh,iconClass:"icon-16-container icon-16-reload",style:"outline:none!important;",onClick:function(){a.grid.reload()}}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({label:e.comparisonReport,iconClass:"icon-16-container icon-16-print",style:"outline:none!important;",onClick:function(){a.createComparisonReportDialog()}}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({label:e.tenderComparisonReport,iconClass:"icon-16-container icon-16-print",
style:"outline:none!important;",onClick:function(){a.createTenderComparisonReportDialog()}}));a.editable&&(b.addChild(new dijit.ToolbarSeparator),b.addChild(new dijit.form.Button({id:this.costData.id+"-element-row-inclusion-button",label:e.showHideRows,iconClass:"icon-16-container icon-16-dial",style:"outline:none!important;",onClick:function(){a.createRowVisibilityDialog()}})));return b},getGridStructure:function(){var a=2+this.costComparisonProjectParticulars.length,b=[{name:"No.",field:"count",
width:"30px",styles:"text-align:center;",rowSpan:2,formatter:D},{name:e.element,field:"description",rowSpan:2,width:"500px",formatter:E},{name:e.elementalCost,field:"approved_cost",showHideGroup:"show_hide_group_approved",width:"140px",styles:"text-align:right;",cellType:"buildspace.widget.grid.cells.Textarea",editable:this.editable,showInCtxMenu:!0,hidden:getCookieBoolean("CostData.hiddenColumns.approved_cost"),formatter:r}],c;for(c in this.costComparisonProjectParticulars)b.push({name:e.elementalCost+
"/"+(0===this.costComparisonProjectParticulars[c].uom_symbol.trim().length?e.unit:this.costComparisonProjectParticulars[c].uom_symbol.trim()),field:"approved-"+this.costComparisonProjectParticulars[c].id,showHideGroup:"show_hide_group_approved",width:"120px",styles:"text-align:right;",hidden:getCookieBoolean("CostData.hiddenColumns.approved_cost"),formatter:p});b=b.concat([{name:e.percentage,field:"approved_percentage",showHideGroup:"show_hide_group_approved",width:"70px",styles:"text-align:right;",
hidden:getCookieBoolean("CostData.hiddenColumns.approved_cost"),formatter:q},{name:e.elementalCost,field:"awarded_cost",showHideGroup:"show_hide_group_awarded",width:"140px",styles:"text-align:right;",cellType:"buildspace.widget.grid.cells.Textarea",editable:this.editable,showInCtxMenu:!0,hidden:getCookieBoolean("CostData.hiddenColumns.awarded_cost"),formatter:r}]);for(c in this.costComparisonProjectParticulars)b.push({name:e.elementalCost+"/"+(0===this.costComparisonProjectParticulars[c].uom_symbol.trim().length?
e.unit:this.costComparisonProjectParticulars[c].uom_symbol.trim()),field:"awarded-"+this.costComparisonProjectParticulars[c].id,showHideGroup:"show_hide_group_awarded",width:"120px",styles:"text-align:right;",hidden:getCookieBoolean("CostData.hiddenColumns.awarded_cost"),formatter:p});b=b.concat([{name:e.percentage,field:"awarded_percentage",showHideGroup:"show_hide_group_awarded",width:"70px",styles:"text-align:right;",hidden:getCookieBoolean("CostData.hiddenColumns.awarded_cost"),formatter:q},{name:e.elementalCost,
field:"adjusted_cost",showHideGroup:"show_hide_group_adjusted",width:"140px",styles:"text-align:right;",showInCtxMenu:!0,hidden:getCookieBoolean("CostData.hiddenColumns.approved_cost"),formatter:p}]);for(c in this.costComparisonProjectParticulars)b.push({name:e.elementalCost+"/"+(0===this.costComparisonProjectParticulars[c].uom_symbol.trim().length?e.unit:this.costComparisonProjectParticulars[c].uom_symbol.trim()),field:"adjusted-"+this.costComparisonProjectParticulars[c].id,showHideGroup:"show_hide_group_adjusted",
width:"120px",styles:"text-align:right;",hidden:getCookieBoolean("CostData.hiddenColumns.adjusted_cost"),formatter:p});b=b.concat([{name:e.percentage,field:"adjusted_percentage",showHideGroup:"show_hide_group_adjusted",width:"70px",styles:"text-align:right;",hidden:getCookieBoolean("CostData.hiddenColumns.adjusted_cost"),formatter:q},{name:e.variationOrderCost,field:"variation_order_cost",width:"140px",styles:"text-align:right;",rowSpan:2,cellType:"buildspace.widget.grid.cells.Textarea",editable:this.editable,
showInCtxMenu:!0,hidden:getCookieBoolean("CostData.hiddenColumns.variation_order_cost"),formatter:r},{name:e.remarks,field:"remarks",width:"300px",rowSpan:2,cellType:"buildspace.widget.grid.cells.Textarea",editable:this.editable,showInCtxMenu:!0,hidden:getCookieBoolean("CostData.hiddenColumns.remarks"),formatter:F}]);return{noscroll:!1,cells:[b,[{name:this.costData.approved_date?e.budget+" ("+this.costData.approved_date+")":e.budget,showHideGroup:"show_hide_group_approved",hidden:getCookieBoolean("CostData.hiddenColumns.approved_cost"),
styles:"text-align:center;",headerClasses:"staticHeader",colSpan:a},{name:this.costData.awarded_date?e.contractSum+" ("+this.costData.awarded_date+")":e.contractSum,showHideGroup:"show_hide_group_awarded",hidden:getCookieBoolean("CostData.hiddenColumns.awarded_cost"),styles:"text-align:center;",headerClasses:"staticHeader",colSpan:a},{name:this.costData.adjusted_date?e.adjustedSum+" ("+this.costData.adjusted_date+")":e.adjustedSum,showHideGroup:"show_hide_group_adjusted",hidden:getCookieBoolean("CostData.hiddenColumns.adjusted_cost"),
styles:"text-align:center;",headerClasses:"staticHeader",colSpan:a}]]}},createBreakdownGrid:function(){var a=this;a.grid=C({id:"costData-elementGrid",costData:a.costData,workCategory:a.workCategory,container:a,structure:a.getGridStructure(),store:new dojo.data.ItemFileWriteStore({clearOnClose:!0,url:"costData/getElementList/costData/"+this.costData.id+"/id/"+this.workCategory.id}),onRowDblClick:function(b){var c=this.getItem(b.rowIndex);0<c.id[0]&&a.editable&&(b=b.cell.field,"awarded_cost"==b&&a.createLinkBillItemsContainer(c),
"variation_order_cost"==b&&a.createLinkVariationOrderItemsContainer(c))}});return a.grid},createComparisonReportDialog:function(){(new y({gridUrl:"costData/getCostDataList/costData/"+this.costData.id,title:e.comparisonReport,exportUrl:"comparisonReport/export/costData/"+this.costData.id+"/parent_id/"+this.workCategory.id+"/level/"+buildspace.apps.CostData.Levels.element+"/_csrf_token/"+this.costData._csrf_token,costData:this.costData,parentItemId:this.workCategory.id,level:buildspace.apps.CostData.Levels.element,
type:buildspace.apps.CostData.ItemTypes.STANDARD})).show()},createTenderComparisonReportDialog:function(){(new z({exportUrl:"tenderComparison/export/costData/"+this.costData.id+"/parent_id/"+this.workCategory.id+"/level/"+buildspace.apps.CostData.Levels.element,costData:this.costData,parentItemId:this.workCategory.id,level:buildspace.apps.CostData.Levels.element})).show()},createRowVisibilityDialog:function(){var a=this,b=[];dojo.forEach(a.grid.store._arrayOfAllItems,function(c,d){0<c.id[0]&&b.push(c.id[0])});
(new A({title:e.showHideRows,gridUrl:"costData/getAllCostDataItemRecords/costData/"+a.costData.id+"/parent_id/"+a.workCategory.id,saveUrl:"costData/updateItemVisibility/costData/"+a.costData.id+"/_csrf_token/"+a.workCategory._csrf_token,selectedItemIds:b,deselectedItemIds:[],onSave:function(){a.grid.reload()}})).show()},createLinkBillItemsContainer:function(a){var b=this,c=buildspace.dialog.indeterminateProgressBar({title:e.pleaseWait+"..."});c.show().then(function(){dojo.xhrGet({url:"costData/getLinkedItems/cost_data_id/"+
b.costData.id+"/id/"+a.id+"/id_type/bill_item_id",content:{id:a.id,cost_data_id:b.costData.id,_csrf_token:b._csrf_token},handleAs:"json",load:function(d){if(d.success){var f="linkBillItems-"+b.costData.id+"-projectListingGrid",g=dijit.byId(f);g&&(b.removeChild(g),g.destroy());d=new w({id:f,title:buildspace.truncateString(a.description,60),region:"bottom",parentContainer:b,costData:b.costData,item:a,style:"padding:0px;margin:0px;width:100%;height:80%;",selectedItemIds:d.ids,linkedProjectsUrl:"costData/getLinkedItems/cost_data_id/"+
b.costData.id+"/id/"+a.id+"/id_type/project_id",linkedBillsUrl:"costData/getLinkedItems/cost_data_id/"+b.costData.id+"/id/"+a.id+"/id_type/bill_id",linkedElementsUrl:"costData/getLinkedItems/cost_data_id/"+b.costData.id+"/id/"+a.id+"/id_type/element_id",conversionFactor:d.conversion_factor,updateUrl:"costData/linkBillItems/id/"+a.id+"/_csrf_token/"+a._csrf_token,onSave:function(){b.grid.reload()}});b.addChild(d)}c.hide()},error:function(d){}})})},createLinkVariationOrderItemsContainer:function(a){var b=
this,c="linkVariationOrderItems-"+b.costData.id+"-projectListingGrid",d=dijit.byId(c);d&&(b.removeChild(d),d.destroy());a=new x({id:c,title:e.variationOrders,region:"bottom",parentContainer:b,costData:b.costData,masterItem:a,style:"padding:0px;margin:0px;width:100%;height:80%;",onSave:function(){b.grid.reload()}});b.addChild(a)}})});
