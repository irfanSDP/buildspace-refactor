define("buildspace/apps/CostData/PrimeCostRateGrid","dojo/_base/declare dojo/number dojo/currency dojox/grid/EnhancedGrid buildspace/widget/grid/cells/Formatter buildspace/widget/grid/cells/Textarea ./ComparisonReport/ComparisonReportDialog ./RowInclusion/RowInclusionDialog ./PrimeCostRateLinkBillItems/ProjectListingGrid dojo/i18n!buildspace/nls/CostData".split(" "),function(p,q,r,v,w,E,x,y,z,e){var B=p("buildspace.apps.CostData.PrimeCostRateGrid",v,{style:"border:none;",region:"center",keepSelection:!0,
escapeHTMLInData:!1,costData:null,parentItem:null,gridCreator:null,constructor:function(a){this.inherited(arguments)},canSort:function(a){return!1},postCreate:function(){this.inherited(arguments)},onStyleRow:function(a){this.inherited(arguments);if(a.node.children[0]&&2<=a.node.children[0].children[0].rows.length){var b=a.node.children[0].children[0].rows[1],c=a.node.children[0].children[0].rows[0].children;b.parentNode.removeChild(b);dojo.forEach(c,function(d,f){f=dojo.attr(d,"rowSpan");(!f||2>f)&&
dojo.attr(d,"rowSpan",2)})}},dodblclick:function(a){this.onRowDblClick(a)},focusCell:function(a,b){var c=this,d=c.getCellByField(b);window.setTimeout(function(){c.focus.setFocusIndex(a,d.index)},10)},updateRecord:function(a,b,c){var d=this,f=d.getItem(b),k=d.store,m=buildspace.dialog.indeterminateProgressBar({title:e.savingData+". "+e.pleaseWait+"..."}),A=function(h,g){for(var l in h)f.hasOwnProperty(l)&&l!=g._getIdentifierAttribute()&&g.setValue(f,l,h[l]);g.save()};a={url:"primeCostRate/updateItem",
content:{id:f.id,attr_name:c,val:a,cost_data_id:d.costData.id,item_id:f.id,_csrf_token:f._csrf_token?f._csrf_token:null},handleAs:"json",load:function(h){h.success&&(0<f.id&&A(h.data,k),d.focusCell(b,c),dojo.forEach(d.gridCreator.stackContainer.getChildren(),function(g,l){g.grid.id!=d.id&&g.grid&&g.grid.reload()}));m.hide()},error:function(h){m.hide()}};m.show();dojo.xhrPost(a)},doApplyCellEdit:function(a,b,c){var d=this.getItem(b);a!==d[c][0]&&this.updateRecord(a,b,c);this.inherited(arguments)},
canEdit:function(a,b){return void 0!=a?0<this.getItem(b).id[0]:this._canEdit},reload:function(){this.store.close();this._refresh()}}),C=function(a,b,c){return"summary"==this.grid.getItem(b).type?(c.customClasses.push("disable-cell"),null):parseInt(b)+1},D=function(a,b,c){"summary"==this.grid.getItem(b).type&&(c.customClasses.push("disable-cell"),c.customClasses.push("pull-right"),a="<strong>"+a+"</strong>");return a},n=function(a,b,c){b=this.grid.getItem(b);var d=q.parse(a);"summary"==b.type&&c.customClasses.push("disable-cell");
a=isNaN(d)||0==d||null==d?"&nbsp;":r.format(a);d=!1;"approved_value"==this.field&&b.approved_value_derived&&b.approved_value_derived[0]?d=!0:"awarded_value"==this.field&&b.awarded_value_derived&&b.awarded_value_derived[0]&&(d=!0);d&&(a='<span style="color: blue;"><strong>'+a+"</strong></span>",c.customClasses.push("light-blue-cell"));return a},t=function(a,b,c){b=q.parse(a);c.customClasses.push("disable-cell");return a=isNaN(b)||0==b||null==b?"&nbsp;":r.format(a)},u=function(a,b,c){"summary"==this.grid.getItem(b).type&&
c.customClasses.push("disable-cell");return a};return p("buildspace.apps.CostData.PrimeCostRateContainer",dijit.layout.BorderContainer,{region:"center",title:"",style:"padding:0px;border:none;width:100%;height:100%;",gutters:!1,costData:null,parentItem:null,grid:null,level:null,gridCreator:null,editable:!1,postCreate:function(){this.inherited(arguments);var a=this.createBreakdownGrid();a=new dijit.layout.ContentPane({style:"padding:0px;border:none;width:100%;height:100%;",region:"center",content:a,
grid:a});this.addChild(this.createToolbar());this.addChild(a)},createToolbar:function(){var a=this,b=new dijit.Toolbar({region:"top",style:"outline:none!important;border:none;padding:2px;width:100%;"});b.addChild(new dijit.form.Button({id:this.parentItem.id+"prime-cost-rate-refresh-button",label:e.refresh,iconClass:"icon-16-container icon-16-reload",style:"outline:none!important;",onClick:function(){a.grid.reload()}}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({label:e.comparisonReport,
iconClass:"icon-16-container icon-16-print",style:"outline:none!important;",onClick:function(){a.createComparisonReportDialog()}}));a.editable&&(b.addChild(new dijit.ToolbarSeparator),b.addChild(new dijit.form.Button({id:this.parentItem.id+"-prime-cost-rate-row-inclusion-button",label:e.showHideRows,iconClass:"icon-16-container icon-16-dial",style:"outline:none!important;",onClick:function(){a.createRowVisibilityDialog()}})));return b},getGridStructure:function(){this.gridFormatter=new w;return{noscroll:!1,
cells:[[{name:"No.",field:"count",width:"30px",styles:"text-align:center;",rowSpan:2,formatter:C},{name:e.description,field:"description",rowSpan:2,width:3!=this.level?"auto":"500px",formatter:D},{name:e.unit,field:"uom_id",rowSpan:2,width:"70px",styles:"text-align:center;",hidden:3!=this.level,formatter:this.gridFormatter.unEditableUnitCellFormatter},{name:3!=this.level?e.totalUnits:e.qty,field:"units",rowSpan:2,width:"140px",cellType:"buildspace.widget.grid.cells.Textarea",editable:this.editable,
styles:"text-align:right;",formatter:n},{name:3!=this.level?e.amountPerUnit:e.unitRate,field:"approved_value",width:"140px",cellType:"buildspace.widget.grid.cells.Textarea",editable:this.editable,styles:"text-align:right;",formatter:n},{name:e.totalAmount,field:"approved_total",width:"120px",styles:"text-align:right;",formatter:t},{name:e.brand,field:"approved_brand",width:"200px",editable:this.editable,hidden:3!=this.level,cellType:"buildspace.widget.grid.cells.Textarea",styles:"text-align:center;",
formatter:u},{name:3!=this.level?e.amountPerUnit:e.unitRate,field:"awarded_value",width:"140px",cellType:"buildspace.widget.grid.cells.Textarea",editable:this.editable,styles:"text-align:right;",formatter:n},{name:e.totalAmount,field:"awarded_total",width:"120px",styles:"text-align:right;",formatter:t},{name:e.brand,field:"awarded_brand",width:"200px",editable:this.editable,hidden:3!=this.level,cellType:"buildspace.widget.grid.cells.Textarea",styles:"text-align:center;",formatter:u}],[{name:this.costData.approved_date?
e.budget+" ("+this.costData.approved_date+")":e.budget,styles:"text-align:center;",headerClasses:"staticHeader",colSpan:3!=this.level?2:3},{name:this.costData.awarded_date?e.contractSum+" ("+this.costData.awarded_date+")":e.contractSum,styles:"text-align:center;",headerClasses:"staticHeader",colSpan:3!=this.level?2:3}]]}},createBreakdownGrid:function(){var a=this;a.grid=B({costData:a.costData,parentItem:a.parentItem,gridCreator:a.gridCreator,structure:a.getGridStructure(),store:new dojo.data.ItemFileWriteStore({clearOnClose:!0,
url:"primeCostRate/getBreakdown/costData/"+this.costData.id+"/parent_id/"+this.parentItem.id+"/level/"+a.level}),onRowDblClick:function(b){var c=this.getItem(b.rowIndex);3>a.level&&0<c.id[0]?a.createPrimeCostRateGrid(c):3==a.level&&0<c.id[0]&&"awarded_value"==b.cell.field&&a.createLinkBillItemsContainer(c)}});return a.grid},createComparisonReportDialog:function(){(new x({gridUrl:"costData/getCostDataList/costData/"+this.costData.id,title:e.comparisonReport,exportUrl:"primeCostRate/exportComparisonReport/costData/"+
this.costData.id+"/parent_id/"+this.parentItem.id+"/level/"+this.level+"/_csrf_token/"+this.costData._csrf_token,costData:this.costData,level:this.level,type:buildspace.apps.CostData.ItemTypes.PRIME_COST_RATE,parentItemId:this.parentItem.id})).show()},createRowVisibilityDialog:function(){var a=this,b=[];dojo.forEach(a.grid.store._arrayOfAllItems,function(c,d){0<c.id[0]&&b.push(c.id[0])});(new y({title:e.showHideRows,gridUrl:"primeCostRate/getAllPrimeCostRateRecords/costData/"+a.costData.id+"/parent_id/"+
a.parentItem.id,saveUrl:"primeCostRate/updateItemVisibility/costData/"+a.costData.id+"/_csrf_token/"+a.costData._csrf_token,selectedItemIds:b,deselectedItemIds:[],onSave:function(){a.grid.reload()}})).show()},createPrimeCostRateGrid:function(a){this.gridCreator.createPrimeCostRateGrid(a,this.level+1)},createLinkBillItemsContainer:function(a){var b=this,c=buildspace.dialog.indeterminateProgressBar({title:e.pleaseWait+"..."});c.show().then(function(){dojo.xhrGet({url:"primeCostRate/getLinkedItems/cost_data_id/"+
b.costData.id+"/id/"+a.id+"/id_type/bill_item_id",content:{id:a.id,cost_data_id:b.costData.id,_csrf_token:b._csrf_token},handleAs:"json",load:function(d){if(d.success){var f="primeCostRate-linkBillItems-"+b.costData.id+"-projectListingGrid",k=dijit.byId(f);k&&(b.removeChild(k),k.destroy());d=new z({id:f,title:buildspace.truncateString(a.description,60),region:"bottom",parentContainer:b,costData:b.costData,item:a,style:"padding:0px;margin:0px;width:100%;height:80%;",selectedItemIds:d.ids,linkedProjectsUrl:"primeCostRate/getLinkedItems/cost_data_id/"+
b.costData.id+"/id/"+a.id+"/id_type/project_id",linkedBillsUrl:"primeCostRate/getLinkedItems/cost_data_id/"+b.costData.id+"/id/"+a.id+"/id_type/bill_id",linkedElementsUrl:"primeCostRate/getLinkedItems/cost_data_id/"+b.costData.id+"/id/"+a.id+"/id_type/element_id",updateUrl:"primeCostRate/linkBillItems/id/"+a.id+"/_csrf_token/"+a._csrf_token,onSave:function(){b.grid.reload()}});b.addChild(d)}c.hide()},error:function(d){}})})}})});
