define("buildspace/apps/CostData/NominatedSubContractorColumns","dojo/_base/declare dojo/_base/lang dojox/grid/EnhancedGrid buildspace/widget/grid/cells/Formatter buildspace/widget/grid/cells/Textarea dojo/i18n!buildspace/nls/CostData".split(" "),function(k,n,p,q,t,d){var r=k("buildspace.apps.CostData.NominatedSubContractorColumnsGrid",p,{costData:null,style:"border:none;",region:"center",escapeHTMLInData:!1,addUrl:"primeCostSum/addNewColumn",updateUrl:"primeCostSum/updateColumn",editable:!1,constructor:function(a){this.inherited(arguments)},
canSort:function(a){return!1},postCreate:function(){var a=this;this.inherited(arguments);this.on("RowClick",function(b){if(b.cell){var c=!1;0<this.getItem(b.rowIndex).id[0]&&(c=!0);a.editable&&a.enableToolbarButtons(c)}})},enableToolbarButtons:function(a){var b=dijit.byId(this.costData.id+"-prime-cost-sum-column-delete-button");b&&b._setDisabledAttr(!a)},dodblclick:function(a){this.onRowDblClick(a)},doApplyCellEdit:function(a,b,c){var f=this,e=f.getItem(b),h=f.store;if(a!==e[c][0]){var m=buildspace.dialog.indeterminateProgressBar({title:d.savingData+
". "+d.pleaseWait+"..."}),l={id:e.id,column_name:a,cost_data_id:f.costData.id,_csrf_token:e._csrf_token?e._csrf_token:null},g=this.updateUrl;e.id==buildspace.constants.GRID_LAST_ROW&&(g=0<b?f.getItem(b-1):!1,n.mixin(l,{prev_item_id:g?g.id:0}),g=this.addUrl);var k=function(a,b){for(var c in a)e.hasOwnProperty(c)&&c!=b._getIdentifierAttribute()&&b.setValue(e,c,a[c]);b.save()};l={url:g,content:l,handleAs:"json",load:function(a){if(a.success){0<e.id?k(a.data,h):(h.deleteItem(e),h.save(),dojo.forEach(a.items,
function(a){h.newItem(a)}),h.save());var g=f.getCellByField(c);window.setTimeout(function(){f.focus.setFocusIndex(b,g.index)},10)}else buildspace.dialog.alert(d.cannotBeEdited,a.errorMsg,80,300,function(){k(a.data,h)});m.hide()},error:function(a){m.hide()}};m.show();dojo.xhrPost(l)}f.inherited(arguments)},canEdit:function(a,b){return!0},reload:function(){this.store.close();this._refresh()}});return k("buildspace.apps.CostData.NominatedSubContractorColumnsContainer",dijit.layout.BorderContainer,{region:"center",
style:"padding:0px;border:none;width:100%;height:100%;",gutters:!1,costData:null,grid:null,editable:!1,postCreate:function(){this.inherited(arguments);this.gridFormatter=new q;this.addChild(this.createToolbar());var a=this.createBreakdownGrid();a=new dijit.layout.ContentPane({style:"padding:0px;border:none;width:100%;height:100%;",region:"center",content:a,grid:a});this.addChild(a)},createToolbar:function(){var a=this,b=new dijit.Toolbar({region:"top",style:"outline:none!important;border:none;padding:2px;width:100%;"});
b.addChild(new dijit.form.Button({id:this.costData.id+"-prime-cost-sum-column-delete-button",label:d.delete,iconClass:"icon-16-container icon-16-delete",disabled:!0,style:"outline:none!important;",onClick:function(){if(-1<a.grid.selection.selectedIndex){var b=a.grid.getItem(a.grid.selection.selectedIndex);0<b.id[0]&&a.deleteRow(b)}}}));return b},createBreakdownGrid:function(){return this.grid=r({costData:this.costData,editable:this.editable,structure:[{name:"No.",field:"count",width:"30px",styles:"text-align:center;",
formatter:this.gridFormatter.rowCountCellFormatter},{name:d.columnName,field:"column_name",width:"auto",cellType:"buildspace.widget.grid.cells.Textarea",editable:this.editable}],store:new dojo.data.ItemFileWriteStore({clearOnClose:!0,url:"primeCostSum/getColumnsList/costData/"+this.costData.id})})},deleteRow:function(a){var b=this,c=buildspace.dialog.indeterminateProgressBar({title:d.deleting+". "+d.pleaseWait+"..."});buildspace.dialog.confirm(d.confirmation,d.confirmationMessage+"<br/>"+d.cannotBeUndone,
80,300,function(){c.show().then(function(){dojo.xhrPost({url:"primeCostSum/deleteColumn",content:{id:a.id,_csrf_token:a._csrf_token},handleAs:"json",load:function(a){a.success?(b.grid.reload(),b.grid.selection.clear(),b.grid.enableToolbarButtons(!1)):buildspace.dialog.alert(d.cannotBeDeleted,a.errorMsg,80,300);c.hide()},error:function(a){c.hide();b.grid.selection.clear();b.grid.enableToolbarButtons(!1)}})})})}})});
