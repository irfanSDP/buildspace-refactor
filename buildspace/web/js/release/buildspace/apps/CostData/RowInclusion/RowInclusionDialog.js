define("buildspace/apps/CostData/RowInclusion/RowInclusionDialog","dojo/_base/declare dojo/aspect dojo/_base/array dojo/_base/connect dojo/dom-style dojox/grid/EnhancedGrid dojox/grid/enhanced/plugins/IndirectSelection dojo/i18n!buildspace/nls/CostData".split(" "),function(g,k,h,f,l,p,q,d){var m=g("buildspace.apps.CostData.RowInclusion.Grid",dojox.grid.EnhancedGrid,{region:"center",style:"border-top:none;",selectedItemIds:[],deselectedItemIds:[],canSort:function(a){return!1},constructor:function(a){this.plugins=
{indirectSelection:{headerSelector:!0,width:"20px",styles:"text-align:center;"}};this.inherited(arguments)},postCreate:function(){this.inherited(arguments);var a=this;k.after(this,"_onFetchComplete",function(){a.markedCheckBoxObject(a.selectedItemIds,!0)});this._connects.push(f.connect(this,"onSelected",function(b){(b=a.getItem(b))&&0<b.id[0]&&a.pushItemIdIntoGridArray(b,!0)}));this._connects.push(f.connect(this,"onDeselected",function(b){(b=a.getItem(b))&&0<b.id[0]&&a.pushItemIdIntoGridArray(b,!1)}));
this._connects.push(f.connect(this.rowSelectCell,"toggleAllSelection",function(b){a.toggleAllSelection(b)}))},markedCheckBoxObject:function(a,b){var c=this,e=this.store;h.forEach(a,function(a){e.fetchItemByIdentity({identity:a,onItem:function(a){a&&(c.pushItemIdIntoGridArray(a,b),c.rowSelectCell.toggleRow(a._0,b))}})})},pushItemIdIntoGridArray:function(a,b){var c=dojo.indexOf(this.selectedItemIds,a.id[0]),e=dojo.indexOf(this.deselectedItemIds,a.id[0]);b?(-1===c&&this.selectedItemIds.push(a.id[0]),
-1!==e&&this.deselectedItemIds.splice(e,1)):(-1!==c&&this.selectedItemIds.splice(c,1),-1===e&&this.deselectedItemIds.push(a.id[0]))},toggleAllSelection:function(a){var b=this;var c=b.selection;a?c.selectRange(0,b.rowCount-1):c.deselectAll();return b.store.fetch({onComplete:function(c){dojo.forEach(c,function(c,d){0<c.id&&b.pushItemIdIntoGridArray(c,a)})}})},refreshGrid:function(){this.selection.deselectAll();this.beginUpdate();this.store.close();this._refresh();this.endUpdate()},destroy:function(){this.inherited(arguments);
h.forEach(this._connects,f.disconnect);return delete this._connects}}),n=function(a,b){return parseInt(b)+1};return g("buildspace.apps.CostData.RowInclusion.Dialog",dijit.Dialog,{style:"padding:0px;margin:0px;",title:null,gridUrl:null,saveUrl:null,selectedItemIds:[],deselectedItemIds:[],buildRendering:function(){var a=this.createContent();a.startup();this.content=a;this.inherited(arguments)},postCreate:function(){l.set(this.containerNode,{padding:"0px",margin:"0px"});this.closeButtonNode.style.display=
"none";this.inherited(arguments)},onHide:function(){this.destroyRecursive()},createToolbar:function(){var a=this,b=new dijit.Toolbar({region:"top",style:"outline:none!important;padding:2px;width:100%;"});b.addChild(new dijit.form.Button({label:d.close,iconClass:"icon-16-container icon-16-close",onClick:function(){a.hide()}}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({label:d.save,iconClass:"icon-16-container icon-16-save",onClick:function(){a.save()}}));return b},getGridStructure:function(){return[{name:"No",
field:"id",width:"30px",styles:"text-align: center;",formatter:n},{name:d.description,field:"description",width:"auto"}]},createContent:function(){var a=new dijit.layout.BorderContainer({style:"padding:0px;width:800px;height:350px;",gutters:!1}),b=this.grid=m({selectedItemIds:this.selectedItemIds,deselectedItemIds:this.deselectedItemIds,structure:this.getGridStructure(),store:dojo.data.ItemFileWriteStore({url:this.gridUrl,clearOnClose:!0})});a.addChild(this.createToolbar());a.addChild(b);return a},
save:function(){var a=this,b=buildspace.dialog.indeterminateProgressBar({title:d.savingData+"... "+d.pleaseWait+"..."});b.show().then(function(){dojo.xhrPost({url:a.saveUrl,handleAs:"json",content:{"selectedIds[]":a.grid.selectedItemIds,"deselectedIds[]":a.grid.deselectedItemIds,_csrf_token:a._csrf_token},load:function(c){a.grid.refreshGrid();a.grid.selectedItemIds=c.ids;a.grid.deselectedItemIds=[];a.grid.markedCheckBoxObject(a.grid.selectedItemIds,!0);if(a.onSave)a.onSave();b.hide()},error:function(a){b.hide()}})})}})});
