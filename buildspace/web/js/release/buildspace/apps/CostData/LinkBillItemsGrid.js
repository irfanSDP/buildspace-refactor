define("buildspace/apps/CostData/LinkBillItemsGrid","dojo/_base/declare dojo/aspect dojo/number dojo/currency dojo/_base/array dojo/_base/connect dojox/grid/EnhancedGrid buildspace/widget/grid/cells/Formatter dojox/grid/enhanced/plugins/IndirectSelection dijit/form/TextBox dojo/i18n!buildspace/nls/CostData".split(" "),function(h,l,f,m,k,e,n,p,u,q,d){var r=h("buildspace.apps.CostData.LinkBillItemsGrid",n,{style:"border:none;",region:"center",keepSelection:!0,rowSelector:"0px",escapeHTMLInData:!1,costData:null,
item:null,selectedItemIds:[],deselectedItemIds:[],constructor:function(a){this.plugins={indirectSelection:{headerSelector:!0,width:"20px",styles:"text-align:center;"}};this.inherited(arguments)},canSort:function(){return!1},postCreate:function(){var a;a=this;this.inherited(arguments);l.after(this,"_onFetchComplete",function(){a.markedCheckBoxObject(a.selectedItemIds,!0)});this._connects.push(e.connect(this,"onSelected",function(b){(b=a.getItem(b))&&0<b.id[0]&&a.pushItemIdIntoGridArray(b,!0)}));this._connects.push(e.connect(this,
"onDeselected",function(b){(b=a.getItem(b))&&0<b.id[0]&&a.pushItemIdIntoGridArray(b,!1)}));this._connects.push(e.connect(this.rowSelectCell,"toggleAllSelection",function(b){a.toggleAllSelection(b)}))},markedCheckBoxObject:function(a,b){var c=this,d=this.store;k.forEach(a,function(a){d.fetchItemByIdentity({identity:a,onItem:function(a){a&&(c.pushItemIdIntoGridArray(a,b),c.rowSelectCell.toggleRow(a._0,b))}})})},pushItemIdIntoGridArray:function(a,b){var c=dojo.indexOf(this.selectedItemIds,a.id[0]),d=
dojo.indexOf(this.deselectedItemIds,a.id[0]);b?(-1===c&&this.selectedItemIds.push(a.id[0]),-1!==d&&this.deselectedItemIds.splice(d,1)):(-1!==c&&this.selectedItemIds.splice(c,1),-1===d&&this.deselectedItemIds.push(a.id[0]))},toggleAllSelection:function(a){var b,c;b=this;c=b.selection;a?c.selectRange(0,b.rowCount-1):c.deselectAll();return b.store.fetch({onComplete:function(c){dojo.forEach(c,function(c,d){0<c.id&&b.pushItemIdIntoGridArray(c,a)})}})},refreshGrid:function(){this.selection.deselectAll();
this.beginUpdate();this.store.close();this._refresh();this.endUpdate()},destroy:function(){this.inherited(arguments);k.forEach(this._connects,e.disconnect);return delete this._connects}}),t=function(a,b){return parseInt(b)+1},g=function(a,b,c){b=f.parse(a);c.customClasses.push("disable-cell");return a=isNaN(b)||0==b||null==b?"&nbsp;":m.format(a)};return h("buildspace.apps.CostData.LinkBillItemsContainer",dijit.layout.BorderContainer,{region:"center",title:"",style:"padding:0px;border:none;width:100%;height:100%;",
gutters:!1,costData:null,item:null,grid:null,selectedItemIds:[],conversionFactor:null,updateUrl:null,stackContainer:null,postCreate:function(){this.inherited(arguments);this.addToolbar();this.addBreakdownGrid()},getGridStructure:function(){this.gridFormatter=new p;return[{name:"No",field:"id",width:"30px",styles:"text-align: center;",formatter:t},{name:d.description,field:"description",width:"auto"},{name:d.unit,field:"uom_id",width:"70px",styles:"text-align: center;",formatter:this.gridFormatter.unitCellFormatter},
{name:d.qty,field:"grand_total_quantity",width:"120px",styles:"text-align: right;",formatter:g},{name:d.rate,field:"rate",width:"140px",styles:"text-align: right;",formatter:g},{name:d.amount,field:"amount",width:"140px",styles:"text-align: right;",formatter:g}]},addToolbar:function(){var a=this,b=new dijit.Toolbar({region:"top",style:"outline:none!important;padding:2px;width:100%;background:#f7f7f7;"});b.addChild(new dijit.form.Button({label:d.save,iconClass:"icon-16-container icon-16-save",onClick:function(){a.save()}}));
b.addChild(a.conversionFactorInput=new q({style:"width:50px;float:right;padding:3px;"}));a.conversionFactorInput.set("value",f.parse(a.conversionFactor));b.addChild(new dijit.layout.ContentPane({style:"padding-left: 10px; padding-right: 10px; padding-top: 3px; float: right;",content:d.conversionFactor}));a.addChild(b)},addBreakdownGrid:function(){var a=this.grid=r({costData:this.costData,item:this.item,structure:this.getGridStructure(),selectedItemIds:this.selectedItemIds,store:new dojo.data.ItemFileWriteStore({clearOnClose:!0,
url:"costData/getBillItemList/costData/"+this.costData.id})}),a=new dijit.layout.ContentPane({style:"padding:0px;border:none;width:100%;height:100%;",region:"center",content:a,grid:a});this.addChild(a)},save:function(){var a=this,b=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});b.show().then(function(){dojo.xhrPost({url:a.updateUrl,handleAs:"json",content:{cost_data_id:a.costData.id,conversion_factor:dojo.trim(a.conversionFactorInput.get("value")),"selectedIds[]":a.grid.selectedItemIds,
"deselectedIds[]":a.grid.deselectedItemIds,_csrf_token:a._csrf_token},load:function(c){a.conversionFactorInput.set("value",f.parse(c.conversion_factor));a.grid.refreshGrid();a.grid.selectedItemIds=c.linked_bill_item_ids;a.grid.deselectedItemIds=[];a.grid.markedCheckBoxObject(a.grid.selectedItemIds,!0);b.hide()},error:function(a){b.hide()}})})}})});
