define("buildspace/apps/ResourceLibrary/rfqRateSelectionGrid","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-attr dojo/_base/connect dojo/aspect dojox/grid/enhanced/plugins/Menu dojox/grid/enhanced/plugins/Selector dojox/grid/enhanced/plugins/Rearrange buildspace/widget/grid/plugins/FormulatedColumn dojo/_base/event dojo/keys dijit/focus dojo/_base/html dojo/request/xhr dijit/PopupMenuItem buildspace/widget/grid/cells/Textarea buildspace/widget/grid/cells/FormulaTextBox dijit/form/DropDownButton dijit/DropDownMenu dijit/MenuItem dojox/grid/enhanced/plugins/IndirectSelection dojo/i18n!buildspace/nls/ResourceLibrary dojox/grid/enhanced/plugins/Filter".split(" "),
function(g,k,u,v,f,l,w,x,m,n,y,z,A,B,C,D,E,F,p,q,r,G,e,H){var t=g("buildspace.apps.ResourceLibrary.ResourceLibraryRFQRateSelectionGrid",dojox.grid.EnhancedGrid,{type:null,libraryId:0,tradeId:0,itemId:0,rfqRateSelectionId:-1,newRfqRateSelectionId:-1,currentSelectedSortingType:1,currentSelectedSortingTypeText:null,style:"border-top:none;",selectedItem:null,borderContainerWidget:null,keepSelection:!0,rowSelector:"0px",addUrl:null,updateUrl:null,checkBeforeDeleteUrl:null,deleteUrl:null,pasteUrl:null,
indentUrl:null,outdentUrl:null,formInfo:null,previousRFQRatesId:null,constructor:function(b){this.rearranger=m(this,{});this.formulatedColumn=n(this,{});this.currentSelectedSortingType=b.formInfo.sorting_type;this.currentSelectedSortingTypeText=b.formInfo.sorting_type_text;this.itemIds=[];this.connects=[];this.plugins={indirectSelection:{headerSelector:!0,width:"20px",styles:"text-align: center;"},filter:{closeFilterbarButton:!1,ruleCount:5,itemsName:"id"}};return this.inherited(arguments)},canSort:function(b){return!1},
postCreate:function(){var b=this;b.inherited(arguments);l.after(this,"_onFetchComplete",function(){return b.markedCheckBoxObject(b.formInfo.previousRFQRatesId,!0)});this._connects.push(f.connect(this,"onCellClick",function(a){return""!==a.cell.name?!1:b.selectTree(a)}));this._connects.push(f.connect(this.rowSelectCell,"toggleAllSelection",function(a){b.toggleAllSelection(a)}))},selectTree:function(b){var a=b.rowIndex;b=this.selection.selected[a];if(a=this.getItem(a))this.pushItemIdIntoGridArray(a,
b),this.saveRateAssignment()},toggleAllSelection:function(b){var a=this,c=a.selection;b?(c.selectRange(0,a.rowCount-1),a.itemIds=[],a.store.fetch({onComplete:function(b){dojo.forEach(b,function(b,c){0<b.id&&a.itemIds.push(b.id[0])})}})):(c.deselectAll(),a.itemIds=[]);a.saveRateAssignment()},pushItemIdIntoGridArray:function(b,a){var c=dojo.indexOf(this.itemIds,b.id[0]);a?-1==c&&this.itemIds.push(b.id[0]):-1!=c&&this.itemIds.splice(c,1)},markedCheckBoxObject:function(b,a){var c,d,e,h,f;e=this;h=this.store;
c=-1;f=[];for(d in b)f.push(h.fetchItemByIdentity({identity:d,onItem:function(b){c=b._0;e.pushItemIdIntoGridArray(b,a);return e.selection.setSelected(c,a)}}));return f},sortBy:function(b){switch(b){case "rateAverage":var a=buildspace.constants.RESOURCE_RATE_SORT_AVERAGE;break;case "rateHighest":a=buildspace.constants.RESOURCE_RATE_SORT_HIGHEST;break;case "rateLowest":a=buildspace.constants.RESOURCE_RATE_SORT_LOWEST;break;case "rateMedian":a=buildspace.constants.RESOURCE_RATE_SORT_MEDIAN}this.currentSelectedSortingType=
a;this.saveRateAssignment()},saveRateAssignment:function(){var b=this,a=buildspace.dialog.indeterminateProgressBar({title:e.applying+". "+e.pleaseWait+"..."});a.show();dojo.xhrPost({url:"resourceLibrary/updateSelectedRatesFromRFQ",content:{resourceItemId:b.itemId,"resource_item_selected_rate[resource_item_id]":b.itemId,"resource_item_selected_rate[sorting_type]":b.currentSelectedSortingType,"resource_item_selected_rate[rfq_item_rates_list][]":b.itemIds,"resource_item_selected_rate[_csrf_token]":b.formInfo._csrf_token},
handleAs:"json",load:function(c){c.success&&b.updateToolbarLabelDescription(c.rateDisplayType,c.newRate);a.hide()},error:function(b){a.hide()}})},updateToolbarLabelDescription:function(b,a){var c=dijit.byId("currentRateDisplayTypeSelectionLabel-"+this.libraryId),d=dijit.byId("currentRateDisplayLabel-"+this.libraryId);c&&c.set("label",e.currentRateDisplayType+': <strong style="color: blue;">'+b+"</strong>");d&&d.set("label",e.currentRateDisplay+': <strong style="color: blue;">'+a+"</strong>")},destroy:function(){this.inherited(arguments);
dojo.forEach(this._connects,f.disconnect);delete this._connects}});return g("buildspace.apps.ResourceLibrary.grid",dijit.layout.BorderContainer,{pageId:"page-00",style:"padding:0px;border:0px;width:100%;height:100%;",gutters:!1,stackContainerTitle:null,libraryId:0,tradeId:0,gridOpts:{},type:null,postCreate:function(){this.inherited(arguments);k.mixin(this.gridOpts,{libraryId:this.libraryId,tradeId:this.tradeId,type:this.type,region:"center",borderContainerWidget:this});var b=this.grid=new t(this.gridOpts),
a=new dijit.Toolbar({region:"top",style:"padding:3px;border-bottom:none;width:100%;"}),c=new q({style:"display: none;"});dojo.forEach(["rateAverage","rateHighest","rateLowest","rateMedian"],function(a){var d=new r({label:e[a],onClick:function(){b.sortBy(a)}});c.addChild(d)});a.addChild(new p({id:"currentRateDisplayTypeSelectionLabel-"+this.libraryId,label:e.currentRateDisplayType+': <strong style="color: blue;">'+this.gridOpts.formInfo.sorting_type_text+"</strong>",name:"sortBy",dropDown:c}));a.addChild(new dijit.ToolbarSeparator);
a.addChild(new dijit.form.Button({id:"currentRateDisplayLabel-"+this.libraryId,label:e.currentRateDisplay+': <strong style="color: blue;">'+this.gridOpts.formInfo.previousRFQRate+"</strong>",showLabel:!0,style:"cursor: default;"}));this.addChild(a);this.addChild(new dijit.layout.ContentPane({style:"width:100%",content:b,region:"center"}));if(a=dijit.byId("resourceLibraryGrid"+this.libraryId+"-stackContainer")){var d=document.createElement("div"),d=new dojox.layout.ContentPane({title:buildspace.truncateString(this.stackContainerTitle,
60),id:this.pageId,executeScripts:!0},d);a.addChild(d);d.set("content",this);a.selectChild(this.pageId)}}})});
