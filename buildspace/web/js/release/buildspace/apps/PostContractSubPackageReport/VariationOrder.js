define("buildspace/apps/PostContractSubPackageReport/VariationOrder","dojo/_base/declare dojo/aspect dojo/currency dojo/number dojo/request dojo/store/Memory dijit/layout/ContentPane ./VariationOrder/VariationOrderGrid ./VariationOrder/VariationOrderItemContainer buildspace/widget/grid/cells/Formatter dojo/i18n!buildspace/nls/PostContract".split(" "),function(g,y,h,l,m,k,z,n,p,q,e){var r=[e.pending,e.approved],t=["false","true"],u=function(a,f,c){if(this.grid.getItem(f).id==buildspace.constants.GRID_LAST_ROW)return c.customClasses.push("disable-cell"),
"&nbsp;";if("true"==a)return c.customClasses.push("green-cell"),e.approved.toUpperCase();c.customClasses.push("yellow-cell");return e.pending.toUpperCase()},v=function(a,f,c){c.customClasses.push("disable-cell");a=l.parse(a);return 0>a?'<span style="color:#FF0000">'+h.format(a)+"</span>":0==a?"&nbsp;":'<span style="color:#42b449;">'+h.format(a)+"</span>"},x=g("buildspace.apps.PostContractSubPackageReport.VariationOrderContainer",dijit.layout.BorderContainer,{style:"padding:0px;border:0px;width:100%;height:100%;",
gutters:!1,subPackage:null,voSelectedStore:[],voItemSelectedStore:[],postCreate:function(){this.inherited(arguments);this.voSelectedStore=new k({idProperty:"id"});this.voItemSelectedStore=new k({idProperty:"id"});var a=this,f=new q,c=dojo.data.ItemFileWriteStore({url:"variationOrder/getSpVariationOrderList/spid/"+a.subPackage.id,clearOnClose:!0}),f=new n({id:"variation_order-"+a.subPackage.id,stackContainerTitle:e.scheduleOfRates,pageId:"variation_order-"+a.subPackage.id,subPackage:a.subPackage,type:"vo",
gridOpts:{type:"vo",gridContainer:a,store:c,structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:f.rowCountCellFormatter},{name:e.description,field:"description",width:"auto",editable:!0,cellType:"buildspace.widget.grid.cells.Textarea"},{name:e.omission,field:"omission",width:"150px",styles:"text-align:right;color:#FF0000;",formatter:f.unEditableCurrencyCellFormatter},{name:e.addition,field:"addition",width:"150px",styles:"text-align:right;",formatter:f.unEditableCurrencyCellFormatter},
{name:e.nettOmissionAddition,field:"nett_omission_addition",width:"150px",styles:"text-align:right;",formatter:v},{name:e.upToDateClaim,field:"total_claim",width:"150px",styles:"text-align:right;",formatter:f.unEditableCurrencyCellFormatter},{name:e.status,field:"is_approved",width:"80px",styles:"text-align:center;",editable:!0,type:"dojox.grid.cells.Select",options:r,values:t,formatter:u},{name:e.lastUpdated,field:"updated_at",width:"120px",styles:"text-align: center;"}],onRowDblClick:function(b){b=
this.getItem(b.rowIndex);0<b.id&&null!==b.description[0]&&0<b.description[0].length&&new p({gridContainer:a,stackContainerTitle:b.description,subPackage:a.subPackage,variationOrder:b,id:"SP_variation_order_items-"+b.id+"-"+a.subPackage.id,pageId:"SP_variation_order_items-"+b.id+"-"+a.subPackage.id+"-page"})},singleCheckBoxSelection:function(a){var d=a.rowIndex;a=this.selection.selected[d];d=this.getItem(d);this.removedIds=[];if(a)return this.gridContainer.voSelectedStore.put({id:d.id[0]}),this.getAffectedItemsByVO(d,
"add");this.gridContainer.voSelectedStore.remove(d.id[0]);this.removedIds.push(d.id[0]);return this.getAffectedItemsByVO(d,"remove")},toggleAllSelection:function(a){var d=this,b=this.selection;d.removedIds=[];if(a)return b.selectRange(0,d.rowCount-1),d.store.fetch({onComplete:function(a){dojo.forEach(a,function(a,b){0<a.id&&d.gridContainer.voSelectedStore.put({id:a.id[0]})})}}),d.getAffectedItemsByVO(null,"add");b.deselectAll();d.store.fetch({onComplete:function(a){dojo.forEach(a,function(a,b){0<
a.id&&(d.gridContainer.voSelectedStore.remove(a.id[0]),d.removedIds.push(a.id[0]))})}});return d.getAffectedItemsByVO(null,"remove")},getAffectedItemsByVO:function(a,d){var b=this,c=[],f=buildspace.dialog.indeterminateProgressBar({title:e.pleaseWait+"..."});f.show();if("add"===d)b.gridContainer.voSelectedStore.query().forEach(function(a){c.push(a.id)});else for(var w in b.removedIds)c.push(b.removedIds[w]);m.post("subPackageVariationOrderReporting/getSubPackageAffectedItems",{handleAs:"json",data:{spid:b.subPackage.id,
vo_ids:JSON.stringify(b.gridContainer.arrayUnique(c))}}).then(function(a){if("add"===d)for(var c in a)for(var e in a[c])b.gridContainer.voItemSelectedStore.put({id:a[c][e]});else for(c in a){for(e in a[c])b.gridContainer.voItemSelectedStore.remove(a[c][e]);b.store.fetchItemByIdentity({identity:c,onItem:function(a){if(a)return b.gridContainer.voSelectedStore.remove(c),b.rowSelectCell.toggleRow(a._0,!1)}})}f.hide()},function(a){f.hide();console.log(a)})}}}),f=this.makeGridContainer(f,e.variationOrders);
this.addChild(f)},makeGridContainer:function(a,f){var c=this.subPackage.id,b=dijit.byId("SP_variationOrder-"+c+"-stackContainer");b&&dijit.byId("SP_variationOrder-"+c+"-stackContainer").destroyRecursive();b=new dijit.layout.StackContainer({style:"width:100%;height:100%;border:0px;",region:"center",id:"SP_variationOrder-"+c+"-stackContainer"});b.addChild(new dijit.layout.ContentPane({title:f,content:a,grid:a.grid}));var d=new dijit.layout.StackController({region:"top",containerId:"SP_variationOrder-"+
c+"-stackContainer"}),d=new dijit.layout.ContentPane({style:"padding:0px;overflow:hidden;","class":"breadCrumbTrail",region:"top",content:d}),e=new dijit.layout.BorderContainer({style:"padding:0px;width:100%;height:100%;border:0px;",gutters:!1,region:"center"});e.addChild(b);e.addChild(d);dojo.subscribe("SP_variationOrder-"+c+"-stackContainer-selectChild","",function(a){var b=dijit.byId("SP_variationOrder-"+c+"-stackContainer");if(b){var d=b.getChildren();for(a=dojo.indexOf(d,a);d.length>a+1;)a+=
1,b.removeChild(d[a]),d[a].destroyRecursive()}});return e},markedCheckBoxObject:function(a,e){var c=a.store;e.query().forEach(function(b){b.id!=buildspace.constants.GRID_LAST_ROW&&c.fetchItemByIdentity({identity:b.id,onItem:function(b){if(b)return a.rowSelectCell.toggleRow(b._0,!0)}})})},arrayUnique:function(a){return a.reverse().filter(function(a,c,b){return-1===b.indexOf(a,c+1)}).reverse()}});return g("buildspace.apps.PostContractSubPackageReport.VariationOrder",dijit.layout.BorderContainer,{region:"center",
subPackage:null,style:"padding:0px;border:0px;margin:0px;width:100%;height:100%;",postCreate:function(){this.inherited(arguments);this.addChild(x({subPackage:this.subPackage,region:"center"}))}})});
