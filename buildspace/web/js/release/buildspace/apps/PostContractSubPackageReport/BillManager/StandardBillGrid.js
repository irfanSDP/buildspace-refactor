define("buildspace/apps/PostContractSubPackageReport/BillManager/StandardBillGrid","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/dom-attr dojo/json dojo/request dojo/aspect dojo/store/Memory dijit/Menu dojo/number dijit/CheckedMenuItem dojox/grid/enhanced/plugins/Menu dojox/grid/enhanced/plugins/Selector dojox/grid/enhanced/plugins/Rearrange dojox/grid/enhanced/plugins/IndirectSelection buildspace/widget/grid/plugins/FormulatedColumn dijit/DropDownMenu dijit/form/DropDownButton dijit/MenuItem dojo/_base/event dojo/keys dijit/focus dojo/_base/html dojo/request/xhr dijit/PopupMenuItem dijit/MenuSeparator buildspace/widget/grid/cells/Formatter ./PrintPreviewElementDialog ./PrintPreviewElementWithWorkDoneOnlyDialog ./PrintPreviewItemDialog ./PrintPreviewItemWorkDoneOnlyWithQtyDialog ./PrintPreviewItemWorkDoneOnlyWithPercentageDialog dojo/i18n!buildspace/nls/PostContract buildspace/widget/grid/cells/TextBox".split(" "),
function(p,u,q,C,D,l,k,v,E,F,G,H,I,J,K,L,M,r,t,g,N,O,P,Q,R,S,T,w,x,y,m,z,A,d){var B=p("buildspace.apps.PostContractSubPackageReport.BillManager.StandardBillGrid",dojox.grid.EnhancedGrid,{typeItemId:-1,type:null,billId:-1,elementId:0,itemId:-1,disableEditing:!1,style:"border-top:none;",selectedItem:null,borderContainerWidget:null,keepSelection:!0,rowSelector:"0px",markupSettings:null,parentGrid:null,elementGridStore:null,selectedClaimRevision:null,claimRevision:null,updateUrl:null,typeItem:null,project:null,
gridContainer:null,constructor:function(a){this.type=a.type;this.currencySetting=buildspace.billCurrencyAbbreviation?buildspace.billCurrencyAbbreviation:buildspace.currencyAbbreviation;this.formatter=new w;this.setColumnStructure();this.createHeaderCtxMenu();this.plugins={indirectSelection:{headerSelector:!0,width:"40px",styles:"text-align: center;"}};this.inherited(arguments)},postCreate:function(){var a=this;a.inherited(arguments);var c="tree"===a.type?"itemPreviewStore":"elementPreviewStore";v.after(a,
"_onFetchComplete",function(){a.gridContainer.markedCheckBoxObject(a,a.gridContainer[c][a.typeItemId])})},startup:function(){var a=this;a.inherited(arguments);this._connects.push(q.connect(this,"onCellClick",function(c){""===c.cell.name&&a.singleCheckBoxSelection(c)}));this._connects.push(q.connect(this.rowSelectCell,"toggleAllSelection",function(c){a.toggleAllSelection(c)}))},singleCheckBoxSelection:function(a){var c=a.rowIndex;a=this.selection.selected[c];c=this.getItem(c);this.removedIds=[];if(a){if("tree"===
this.type)return this.gridContainer.itemPreviewStore[this.typeItemId].put({id:c.id[0]}),this.getAffectedElementsAndTypesByItems(c,"add");this.gridContainer.elementPreviewStore[this.typeItemId].put({id:c.id[0]});return this.getAffectedItemsAndTypesByElement(c,"add")}if("tree"===this.type)return this.gridContainer.itemPreviewStore[this.typeItemId].remove(c.id[0]),this.removedIds.push(c.id[0]),this.getAffectedElementsAndTypesByItems(c,"remove");this.gridContainer.elementPreviewStore[this.typeItemId].remove(c.id[0]);
this.removedIds.push(c.id[0]);return this.getAffectedItemsAndTypesByElement(c,"remove")},toggleAllSelection:function(a){var c=this,b=this.selection;c.removedIds=[];var d="tree"===c.type?"itemPreviewStore":"elementPreviewStore";if(a)return b.selectRange(0,c.rowCount-1),c.store.fetch({onComplete:function(a){dojo.forEach(a,function(a,b){0<a.id&&c.gridContainer[d][c.typeItemId].put({id:a.id[0]})})}}),"tree"===c.type?c.getAffectedElementsAndTypesByItems(null,"add"):c.getAffectedItemsAndTypesByElement(null,
"add");b.deselectAll();c.store.fetch({onComplete:function(a){dojo.forEach(a,function(a,b){0<a.id&&(c.gridContainer[d][c.typeItemId].remove(a.id[0]),c.removedIds.push(a.id[0]))})}});return"tree"===c.type?c.getAffectedElementsAndTypesByItems(null,"remove"):c.getAffectedItemsAndTypesByElement(null,"remove")},getAffectedItemsAndTypesByElement:function(a,c){var b=this;a=b.gridContainer.elementPreviewStore[b.typeItemId];var e=[],f=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});f.show();
if("add"===c)a.query().forEach(function(a){e.push(a.id)});else for(var g in b.removedIds)e.push(b.removedIds[g]);k.post("postContractStandardBillClaimReporting/getAffectedTypesAndItems",{handleAs:"json",data:{subPackageId:b.subPackage.id,typeId:b.typeItemId,bill_id:b.billId,element_ids:l.stringify(b.borderContainerWidget.arrayUnique(e))}}).then(function(a){var d=dijit.byId("postContractReport-type-page-container-"+b.billId);if("add"===c)for(var e in a){d.store.fetchItemByIdentity({identity:e,onItem:function(a){if(a)return b.gridContainer.typesPreviewStore.put({id:e}),
d.rowSelectCell.toggleRow(a._0,!0)}});for(var h in a[e])for(var n in a[e][h])b.gridContainer.itemPreviewStore[b.typeItemId].put({id:a[e][h][n]})}else for(e in a){for(h in a[e])for(n in b.gridContainer.elementPreviewStore[b.typeItemId].remove(h),a[e][h])b.gridContainer.itemPreviewStore[b.typeItemId].remove(a[e][h][n]);d.store.fetchItemByIdentity({identity:e,onItem:function(a){if(a&&0===b.gridContainer.elementPreviewStore[b.typeItemId].data.length)return b.gridContainer.typesPreviewStore.remove(e),
d.rowSelectCell.toggleRow(a._0,!1)}})}f.hide()},function(a){f.hide();console.log(a)})},getAffectedElementsAndTypesByItems:function(a,c){var b=this,e=[],f=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});f.show();if("add"===c)b.gridContainer.itemPreviewStore[b.typeItemId].query().forEach(function(a){e.push(a.id)});else for(var g in b.removedIds)e.push(b.removedIds[g]);k.post("postContractStandardBillClaimReporting/getAffectedTypesAndElements",{handleAs:"json",data:{subPackageId:b.subPackage.id,
typeId:b.typeItemId,bill_id:b.billId,itemIds:l.stringify(b.borderContainerWidget.arrayUnique(e))}}).then(function(a){var d=dijit.byId("postContractReport-type-page-container-"+b.billId),e=dijit.byId("postContractReport-element-page-container-"+b.billId);if("add"===c)for(var h in a){d.store.fetchItemByIdentity({identity:h,onItem:function(a){if(a)return b.gridContainer.typesPreviewStore.put({id:h}),d.rowSelectCell.toggleRow(a._0,!0)}});for(var g in a[h])e.grid.store.fetchItemByIdentity({identity:g,
onItem:function(a){if(a)return b.gridContainer.elementPreviewStore[b.typeItemId].put({id:g}),e.grid.rowSelectCell.toggleRow(a._0,!0)}})}else for(h in a){for(g in a[h]){for(var k in a[h][g])b.gridContainer.itemPreviewStore[b.typeItemId].remove(a[h][g][k]);e.grid.store.fetchItemByIdentity({identity:g,onItem:function(a){if(a&&0===b.gridContainer.itemPreviewStore[b.typeItemId].data.length)return b.gridContainer.elementPreviewStore[b.typeItemId].remove(g),e.grid.rowSelectCell.toggleRow(a._0,!1)}})}d.store.fetchItemByIdentity({identity:h,
onItem:function(a){if(a&&0===b.gridContainer.elementPreviewStore[b.typeItemId].data.length)return b.gridContainer.typesPreviewStore.remove(h),d.rowSelectCell.toggleRow(a._0,!1)}})}f.hide()},function(a){f.hide();console.log(a)})},dodblclick:function(a){if(a.cellNode)if(a.cell.editable)this.editableCellDblClick(a);else this.onCellDblClick(a);else this.onRowDblClick(a)},editableCellDblClick:function(a){},setColumnStructure:function(){var a=this.formatter;this.structure="tree"==this.type?{noscroll:!1,
cells:[[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:a.rowCountCellFormatter,rowSpan:2},{name:d.billReference,field:"bill_ref",styles:"text-align:center; color: red;",width:"80px",noresize:!0,showInCtxMenu:!0,formatter:a.billRefCellFormatter,rowSpan:2,hidden:!0},{name:d.description,field:"description",width:"500px",formatter:a.claimTreeCellFormatter,showInCtxMenu:!0,rowSpan:2},{name:d.type,field:"type",width:"70px",rowSpan:2,type:"dojox.grid.cells.Select",formatter:a.typeCellFormatter,
styles:"text-align:center;",showInCtxMenu:!0,hidden:!0},{name:d.qty,field:"qty_per_unit",width:"90px",styles:"text-align: right;",formatter:a.claimQtyPerUnitCellFormatter,showInCtxMenu:!0,noresize:!0,rowSpan:2},{name:d.unit,field:"uom_symbol",width:"70px",styles:"text-align: center;",formatter:a.unitIdCellFormatter,showInCtxMenu:!0,rowSpan:2},{name:d.rate,field:"rate",width:"70px",styles:"text-align: right;",formatter:a.claimRateLSCellFormatter,showInCtxMenu:!0,rowSpan:2},{name:d.total,field:"total_per_unit",
width:"90px",styles:"text-align: right;color:blue;",formatter:a.unEditableCurrencyCellFormatter,showInCtxMenu:!0,rowSpan:2},{name:d.percent,field:"prev_percentage",width:"70px",headerClasses:"typeHeader1",formatter:a.unEditablePercentageCellFormatter,styles:"text-align: right;"},{name:d.amount,field:"prev_amount",width:"110px",headerClasses:"typeHeader1",formatter:a.unEditableCurrencyCellFormatter,styles:"text-align: right;"},{name:d.percent,field:"current_percentage",width:"70px",headerClasses:"typeHeader2",
styles:"text-align: right;",formatter:a.editableClaimPercentageCellFormatter},{name:d.amount,field:"current_amount",width:"110px",headerClasses:"typeHeader2",styles:"text-align: right;",formatter:a.claimAmountCellFormatter},{name:d.percent,field:"up_to_date_percentage",width:"70px",headerClasses:"typeHeader1",styles:"text-align: right;",formatter:a.editableClaimPercentageCellFormatter},{name:d.qty,field:"up_to_date_qty",width:"90px",headerClasses:"typeHeader1",styles:"text-align: right;",formatter:a.claimAmountCellFormatter},
{name:d.amount,field:"up_to_date_amount",width:"110px",headerClasses:"typeHeader1",styles:"text-align: right;",formatter:a.claimAmountCellFormatter}],[{name:d.previousClaim,styles:"text-align:center;",headerClasses:"staticHeader typeHeader1",colSpan:2},{name:d.currentClaim,styles:"text-align:center;",headerClasses:"staticHeader typeHeader2",colSpan:2},{name:d.upToDateClaim,styles:"text-align:center;",headerClasses:"staticHeader typeHeader1",colSpan:3}]]}:{noscroll:!1,cells:[[{name:"No.",field:"id",
width:"30px",styles:"text-align:center;",formatter:a.rowCountCellFormatter,noresize:!0,rowSpan:2},{name:d.description,field:"description",width:"auto",noresize:!0,formatter:a.claimTreeCellFormatter,rowSpan:2},{name:d.total,field:"total_per_unit",width:"90px",styles:"text-align: right;color:blue;",formatter:a.unEditableCurrencyCellFormatter,noresize:!0,rowSpan:2},{name:d.percent,field:"prev_percentage",width:"70px",headerClasses:"typeHeader1",formatter:a.unEditablePercentageCellFormatter,styles:"text-align: right;",
noresize:!0},{name:d.amount,field:"prev_amount",width:"110px",headerClasses:"typeHeader1",formatter:a.unEditableCurrencyCellFormatter,styles:"text-align: right;",noresize:!0},{name:d.percent,field:"current_percentage",width:"70px",headerClasses:"typeHeader2",styles:"text-align: right;",formatter:a.unEditablePercentageCellFormatter,noresize:!0,cellType:"buildspace.widget.grid.cells.TextBox"},{name:d.amount,field:"current_amount",width:"110px",headerClasses:"typeHeader2",styles:"text-align: right;",
formatter:a.unEditableCurrencyCellFormatter,noresize:!0,cellType:"buildspace.widget.grid.cells.TextBox"},{name:d.percent,field:"up_to_date_percentage",width:"70px",headerClasses:"typeHeader1",styles:"text-align: right;",formatter:a.elementClaimEditablePercentageCellFormatter},{name:d.amount,field:"up_to_date_amount",width:"110px",headerClasses:"typeHeader1",styles:"text-align: right;",formatter:a.elementClaimAmountCellFormatter}],[{name:d.previousClaim,styles:"text-align:center;",headerClasses:"staticHeader typeHeader1",
colSpan:2,noresize:!0},{name:d.currentClaim,styles:"text-align:center;",headerClasses:"staticHeader typeHeader2",colSpan:2,noresize:!0},{name:d.upToDateClaim,styles:"text-align:center;",headerClasses:"staticHeader typeHeader1",colSpan:2}]]}},canSort:function(a){return!1},onStyleRow:function(a){this.inherited(arguments);if(a.node.children[0]&&2<=a.node.children[0].children[0].rows.length){var c=a.node.children[0].children[0].rows[1],b=a.node.children[0].children[0].rows[0].children;c.parentNode.removeChild(c);
dojo.forEach(b,function(a,b){b=dojo.attr(a,"rowSpan");(!b||2>b)&&dojo.attr(a,"rowSpan",2)})}},createHeaderCtxMenu:function(){if("undefined"!==typeof this.structure){var a=this.structure.cells[0],c=this,b={headerMenu:new dijit.Menu};dojo.forEach(a,function(a,d){a.showInCtxMenu&&b.headerMenu.addChild(new dijit.CheckedMenuItem({label:a.name,checked:"undefined"===typeof a.hidden||!1===a.hidden?!0:!1,onChange:function(a){var b=!1;a&&(b=!0);c.showHideColumn(b,d)}}))});this.plugins={menus:b}}},showHideColumn:function(a,
c){this.beginUpdate();this.layout.setColumnVisibility(c,a);this.endUpdate()}});return p("buildspace.apps.PostContractSubPackageReport.BillManager.StandardBillGridBuilder",dijit.layout.BorderContainer,{pageId:"page-00",style:"padding:0px;width:100%;height:100%;",gutters:!1,stackContainerTitle:"",rootProject:null,subPackage:null,billId:-1,elementId:0,disableEditing:!1,itemId:-1,rowSelector:null,typeItem:null,gridOpts:{},type:null,postCreate:function(){var a=this;a.inherited(arguments);u.mixin(a.gridOpts,
{subPackage:a.subPackage,billId:a.billId,typeItem:a.typeItem,project:a.rootProject,elementId:a.elementId,type:a.type,region:"center",disableEditing:a.disableEditing,borderContainerWidget:a});var c=new dijit.Toolbar({region:"top",style:"outline:none!important; border-bottom:none; padding:2px; width:100%;"}),b=this.grid=new B(a.gridOpts);if("element"===this.type){var e=new r({style:"display: none;"}),f=new g({label:d.elementDetail,onClick:function(){a.openSelectedElementDetailPrintPreview()}});e.addChild(f);
f=new g({label:d.elementWorkDoneOnly,onClick:function(){a.openElementWorkDoneOnlyDetailPrintPreview()}});e.addChild(f);c.addChild(new t({label:d.elements,iconClass:"icon-16-container icon-16-print",dropDown:e}));c.addChild(new dijit.ToolbarSeparator)}e=new r({style:"display: none;"});f=new g({label:d.allItems,onClick:function(){a.openSelectedItemPrintPreviewDialog()}});e.addChild(f);f=new g({label:d.itemsWithCurrentClaimMoreThanZero,onClick:function(){a.openItemsWithCurrentClaimPrintPreviewDialog()}});
e.addChild(f);f=new g({label:d.itemsWithClaim,onClick:function(){a.openItemsWithClaimPrintPreviewDialog()}});e.addChild(f);f=new g({label:d.workDoneOnlyWithQty,onClick:function(){a.openItemsWorkDoneQtyPrintPreviewDialog()}});e.addChild(f);f=new g({label:d.workDoneOnlyWithPercent,onClick:function(){a.openItemsWorkDonePercentagePrintPreviewDialog()}});e.addChild(f);c.addChild(new t({label:d.items,iconClass:"icon-16-container icon-16-print",dropDown:e}));a.addChild(c);a.addChild(new dijit.layout.ContentPane({style:"width:100%",
content:b,region:"center"}));if(c=dijit.byId("subPackagePostContractReportStandardBill"+this.billId+"-stackContainer"))b=document.createElement("div"),b=new dojox.layout.ContentPane({title:buildspace.truncateString(a.stackContainerTitle,60),id:a.pageId},b),c.addChild(b),b.set("content",a),b.set("grid",a.grid),c.selectChild(a.pageId)},openSelectedElementDetailPrintPreview:function(){var a=this,c=[];a.gridOpts.gridContainer.elementPreviewStore[a.gridOpts.typeItemId].query().forEach(function(a){c.push(a.id)});
var b=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});b.show();k.post("postContractSubPackageStandardBill/getPrintingSelectedElementClaims",{handleAs:"json",data:{subPackageId:a.subPackage.id,bill_id:a.billId,type_ref_id:a.typeItem.id,itemIds:l.stringify(a.arrayUnique(c))}}).then(function(e){(new x({project:a.rootProject,type_ref_id:a.typeItem.id,subPackageId:a.subPackage.id,billId:a.billId,title:d.elementDetail,data:e,selectedItems:c})).show();b.hide()},function(a){console.log(a);
b.hide()})},openElementWorkDoneOnlyDetailPrintPreview:function(){var a=this,c=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});c.show();k.post("postContractSubPackageStandardBill/getPrintingElementWorkDoneOnlyClaims",{handleAs:"json",data:{subPackageId:a.subPackage.id,bill_id:a.billId,type_ref_id:a.typeItem.id}}).then(function(b){(new y({project:a.rootProject,type_ref_id:a.typeItem.id,subPackageId:a.subPackage.id,billId:a.billId,title:d.elementWorkDoneOnly,data:b})).show();c.hide()},
function(a){console.log(a);c.hide()})},openSelectedItemPrintPreviewDialog:function(){var a=this,c=[];a.gridOpts.gridContainer.itemPreviewStore[a.gridOpts.typeItemId].query().forEach(function(a){c.push(a.id)});var b=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});b.show();k.post("postContractSubPackageStandardBill/getPrintingSelectedItemClaims",{handleAs:"json",data:{subPackageId:a.subPackage.id,bill_id:a.billId,type_ref_id:a.typeItem.id,itemIds:l.stringify(a.arrayUnique(c))}}).then(function(e){(new m({project:a.rootProject,
type_ref_id:a.typeItem.id,subPackageId:a.subPackage.id,billId:a.billId,title:d.allItems,printURL:"postContractSubPackageStandardBill/printStandardBillSelectedItems",exportURL:"postContractSubPackageStandardBillExportExcelReporting/exportExcelStandardBillSelectedItems",data:e,selectedItems:c})).show();b.hide()},function(a){console.log(a);b.hide()})},openItemsWithCurrentClaimPrintPreviewDialog:function(){var a=this,c=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});c.show();k.post("postContractSubPackageStandardBill/getPrintingPreviewItemsWithCurrentClaim",
{handleAs:"json",data:{subPackageId:a.subPackage.id,bill_id:a.billId,type_ref_id:a.typeItem.id}}).then(function(b){(new m({project:a.rootProject,type_ref_id:a.typeItem.id,subPackageId:a.subPackage.id,billId:a.billId,title:d.itemsWithCurrentClaimMoreThanZero,printURL:"postContractSubPackageStandardBill/printStandardBillItemWithCurrentClaim",exportURL:"postContractSubPackageStandardBillExportExcelReporting/exportExcelStandardBillItemWithCurrentClaim",data:b})).show();c.hide()},function(a){console.log(a);
c.hide()})},openItemsWithClaimPrintPreviewDialog:function(){var a=this,c=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});c.show();k.post("postContractSubPackageStandardBill/getPrintingPreviewItemsWithClaim",{handleAs:"json",data:{subPackageId:a.subPackage.id,bill_id:a.billId,type_ref_id:a.typeItem.id}}).then(function(b){(new m({project:a.rootProject,type_ref_id:a.typeItem.id,subPackageId:a.subPackage.id,billId:a.billId,title:d.itemsWithClaim,printURL:"postContractSubPackageStandardBill/printStandardBillItemWithClaim",
exportURL:"postContractSubPackageStandardBillExportExcelReporting/exportExcelStandardBillItemWithClaim",data:b})).show();c.hide()},function(a){console.log(a);c.hide()})},openItemsWorkDoneQtyPrintPreviewDialog:function(){var a=this,c=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});c.show();k.post("postContractSubPackageStandardBill/getPrintingPreviewItemsWorkDoneWithQty",{handleAs:"json",data:{subPackageId:a.subPackage.id,bill_id:a.billId,type_ref_id:a.typeItem.id}}).then(function(b){(new z({project:a.rootProject,
type_ref_id:a.typeItem.id,subPackageId:a.subPackage.id,billId:a.billId,title:d.workDoneOnlyWithQty,data:b})).show();c.hide()},function(a){console.log(a);c.hide()})},openItemsWorkDonePercentagePrintPreviewDialog:function(){var a=this,c=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});c.show();k.post("postContractSubPackageStandardBill/getPrintingPreviewItemsWorkDoneWithPercentage",{handleAs:"json",data:{subPackageId:a.subPackage.id,bill_id:a.billId,type_ref_id:a.typeItem.id}}).then(function(b){(new A({project:a.rootProject,
type_ref_id:a.typeItem.id,subPackageId:a.subPackage.id,billId:a.billId,title:d.workDoneOnlyWithPercent,data:b})).show();c.hide()},function(a){console.log(a);c.hide()})},arrayUnique:function(a){return a.reverse().filter(function(a,b,d){return-1===d.indexOf(a,b+1)}).reverse()}})});
