define("buildspace/apps/PostContractSubPackageReport/VariationOrder/VariationOrderItemContainer","dojo/_base/declare dojo/_base/lang dojo/currency dojo/number dojo/when dojo/aspect dojo/request dijit/layout/TabContainer dijit/layout/ContentPane ./VariationOrderGrid ./buildUpQuantityGrid ./buildUpQuantitySummary ./VariationOrderClaim buildspace/apps/ProjectBuilder/BillManager/ScheduleOfQuantityGrid buildspace/widget/grid/cells/Formatter dojo/i18n!buildspace/nls/PostContract".split(" "),function(p,
q,k,e,r,M,x,y,z,A,B,C,D,E,u,c){var F=function(b,a,c){a=this.grid.getItem(a);a.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER||a.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_N||a.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_NOID||a.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_RATE_ONLY?(c.customClasses.push("disable-cell"),b="&nbsp;"):(0<a.bill_item_id[0]||!a.can_be_edited[0])&&c.customClasses.push("disable-cell");return b},G=function(b,a,c){var d=
e.parse(b);a=this.grid.getItem(a);isNaN(d)||0==d||null==d?b="&nbsp;":(b=k.format(d),b=0<=d?b:'<span style="color:#FF0000">'+b+"</span>");a.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER||a.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_N||a.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_NOID||a.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_RATE_ONLY?c.customClasses.push("disable-cell"):0<a.bill_item_id[0]&&c.customClasses.push("disable-cell");return b},
H=function(b,a,c){a=this.grid.getItem(a);b=e.parse(b);var d="&nbsp;";a.can_be_edited[0]||c.customClasses.push("disable-cell");isNaN(b)||0==b||null==b||(d=e.format(b,{places:2}));a.type!=buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER&&a.type!=buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_N&&a.type!=buildspace.widget.grid.constants.HIERARCHY_TYPE_NOID&&a.type!=buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_RATE_ONLY||c.customClasses.push("disable-cell");return void 0!=a.has_addition_build_up_quantity&&
a.has_addition_build_up_quantity[0]?'<span style="color:#0000FF;"><b>'+d+"</b></span>":0<=b?d:'<span style="color:#FF0000">'+d+"</span>"},I=function(b,a,c){a=this.grid.getItem(a);var d=e.parse(b);b="&nbsp;";a=0<a.id?d*e.parse(a["rate-value"][0])*e.parse(a.total_unit[0]):0;isNaN(a)||0==a||(b=k.format(a));c.customClasses.push("disable-cell");return 0<=a?b:'<span style="color:#FF0000">'+b+"</span>"},J=function(b,a,c){a=this.grid.getItem(a);b=e.parse(b);var d="&nbsp;";c.customClasses.push("disable-cell");
isNaN(b)||0==b||null==b||(d=e.format(b,{places:2}));return void 0!=a.has_omission_build_up_quantity&&a.has_omission_build_up_quantity[0]?'<span style="color:#0000FF;"><b>'+d+"</b></span>":0<=b?d:'<span style="color:#FF0000">'+d+"</span>"},K=function(b,a,c){a=this.grid.getItem(a);var d=e.parse(b);b="&nbsp;";a=0<a.id?d*e.parse(a["rate-value"][0])*e.parse(a.total_unit[0]):0;isNaN(a)||0==a||(b=k.format(a));c.customClasses.push("disable-cell");return'<span style="color:#FF0000">'+b+"</span>"},L=function(b,
a,c){a=this.grid.getItem(a);b=0<a.id?e.parse(a["omission_quantity-value"][0])*e.parse(a["rate-value"][0])*e.parse(a.total_unit[0]):0;a=0<a.id?e.parse(a["addition_quantity-value"][0])*e.parse(a["rate-value"][0])*e.parse(a.total_unit[0]):0;c.customClasses.push("disable-cell");c=a-b;return 0>c?'<span style="color:#FF0000">'+k.format(c)+"</span>":0==c?"&nbsp;":'<span style="color:#42b449;">'+k.format(c)+"</span>"};return p("buildspace.apps.PostContractSubPackageReport.VariationOrder.VariationOrderItemContainer",
y,{pageId:"page-00",style:"margin:0px;padding:0px;border:0px;width:100%;height:100%;",gutters:!1,stackContainerTitle:null,gridOpts:{},subPackage:null,nested:!0,variationOrder:null,type:null,gridContainer:null,postCreate:function(){var b=this;b.inherited(arguments);q.mixin(b.gridOpts,{variationOrder:b.variationOrder,subPackage:b.subPackage,type:b.type,region:"center",tabContainerWidget:b});var a=dojo.xhrGet({url:"variationOrder/getUnits",handleAs:"json"}),l=buildspace.dialog.indeterminateProgressBar({title:c.pleaseWait+
"..."}),d=dojo.xhrGet({url:"variationOrder/getSpClaimStatus",content:{id:this.variationOrder.id},handleAs:"json"});l.show();r(a,function(a){d.then(function(c){l.hide();b.createVariationOrderItemGrid(a,c,!0);b.createVariationOrderClaimGrid(c)})});if(a=dijit.byId("SP_variationOrder-"+b.subPackage.id+"-stackContainer")){var g=document.createElement("div"),g=new dojox.layout.ContentPane({title:buildspace.truncateString(b.stackContainerTitle,60),id:b.pageId,executeScripts:!0},g);a.addChild(g);g.set("content",
b);a.selectChild(b.pageId)}},createVariationOrderItemGrid:function(b,a,l){(b=dijit.byId("SP_variationOrderItems_tab-"+this.subPackage.id+"_"+this.variationOrder.id+"-StackPane"))||(b=new dijit.layout.StackContainer({id:"SP_variationOrderItems_tab-"+this.subPackage.id+"_"+this.variationOrder.id+"-StackPane",style:"margin:0px;padding:0px;border:0px;width:100%;height:100%;",title:c.variationOrderItems}));var d=dijit.byId("SP_variationOrderItems-"+this.subPackage.id+"_"+this.variationOrder.id+"-borderContainer");
d&&(b.removeChild(d),d.destroyRecursive());var g=this,d=new u,e=dojo.data.ItemFileWriteStore({url:"variationOrder/getSpVariationOrderItemList/id/"+g.variationOrder.id,clearOnClose:!0});a=new A({subPackage:g.subPackage,variationOrder:g.variationOrder,type:0<a.count?"vo-claims":"vo-items",locked:"true"==g.variationOrder.is_approved[0]?!0:!1,gridOpts:{variationOrder:g.variationOrder,gridContainer:g.gridContainer,store:e,escapeHTMLInData:!1,structure:{cells:[[{name:"No",field:"id",styles:"text-align:center;",
width:"30px",formatter:d.rowCountCellFormatter,noresize:!0,rowSpan:2},{name:c.billReference,field:"bill_ref",styles:"text-align:center; color:red;",width:"80px",formatter:d.unEditableCellFormatter,noresize:!0,rowSpan:2},{name:c.totalUnit,field:"total_unit",styles:"text-align:center;",width:"70px",formatter:F,noresize:!0,rowSpan:2},{name:c.description,field:"description",width:"500px",formatter:d.treeCellFormatter,noresize:!0,rowSpan:2},{name:c.type,field:"type",width:"70px",styles:"text-align:center;",
formatter:d.typeCellFormatter,noresize:!0,rowSpan:2},{name:c.unit,field:"uom_id",width:"70px",styles:"text-align:center;",formatter:d.unitIdCellFormatter,noresize:!0,rowSpan:2},{name:c.rate,field:"rate-value",styles:"text-align:right;",width:"120px",formatter:"true"==g.variationOrder.is_approved[0]?d.unEditableCurrencyCellFormatter:G,noresize:!0,rowSpan:2},{name:c.qty,field:"omission_quantity-value",styles:"text-align:right;",width:"90px",formatter:J,noresize:!0},{name:c.total,field:"omission_quantity-value",
styles:"text-align:right;",width:"120px",formatter:K,noresize:!0},{name:c.qty,field:"addition_quantity-value",styles:"text-align:right;",width:"90px",formatter:H,noresize:!0},{name:c.total,field:"addition_quantity-value",styles:"text-align:right;",width:"120px",formatter:I,noresize:!0},{name:c.nettOmissionAddition,field:"id",styles:"text-align:right;",width:"120px",noresize:!0,formatter:L,rowSpan:2},{name:"%",field:"previous_percentage-value",styles:"text-align:right;",width:"60px",formatter:d.unEditablePercentageCellFormatter,
noresize:!0},{name:c.amount,field:"previous_amount-value",styles:"text-align:right;",width:"120px",formatter:d.unEditableCurrencyCellFormatter,noresize:!0},{name:"%",field:"current_percentage-value",styles:"text-align:right;",width:"60px",formatter:0<a.count&&a.can_edit_claim_amount?d.editablePercentageCellFormatter:d.unEditablePercentageCellFormatter,noresize:!0},{name:c.amount,field:"current_amount-value",styles:"text-align:right;",width:"120px",formatter:0<a.count&&a.can_edit_claim_amount?d.currencyCellFormatter:
d.unEditableCurrencyCellFormatter,noresize:!0},{name:"%",field:"up_to_date_percentage-value",styles:"text-align:right;",width:"60px",formatter:0<a.count&&a.can_edit_claim_amount?d.editablePercentageCellFormatter:d.unEditablePercentageCellFormatter,noresize:!0},{name:c.amount,field:"up_to_date_amount-value",styles:"text-align:right;",width:"120px",formatter:0<a.count&&a.can_edit_claim_amount?d.currencyCellFormatter:d.unEditableCurrencyCellFormatter,noresize:!0}],[{name:c.omission,field:"id",styles:"text-align:center;",
headerClasses:"staticHeader",noresize:!0,colSpan:2},{name:c.addition,field:"id",styles:"text-align:center;",headerClasses:"staticHeader",noresize:!0,colSpan:2},{name:c.previousClaim,field:"id",styles:"text-align:center;",headerClasses:"staticHeader",noresize:!0,colSpan:2},{name:c.currentClaim,field:"id",styles:"text-align:center;",headerClasses:"staticHeader",noresize:!0,colSpan:2},{name:c.upToDateClaim,field:"id",styles:"text-align:center;",headerClasses:"staticHeader",noresize:!0,colSpan:2}]]},
onRowDblClick:function(a){var b=a.cell.field,f=this.getItem(a.rowIndex);if((this.locked||"omission_quantity-value"==b&&f.has_omission_build_up_quantity[0])&&("addition_quantity-value"==b&&f.has_addition_build_up_quantity[0]||"omission_quantity-value"==b&&f.has_omission_build_up_quantity[0])&&0<f.id&&(f.type[0]==buildspace.widget.grid.constants.HIERARCHY_TYPE_WORK_ITEM||f.type[0]==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_HTML_EDITOR||f.type[0]==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_PROVISIONAL||
f.type[0]==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_NOT_LISTED))if(0<f.uom_id[0]){var d=this;a=dojo.xhrGet({url:"billBuildUpQuantity/getDimensionColumnStructure",content:{uom_id:f.uom_id[0]},handleAs:"json"});var h=buildspace.dialog.indeterminateProgressBar({title:c.pleaseWait+"..."}),e="addition_quantity-value"==b?"addition":"omission";h.show();a.then(function(a){g.createBuildUpQuantityContainer(f,a,e,d.locked);h.hide()},function(a){h.hide()})}else buildspace.dialog.alert(c.buildUpQtyAlert,
c.pleaseSetUOM,60,300)},editableCellDblClick:function(a){var b=a.cell.field,d=this.getItem(a.rowIndex);if("addition_quantity-value"==b&&0<d.id&&(d.type[0]==buildspace.widget.grid.constants.HIERARCHY_TYPE_WORK_ITEM||d.type[0]==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_HTML_EDITOR||d.type[0]==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_PROVISIONAL||d.type[0]==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_NOT_LISTED))if(0<d.uom_id[0]){a=dojo.xhrGet({url:"billBuildUpQuantity/getDimensionColumnStructure",
content:{uom_id:d.uom_id[0]},handleAs:"json"});var h=buildspace.dialog.indeterminateProgressBar({title:c.pleaseWait+"..."});h.show();a.then(function(a){g.createBuildUpQuantityContainer(d,a,"addition",!1);h.hide()},function(a){h.hide()})}else buildspace.dialog.alert(c.buildUpQtyAlert,c.pleaseSetUOM,60,300)},singleCheckBoxSelection:function(a){var b=a.rowIndex;a=this.selection.selected[b];b=this.getItem(b);this.removedIds=[];if(a)return this.gridContainer.voItemSelectedStore.put({id:b.id[0]}),this.getAffectedVOByItems(b,
"add");this.gridContainer.voItemSelectedStore.remove(b.id[0]);this.removedIds.push(b.id[0]);return this.getAffectedVOByItems(b,"remove")},toggleAllSelection:function(a){var b=this,c=this.selection;b.removedIds=[];if(a)return c.selectRange(0,b.rowCount-1),b.store.fetch({onComplete:function(a){dojo.forEach(a,function(a,c){0<a.id&&b.gridContainer.voItemSelectedStore.put({id:a.id[0]})})}}),b.getAffectedVOByItems(null,"add");c.deselectAll();b.store.fetch({onComplete:function(a){dojo.forEach(a,function(a,
c){0<a.id&&(b.gridContainer.voItemSelectedStore.remove(a.id[0]),b.removedIds.push(a.id[0]))})}});return b.getAffectedVOByItems(null,"remove")},getAffectedVOByItems:function(a,b){var d=this,g=[],h=buildspace.dialog.indeterminateProgressBar({title:c.pleaseWait+"..."});h.show();if("add"===b)d.gridContainer.voItemSelectedStore.query().forEach(function(a){g.push(a.id)});else for(var e in d.removedIds)g.push(d.removedIds[e]);x.post("subPackageVariationOrderReporting/getSubPackageAffectedVOS",{handleAs:"json",
data:{spid:d.subPackage.id,item_ids:JSON.stringify(d.gridContainer.arrayUnique(g))}}).then(function(a){var c=dijit.byId("variation_order-"+d.subPackage.id);if("add"===b)for(var f in a){for(var g in a[f])d.gridContainer.voItemSelectedStore.put({id:a[f][g]});c.grid.store.fetchItemByIdentity({identity:f,onItem:function(a){if(a&&0<d.gridContainer.voItemSelectedStore.data.length)return d.gridContainer.voSelectedStore.put({id:f}),c.grid.rowSelectCell.toggleRow(a._0,!0)}})}else for(f in a){for(g in a[f])d.gridContainer.voItemSelectedStore.remove(a[f][g]);
c.grid.store.fetchItemByIdentity({identity:f,onItem:function(a){if(a&&0===d.gridContainer.voItemSelectedStore.data.length)return d.gridContainer.voSelectedStore.remove(f),c.grid.rowSelectCell.toggleRow(a._0,!1)}})}h.hide()},function(a){h.hide();console.log(a)})}}});b.addChild(this.makeItemGridContainer(a,c.variationOrderItems));l&&this.addChild(b)},createBuildUpQuantityContainer:function(b,a,e,d){d=!0;var g=this,l,h=new dijit.layout.BorderContainer({style:"padding:0px;width:100%;height:100%;border:0px;outline:none;",
gutters:!1}),t=new dijit.layout.TabContainer({nested:!0,style:"padding:0;border:none;margin:0;width:100%;height:100%;",region:"center"}),f=new u,k=dojo.xhrGet({url:"variationOrder/getSpLinkInfo/id/"+b.id+"/t/"+e,handleAs:"json"}),p=new dojo.data.ItemFileWriteStore({url:"variationOrder/getSpBuildUpQuantityItemList/id/"+b.id+"/type/"+e,clearOnClose:!0}),q=[buildspace.constants.SIGN_POSITIVE_TEXT,buildspace.constants.SIGN_NEGATIVE_TEXT],r=[buildspace.constants.SIGN_POSITIVE,buildspace.constants.SIGN_NEGATIVE],
v=!1,w=buildspace.dialog.indeterminateProgressBar({title:c.pleaseWait+"..."});w.show();k.then(function(k){var n=[{name:"No",field:"id",styles:"text-align:center;",width:"30px",formatter:f.rowCountCellFormatter},{name:c.description,field:"description",width:"auto",cellType:"buildspace.widget.grid.cells.Textarea"},{name:c.factor,field:"factor-value",width:"100px",styles:"text-align:right;",cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:f.formulaNumberCellFormatter}];dojo.forEach(a,
function(a){n.push({name:a.title,field:a.field_name,width:"100px",styles:"text-align:right;",cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:f.formulaNumberCellFormatter})});n.push({name:c.total,field:"total",width:"100px",styles:"text-align:right;",formatter:f.numberCellFormatter});n.push({name:c.sign,field:"sign",width:"70px",styles:"text-align:center;",cellType:"dojox.grid.cells.Select",options:q,values:r,formatter:f.signCellFormatter});var m=new C({itemId:b.id,type:e,container:h,
hasLinkedQty:k.has_linked_qty,_csrf_token:b._csrf_token,locked:d});k.has_linked_qty&&(v=!0,l=E({title:c.scheduleOfQuantities,BillItem:b,disableEditingMode:!0,stackContainerId:"SP_variationOrderItems-"+g.subPackage.id+"_"+g.variationOrder.id+"-stackContainer",gridOpts:{qtyType:e,buildUpSummaryWidget:m,store:new dojo.data.ItemFileWriteStore({url:"variationOrder/getSpScheduleOfQuantities/id/"+b.id+"/t/"+e,clearOnClose:!0}),structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:f.rowCountCellFormatter},
{name:c.description,field:"description",width:"auto",formatter:f.treeCellFormatter},{name:c.type,field:"type",width:"70px",styles:"text-align:center;",formatter:f.typeCellFormatter},{name:c.unit,field:"uom_id",width:"70px",styles:"text-align:center;",formatter:f.unitIdCellFormatter},{name:c.qty,field:"quantity-value",width:"100px",styles:"text-align:right;",formatter:f.formulaNumberCellFormatter}]}}));t.addChild(new B({title:c.manualQtyItems,region:"center",VariationOrderItem:b,type:e,locked:d,gridOpts:{store:p,
structure:n,buildUpSummaryWidget:m}}));v&&t.addChild(l);h.addChild(t);h.addChild(m);if(k=dijit.byId("SP_variationOrderItems-"+g.subPackage.id+"_"+g.variationOrder.id+"-stackContainer"))m=document.createElement("div"),m=new dojox.layout.ContentPane({title:buildspace.truncateString(b.description,45)+" ("+c.buildUpQuantity+" - "+b.uom_symbol+")",id:"SP_variationOrderBuildUpQuantityPage-"+b.id,style:"padding:0px;border:0px;",content:h,executeScripts:!0},m),k.addChild(m),k.selectChild("SP_variationOrderBuildUpQuantityPage-"+
b.id);w.hide()})},createVariationOrderClaimGrid:function(b){this.addChild(new z({style:"margin:0px;padding:0px;border:0px;width:100%;height:100%;",title:c.claimRevisions,content:new D({variationOrder:this.variationOrder,variationOrderItemContainer:this,claimStatus:b})}))},makeItemGridContainer:function(b,a){var c=this.subPackage.id+"_"+this.variationOrder.id,d=dijit.byId("SP_variationOrderItems-"+c+"-stackContainer");d&&d.destroyRecursive();d=new dijit.layout.StackContainer({style:"width:100%;height:100%;border:0px;",
region:"center",id:"SP_variationOrderItems-"+c+"-stackContainer"});d.addChild(new dijit.layout.ContentPane({title:a,content:b,grid:b.grid}));var g=new dijit.layout.StackController({region:"top",containerId:"SP_variationOrderItems-"+c+"-stackContainer"}),g=new dijit.layout.ContentPane({style:"padding:0px;overflow:hidden;","class":"breadCrumbTrail",region:"top",content:g}),e=dijit.byId("SP_variationOrderItems-"+c+"-borderContainer");e&&e.destroyRecursive(!0);e=new dijit.layout.BorderContainer({id:"SP_variationOrderItems-"+
c+"-borderContainer",style:"padding:0px;width:100%;height:100%;border:0px;",gutters:!1,region:"center"});e.addChild(d);e.addChild(g);dojo.subscribe("SP_variationOrderItems-"+c+"-stackContainer-selectChild","",function(a){var b=dijit.byId("SP_variationOrderItems-"+c+"-stackContainer");if(b){var d=b.getChildren();a=dojo.indexOf(d,a);a+=1;if(d.length>a)for(;d.length>a;)b.removeChild(d[a]),d[a].destroyDescendants(),d[a].destroyRecursive(),a+=1}});return e}})});
