define("buildspace/apps/Tendering/Builder","../../../dojo/_base/declare dijit/form/Form dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/array dojo/_base/event dojo/keys dojo/dom-style dojo/on dijit/form/DropDownButton dijit/DropDownMenu dijit/MenuItem ./WorkArea ./tenderImportDialog ./checkPublishRequirementDialog dojo/i18n!buildspace/nls/Tendering".split(" "),function(k,m,n,C,p,q,D,E,F,r,t,G,u,v,w,x,y,z,b){var A=k("buildspace.apps.ProjectBuilder.ExportTenderingProjectForm",
[m,n,p,q,dojox.form.manager._Mixin,dojox.form.manager._NodeMixin,dojox.form.manager._ValueMixin,dojox.form.manager._DisplayMixin],{templateString:'<form data-dojo-attach-point="containerNode"><table class="table-form"><tr><td class="label" style="width:80px;"><label style="display: inline;"></span>'+b.downloadAs+' :</label></td><td><input type="text" name="filename" style="padding:2px;width:220px;" data-dojo-type="dijit/form/ValidationTextBox" data-dojo-props="trim:true, propercase:true, required: true"><input type="hidden" name="id" value=""><input type="hidden" name="_csrf_token" value=""></td></tr></table></form>',
project:null,region:"center",exportRate:!1,dialogWidget:null,exportUrl:null,style:"outline:none;padding:0;margin:0;border:none;",baseClass:"buildspace-form",startup:function(){this.inherited(arguments);var a=this.project.title[0].toString();60<a.length&&(a=a.substring(0,60));a=this.exportRate?"Rates-"+a:a;this.setFormValues({filename:a,id:this.project.id,_csrf_token:this.project._csrf_token})},submit:function(){if(this.validate()&&this.exportUrl){var a=dojo.formToObject(this.id),d=a.filename.replace(/ /g,
"_");buildspace.windowOpen("POST",this.exportUrl,{filename:d,id:a.id,_csrf_token:a._csrf_token});this.dialogWidget&&this.dialogWidget.hide()}}}),l=k("buildspace.apps.Tendering.ExportTenderingProjectDialog",dijit.Dialog,{style:"padding:0px;margin:0;",title:b.exportProject,project:null,exportRate:!1,exportUrl:null,buildRendering:function(){var a=this.createContent();a.startup();this.content=a;this.inherited(arguments)},postCreate:function(){t.set(this.containerNode,{padding:"0",margin:"0"});this.closeButtonNode.style.display=
"none";this.inherited(arguments)},_onKey:function(a){a.keyCode==r.ESCAPE&&dojo.stopEvent(a)},onHide:function(){this.destroyRecursive()},createContent:function(){var a=new dijit.layout.BorderContainer({style:"padding:0;width:400px;height:80px;",gutters:!1}),d=new dijit.Toolbar({region:"top",style:"outline:none!important;padding:2px;overflow:hidden;"}),c=A({project:this.project,exportUrl:this.exportUrl,exportRate:this.exportRate,dialogWidget:this});d.addChild(new dijit.form.Button({label:b.close,iconClass:"icon-16-container icon-16-close",
style:"outline:none!important;",onClick:dojo.hitch(this,"hide")}));d.addChild(new dijit.ToolbarSeparator);d.addChild(new dijit.form.Button({label:b.download,iconClass:"icon-16-container icon-16-import",style:"outline:none!important;",onClick:dojo.hitch(c,"submit")}));a.addChild(d);a.addChild(c);return a}});return k("buildspace.apps.Tendering.Builder",dijit.layout.BorderContainer,{style:"padding:0px;width:100%;height:100%;",gutters:!1,project:null,workarea:null,postCreate:function(){this.inherited(arguments);
var a=this;dojo.xhrGet({url:"projectAnalyzer/getAnalysisStatus/",content:{pid:this.project.id},handleAs:"json"}).then(function(d){var c=new dijit.Toolbar({id:a.project.id+"TenderingBuilder-toolbar",region:"top",style:"padding:2px;width:100%;"}),f=a.workarea=x({rootProject:a.project});switch(parseInt(String(a.project.tender_type_id))){case buildspace.constants.TENDER_TYPE_PARTICIPATED:parseInt(String(a.project.status_id))==buildspace.constants.STATUS_IMPORT?c.addChild(new dijit.form.Button({label:b.importAddendum,
id:a.project.id+"ImportAddendumRow-button",iconClass:"icon-16-container icon-16-container icon-16-import",disabled:parseInt(String(a.project.status_id))!=buildspace.constants.STATUS_IMPORT,onClick:function(e){e=new y({uploadUrl:"tendering/uploadAddendum",importUrl:"tendering/importAddendum",importType:"addendum",rootProject:a.project,title:b.importAddendum});a.workarea.removeBillTab();e.show()}})):c.addChild(new dijit.form.Button({label:b.importUpdate,id:a.project.id+"ImportUpdateRow-button",iconClass:"icon-16-container icon-16-container icon-16-import",
disabled:!0,onClick:function(e){console.log("update")}}));c.addChild(new dijit.ToolbarSeparator);c.addChild(new dijit.form.Button({label:b.exportRates,id:"exportRates-button",iconClass:"icon-16-container icon-16-export",onClick:function(){l({title:b.exportRates,project:a.project,exportRate:!0,exportUrl:"tenderingExportFile/exportRatesByProject"}).show()}}));c.addChild(new dijit.ToolbarSeparator);break;case buildspace.constants.TENDER_TYPE_TENDERED:c.addChild(new dijit.form.Button({label:b.exportProject,
iconClass:"icon-16-container icon-16-export",onClick:function(){l({project:a.project,exportUrl:"tenderingExportFile/exportByProject"}).show()}})),c.addChild(new dijit.ToolbarSeparator)}var g=new v({style:"display: none;"});dojo.forEach(["resourceAnalysis","scheduleOfRateAnalysis"],function(e){var h=!0;"resourceAnalysis"==e&&1==d.enable_resource_analysis?h=!1:"scheduleOfRateAnalysis"==e&&1==d.enable_schedule_of_rate_analysis&&(h=!1);h=new w({id:e+"-"+a.project.id+"-menuItem",label:b[e],disabled:h,
onClick:function(){buildspace.app.launch({__children:[],icon:"project_analyzer",id:a.project.id+"-project_analyzer",is_app:!0,level:0,sysname:"ProjectAnalyzer",title:b.projectAnalyzer},{type:buildspace.constants.STATUS_TENDERING,opt:e,project:a.project})}});g.addChild(h)});c.addChild(new u({label:b.projectAnalyzer,iconClass:"icon-16-container icon-16-project_analyzer",style:"outline:none!important;",dropDown:g}));c.addChild(new dijit.ToolbarSeparator);c.addChild(new dijit.form.Button({id:a.project.id+
"ViewSubPackageRow-button",label:b.subPackages,iconClass:"icon-16-container icon-16-file",onClick:function(e){buildspace.app.launch({__children:[],icon:"project_sub_package",id:a.project.id+"-project_sub_package",is_app:!0,level:0,sysname:"SubPackage",title:b.subPackages},{type:buildspace.constants.STATUS_TENDERING,project:a.project})}}));c.addChild(new dijit.ToolbarSeparator);c.addChild(new dijit.form.Button({id:"soq-"+a.project.id+"-mainButton",label:b.scheduleOfQuantities,iconClass:"icon-16-container icon-16-pyramid",
disabled:1!=d.enable_schedule_of_qty,onClick:function(e){buildspace.app.launch({__children:[],icon:"project_schedule_of_quantity",id:a.project.id+"-schedule_of_quantity",is_app:!0,level:0,sysname:"ScheduleOfQuantity",title:b.scheduleOfQuantities},{type:buildspace.constants.STATUS_TENDERING,project:a.project,canEdit:!1})}}));var B=!a.project.tendering_module_locked[0]&&a.project.can_publish_to_post_contract[0]||a.project.status_id[0]==buildspace.constants.STATUS_IMPORT_SUB_PACKAGE||a.project.status_id[0]==
buildspace.constants.STATUS_IMPORT;a.project.is_admin[0]&&B&&(c.addChild(new dijit.ToolbarSeparator({id:a.project.id+"PublishToPostContractBtn-toolbar_separator"})),c.addChild(new dijit.form.Button({id:a.project.id+"PublishToPostContractRow-button",label:b.pushToPostContract,iconClass:"icon-16-container icon-16-indent",onClick:function(e){a.workarea.removeBillTab();a.workarea.removeTabByType(9999999);a.publishToPostContract()}})));f.startup();a.addChild(c);a.addChild(f)})},publishToPostContract:function(){var a=
this,d=this.project,c=buildspace.dialog.indeterminateProgressBar({title:b.processing+". "+b.pleaseWait+"..."});c.show().then(function(){dojo.xhrGet({url:"tendering/checkPublishRequirement",content:{id:d.id},handleAs:"json",load:function(f){c.hide();if(f.can_publish)f=new z({rootProject:d,builderObj:a,data:f}),f.show();else{var g='<div style="background:#cc1313;padding:5px;min-width:64px;color:#fff;">'+b.cannotPublishDifferentAwardedContractorTxt+"</div>";g+='<div class="buildspace-form"><fieldset><legend>'+
b.companyInformation+'</legend><div style="height:2px;">&nbsp;</div><table class="table-form"><tr><td class="label" style="width:10%;"><label style="display: inline;">'+b.name+' :</label></td><td style="width:90%;">'+f.company_name+'</td></tr><tr><td class="label" style="width:10%;"><label style="display: inline;">'+b.address+' :</label></td><td style="width:90%;"><label style="display: inline;white-space: pre-wrap;">'+f.company_address+"</label></td></tr></table></fieldset></div>";buildspace.dialog.alert(b.error,
g,280,640)}},error:function(f){c.hide()}})})},disableButtonsAfterPublish:function(){var a=dijit.byId(this.project.id+"PublishToPostContractRow-button"),d=dijit.byId(this.project.id+"ImportAddendumRow-button");a&&a._setDisabledAttr(!0);d&&d._setDisabledAttr(!0);this.reloadRevision()},reloadRevision:function(){var a=dijit.byId(this.project.id[0]+"-ProjectRevision");dojo.empty(a.projectRevisionSettingsForm.tableContainer);a.projectRevisionSettingsForm.masterGenerateProjectRevisionTableRow()},disableToolbarButtons:function(a){}})});
