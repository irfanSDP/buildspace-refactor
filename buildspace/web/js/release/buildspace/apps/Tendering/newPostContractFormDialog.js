define("buildspace/apps/Tendering/newPostContractFormDialog","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/when dojo/on dojo/html dojo/dom dojo/keys dojo/dom-style dijit/registry dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/form/FilteringSelect dijit/form/NumberTextBox dijit/form/CheckBox dijit/layout/ContentPane buildspace/widget/grid/cells/Formatter dijit/form/DropDownButton dijit/Menu dijit/DropDownMenu dijit/MenuItem dijit/PopupMenuItem dojo/text!./templates/newPostContractForm.html dojo/i18n!buildspace/nls/NewPostContractForm".split(" "),
function(r,u,C,D,p,e,g,v,h,t,w,x,y,z,m,l,E,F,G,H,I,J,K,L,A,k){var B=r("buildspace.apps.Tendering.NewContractForm",[w,x,y,z],{templateString:A,baseClass:"buildspace-form",region:"center",dialogObj:null,project:null,selectedContractor:null,eTenderWaiverSelected:null,eAuctionWaiverSelected:null,nls:k,startup:function(){this.inherited(arguments);e.set(this.projectTitleNode,String(this.project.title));var a=this,c=this.project,d=buildspace.dialog.indeterminateProgressBar({title:k.pleaseWait+"..."});d.show().then(function(){dojo.xhrGet({url:"tendering/getSelectedContractor",
handleAs:"json",content:{project_id:c.id}}).then(function(f){e.set(a.selectedContractorNameNode,f.name?String(f.name):"");h.set(a.awardedTenderAlternativeRowNode,{display:"none"});0<parseInt(f.tender_alternative_id)&&(e.set(a.awardedTenderAlternativeTitleNode,String(f.tender_alternative_title)),h.set(a.awardedTenderAlternativeRowNode,{display:""}));dojo.xhrGet({url:"tendering/newPostContractFormInformationForm",handleAs:"json",content:{project_id:c.id,use_original_rate:a.dialogObj.useOriginalRate,
without_not_listed_item:a.dialogObj.withoutNotListedItem},load:function(b){a.initWaiverOptionState();a.eTenderWaiverOption.set("checked",null!=b.eTenderWaiverOption);a.eAuctionWaiverOption.set("checked",null!=b.eAuctionWaiverOption);null!=b.eTenderWaiverOption&&a.eTenderWaiverOptionSelect.set("value",b.eTenderWaiverOption);null!=b.eAuctionWaiverOption&&a.eAuctionWaiverOptionSelect.set("value",b.eAuctionWaiverOption);a.eTenderWaiverUserDefinedOptionInput.set("value",b.eTenderWaiverUserDefinedOption);
a.eAuctionWaiverUserDefinedOptionInput.set("value",b.eAuctionWaiverUserDefinedOption);if(b.eproject_in_post_contract){var q=["new_post_contract_form_information[contract_period_from]","new_post_contract_form_information[contract_period_to]"],n;for(n in a.newPostContractForm.formWidgets)-1!=q.indexOf(n)&&(a.newPostContractForm.formWidgets[n].widget.destroyRecursive(!0),delete a.newPostContractForm.formWidgets[n]);e.set(g.byId("new_post_contract_form_information-contract_period_from-column"),b.commencement_date);
e.set(g.byId("new_post_contract_form_information-contract_period_to-column"),b.completion_date);b.selected_trade&&(a.newPostContractForm.formWidgets["new_post_contract_form_information[pre_defined_location_code_id]"].widget.destroyRecursive(!0),delete a.newPostContractForm.formWidgets["new_post_contract_form_information[pre_defined_location_code_id]"],e.set(g.byId("new_post_contract_form_information-trade-column"),b.selected_trade));a.newPostContractForm.formWidgets["new_post_contract_form_information[labour_rate_hours]"].widget.destroyRecursive(!0);
delete a.newPostContractForm.formWidgets["new_post_contract_form_information[labour_rate_hours]"];e.set(g.byId("new_post_contract_form_information-labour_rate_hours"),b.labour_rates.hours);a.newPostContractForm.formWidgets["new_post_contract_form_information[labour_rate_skilled_normal]"].widget.destroyRecursive(!0);delete a.newPostContractForm.formWidgets["new_post_contract_form_information[labour_rate_skilled_normal]"];e.set(g.byId("new_post_contract_form_information-labour_rate_skilled_normal"),
b.labour_rates.skilled.normal);a.newPostContractForm.formWidgets["new_post_contract_form_information[labour_rate_skilled_ot]"].widget.destroyRecursive(!0);delete a.newPostContractForm.formWidgets["new_post_contract_form_information[labour_rate_skilled_ot]"];e.set(g.byId("new_post_contract_form_information-labour_rate_skilled_ot"),b.labour_rates.skilled.ot);a.newPostContractForm.formWidgets["new_post_contract_form_information[labour_rate_semi_skilled_normal]"].widget.destroyRecursive(!0);delete a.newPostContractForm.formWidgets["new_post_contract_form_information[labour_rate_semi_skilled_normal]"];
e.set(g.byId("new_post_contract_form_information-labour_rate_semi_skilled_normal"),b.labour_rates.semi_skilled.normal);a.newPostContractForm.formWidgets["new_post_contract_form_information[labour_rate_semi_skilled_ot]"].widget.destroyRecursive(!0);delete a.newPostContractForm.formWidgets["new_post_contract_form_information[labour_rate_semi_skilled_ot]"];e.set(g.byId("new_post_contract_form_information-labour_rate_semi_skilled_ot"),b.labour_rates.semi_skilled.ot);a.newPostContractForm.formWidgets["new_post_contract_form_information[labour_rate_labour_normal]"].widget.destroyRecursive(!0);
delete a.newPostContractForm.formWidgets["new_post_contract_form_information[labour_rate_labour_normal]"];e.set(g.byId("new_post_contract_form_information-labour_rate_labour_normal"),b.labour_rates.labour.normal);a.newPostContractForm.formWidgets["new_post_contract_form_information[labour_rate_labour_ot]"].widget.destroyRecursive(!0);delete a.newPostContractForm.formWidgets["new_post_contract_form_information[labour_rate_labour_ot]"];e.set(g.byId("new_post_contract_form_information-labour_rate_labour_ot"),
b.labour_rates.labour.ot)}1>b.labour_rates.len&&(b.formValues["new_post_contract_form_information[labour_rate_hours]"]=b.labour_rates.hours,b.formValues["new_post_contract_form_information[labour_rate_skilled_normal]"]=b.labour_rates.skilled.normal,b.formValues["new_post_contract_form_information[labour_rate_skilled_ot]"]=b.labour_rates.skilled.ot,b.formValues["new_post_contract_form_information[labour_rate_semi_skilled_normal]"]=b.labour_rates.semi_skilled.normal,b.formValues["new_post_contract_form_information[labour_rate_semi_skilled_ot]"]=
b.labour_rates.semi_skilled.ot,b.formValues["new_post_contract_form_information[labour_rate_labour_normal]"]=b.labour_rates.labour.normal,b.formValues["new_post_contract_form_information[labour_rate_labour_ot]"]=b.labour_rates.labour.ot);a.newPostContractForm.setFormValues(b.formValues);d.hide()},error:function(b){d.hide()}})})})},postCreate:function(){this.inherited(arguments);var a=this;a.formTypeSelect=(new m({name:"new_post_contract_form_information[type]",store:new dojo.data.ItemFileReadStore({url:"tendering/getNewPostContractFormType"}),
style:"padding:2px;",searchAttr:"name",readOnly:!1,onChange:function(c){switch(c){case buildspace.constants.NEW_POST_CONTRACT_FORM_TYPE_WORK_ORDER:c=k.workOrderNo;break;case buildspace.constants.NEW_POST_CONTRACT_FORM_TYPE_CONTRACT_INFO:c=k.contractInfoNo;break;default:c=k.letterOfAwardNo}e.set(g.byId("label_number"),c);var d=this.get("value"),f=buildspace.dialog.indeterminateProgressBar({title:k.pleaseWait+"..."});f.show().then(function(){dojo.xhrGet({url:"tendering/getNewPostContractFormNumber",
content:{project_id:a.project.id,form_type:d},handleAs:"json",load:function(b){b.success&&t.byId("form_number").set("value",b.form_number);f.hide()},error:function(b){f.hide()}})})}})).placeAt(a.formTypeSelectDivNode);t.byId("form_number").on("change",function(){var c=this.get("value"),d=a.formTypeSelect.get("value");dojo.xhrGet({url:"tendering/getLetterOfAwardCode",content:{project_id:a.project.id,form_type:d,form_number:c},handleAs:"json",load:function(f){f.success&&dijit.byId("new_post_contract_form_information[reference]").set("value",
f.code)},error:function(f){}})});(new m({id:"new_post_contract_form_information-pre_defined_location_code_id",name:"new_post_contract_form_information[pre_defined_location_code_id]",store:new dojo.data.ItemFileReadStore({url:"tendering/getLocationTradesDropDownList"}),style:"padding:2px;",searchAttr:"name",readOnly:!1})).placeAt(a.tradeSelectDivNode);(new m({name:"new_post_contract_form_information[works_1]",store:new dojo.data.ItemFileReadStore({url:"tendering/getSubPackageWorksDropDownList/type/"+
buildspace.constants.SUB_PACKAGE_WORKS_TYPE_1}),style:"padding:2px;",searchAttr:"name",readOnly:!1,required:!1})).placeAt(a.worksSelectDivNode);(new m({name:"new_post_contract_form_information[works_2]",store:new dojo.data.ItemFileReadStore({url:"tendering/getSubPackageWorksDropDownList/type/"+buildspace.constants.SUB_PACKAGE_WORKS_TYPE_2}),style:"padding:2px;",searchAttr:"name",readOnly:!1,required:!1})).placeAt(a.works2SelectDivNode);(new l({name:"new_post_contract_form_information[labour_rate_hours]",
id:"new_post_contract_form_information[labour_rate_hours]",style:"padding:2px;width:70px;",value:0,trim:!0,readOnly:!1,required:!0})).placeAt(a.labourRateHoursDivNode);(new l({name:"new_post_contract_form_information[labour_rate_skilled_normal]",id:"new_post_contract_form_information[labour_rate_skilled_normal]",style:"padding:2px;width:70px;",value:0,trim:!0,readOnly:!1,required:!0})).placeAt(a.labourRateSkilledNormalDivNode);(new l({name:"new_post_contract_form_information[labour_rate_skilled_ot]",
id:"new_post_contract_form_information[labour_rate_skilled_ot]",style:"padding:2px;width:70px;",value:0,trim:!0,readOnly:!1,required:!0})).placeAt(a.labourRateSkilledOTDivNode);(new l({name:"new_post_contract_form_information[labour_rate_semi_skilled_normal]",id:"new_post_contract_form_information[labour_rate_semi_skilled_normal]",style:"padding:2px;width:70px;",value:0,trim:!0,readOnly:!1,required:!0})).placeAt(a.labourRateSemiSkilledNormalDivNode);(new l({name:"new_post_contract_form_information[labour_rate_semi_skilled_ot]",
id:"new_post_contract_form_information[labour_rate_semi_skilled_ot]",style:"padding:2px;width:70px;",value:0,trim:!0,readOnly:!1,required:!0})).placeAt(a.labourRateSemiSkilledOTDivNode);(new l({name:"new_post_contract_form_information[labour_rate_labour_normal]",id:"new_post_contract_form_information[labour_rate_labour_normal]",style:"padding:2px;width:70px;",value:0,trim:!0,readOnly:!1,required:!0})).placeAt(a.labourRateLabourNormalDivNode);p(dijit.byId("new_post_contract_form_information[retention]"),
"keyup",function(){dijit.byId("new_post_contract_form_information[max_retention_sum]").set("value",dijit.byId("new_post_contract_form_information[retention]").textbox.value)});dijit.byId("includeVO").on("change",function(c){c=c?"block":"none";var d=g.byId("includeVODesription");d&&h.set(d,"display",c)});(new l({name:"new_post_contract_form_information[labour_rate_labour_ot]",id:"new_post_contract_form_information[labour_rate_labour_ot]",style:"padding:2px;width:70px;",value:0,trim:!0,readOnly:!1,
required:!0})).placeAt(a.labourRateLabourOTDivNode);dijit.byId("new_post_contract_form_information-pre_defined_location_code_id").on("change",function(c){dojo.xhrGet({url:"tendering/getProjectLabourRateRecords",handleAs:"json",content:{trade_id:c,project_id:a.project.id}}).then(function(d){d.projectLabourRates&&(dijit.byId("new_post_contract_form_information[labour_rate_hours]").textbox.value=d.projectLabourRates.hours,dijit.byId("new_post_contract_form_information[labour_rate_skilled_normal]").textbox.value=
d.projectLabourRates.skilled.normal,dijit.byId("new_post_contract_form_information[labour_rate_skilled_ot]").textbox.value=d.projectLabourRates.skilled.ot,dijit.byId("new_post_contract_form_information[labour_rate_semi_skilled_normal]").textbox.value=d.projectLabourRates.semi_skilled.normal,dijit.byId("new_post_contract_form_information[labour_rate_semi_skilled_ot]").textbox.value=d.projectLabourRates.semi_skilled.ot,dijit.byId("new_post_contract_form_information[labour_rate_labour_normal]").textbox.value=
d.projectLabourRates.labour.normal,dijit.byId("new_post_contract_form_information[labour_rate_labour_ot]").textbox.value=d.projectLabourRates.labour.ot)})});p(this.eTenderWaiverOption,"change",function(c){e.set(g.byId("new_post_contract_form_information_error-e_tender_waiver"),"");a.toggleETenderWaiverOption(this.checked);a.toggleETenderWaiverDescription(this.checked)});p(this.eAuctionWaiverOption,"change",function(c){e.set(g.byId("new_post_contract_form_information_error-e_auction_waiver"),"");a.toggleEAuctionWaiverOption(this.checked);
a.toggleEAuctionWaiverDescription(this.checked)});a.eTenderWaiverOptionSelect=(new m({name:"new_post_contract_form_information[eTenderWaiverOption]",store:new dojo.data.ItemFileReadStore({url:"tendering/getWaiverOptionType/type/"+buildspace.constants.WAIVER_OPTION_TYPE_E_TENDER}),required:!1,onChange:function(c){a.toggleETenderWaiverUserDefinedOption(c==buildspace.constants.E_TENDER_WAIVER_OPTION_OTHERS)}})).placeAt(a.eTenderWaiverOptionSelectDivNode);a.eAuctionWaiverOptionSelect=(new m({name:"new_post_contract_form_information[eAuctionWaiverOption]",
store:new dojo.data.ItemFileReadStore({url:"tendering/getWaiverOptionType/type/"+buildspace.constants.WAIVER_OPTION_TYPE_E_AUCTION}),required:!1,onChange:function(c){a.toggleEAuctionWaiverUserDefinedOption(c==buildspace.constants.E_AUCTION_WAIVER_OPTION_OTHERS)}})).placeAt(a.eAuctionWaiverOptionSelectDivNode)},initWaiverOptionState:function(){this.toggleETenderWaiverOption(!1);this.toggleETenderWaiverUserDefinedOption(!1);this.toggleETenderWaiverDescription(!1);this.toggleEAuctionWaiverOption(!1);
this.toggleEAuctionWaiverUserDefinedOption(!1);this.toggleEAuctionWaiverDescription(!1)},toggleETenderWaiverOption:function(a){a=a?"":"none";h.set(this.eTenderWaiverOptionLabel,"display",a);h.set(this.eTenderWaiverOptionSelectDivNode,"display",a)},toggleETenderWaiverUserDefinedOption:function(a){a=a?"":"none";h.set(this.eTenderWaiverUserDefinedOptionLabel,"display",a);h.set(this.eTenderWaiverOptionUserDefinedInputDiv,"display",a)},toggleETenderWaiverDescription:function(a){h.set(this.eTenderWaiverDescription,
"display",a?"":"none")},toggleEAuctionWaiverOption:function(a){a=a?"":"none";h.set(this.eAuctionWaiverOptionLabel,"display",a);h.set(this.eAuctionWaiverOptionSelectDivNode,"display",a)},toggleEAuctionWaiverUserDefinedOption:function(a){a=a?"":"none";h.set(this.eAuctionWaiverUserDefinedOptionLabel,"display",a);h.set(this.eAuctionWaiverOptionUserDefinedInputDiv,"display",a)},toggleEAuctionWaiverDescription:function(a){h.set(this.eAuctionWaiverDescription,"display",a?"":"none")},save:function(){var a=
this,c=dojo.formToObject(this.newPostContractForm.id),d=buildspace.dialog.indeterminateProgressBar({title:k.submitting+". "+k.pleaseWait+"..."});u.mixin(c,{"new_post_contract_form_information[project_structure_id]":this.project.id,pid:this.project.id,use_original_rate:this.dialogObj.useOriginalRate,without_not_listed_item:this.dialogObj.withoutNotListedItem});this.newPostContractForm.validate()&&d.show().then(function(){dojo.xhrPost({url:"tendering/submitNewContractForm",content:c,handleAs:"json",
load:function(f){dojo.query('[id^="new_post_contract_form_information_error-"]').forEach(function(n){n.innerHTML=""});if(f.success)a.dialogObj.checkPublishRequirementDialog.sendNewPostContractFormForApproval(),a.dialogObj.hide();else for(var b in f.errors){var q=f.errors[b];e.set(g.byId("new_post_contract_form_information_error-"+b),q)}d.hide()},error:function(f){d.hide()}})})}});return r("buildspace.apps.Tendering.ChooseNewPostContractFormTypeDialog",dijit.Dialog,{style:"padding:0px;margin:0px;",
title:k.postContract,rootProject:null,useOriginalRate:!1,withoutNotListedItem:!1,checkPublishRequirementDialog:null,buildRendering:function(){var a=this.createForm();a.startup();this.content=a;this.inherited(arguments)},postCreate:function(){h.set(this.containerNode,{padding:"0px",margin:"0px"});this.closeButtonNode.style.display="none";this.inherited(arguments)},_onKey:function(a){a.keyCode==v.ESCAPE&&dojo.stopEvent(a)},onHide:function(){this.destroyRecursive()},createForm:function(){var a=new dijit.layout.BorderContainer({style:"padding:0px;width:960px;height:520px;",
gutters:!1}),c=new B({dialogObj:this,project:this.rootProject,style:"width:100%;border:none;height:100%;overflow:auto;"}),d=new dijit.Toolbar({region:"top",style:"outline:none!important;padding:2px;overflow:hidden;"});d.addChild(new dijit.form.Button({label:k.save,iconClass:"icon-16-container icon-16-save",style:"outline:none!important;",onClick:dojo.hitch(c,"save")}));d.addChild(new dijit.ToolbarSeparator);d.addChild(new dijit.form.Button({label:k.close,iconClass:"icon-16-container icon-16-close",
style:"outline:none!important;",onClick:dojo.hitch(this,"hide")}));a.addChild(d);a.addChild(c);return a}})});
