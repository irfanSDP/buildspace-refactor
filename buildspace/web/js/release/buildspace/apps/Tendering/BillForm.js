define("buildspace/apps/Tendering/BillForm","dojo/_base/declare dojo/html dojo/dom dojo/keys dojo/dom-style dijit/form/Form dijit/form/ValidationTextBox dijit/form/Textarea dijit/form/Select dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/billForm.html dojo/i18n!buildspace/nls/ProjectBuilder dojo/on".split(" "),function(k,f,m,n,d,x,y,z,h,p,q,r,t,u,g,A){var w=k("buildspace.apps.Tendering.BillFormWidget",[p,q,r,t],{templateString:u,
baseClass:"buildspace-form",region:"center",dialogObj:null,billId:-1,parentId:null,projectBreakdownGrid:null,billType:null,nls:g,style:"padding:5px;overflow:auto;",constructor:function(a){var b=this.BillTypeConstantArray=[];this.BILL_TYPE_STANDARD=buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_STANDARD;this.BILL_TYPE_STANDARD_TEXT=buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_STANDARD_TEXT;this.BILL_TYPE_STANDARD_DESCRIPTION=buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_STANDARD_DESCRIPTION;
this.BILL_TYPE_PRELIMINARY=buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_PRELIMINARY;this.BILL_TYPE_PRELIMINARY_TEXT=buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_PRELIMINARY_TEXT;this.BILL_TYPE_PRELIMINARY_DESCRIPTION=buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_PRELIMINARY_DESCRIPTION;this.BILL_TYPE_PROVISIONAL=buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_PROVISIONAL;this.BILL_TYPE_PROVISIONAL_TEXT=buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_PROVISIONAL_TEXT;
this.BILL_TYPE_PROVISIONAL_DESCRIPTION=buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_PROVISIONAL_DESCRIPTION;this.BILL_TYPE_PRIMECOST=buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_PRIMECOST;this.BILL_TYPE_PRIMECOST_TEXT=buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_PRIMECOST_TEXT;this.BILL_TYPE_PRIMECOST_DESCRIPTION=buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_PRIMECOST_DESCRIPTION;this.RoundingTypeConstants=RoundingTypeConstants=[{label:buildspace.constants.ROUNDING_TYPE_DISABLED_TEXT,
value:buildspace.constants.ROUNDING_TYPE_DISABLED},{label:buildspace.constants.ROUNDING_TYPE_UPWARD_TEXT,value:buildspace.constants.ROUNDING_TYPE_UPWARD},{label:buildspace.constants.ROUNDING_TYPE_DOWNWARD_TEXT,value:buildspace.constants.ROUNDING_TYPE_DOWNWARD},{label:buildspace.constants.ROUNDING_TYPE_NEAREST_WHOLE_NUMBER_TEXT,value:buildspace.constants.ROUNDING_TYPE_NEAREST_WHOLE_NUMBER},{label:buildspace.constants.ROUNDING_TYPE_NEAREST_TENTH_TEXT,value:buildspace.constants.ROUNDING_TYPE_NEAREST_TENTH}];
this.BillTypeConstants=BillTypeConstants=[{label:buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_STANDARD_TEXT,value:buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_STANDARD,description:buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_STANDARD_DESCRIPTION},{label:buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_PRELIMINARY_TEXT,value:buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_PRELIMINARY,description:buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_PRELIMINARY_DESCRIPTION},
{label:buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_PROVISIONAL_TEXT,value:buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_PROVISIONAL,description:buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_PROVISIONAL_DESCRIPTION},{label:buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_PRIMECOST_TEXT,value:buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_PRIMECOST,description:buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_PRIMECOST_DESCRIPTION}];
b[this.BILL_TYPE_STANDARD]={title:this.BILL_TYPE_STANDARD_TEXT,description:this.BILL_TYPE_STANDARD_DESCRIPTION};b[this.BILL_TYPE_PRELIMINARY]={title:this.BILL_TYPE_PRELIMINARY_TEXT,description:this.BILL_TYPE_PRELIMINARY_DESCRIPTION};b[this.BILL_TYPE_PROVISIONAL]={title:this.BILL_TYPE_PROVISIONAL_TEXT,description:this.BILL_TYPE_PROVISIONAL_DESCRIPTION};b[this.BILL_TYPE_PRIMECOST]={title:this.BILL_TYPE_PRIMECOST_TEXT,description:this.BILL_TYPE_PRIMECOST_DESCRIPTION};this.inherited(arguments)},postCreate:function(){this.inherited(arguments);
var a=new dojo.data.ItemFileReadStore({url:"projectBuilder/getUnitTypes"});this.billSelect=(new h({name:"bill_type[type]",style:"width:180px;padding:2px!important;",options:this.BillTypeConstants,searchAttr:"value",onChange:dojo.hitch(this,"doChangeBillType")})).placeAt(this.billTypeInputDivNode);this.buildUpQuantityRoundingSelect=(new h({name:"bill_setting[build_up_quantity_rounding_type]",style:"width:180px;padding:2px!important;",options:this.RoundingTypeConstants,searchAttr:"name"})).placeAt(this.buildUpQuantityRoundingTypeInputDivNode);
this.buildUpRateRoundingSelect=(new h({name:"bill_setting[build_up_rate_rounding_type]",style:"width:180px;padding:2px!important;",options:this.RoundingTypeConstants,searchAttr:"name"})).placeAt(this.buildUpRateRoundingTypeInputDivNode);this.unitTypeSelect=(new h({name:"bill_setting[unit_type]",style:"width:80px;padding:2px!important;",store:a,searchAttr:"name"})).placeAt(this.unitTypeInputDivNode)},startup:function(){this.inherited(arguments);var a=this;0<this.billId?this.toggleEditableInputElements(!1):
this.toggleEditableInputElements(!0);var b=buildspace.dialog.indeterminateProgressBar({title:g.pleaseWait+"..."});b.show().then(function(){dojo.xhrGet({url:"projectBuilder/billForm",handleAs:"json",content:{id:a.billId,parent_id:a.parentId},load:function(c){a.billForm.setFormValues(c);a.billType=a.BillTypeConstantArray[c["bill_type[type]"]];f.set(a.unitTypeViewDivNode,c.unitTypeText?c.unitTypeText:"");f.set(a.billTypeViewDivNode,a.billType.title);f.set(a.billTypeDescriptionViewDivNode,a.billType.description);
b.hide()},error:function(c){b.hide()}})})},toggleEditableInputElements:function(a){a?(d.set(this.unitTypeViewDivNode,"display","none"),d.set(this.billTypeViewDivNode,"display","none"),d.set(this.unitTypeInputDivNode,"display",""),d.set(this.billTypeInputDivNode,"display","")):(d.set(this.unitTypeViewDivNode,"display",""),d.set(this.billTypeViewDivNode,"display",""),d.set(this.unitTypeInputDivNode,"display","none"),d.set(this.billTypeInputDivNode,"display","none"))},doChangeBillType:function(){var a=
this.billSelect.get("value");this.billType=this.BillTypeConstantArray[a];f.set(this.billTypeViewDivNode,this.billType.title);f.set(this.billTypeDescriptionViewDivNode,this.billType.description)},save:function(){if(this.billForm.validate()){var a=buildspace.dialog.indeterminateProgressBar({title:g.savingData+"..."}),b=this,c=dojo.formToObject(b.billForm.id);a.show().then(function(){dojo.xhrPost({url:"tendering/billUpdate",content:c,handleAs:"json",load:function(e){dojo.query('[id^="error-bill_setting_"]').forEach(function(v){v.innerHTML=
""});if(e.success)e=dijit.byId("bill_element_container_"+b.projectBreakdownGrid.rootProject.id+"-bill-"+e.item.id),b.projectBreakdownGrid.reload(),e&&e.reconstructBillContainer(),b.dialogObj&&b.dialogObj.hide();else for(var l in e.errors)f.set(m.byId("error-bill_setting_"+l),e.errors[l]);a.hide()},error:function(e){a.hide()}})})}},close:function(){},onCancel:function(){}});return k("buildspace.apps.Tendering.BillFormDialog",dijit.Dialog,{style:"padding:0px;margin:0px;",billId:-1,parentId:null,projectBreakdownGrid:null,
title:null,buildRendering:function(){var a=this.createForm();a.startup();this.content=a;this.inherited(arguments)},postCreate:function(){d.set(this.containerNode,{padding:"0px",margin:"0px"});this.closeButtonNode.style.display="none";this.inherited(arguments)},_onKey:function(a){a.keyCode==n.ESCAPE&&dojo.stopEvent(a)},onHide:function(){this.destroyRecursive()},createForm:function(){var a=new dijit.layout.BorderContainer({style:"padding:0px;width:540px;height:320px;",gutters:!1}),b=new w({dialogObj:this,
billId:this.billId,parentId:this.parentId,projectBreakdownGrid:this.projectBreakdownGrid}),c=new dijit.Toolbar({region:"top",style:"outline:none!important;padding:2px;overflow:hidden;"});c.addChild(new dijit.form.Button({label:g.save,iconClass:"icon-16-container icon-16-save",style:"outline:none!important;",onClick:dojo.hitch(b,"save")}));c.addChild(new dijit.ToolbarSeparator);c.addChild(new dijit.form.Button({label:g.close,iconClass:"icon-16-container icon-16-close",style:"outline:none!important;",
onClick:dojo.hitch(this,"hide")}));a.addChild(c);a.addChild(b);return a}})});
