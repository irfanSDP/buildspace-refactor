define("buildspace/apps/Tendering/ProjectBreakdown","dojo/_base/declare dojo/aspect dojo/keys dojo/dom-style dojo/_base/connect dojox/grid/EnhancedGrid dijit/TooltipDialog dijit/popup buildspace/widget/grid/cells/Formatter ./RecalculateDialog ../ProjectBuilder/exportItemDialog ../ProjectBuilder/exportSupplyOfMaterialItemDialog ../ProjectBuilder/ExportScheduleOfRateBillDialog ./LogDialog buildspace/apps/ProjectBuilder/ExportProjectBackupDialog dijit/form/Form dojox/form/manager/_Mixin dojox/form/manager/_NodeMixin dojox/form/manager/_ValueMixin dojox/form/manager/_DisplayMixin dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/form/ValidationTextBox dijit/Menu dijit/form/DropDownButton dijit/DropDownMenu dijit/MenuItem dijit/PopupMenuItem buildspace/apps/TenderAlternative/TenderAlternativeFormDialog buildspace/apps/TenderAlternative/TenderAlternativeListDialog buildspace/apps/PageGenerator/GeneratorDialog buildspace/apps/Tendering/PrintFinalBQDialog ./BillForm dojo/i18n!buildspace/nls/Tendering".split(" "),
function(q,J,z,A,r,K,L,t,M,N,O,P,Q,R,S,B,C,D,E,F,G,fa,H,I,ha,T,w,x,u,U,V,v,y,W,X,d){var Y=q("buildspace.apps.Tendering.ProjectBreakdownGrid",K,{rootProject:null,workArea:null,style:"border:none;",region:"center",keepSelection:!0,rowSelector:"0px",aspectHandles:[],currencySetting:buildspace.currencyAbbreviation,canSort:function(a){return!1},postCreate:function(){this.inherited(arguments);var a=this,c=this.rootProject,b=null;const m=["AddBill","AddLevel"];this.on("RowClick",function(e){if(e.cell){var k=
e.cell.field;e=this.getItem(e.rowIndex);var l=m.slice();if(e&&0<parseInt(String(e.id)))switch(parseInt(String(e.type))){case buildspace.apps.Tendering.ProjectStructureConstants.TYPE_BILL:let n=["Backup","ExportItemFromBill",...l];e.hasOwnProperty("can_delete")&&e.can_delete[0]&&(n=[...n,"Delete"]);l=[...n];break;case buildspace.apps.Tendering.ProjectStructureConstants.TYPE_SUPPLY_OF_MATERIAL_BILL:l=["ExportItemFromBill",...l];break;case buildspace.apps.Tendering.ProjectStructureConstants.TYPE_SCHEDULE_OF_RATE_BILL:l=
["ExportItemFromBill",...l]}e&&0<parseInt(String(e.id))&&parseInt(String(e.type))==buildspace.apps.Tendering.ProjectStructureConstants.TYPE_BILL&&buildspace.apps.Tendering.isRecalculateBillStatus(parseInt(String(e.bill_status)))&&("recalculate"==k&&(new N({title:d.recalculate+" "+buildspace.truncateString(e.title,70),rootProject:c,bill:e,projectBreakDownGrid:a})).show(),["Backup","ExportItemFromBill"].forEach(function(n){n=l.indexOf(n);-1<n&&l.splice(n,1)}));this.disableToolbarButtons(!0,l)}});var g=
J.after(this,"_onFetchComplete",function(){var e=a.store._arrayOfAllItems.some(function(k){return"bill_status"in k?buildspace.apps.Tendering.isRecalculateBillStatus(parseInt(String(k.bill_status))):!1});dijit.byId("exportRates-button")._setDisabledAttr(e)});this.aspectHandles.push(g);this._connects.push(r.connect(this,"onCellMouseOver",function(e){var k=e.cell.field,l=this.getItem(e.rowIndex);if((l&&l.hasOwnProperty("addendum_version")&&"addendum_version"==k&&"undefined"!==typeof l.addendum_version&&
parseInt(String(l.addendum_version))||l&&l.hasOwnProperty("tender_alternative_count")&&"tender_alternative_count"==k&&"undefined"!==typeof l.tender_alternative_count&&parseInt(String(l.tender_alternative_count)))&&null===b){switch(k){case "addendum_version":var n="tendering/getAddendumInfoByBill/id/"+String(l.id);break;case "tender_alternative_count":n="getTenderAlternativeInfoByBill/"+String(l.id)}dojo.xhrGet({url:n,handleAs:"json",sync:!0,preventCache:!0}).then(function(f){if(f.length){switch(k){case "addendum_version":var h=
'<table class="buildspace-table"><thead><tr><th class="gridCell" style="text-align:center;padding:2px;">'+d.version+'</th><th class="gridCell" style="text-align:center;padding:2px;">'+d.revision+"</th></tr><tbody>";for(var p=0;p<f.length;p++)h+='<tr><td class="gridCell" style="text-align:center;">'+f[p].version+'</td><td class="gridCell" style="text-align:center;padding-left:4px;padding-right:4px;">'+f[p].revision+"</td></tr>";h+="</tbody></table>";break;case "tender_alternative_count":n="getTenderAlternativeInfoByBill/"+
String(l.id);h='<table class="buildspace-table"><thead><tr><th class="gridCell" style="text-align:center;padding:2px;">'+d.title+'</th><th class="gridCell" style="text-align:center;padding:2px;">'+d.revision+"</th></tr><tbody>";for(p=0;p<f.length;p++)h+='<tr><td class="gridCell" style="text-align:center;">'+f[p].title+'</td><td class="gridCell" style="text-align:center;padding-left:4px;padding-right:4px;">'+f[p].revision+"</td></tr>";h+="</tbody></table>"}b=new L({content:h,onMouseLeave:function(){t.close(b)}});
t.open({popup:b,around:e.cellNode})}})}}));this._connects.push(r.connect(this,"onCellMouseOut",function(){null!==b&&(t.close(b),b=null)}));this._connects.push(r.connect(this,"onStartEdit",function(){null!==b&&(t.close(b),b=null)}))},dodblclick:function(a){this.onRowDblClick(a)},disableButtonsAfterPublish:function(){},onRowDblClick:function(a){a=this.getItem(a.rowIndex);switch(parseInt(String(a.type))){case buildspace.apps.Tendering.ProjectStructureConstants.TYPE_BILL:parseInt(String(a.bill_status))==
buildspace.apps.Tendering.ProjectStructureConstants.BILL_STATUS_OPEN&&this.workArea.initTab(a,{bill:a,billLayoutSettingId:a.billLayoutSettingId,projectBreakdownGrid:this,rootProject:this.rootProject});break;case buildspace.apps.Tendering.ProjectStructureConstants.TYPE_SUPPLY_OF_MATERIAL_BILL:this.workArea.initTab(a,{billId:parseInt(String(a.id)),projectBreakdownGrid:this,rootProject:this.rootProject});break;case buildspace.apps.Tendering.ProjectStructureConstants.TYPE_SCHEDULE_OF_RATE_BILL:this.workArea.initTab(a,
{billId:parseInt(String(a.id)),projectBreakdownGrid:this,rootProject:this.rootProject})}},deleteRow:function(a){var c=this,b=buildspace.dialog.indeterminateProgressBar({title:d.deleting+". "+d.pleaseWait+"..."}),m;parseInt(String(a.type))==buildspace.apps.Tendering.ProjectStructureConstants.TYPE_BILL||parseInt(String(a.type))==buildspace.apps.Tendering.ProjectStructureConstants.TYPE_SUPPLY_OF_MATERIAL_BILL||parseInt(String(a.type))==buildspace.apps.Tendering.ProjectStructureConstants.TYPE_SCHEDULE_OF_RATE_BILL?
m="<div>"+d.deleteBillAndAllData+"</div>":parseInt(String(a.type))==buildspace.apps.Tendering.ProjectStructureConstants.TYPE_LEVEL&&(m="<div>"+d.deleteLevelAndAllData+"</div>");buildspace.dialog.confirm(d.confirmation,m,80,300,function(){b.show().then(function(){dojo.xhrPost({url:"projectBuilder/projectStructureDelete",content:{id:a.id,_csrf_token:a._csrf_token},handleAs:"json",load:function(g){if(g.success){g=g.items;for(var e=0,k=g.length;e<k;++e)c.store.fetchItemByIdentity({identity:g[e].id,onItem:function(l){var n=
c.workArea.getChildren(),f;for(f in n)if("object"==typeof n[f].pane_info&&n[f].pane_info.id==parseInt(String(l.id))+"-form_"+parseInt(String(l.type))){c.workArea.removeChild(n[f]);break}}});g.length=0;c.reload()}b.hide();c.selection.clear();c.disableToolbarButtons(!0)},error:function(g){b.hide();c.selection.clear();c.disableToolbarButtons(!0)}})})})},openBillForm:function(a){var c=this.getItem(a);String(c.id)==buildspace.constants.GRID_LAST_ROW&&(c=this.getItem(a-1));a=X({title:d.addBill,projectBreakdownGrid:this,
parentId:parseInt(String(c.id))});a.startup();a.show()},disableToolbarButtons:function(a,c){if(a&&c instanceof Array){var b=this,m=dijit.byId(this.rootProject.id+"BackupRow-button"),g=dijit.byId(this.rootProject.id+"ExportItemFromBillRow-button");DeleteBillButton=dijit.byId(this.rootProject.id+"DeleteRow-button");m&&m._setDisabledAttr(a);g&&g._setDisabledAttr(a);DeleteBillButton&&DeleteBillButton._setDisabledAttr(a);dojo.forEach(c,function(e){(e=dijit.byId(b.rootProject.id+e+"Row-button"))&&e._setDisabledAttr(!1)})}},
reload:function(){this.store.close();this._refresh()},destroy:function(){this.inherited(arguments);this.aspectHandles.forEach(function(a){a.remove()});this.aspectHandles=[];dojo.forEach(this._connects,r.disconnect);delete this._connects}}),Z=function(a,c){return 0<a?a:""},aa=function(a,c){c=this.grid.getItem(c);var b=16*c.level;a=null==a?"&nbsp":a;c&&parseInt(String(c.type))<buildspace.apps.Tendering.ProjectStructureConstants.TYPE_BILL&&(a="<b>"+a+"</b>");return a='<div class="treeNode" style="padding-left:'+
b+'px;"><div class="treeContent">'+a+"&nbsp;</div></div>"},ba=q("buildspace.apps.Tendering.ProjectSummary.ExportToExcelForm",[B,G,H,I,C,D,E,F],{templateString:'<form data-dojo-attach-point="containerNode"><table class="table-form"><tr><td class="label" style="width:80px;"><label style="display: inline;"></span>'+d.exportAs+' :</label></td><td><input type="text" name="filename" style="padding:2px;width:220px;" data-dojo-type="dijit/form/ValidationTextBox" data-dojo-props="trim:true, propercase:true, maxlength:45, required: true"> .xlsx</td></tr></table></form>',
project:null,region:"center",dialogWidget:null,style:"outline:none;padding:0px;margin:0px;border:none;",baseClass:"buildspace-form",startup:function(){this.inherited(arguments);var a=new Date;this.setFormValues({filename:"Project_Summary"+a.getDate()+(a.getMonth()+1)+a.getFullYear()})},submit:function(){var a=dojo.formToObject(this.id);this.validate()&&(a=a.filename.replace(/ /g,"_"),window.open("ProjectSummaryXls/"+this.project.id+"/"+this.project._csrf_token+"/"+a,"_self"),this.dialogWidget&&this.dialogWidget.hide())}}),
ca=q("buildspace.apps.Tendering.ProjectSummary.ExportExcelDialog",dijit.Dialog,{style:"padding:0px;margin:0px;",title:d.exportToExcel,project:null,buildRendering:function(){var a=this.createContent();a.startup();this.content=a;this.inherited(arguments)},postCreate:function(){A.set(this.containerNode,{padding:"0px",margin:"0px"});this.closeButtonNode.style.display="none";this.inherited(arguments)},_onKey:function(a){a.keyCode==z.ESCAPE&&dojo.stopEvent(a)},onHide:function(){this.destroyRecursive()},
createContent:function(){var a=new dijit.layout.BorderContainer({style:"padding:0px;width:400px;height:80px;",gutters:!1}),c=new dijit.Toolbar({region:"top",style:"outline:none!important;padding:2px;overflow:hidden;"}),b=ba({project:this.project,dialogWidget:this});c.addChild(new dijit.form.Button({label:d.close,iconClass:"icon-16-container icon-16-close",style:"outline:none!important;",onClick:dojo.hitch(this,"hide")}));c.addChild(new dijit.ToolbarSeparator);c.addChild(new dijit.form.Button({label:d.export,
iconClass:"icon-16-container icon-16-export",style:"outline:none!important;",onClick:dojo.hitch(b,"submit")}));a.addChild(c);a.addChild(b);return a}}),da=q("buildspace.apps.ProjectBuilder.ExportEstimateRatesForm",[B,G,H,I,C,D,E,F],{templateString:'<form data-dojo-attach-point="containerNode"><table class="table-form"><tr><td class="label" style="width:80px;"><label style="display: inline;"></span>'+d.downloadAs+' :</label></td><td><input type="text" name="filename" style="padding:2px;width:220px;" data-dojo-type="dijit/form/ValidationTextBox" data-dojo-props="trim:true, propercase:true, required: true"><input type="hidden" name="id" value=""><input type="hidden" name="_csrf_token" value=""></td></tr></table></form>',
project:null,region:"center",exportRate:!1,dialogWidget:null,exportUrl:null,style:"outline:none;padding:0;margin:0;border:none;",baseClass:"buildspace-form",startup:function(){this.inherited(arguments);var a=this.project.title[0].toString();60<a.length&&(a=a.substring(0,60));a=this.exportRate?"Rates-"+a:a;this.setFormValues({filename:a,id:this.project.id,_csrf_token:this.project._csrf_token})},submit:function(){if(this.validate()&&this.exportUrl){var a=dojo.formToObject(this.id),c=a.filename.replace(/ /g,
"_");buildspace.windowOpen("POST",this.exportUrl,{filename:c,id:a.id,_csrf_token:a._csrf_token});this.dialogWidget&&this.dialogWidget.hide()}}}),ea=q("buildspace.apps.Tendering.ExportEstimateRatesDialog",dijit.Dialog,{style:"padding:0px;margin:0;",title:d.exportEstimateRates,project:null,exportRate:!1,exportUrl:null,buildRendering:function(){var a=this.createContent();a.startup();this.content=a;this.inherited(arguments)},postCreate:function(){A.set(this.containerNode,{padding:"0",margin:"0"});this.closeButtonNode.style.display=
"none";this.inherited(arguments)},_onKey:function(a){a.keyCode==z.ESCAPE&&dojo.stopEvent(a)},onHide:function(){this.destroyRecursive()},createContent:function(){var a=new dijit.layout.BorderContainer({style:"padding:0;width:400px;height:80px;",gutters:!1}),c=new dijit.Toolbar({region:"top",style:"outline:none!important;padding:2px;overflow:hidden;"}),b=da({project:this.project,exportUrl:this.exportUrl,dialogWidget:this});c.addChild(new dijit.form.Button({label:d.close,iconClass:"icon-16-container icon-16-close",
style:"outline:none!important;",onClick:dojo.hitch(this,"hide")}));c.addChild(new dijit.ToolbarSeparator);c.addChild(new dijit.form.Button({label:d.download,iconClass:"icon-16-container icon-16-import",style:"outline:none!important;",onClick:dojo.hitch(b,"submit")}));a.addChild(c);a.addChild(b);return a}});return q("buildspace.apps.Tendering.ProjectBreakdown",dijit.layout.BorderContainer,{region:"center",style:"padding:0px;width:100%;height:100%;",gutters:!1,rootProject:null,workArea:null,grid:null,
postCreate:function(){this.inherited(arguments);var a=new M,c=buildspace.billCurrencyAbbreviation?buildspace.billCurrencyAbbreviation:buildspace.currencyAbbreviation,b=this,m=[{name:"No.",field:"count",width:"30px",styles:"text-align:center;",formatter:Z},{name:d.description,field:"title",width:"auto",formatter:aa}];parseInt(String(this.rootProject.has_tender_alternative))&&m.push({name:d.tenderAlternative,field:"tender_alternative_count",styles:"text-align: center;",width:"68px",formatter:a.tenderAlternativeInfoCellFormatter,
noresize:!0});parseInt(String(this.rootProject.has_addendum))&&m.push({name:d.addendum,field:"addendum_version",styles:"text-align: center;",width:"68px",formatter:a.addendumInfoCellFormatter,noresize:!0});dojo.forEach([{name:d.originalAmount,field:"original_total",width:"150px",styles:"text-align: right;",formatter:a.unEditableCurrencyCellFormatter},{name:d.total+" "+d.markup+" (%)",field:"original_total",width:"100px",styles:"text-align: right;",formatter:a.elementTotalMarkupPercentageCellFormatter},
{name:d.total+" "+d.markup+" ("+c+")",field:"original_total",width:"120px",styles:"text-align: right;",formatter:a.elementTotalMarkupAmountCellFormatter},{name:d.overallTotal,field:"overall_total_after_markup",width:"150px",styles:"text-align: right;",formatter:a.unEditableCurrencyCellFormatter},{name:"% "+d.project,field:"overall_total_after_markup",width:"80px",styles:"text-align: center;",formatter:a.projectBreakdownJobPercentageCellFormatter},{name:d.recalculate,field:"recalculate",width:"80px",
styles:"text-align: center;",formatter:a.recalculateBillCellFormatter}],function(f){m.push(f)});var g=this.grid=Y({rootProject:this.rootProject,workArea:this.workArea,currencySetting:c,structure:m,store:new dojo.data.ItemFileWriteStore({clearOnClose:!0,url:"tendering/getProjectBreakdown/id/"+this.rootProject.id})});a=new dijit.Toolbar({region:"top",style:"outline:none!important;border:none;padding:2px;width:100%;"});a.addChild(new dijit.form.Button({label:d.importRates,id:b.rootProject.id+"ImportRatesRow-button",
iconClass:"icon-16-container icon-16-container icon-16-import",disabled:!1,onClick:function(){buildspace.app.launch({__children:[],icon:"project_import_rates",id:b.rootProject.id+"-project_import_rates",is_app:!0,level:0,sysname:"ProjectImportRates",title:d.importRates},{type:buildspace.constants.STATUS_TENDERING,project:b.rootProject})}}));switch(parseInt(String(b.rootProject.tender_type_id))){case buildspace.constants.TENDER_TYPE_TENDERED:parseInt(String(b.rootProject.status_id))==buildspace.constants.STATUS_TENDERING&&
(a.addChild(new dijit.ToolbarSeparator),a.addChild(new dijit.form.Button({id:b.rootProject.id+"AddTenderAlternative-button",label:d.addTenderAlternative,iconClass:"icon-16-container icon-16-add",style:"outline:none!important;",onClick:function(){var f=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});f.show().then(function(){dojo.xhrGet({url:"getProjectRevisionInfo/"+String(b.rootProject.id),handleAs:"json",sync:!0,preventCache:!0}).then(function(h){f.hide();!h.locked_status&&
h.current_selected_revision?(new V({tenderAlternativeId:-1,project:b.rootProject,projectBreakdownGrid:g})).show():buildspace.dialog.alert(d.tenderAlternativeAlert,d.projectRevisionAlertDesc,100,300)})})}})));a.addChild(new dijit.ToolbarSeparator);a.addChild(new dijit.form.Button({id:b.rootProject.id+"ViewTendererRow-button",label:d.viewTenderers,disabled:!parseInt(String(b.rootProject.show_contractor_rates)),iconClass:"icon-16-container icon-16-messenger",onClick:dojo.hitch(b,"_viewTenderers")}));
break;case buildspace.constants.TENDER_TYPE_PARTICIPATED:a.addChild(new dijit.ToolbarSeparator),a.addChild(new dijit.form.Button({id:b.rootProject.id+"RationalizeRatesRow-button",label:d.compareRationalizedRates,iconClass:"icon-16-container icon-16-list",onClick:function(){buildspace.app.launch({__children:[],icon:"rationalize_rate",id:b.rootProject.id+"-rationalize_rate",is_app:!0,level:0,sysname:"RationalizeRate",title:d.compareRationalizedRates},{type:buildspace.constants.STATUS_IMPORT,project:b.rootProject})}}))}var e=
new x({style:"display: none;"}),k;dojo.forEach([{id:"printToPdf",sub_menus:[{id:"withPrice"},{id:"withoutPrice"}]},{id:"exportToExcel",sub_menus:[]}],function(f){if(0<f.sub_menus.length){var h=new T;dojo.forEach(f.sub_menus,function(p){h.addChild(new u({label:d[p.id],onClick:dojo.hitch(b,"printToPdf",p.id)}))});k=new U({label:d[f.id],iconClass:"icon-16-container icon-16-print",popup:h})}else k=new u({label:d[f.id],iconClass:"icon-16-container icon-16-spreadsheet",onClick:dojo.hitch(b,f.id)});e.addChild(k)});
a.addChild(new dijit.ToolbarSeparator);a.addChild(new w({label:d.projectSummary,iconClass:"icon-16-container icon-16-list",style:"outline:none!important;",dropDown:e}));var l=new x({style:"display: none;"});dojo.forEach(["withPrice","withoutPrice"],function(f){return l.addChild(new u({label:d[f],onClick:dojo.hitch(b,"_printFinalBQ","withPrice"===f)}))});a.addChild(new dijit.ToolbarSeparator);a.addChild(new w({label:d.printFinalBQ,iconClass:"icon-16-container icon-16-print",style:"outline:none!important;",
dropDown:l}));a.addChild(new dijit.ToolbarSeparator);a.addChild(new dijit.form.Button({id:b.rootProject.id+"ExportItemFromBillRow-button",label:d.exportBill,iconClass:"icon-16-container icon-16-export",disabled:-1>=g.selection.selectedIndex,onClick:function(f){-1<g.selection.selectedIndex&&(f=g.getItem(g.selection.selectedIndex),(new y({project:b.rootProject,bill:f,onSuccess:dojo.hitch(b,"_openExportExcelBillDialog",f),onClickErrorNode:function(h,p){switch(parseInt(String(h.type))){case buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_BILL:parseInt(String(h.bill_status))==
buildspace.apps.ProjectBuilder.ProjectStructureConstants.BILL_STATUS_OPEN&&b.workArea.initTab(h,{billId:parseInt(String(h.id)),billType:parseInt(String(h.bill_type)),billLayoutSettingId:h.billLayoutSettingId,projectBreakdownGrid:g,rootProject:b.rootProject});break;case buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SUPPLY_OF_MATERIAL_BILL:b.workArea.initTab(h,{billId:parseInt(String(h.id)),somBillLayoutSettingId:h.somBillLayoutSettingId,projectBreakdownGrid:g,rootProject:b.rootProject});
break;case buildspace.apps.ProjectBuilder.ProjectStructureConstants.TYPE_SCHEDULE_OF_RATE_BILL:b.workArea.initTab(h,{billId:parseInt(String(h.id)),sorBillLayoutSettingId:h.sorBillLayoutSettingId,projectBreakdownGrid:g,rootProject:b.rootProject})}}})).show())}}));a.addChild(new dijit.ToolbarSeparator);a.addChild(new dijit.form.Button({id:b.rootProject.id+"BackupRow-button",label:d.exportBackup,iconClass:"icon-16-container icon-16-export",disabled:-1<g.selection.selectedIndex?!1:!0,onClick:function(f){-1<
g.selection.selectedIndex&&(f=g.getItem(g.selection.selectedIndex),(new S({bill:f,project:b.rootProject,exportUrl:"projectBackup/index"})).show())}}));a.addChild(new dijit.ToolbarSeparator);a.addChild(new dijit.form.Button({label:d.exportEstimateRates,id:"exportEstimateRates-button",iconClass:"icon-16-container icon-16-export",onClick:function(){ea({project:b.rootProject,exportUrl:"exportEstimateRates/exportEstimateRatesByProject"}).show()}}));[c]=this.rootProject.can_add_addendum_bills;const n=new x({style:"display: none;"});
n.addChild(new u({label:d.normalBill,onClick:function(f){-1<g.selection.selectedIndex&&g.openBillForm(g.selection.selectedIndex)}}));a.addChild(new w({id:b.rootProject.id+"AddBillRow-button",label:d.addBill,iconClass:"icon-16-container icon-16-add",dropDown:n,disabled:!0,style:Object.entries({outline:"none!important",...(!c&&{display:"none"})}).map(([f,h])=>`${f}:${h}`).join(";")}));a.addChild(new dijit.form.Button({id:b.rootProject.id+"DeleteRow-button",label:d.delete,iconClass:"icon-16-container icon-16-delete",
disabled:!0,style:Object.entries({outline:"none!important",...(!c&&{display:"none"})}).map(([f,h])=>`${f}:${h}`).join(";"),onClick:function(){if(-1<g.selection.selectedIndex){var f=g.getItem(g.selection.selectedIndex);f&&0<parseInt(String(f.id))&&(parseInt(String(f.type))==buildspace.apps.Tendering.ProjectStructureConstants.TYPE_BILL||parseInt(String(f.type))==buildspace.apps.Tendering.ProjectStructureConstants.TYPE_SUPPLY_OF_MATERIAL_BILL||parseInt(String(f.type))==buildspace.apps.Tendering.ProjectStructureConstants.TYPE_SCHEDULE_OF_RATE_BILL||
parseInt(String(f.type))==buildspace.apps.Tendering.ProjectStructureConstants.TYPE_LEVEL)&&g.deleteRow(f)}}}));a.addChild(new dijit.ToolbarSeparator);a.addChild(new dijit.form.Button({id:b.rootProject.id+"LogRateRow-button",label:"Log",iconClass:"icon-16-container icon-16-diary",onClick:function(f){dojo.xhrGet({url:"tendering/getProjectRateLogCount",handleAs:"json",content:{pid:b.rootProject.id}}).then(function(h){(new R({project:b.rootProject,logData:h})).show()})}}));a.addChild(new dijit.ToolbarSeparator);
a.addChild(new dijit.form.Button({id:b.rootProject.id+"ReloadGridRow-button",label:d.reload,iconClass:"icon-16-container icon-16-reload",onClick:function(f){g.reload()}}));this.addChild(a);this.addChild(g)},_printFinalBQ:function(a){var c=this,b=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."}),m=dojo.xhrGet({url:"getTenderAlternatives/"+String(this.rootProject.id)+"/1",handleAs:"json"});b.show().then(function(){m.then(function(g){b.hide();2<g.items.length?(c.rootProject.has_tender_alternative=
1,g=new v({project:c.rootProject,workArea:c.workArea,type:"printFinalBQ",opt:{withPrice:a}})):g=new W({title:d.printFinalBQ+" ("+(a?d.withPrice:d.withoutPrice)+")",project:c.rootProject,withPrice:a});g.show()})})},_viewTenderers:function(){var a=this,c=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."}),b=dojo.xhrGet({url:"getTenderAlternatives/"+String(this.rootProject.id)+"/1",handleAs:"json"});c.show().then(function(){b.then(function(m){c.hide();2<m.items.length?(a.rootProject.has_tender_alternative=
1,(new v({project:a.rootProject,workArea:a.workArea,type:"viewTenderer"})).show()):buildspace.app.launch({__children:[],icon:"view_tenderer",id:String(a.rootProject.id)+"-view_tenderer",is_app:!0,level:0,sysname:"ViewTenderer",title:d.viewTenderers},{type:buildspace.constants.STATUS_TENDERING,project:a.rootProject})})})},_openExportExcelBillDialog:function(a){switch(parseInt(String(a.type))){case buildspace.apps.Tendering.ProjectStructureConstants.TYPE_SUPPLY_OF_MATERIAL_BILL:(new P({bill:a})).show();
break;case buildspace.apps.Tendering.ProjectStructureConstants.TYPE_SCHEDULE_OF_RATE_BILL:(new Q({bill:a})).show();break;default:(new O({bill:a})).show()}},exportToExcel:function(){var a=this,c=this.grid,b=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."}),m=dojo.xhrGet({url:"getTenderAlternatives/"+String(this.rootProject.id)+"/1",handleAs:"json"});b.show().then(function(){m.then(function(g){b.hide();2<g.items.length?(a.rootProject.has_tender_alternative=1,g=new v({project:a.rootProject,
workArea:a.workArea,type:"exportExcel"})):(a.rootProject.has_tender_alternative=0,g=new y({project:a.rootProject,onSuccess:dojo.hitch(a,"_exportToExcel"),onClickErrorNode:function(e,k){switch(parseInt(String(e.type))){case buildspace.apps.Tendering.ProjectStructureConstants.TYPE_BILL:parseInt(String(e.bill_status))==buildspace.apps.Tendering.ProjectStructureConstants.BILL_STATUS_OPEN&&a.workArea.initTab(e,{billId:parseInt(String(e.id)),billType:parseInt(String(e.bill_type)),billLayoutSettingId:e.billLayoutSettingId,
projectBreakdownGrid:c,rootProject:a.rootProject});break;case buildspace.apps.Tendering.ProjectStructureConstants.TYPE_SUPPLY_OF_MATERIAL_BILL:a.workArea.initTab(e,{billId:parseInt(String(e.id)),somBillLayoutSettingId:e.somBillLayoutSettingId,projectBreakdownGrid:c,rootProject:a.rootProject});break;case buildspace.apps.Tendering.ProjectStructureConstants.TYPE_SCHEDULE_OF_RATE_BILL:a.workArea.initTab(e,{billId:parseInt(String(e.id)),sorBillLayoutSettingId:e.sorBillLayoutSettingId,projectBreakdownGrid:c,
rootProject:a.rootProject})}}}));g.show()})})},_exportToExcel:function(){ca({project:this.rootProject}).show()},printToPdf:function(a){var c=this,b=this.grid,m=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."}),g=dojo.xhrGet({url:"getTenderAlternatives/"+String(this.rootProject.id)+"/1",handleAs:"json"});m.show().then(function(){g.then(function(e){m.hide();2<e.items.length?(c.rootProject.has_tender_alternative=1,e=new v({project:c.rootProject,workArea:c.workArea,type:"printPdf",
opt:a})):(c.rootProject.has_tender_alternative=0,e=new y({project:c.rootProject,onSuccess:dojo.hitch(c,"_printToPdf",a),onClickErrorNode:function(k,l){switch(parseInt(String(k.type))){case buildspace.apps.Tendering.ProjectStructureConstants.TYPE_BILL:parseInt(String(k.bill_status))==buildspace.apps.Tendering.ProjectStructureConstants.BILL_STATUS_OPEN&&c.workArea.initTab(k,{billId:parseInt(String(k.id)),billType:parseInt(String(k.bill_type)),billLayoutSettingId:k.billLayoutSettingId,projectBreakdownGrid:b,
rootProject:c.rootProject});break;case buildspace.apps.Tendering.ProjectStructureConstants.TYPE_SUPPLY_OF_MATERIAL_BILL:c.workArea.initTab(k,{billId:parseInt(String(k.id)),somBillLayoutSettingId:k.somBillLayoutSettingId,projectBreakdownGrid:b,rootProject:c.rootProject});break;case buildspace.apps.Tendering.ProjectStructureConstants.TYPE_SCHEDULE_OF_RATE_BILL:c.workArea.initTab(k,{billId:parseInt(String(k.id)),sorBillLayoutSettingId:k.sorBillLayoutSettingId,projectBreakdownGrid:b,rootProject:c.rootProject})}}}));
e.show()})})},_printToPdf:function(a){window.open("ProjectSummaryPdf/"+this.rootProject.id+"/"+this.rootProject._csrf_token+"/"+a,"_blank");return window.focus()}})});
