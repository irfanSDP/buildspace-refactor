define("buildspace/apps/Tendering/BillManager/buildUpFloorAreaDialog","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-attr dojox/grid/enhanced/plugins/Menu dojox/grid/enhanced/plugins/Selector dojox/grid/enhanced/plugins/Rearrange buildspace/widget/grid/plugins/FormulatedColumn dojo/_base/event dojo/keys dojo/currency dijit/focus dojo/request/xhr dijit/PopupMenuItem buildspace/widget/grid/cells/Select buildspace/widget/grid/cells/Textarea buildspace/widget/grid/cells/FormulaTextBox dojo/when dojo/html dojo/dom dojo/dom-style buildspace/widget/grid/cells/Formatter ./buildUpFloorAreaSummary dojo/i18n!buildspace/nls/BuildUpFloorArea".split(" "),
function(m,n,B,C,D,E,q,r,t,p,F,l,G,H,I,J,K,L,u,M,v,w,x,d){var z=m("buildspace.apps.Tendering.BillManager.BuildUpFloorArea.grid",dojox.grid.EnhancedGrid,{billColumnSettingId:null,style:"border-top:none;",selectedItem:null,keepSelection:!0,rowSelector:"0px",addUrl:null,updateUrl:null,deleteUrl:null,pasteUrl:null,buildUpSummaryWidget:null,type:null,constructor:function(a){this.rearranger=q(this,{});this.formulatedColumn=r(this,{})},canSort:function(a){return!1},postCreate:function(){var a=this;a.inherited(arguments);
this.on("RowContextMenu",function(b){a.selection.clear();var c=a.getItem(b.rowIndex);a.selection.setSelected(b.rowIndex,!0);a.contextMenu(b);0<c.id?a.disableToolbarButtons(!1):a.disableToolbarButtons(!0,["Add"])},!0);this.on("RowClick",function(b){(b=a.getItem(b.rowIndex))&&0<b.id?a.disableToolbarButtons(!1):a.disableToolbarButtons(!0,["Add"])})},doApplyCellEdit:function(a,b,c){var f=this,e=f.getItem(b),d=f.store;if(a!==e[c][0]){var g=c.replace("-value","");-1!==c.indexOf("-value")&&(a=this.formulatedColumn.convertRowIndexToItemId(a,
b));var g={id:e.id,attr_name:g,val:a,type:f.type,_csrf_token:e._csrf_token?e._csrf_token:null},h=this.updateUrl;e.id==buildspace.constants.GRID_LAST_ROW&&(h=0<b?f.getItem(b-1):!1,n.mixin(g,{prev_item_id:h?h.id:0,relation_id:e.relation_id,bill_column_setting_id:f.billColumnSettingId}),h=this.addUrl);var y=function(a,b){for(var c in a)e.hasOwnProperty(c)&&c!=b._getIdentifierAttribute()&&b.setValue(e,c,a[c]),dojo.forEach(a.affected_nodes,function(a){b.fetchItemByIdentity({identity:a.id,onItem:function(c){for(var f in a)e.hasOwnProperty(f)&&
f!=b._getIdentifierAttribute()&&b.setValue(c,f,a[f])}})});b.save()};dojo.xhrPost({url:h,content:g,handleAs:"json",load:function(a){if(a.success){0<e.id?y(a.data,d):(d.deleteItem(e),d.save(),dojo.forEach(a.items,function(a){d.newItem(a)}),d.save(),f.disableToolbarButtons(!0));f.updateTotalBuildUp(a.total_build_up);var g=f.getCellByField(c);window.setTimeout(function(){f.focus.setFocusIndex(b,g.index)},10)}},error:function(a){console.log(a)}})}f.inherited(arguments)},dodblclick:function(a){},addRow:function(a){l.curNode.blur();
l.curNode=null;var b=this,c=buildspace.dialog.indeterminateProgressBar({title:d.addingRow+". "+d.pleaseWait+"..."}),f=b.store,e=b.getItem(a);if(0<e.id)e={before_id:e.id,type:b.type,_csrf_token:e._csrf_token,bill_column_setting_id:b.billColumnSettingId,relation_id:e.relation_id};else var k=0<a?b.getItem(a-1).id:0,e={id:e.id,type:b.type,prev_item_id:k,relation_id:e.relation_id,bill_column_setting_id:b.billColumnSettingId,_csrf_token:e._csrf_token};c.show();dojo.xhrPost({url:this.addUrl,content:e,handleAs:"json",
load:function(e){e.success&&dojo.forEach(e.items,function(c){0<c.id&&(c=f.newItem(c),f.save(),c=b.getItemIndex(c),b.rearranger.moveRows([c],a),b.selection.clear())});window.setTimeout(function(){b.selection.setSelected(a,!0);b.focus.setFocusIndex(a,1)},30);c.hide()},error:function(a){b.selection.clear();b.disableToolbarButtons(!0);c.hide()}})},deleteRow:function(a){var b=this,c=b.getItem(a),f=buildspace.dialog.indeterminateProgressBar({title:d.deleting+". "+d.pleaseWait+"..."});l.curNode.blur();l.curNode=
null;f.show();dojo.xhrPost({url:this.deleteUrl,content:{id:c.id,_csrf_token:c._csrf_token},handleAs:"json",load:function(e){if(e.success){var d=e.affected_nodes,g=b.store;g.deleteItem(c);g.save();var h=0;for(e=d.length;h<e;++h)g.fetchItemByIdentity({identity:d[h].id,onItem:function(a){for(var b in d[h])a.hasOwnProperty(b)&&b!=g._getIdentifierAttribute()&&g.setValue(a,b,d[h][b]);g.save()}});b.updateTotalBuildUp()}f.hide();b.selection.clear();window.setTimeout(function(){b.focus.setFocusIndex(a,0)},
10);b.disableToolbarButtons(!0);b.selectedItem=null;b.pasteOp=null},error:function(a){b.selection.clear();b.disableToolbarButtons(!0);b.selectedItem=null;b.pasteOp=null;f.hide()}})},cutItems:function(){this.selectedItem=this.selection.getFirstSelected();this.pasteOp="cut";var a=dijit.byId("buildUpFloorAreaGrid-"+this.billColumnSettingId+"_PasteRow-button");this.selectedItem&&a._setDisabledAttr(!1)},copyItems:function(){this.selectedItem=this.selection.getFirstSelected();this.pasteOp="copy";var a=
dijit.byId("buildUpFloorAreaGrid-"+this.billColumnSettingId+"_PasteRow-button");this.selectedItem&&a._setDisabledAttr(!1)},pasteItem:function(a){var b=this,c=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."}),f=b.store,e=b.selection.getFirstSelected(),k=e.id==buildspace.constants.GRID_LAST_ROW&&0<a?b.getItem(a-1).id:0;c.show();dojo.xhrPost({url:this.pasteUrl,content:{type:b.pasteOp,target_id:e.id,id:b.selectedItem.id,prev_item_id:k,_csrf_token:b.selectedItem._csrf_token},handleAs:"json",
load:function(e){var d=[];if(e.success)switch(b.pasteOp){case "cut":f.fetchItemByIdentity({identity:e.data.id,onItem:function(c){c=b.getItemIndex(c);d.push(c);0<d.length&&b.rearranger.moveRows(d,a);b.selectAfterPaste(c>a?a:a-1,!0)}});break;case "copy":e=f.newItem(e.data),f.save(),e=b.getItemIndex(e),d.push(e),0<d.length&&(b.rearranger.moveRows(d,a),b.selectAfterPaste(a,!1)),b.updateTotalBuildUp()}b.pasteOp=null;b.disableToolbarButtons(!1);d.length=0;c.hide()},error:function(a){b.selection.clear();
b.selectedItem=null;b.pasteOp=null;b.disableToolbarButtons(!0);c.hide()}})},selectAfterPaste:function(a,b){this.selection.clear();this.selectedItem=null;this.selection.setSelected(a,!0);b&&this.scrollToRow(0<a-3?a-3:a)},contextMenu:function(a){var b=this.rowCtxMenu=new dijit.Menu;this.contextMenuItems(a);var c={target:a.target,coords:a.keyCode!==p.F10&&"pageX"in a?{x:a.pageX,y:a.pageY}:null},d=this.getItem(a.rowIndex);b&&d&&(this.selection.isSelected(a.rowIndex)||a.rowNode&&u.hasClass(a.rowNode,"dojoxGridRowbar"))&&
(b._openMyself(c),t.stop(a))},contextMenuItems:function(a){var b=this.getItem(a.rowIndex);0<b.id&&(this.rowCtxMenu.addChild(new dijit.MenuItem({label:d.cut,iconClass:"icon-16-container icon-16-cut",onClick:dojo.hitch(this,"cutItems")})),this.rowCtxMenu.addChild(new dijit.PopupMenuItem({label:d.copy,iconClass:"icon-16-container icon-16-copy",onClick:dojo.hitch(this,"copyItems")})));this.rowCtxMenu.addChild(new dijit.PopupMenuItem({label:d.paste,iconClass:"icon-16-container icon-16-paste",onClick:dojo.hitch(this,
"pasteItem",a.rowIndex),disabled:this.selectedItem?!1:!0}));this.rowCtxMenu.addChild(new dijit.MenuItem({label:d.addRow,iconClass:"icon-16-container icon-16-add",onClick:dojo.hitch(this,"addRow",a.rowIndex)}));0<b.id&&this.rowCtxMenu.addChild(new dijit.MenuItem({label:d.deleteRow,iconClass:"icon-16-container icon-16-delete",onClick:dojo.hitch(this,"deleteRow",a.rowIndex)}))},disableToolbarButtons:function(a,b){var c=dijit.byId("buildUpFloorAreaGrid-"+this.billColumnSettingId+"_AddRow-button"),d=dijit.byId("buildUpFloorAreaGrid-"+
this.billColumnSettingId+"_DeleteRow-button"),e=dijit.byId("buildUpFloorAreaGrid-"+this.billColumnSettingId+"_CopyRow-button"),k=dijit.byId("buildUpFloorAreaGrid-"+this.billColumnSettingId+"_CutRow-button"),g=dijit.byId("buildUpFloorAreaGrid-"+this.billColumnSettingId+"_PasteRow-button");c._setDisabledAttr(a);d._setDisabledAttr(a);e._setDisabledAttr(a);k._setDisabledAttr(a);this.selectedItem&&-1<this.selection.selectedIndex?g._setDisabledAttr(!1):g._setDisabledAttr(!0);if(a&&b instanceof Array){var h=
this;dojo.forEach(b,function(a){dijit.byId("buildUpFloorAreaGrid-"+h.billColumnSettingId+"_"+a+"Row-button")._setDisabledAttr(!1)})}},updateTotalBuildUp:function(){this.buildUpSummaryWidget.refreshTotalFloorArea()}}),A=m("buildspace.apps.Tendering.BillManager.BuildUpFloorAreaGrid",dijit.layout.BorderContainer,{style:"padding:0px;width:100%;height:100%;border:0px;",gutters:!1,billColumnSettingId:null,type:null,gridOpts:{},postCreate:function(){this.inherited(arguments);n.mixin(this.gridOpts,{billColumnSettingId:this.billColumnSettingId,
region:"center",type:this.type});var a=this.grid=new z(this.gridOpts),b=new dijit.Toolbar({region:"top",style:"padding:2px;border-bottom:none;width:100%;"});b.addChild(new dijit.form.Button({id:"buildUpFloorAreaGrid-"+this.billColumnSettingId+"_AddRow-button",label:d.addRow,iconClass:"icon-16-container icon-16-add",disabled:-1<a.selection.selectedIndex?!1:!0,onClick:function(){-1<a.selection.selectedIndex&&a.addRow(a.selection.selectedIndex)}}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({id:"buildUpFloorAreaGrid-"+
this.billColumnSettingId+"_DeleteRow-button",label:d.deleteRow,iconClass:"icon-16-container icon-16-delete",disabled:-1<a.selection.selectedIndex?!1:!0,onClick:function(){-1<a.selection.selectedIndex&&a.deleteRow(a.selection.selectedIndex)}}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({id:"buildUpFloorAreaGrid-"+this.billColumnSettingId+"_CutRow-button",label:d.cut,iconClass:"icon-16-container icon-16-cut",disabled:-1<a.selection.selectedIndex?!1:!0,onClick:function(){-1<
a.selection.selectedIndex&&a.cutItems()}}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({id:"buildUpFloorAreaGrid-"+this.billColumnSettingId+"_CopyRow-button",label:d.copy,iconClass:"icon-16-container icon-16-copy",disabled:-1<a.selection.selectedIndex?!1:!0,onClick:function(){-1<a.selection.selectedIndex&&a.copyItems()}}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({id:"buildUpFloorAreaGrid-"+this.billColumnSettingId+"_PasteRow-button",label:d.paste,
iconClass:"icon-16-container icon-16-paste",disabled:-1<a.selection.selectedIndex?!1:!0,onClick:function(){-1<a.selection.selectedIndex&&a.pasteItem(a.selection.selectedIndex)}}));this.addChild(b);this.addChild(new dijit.layout.ContentPane({style:"width:100%",content:a,region:"center"}))}});return m("buildspace.apps.Tendering.BillManager.BuildUpFloorAreaDialog",dijit.Dialog,{style:"padding:0px;margin:0px;",title:d.appName,billId:0,billColumnSettingId:0,columnSettingForm:null,buildRendering:function(){var a=
this.createContent();a.startup();this.content=a;this.inherited(arguments)},postCreate:function(){v.set(this.containerNode,{padding:"0px",margin:"0px"});this.closeButtonNode.style.display="none";this.inherited(arguments)},_onKey:function(a){a.keyCode==p.ESCAPE&&dojo.stopEvent(a)},onHide:function(){this.columnSettingForm.refreshColumn();this.destroyRecursive()},createContent:function(){var a=new dijit.layout.BorderContainer({style:"padding:0px;width:900px;height:450px;",gutters:!1}),b=new dijit.Toolbar({region:"top",
style:"outline:none!important;padding:2px;overflow:hidden;"});b.addChild(new dijit.form.Button({label:d.close,iconClass:"icon-16-container icon-16-close",style:"outline:none!important;",onClick:dojo.hitch(this,"hide")}));var c=new w,f=[{name:"No",field:"id",styles:"text-align:center;",width:"40px",formatter:c.rowCountCellFormatter},{name:d.description,field:"description",width:"auto",editable:!0,cellType:"buildspace.widget.grid.cells.Textarea"},{name:d.factor,field:"factor-value",width:"100px",styles:"text-align:right;",
editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:c.formulaNumberCellFormatter},{name:d.length,field:"length-value",width:"100px",styles:"text-align:right;",editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:c.formulaNumberCellFormatter},{name:d.width,field:"width-value",width:"100px",styles:"text-align:right;",editable:!0,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:c.formulaNumberCellFormatter},{name:d.total,field:"total",
width:"100px",styles:"text-align:right;",formatter:c.numberCellFormatter},{name:d.sign,field:"sign",width:"70px",styles:"text-align:center;",editable:!0,cellType:"dojox.grid.cells.Select",options:[buildspace.constants.SIGN_POSITIVE_TEXT,buildspace.constants.SIGN_NEGATIVE_TEXT],values:[buildspace.constants.SIGN_POSITIVE,buildspace.constants.SIGN_NEGATIVE],formatter:c.signCellFormatter}],e=dojo.data.ItemFileWriteStore({url:"billBuildUpFloorArea/getBuildUpFloorAreaItemList/bill_column_setting_id/"+this.billColumnSettingId,
clearOnClose:!0}),c=x({billId:this.billId,billColumnSettingId:this.billColumnSettingId,container:a,columnSettingForm:this.columnSettingForm,buildUpGridStore:e}),f=A({region:"center",billColumnSettingId:this.billColumnSettingId,gridOpts:{addUrl:"billBuildUpFloorArea/buildUpFloorAreaItemAdd",updateUrl:"billBuildUpFloorArea/buildUpFloorAreaItemUpdate",deleteUrl:"billBuildUpFloorArea/buildUpFloorAreaItemDelete",pasteUrl:"billBuildUpFloorArea/buildUpFloorAreaItemPaste",store:e,structure:f,buildUpSummaryWidget:c}}),
f=this.makeGridContainer(f,d.appName);a.addChild(b);a.addChild(c);a.addChild(f);return a},makeGridContainer:function(a,b){var c=this.billId,d=dijit.byId("billManager-buildUpFloorArea_"+c+"-stackContainer");d&&dijit.byId("billManager-buildUpFloorArea_"+c+"-stackContainer").destroyRecursive();var d=new dijit.layout.StackContainer({style:"width:100%;height:100%;border:0px;",region:"center",id:"billManager-buildUpFloorArea_"+c+"-stackContainer"}),e=new dijit.layout.ContentPane({title:b,content:a});d.addChild(e);
var e=new dijit.layout.StackController({region:"top",containerId:"billManager-buildUpFloorArea_"+c+"-stackContainer"}),e=new dijit.layout.ContentPane({style:"padding:0px;overflow:hidden;","class":"breadCrumbTrail",region:"top",content:e}),k=new dijit.layout.BorderContainer({style:"padding:0px;width:100%;height:100%;border:0px;",gutters:!1,region:"center"});k.addChild(d);k.addChild(e);dojo.subscribe("billManager-buildUpFloorArea_"+c+"-stackContainer-selectChild","",function(a){var b=dijit.byId("billManager-buildUpFloorArea_"+
c+"-stackContainer");if(b){var d=b.getChildren();a=dojo.indexOf(d,dijit.byId(a.id));for(a+=1;d.length>a;)b.removeChild(d[a]),d[a].destroyRecursive(!0),a+=1}});return k}})});
