define("buildspace/apps/Tendering/BillManager/BillPropertiesForm","dojo/_base/declare dojo/html dojo/dom dojo/dom-construct dojo/keys dojo/dom-style dojo/dom-attr dojo/dom-geometry dijit/form/Form dijit/form/RadioButton dijit/form/Select dijit/form/ValidationTextBox dijit/form/NumberTextBox dijit/form/CurrencyTextBox dojo/number dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/billPropertiesForm.html dojo/text!./templates/columnSettingsForm.html dojo/text!./templates/markupSettingsForm.html dojo/i18n!buildspace/nls/Tendering ./buildUpFloorAreaDialog".split(" "),
function(h,e,q,r,D,c,E,t,u,F,G,H,I,J,k,l,K,m,n,v,w,x,b,y,L){var z=h("buildspace.apps.Tendering.BillManager.MarkupSettingsForm",[l,m,n],{billId:-1,templateString:x,baseClass:"buildspace-form",nls:b,billElementObj:null,markupSettings:null,_csrf_token:0,region:"center",style:"padding:5px;overflow:auto;border:0px;height:146px;",constructor:function(){this.ROUNDING_TYPE_DISABLED=buildspace.constants.ROUNDING_TYPE_DISABLED;this.ROUNDING_TYPE_UPWARD=buildspace.constants.ROUNDING_TYPE_UPWARD;this.ROUNDING_TYPE_DOWNWARD=
buildspace.constants.ROUNDING_TYPE_DOWNWARD;this.ROUNDING_TYPE_NEAREST_WHOLE_NUMBER=buildspace.constants.ROUNDING_TYPE_NEAREST_WHOLE_NUMBER;this.ROUNDING_TYPE_NEAREST_TENTH=buildspace.constants.ROUNDING_TYPE_NEAREST_TENTH;this.ROUNDING_TYPE_DISABLED_TEXT=buildspace.constants.ROUNDING_TYPE_DISABLED_TEXT;this.ROUNDING_TYPE_UPWARD_TEXT=buildspace.constants.ROUNDING_TYPE_UPWARD_TEXT;this.ROUNDING_TYPE_DOWNWARD_TEXT=buildspace.constants.ROUNDING_TYPE_DOWNWARD_TEXT;this.ROUNDING_TYPE_NEAREST_WHOLE_NUMBER_TEXT=
buildspace.constants.ROUNDING_TYPE_NEAREST_WHOLE_NUMBER_TEXT;this.ROUNDING_TYPE_NEAREST_TENTH_TEXT=buildspace.constants.ROUNDING_TYPE_NEAREST_TENTH_TEXT;this.currencyAbbreviation=buildspace.billCurrencyAbbreviation?buildspace.billCurrencyAbbreviation:buildspace.currencyAbbreviation;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.setValues()},setValues:function(){this.elementMarkupEnabledNode.set("checked",this.markupSettings.element_markup_enabled);e.set(this.elementMarkupEnabledViewDivNode,
this.markupSettings.element_markup_enabled?b.yesCapital:b.noCapital);this.itemMarkupEnabledNode.set("checked",this.markupSettings.item_markup_enabled);e.set(this.itemMarkupEnabledViewDivNode,this.markupSettings.item_markup_enabled?b.yesCapital:b.noCapital);this.roundingTypeNode.set("value",this.markupSettings.rounding_type);var a=this.getRoundingTypeText();e.set(this.roundingTypeViewDivNode,a)},editElementMarkup:function(){c.set(this.editElementMarkupButton.domNode,"display","none");c.set(this.saveElementMarkupButton.domNode,
"display","");c.set(this.elementMarkupEnabledViewDivNode,"display","none");c.set(this.elementMarkupEnabledInputDivNode,"display","")},saveElementMarkup:function(){var a=this,d=buildspace.dialog.indeterminateProgressBar({title:b.savingData+"..."}),f=this.billElementObj;d.show();dojo.xhrPost({url:"billManager/billMarkupSettingUpdate",content:{bill_id:this.billId,type:"element","bill_markup_setting[element_markup_enabled]":this.elementMarkupEnabledNode.get("checked"),"bill_markup_setting[_csrf_token]":this._csrf_token},
handleAs:"json",load:function(g){if(1==g.success)c.set(a.editElementMarkupButton.domNode,"display",""),c.set(a.saveElementMarkupButton.domNode,"display","none"),c.set(a.elementMarkupEnabledViewDivNode,"display",""),c.set(a.elementMarkupEnabledInputDivNode,"display","none"),a.markupSettings=g.data,a.setValues(),f.reconstructBillContainer();else{g=g.errors;for(var b in g)a["error-"+b]&&e.set(a["error-"+b],g[b])}d.hide()},error:function(a){d.hide()}})},editItemMarkup:function(){c.set(this.editItemMarkupButton.domNode,
"display","none");c.set(this.saveItemMarkupButton.domNode,"display","");c.set(this.itemMarkupEnabledViewDivNode,"display","none");c.set(this.itemMarkupEnabledInputDivNode,"display","")},saveItemMarkup:function(){var a=this,d=buildspace.dialog.indeterminateProgressBar({title:b.savingData+"..."}),f=this.billElementObj;d.show();dojo.xhrPost({url:"billManager/billMarkupSettingUpdate",content:{bill_id:this.billId,type:"item","bill_markup_setting[item_markup_enabled]":this.itemMarkupEnabledNode.get("checked"),
"bill_markup_setting[_csrf_token]":this._csrf_token},handleAs:"json",load:function(b){if(1==b.success)c.set(a.editItemMarkupButton.domNode,"display",""),c.set(a.saveItemMarkupButton.domNode,"display","none"),c.set(a.itemMarkupEnabledViewDivNode,"display",""),c.set(a.itemMarkupEnabledInputDivNode,"display","none"),a.markupSettings=b.data,a.setValues(),f.reconstructBillContainer();else{b=b.errors;for(var g in b)a["error-"+g]&&e.set(a["error-"+g],b[g])}d.hide()},error:function(a){d.hide()}})},editRoundingType:function(){c.set(this.editRoundingTypeButton.domNode,
"display","none");c.set(this.saveRoundingTypeButton.domNode,"display","");c.set(this.roundingTypeViewDivNode,"display","none");c.set(this.roundingTypeInputDivNode,"display","")},saveRoundingType:function(){var a=this,d=buildspace.dialog.indeterminateProgressBar({title:b.savingData+"..."}),f=this.billElementObj;d.show();dojo.xhrPost({url:"billManager/billMarkupSettingUpdate",content:{bill_id:this.billId,type:"rounding","bill_markup_setting[rounding_type]":this.roundingTypeNode.get("value"),"bill_markup_setting[_csrf_token]":this._csrf_token},
handleAs:"json",load:function(b){1==b.success&&(c.set(a.editRoundingTypeButton.domNode,"display",""),c.set(a.saveRoundingTypeButton.domNode,"display","none"),c.set(a.editRoundingTypeButton.domNode,"display",""),c.set(a.saveRoundingTypeButton.domNode,"display","none"),c.set(a.roundingTypeViewDivNode,"display",""),c.set(a.roundingTypeInputDivNode,"display","none"),a.markupSettings=b.data,a.setValues(),f.reconstructBillContainer());d.hide()},error:function(a){d.hide()}})},getRoundingTypeText:function(){switch(this.markupSettings.rounding_type.toString()){case buildspace.constants.ROUNDING_TYPE_DISABLED:return buildspace.constants.ROUNDING_TYPE_DISABLED_TEXT;
case buildspace.constants.ROUNDING_TYPE_UPWARD:return buildspace.constants.ROUNDING_TYPE_UPWARD_TEXT;case buildspace.constants.ROUNDING_TYPE_DOWNWARD:return buildspace.constants.ROUNDING_TYPE_DOWNWARD_TEXT;case buildspace.constants.ROUNDING_TYPE_NEAREST_WHOLE_NUMBER:return buildspace.constants.ROUNDING_TYPE_NEAREST_WHOLE_NUMBER_TEXT;case buildspace.constants.ROUNDING_TYPE_NEAREST_TENTH:return buildspace.constants.ROUNDING_TYPE_NEAREST_TENTH_TEXT;default:return null}}}),B=h("buildspace.apps.Tendering.BillManager.ColumnSettingsForm",
[l,m,n],{count:0,billId:-1,columnSettingName:"",columnSettingQuantity:"",columnSettingRemeasurementQuantityEnabled:!1,columnSettingUseOriginalQuantity:!0,columnSettingTotalFloorAreaM2:0,columnSettingTotalFloorAreaFT2:0,columnSettingShowEstimatedTotalCost:!1,columnSettingFloorAreaHasBuildUp:!1,columnSettingFloorAreaUseMetric:!1,columnSettingFloorAreaDisplayMetric:!1,editMode:!1,columnId:-1,quantity:1,locked:!1,templateString:w,billElementObj:null,_csrf_token:0,postCreate:function(){this.inherited(arguments);
this.toggleEditableInputElements(this.editMode);this.setValues()},setValues:function(){this.nameNode.set("value",this.columnSettingName);this.quantityNode.set("value",this.columnSettingQuantity);this.totalFloorAreaM2Node.set("value",this.columnSettingTotalFloorAreaM2);this.totalFloorAreaFT2Node.set("value",this.columnSettingTotalFloorAreaFT2);this.remeasurementQuantityEnabledNode.set("checked",this.columnSettingRemeasurementQuantityEnabled);this.showEstimatedTotalCostNode.set("checked",this.columnSettingShowEstimatedTotalCost);
var a=this.columnSettingShowEstimatedTotalCost?b.yesCapital:b.noCapital;e.set(this.nameViewDivNode,this.columnSettingName);e.set(this.showEstimatedTotalCostViewDivNode,a);e.set(this.quantityViewDivNode,""+this.columnSettingQuantity+"");this.columnSettingFloorAreaUseMetric?(e.set(this.totalFloorAreaM2ViewDivNode,this.createBuildUpFloorAreaLinks("M2")),e.set(this.totalFloorAreaFT2ViewDivNode,""+this.columnSettingTotalFloorAreaFT2+"")):(e.set(this.totalFloorAreaM2ViewDivNode,""+this.columnSettingTotalFloorAreaM2+
""),e.set(this.totalFloorAreaFT2ViewDivNode,this.createBuildUpFloorAreaLinks("FT2")));this.columnSettingUseOriginalQuantity?(this.originalQtyNode.set("checked",!0),this.locked&&this.remeasurementQtyNode.set("disabled",!0)):(this.remeasurementQtyNode.set("checked",!0),this.locked&&this.originalQtyNode.set("disabled",!0));this.columnSettingFloorAreaDisplayMetric?this.floorAreaDisplayMetricNode.set("checked",!0):this.floorAreaDisplayImperialNode.set("checked",!0);this.toggleCheckUseMetric();this.editMode?
(c.set(this.editButton.domNode,"display","none"),c.set(this.saveButton.domNode,"display","")):(c.set(this.saveButton.domNode,"display","none"),c.set(this.editButton.domNode,"display",""))},toggleCheckUseMetric:function(){this.columnSettingFloorAreaUseMetric?this.floorAreaUseMetricNode.set("checked",!0):this.floorAreaUseImperialNode.set("checked",!0)},createBuildUpFloorAreaLinks:function(a){var d=this,c=null,c="M2"==a?this.columnSettingTotalFloorAreaM2:this.columnSettingTotalFloorAreaFT2;return r.create("a",
{onclick:function(){(new y({billColumnSettingId:d.columnId,billId:d.billId,columnSettingForm:d})).show();return!1},"class":"buildUpLink",href:"#",title:"Open Build Up Floor Area",innerHTML:c})},toggleEditableInputElements:function(a){var d=this,f=function(a){a?(c.set(d.remeasurementQuantityEnabledViewDivNode,"display","none"),c.set(d.showEstimatedTotalCostViewDivNode,"display","none"),c.set(d.remeasurementQuantityEnabledInputDivNode,"display",""),c.set(d.showEstimatedTotalCostInputDivNode,"display",
""),this.locked&&(c.set(d.nameViewDivNode,"display","none"),c.set(d.quantityViewDivNode,"display","none"),c.set(d.nameInputDivNode,"display",""),c.set(d.quantityInputDivNode,"display",""))):(c.set(d.nameInputDivNode,"display","none"),c.set(d.quantityInputDivNode,"display","none"),c.set(d.remeasurementQuantityEnabledInputDivNode,"display","none"),c.set(d.showEstimatedTotalCostInputDivNode,"display","none"),c.set(d.nameViewDivNode,"display",""),c.set(d.quantityViewDivNode,"display",""),c.set(d.remeasurementQuantityEnabledViewDivNode,
"display",""),c.set(d.showEstimatedTotalCostViewDivNode,"display",""));d.toggleFloorAreaInputDiv(a)};a?(f(!0),this.toggleFloorAreaDisplayMetric(!0),this.columnSettingRemeasurementQuantityEnabled?this.toggleUseOriginalQuantity(!0):this.toggleUseOriginalQuantity(!1)):(f(!1),e.set(this.remeasurementQuantityEnabledViewDivNode,this.columnSettingRemeasurementQuantityEnabled?b.yesCapital:b.noCapital),this.toggleUseOriginalQuantity(!1),this.toggleFloorAreaDisplayMetric(!1))},toggleUseOriginalQuantity:function(a){var d=
this,b=function(a){a?(c.set(d.originalQtyViewDivNode,"display","none"),c.set(d.remeasurementQtyViewDivNode,"display","none"),c.set(d.originalQtyInputDivNode,"display",""),c.set(d.remeasurementQtyInputDivNode,"display","")):(c.set(d.originalQtyInputDivNode,"display","none"),c.set(d.remeasurementQtyInputDivNode,"display","none"),c.set(d.originalQtyViewDivNode,"display","block"),c.set(d.remeasurementQtyViewDivNode,"display","block"))};a?b(!0):(b(!1),b=a=null,this.columnSettingRemeasurementQuantityEnabled&&
(a=this.columnSettingUseOriginalQuantity?"icon-16-container icon-16-checkmark2":"icon-16-container icon-16-cross",b=this.columnSettingUseOriginalQuantity?"icon-16-container icon-16-cross":"icon-16-container icon-16-checkmark2"),e.set(this.originalQtyViewDivNode,'<span class="dijitReset dijitInline dijitIcon '+a+'"></span>'),e.set(this.remeasurementQtyViewDivNode,'<span class="dijitReset dijitInline dijitIcon '+b+'"></span>'))},toggleFloorAreaInputDiv:function(a){a?this.columnSettingFloorAreaUseMetric?
(c.set(this.totalFloorAreaM2ViewDivNode,"display","none"),c.set(this.totalFloorAreaM2InputDivNode,"display",""),c.set(this.totalFloorAreaFT2ViewDivNode,"display",""),c.set(this.totalFloorAreaFT2InputDivNode,"display","none"),this.totalFloorAreaFT2Node.set("value",this.columnSettingTotalFloorAreaFT2),e.set(this["error-total_floor_area_ft2"],"")):(c.set(this.totalFloorAreaFT2ViewDivNode,"display","none"),c.set(this.totalFloorAreaFT2InputDivNode,"display",""),c.set(this.totalFloorAreaM2ViewDivNode,"display",
""),c.set(this.totalFloorAreaM2InputDivNode,"display","none"),this.totalFloorAreaM2Node.set("value",this.columnSettingTotalFloorAreaM2),e.set(this["error-total_floor_area_m2"],"")):(c.set(this.totalFloorAreaM2InputDivNode,"display","none"),c.set(this.totalFloorAreaM2ViewDivNode,"display",""),c.set(this.totalFloorAreaFT2InputDivNode,"display","none"),c.set(this.totalFloorAreaFT2ViewDivNode,"display",""))},toggleFloorAreaDisplayMetric:function(a){var d=this,b=function(a){a?(c.set(d.floorAreaDisplayMetricViewDivNode,
"display","none"),c.set(d.floorAreaDisplayImperialViewDivNode,"display","none"),c.set(d.floorAreaDisplayMetricInputDivNode,"display",""),c.set(d.floorAreaDisplayImperialInputDivNode,"display","")):(c.set(d.floorAreaDisplayMetricInputDivNode,"display","none"),c.set(d.floorAreaDisplayImperialInputDivNode,"display","none"),c.set(d.floorAreaDisplayMetricViewDivNode,"display",""),c.set(d.floorAreaDisplayImperialViewDivNode,"display",""))};a?b(!0):(b(!1),a=this.columnSettingFloorAreaDisplayMetric?"icon-16-container icon-16-cross":
"icon-16-container icon-16-checkmark2",e.set(this.floorAreaDisplayMetricViewDivNode,'<span class="dijitReset dijitInline dijitIcon '+(this.columnSettingFloorAreaDisplayMetric?"icon-16-container icon-16-checkmark2":"icon-16-container icon-16-cross")+'"></span>'),e.set(this.floorAreaDisplayImperialViewDivNode,'<span class="dijitReset dijitInline dijitIcon '+a+'"></span>'))},doEnableRemeasurementQuantity:function(){var a=this;this.remeasurementQuantityEnabledNode.get("checked")?a.toggleUseOriginalQuantity(!0):
this.columnSettingRemeasurementQuantityEnabled?buildspace.dialog.confirm(b.confirmation,"<div>"+b.detachAllQty2BuildUpAndLink+"</div>",60,280,function(){a.columnSettingRemeasurementQuantityEnabled=!1;a.toggleUseOriginalQuantity(!1)},function(){a.remeasurementQuantityEnabledNode.set("checked",!0);a.toggleUseOriginalQuantity(!0)}):a.toggleUseOriginalQuantity(!1)},edit:function(){c.set(this.editButton.domNode,"display","none");c.set(this.saveButton.domNode,"display","");this.editMode=!0;this.toggleEditableInputElements(!0)},
checkManualFloorArea:function(){var a=k.format(this.totalFloorAreaM2Node.get("value"),{places:2}),c=k.format(this.totalFloorAreaFT2Node.get("value"),{places:2});if(0<this.columnId&&this.columnSettingFloorAreaHasBuildUp&&(a!=this.columnSettingTotalFloorAreaM2||c!=this.columnSettingTotalFloorAreaFT2))return!0},save:function(){var a=this,c=function(){a.columnSettingFloorAreaHasBuildUp=!1;a.doSave()},f=function(){a.totalFloorAreaM2Node.set("value",a.columnSettingTotalFloorAreaM2);a.totalFloorAreaFT2Node.set("value",
a.columnSettingTotalFloorAreaFT2)};a.checkManualFloorArea()?buildspace.dialog.confirm(b.confirmation,"<div>"+b.detachAllBuildUpAndLink+"</div>",60,280,c,f):a.doSave()},doSave:function(){var a=this,d=buildspace.dialog.indeterminateProgressBar({title:b.savingData+"..."}),f=this.billElementObj;d.show();var g=this.originalQtyNode.get("checked")?!0:!1,p=this.floorAreaDisplayMetricNode.get("checked")?!0:!1,A=this.floorAreaUseMetricNode.get("checked")?!0:!1,g={id:this.columnId,"bill_column_setting[project_structure_id]":this.billId,
"bill_column_setting[name]":this.nameNode.get("value"),"bill_column_setting[quantity]":this.quantityNode.get("value"),"bill_column_setting[total_floor_area_m2]":this.totalFloorAreaM2Node.get("value"),"bill_column_setting[total_floor_area_ft2]":this.totalFloorAreaFT2Node.get("value"),"bill_column_setting[floor_area_display_metric]":p,"bill_column_setting[floor_area_use_metric]":A,"bill_column_setting[floor_area_has_build_up]":this.columnSettingFloorAreaHasBuildUp,"bill_column_setting[remeasurement_quantity_enabled]":this.remeasurementQuantityEnabledNode.get("checked"),
"bill_column_setting[show_estimated_total_cost]":this.showEstimatedTotalCostNode.get("checked"),"bill_column_setting[use_original_quantity]":g,"bill_column_setting[_csrf_token]":this._csrf_token};dojo.xhrPost({url:"billManager/billColumnSettingUpdate",content:g,handleAs:"json",load:function(b){e.set(a["error-name"],"");e.set(a["error-quantity"],"");e.set(a["error-total_floor_area_m2"],"");e.set(a["error-total_floor_area_ft2"],"");if(1==b.success)c.set(a.saveButton.domNode,"display","none"),c.set(a.editButton.domNode,
"display",""),a.editMode=!1,a.columnId=b.item.id,a.columnSettingName=b.item.name,a.columnSettingQuantity=b.item.quantity,a.columnSettingRemeasurementQuantityEnabled=b.item.remeasurement_quantity_enabled,a.columnSettingUseOriginalQuantity=b.item.use_original_quantity,a.columnSettingTotalFloorAreaFT2=k.format(b.item.total_floor_area_ft2,{places:2}),a.columnSettingTotalFloorAreaM2=k.format(b.item.total_floor_area_m2,{places:2}),a.columnSettingFloorAreaHasBuildUp=b.item.floor_area_has_build_up,a.columnSettingFloorAreaUseMetric=
b.item.floor_area_use_metric,a.columnSettingFloorAreaDisplayMetric=b.item.floor_area_display_metric,a.columnSettingShowEstimatedTotalCost=b.item.show_estimated_total_cost,a.setValues(),a.toggleEditableInputElements(!1),f.reconstructBillContainer();else{b=b.errors;for(var g in b)a["error-"+g]&&e.set(a["error-"+g],b[g])}d.hide()},error:function(a){d.hide()}})},refreshColumn:function(){var a=this,d=buildspace.dialog.indeterminateProgressBar({title:b.savingData+"..."}),f=this.billElementObj;d.show();
dojo.xhrPost({url:"billManager/getBillColumnSetting",content:{id:this.columnId},handleAs:"json",load:function(b){c.set(a.saveButton.domNode,"display","none");c.set(a.editButton.domNode,"display","");a.editMode=!1;a.columnId=b.item.id;a.columnSettingName=b.item.name;a.columnSettingQuantity=b.item.quantity;a.columnSettingRemeasurementQuantityEnabled=b.item.remeasurement_quantity_enabled;a.columnSettingUseOriginalQuantity=b.item.use_original_quantity;a.columnSettingTotalFloorAreaFT2=k.format(b.item.total_floor_area_ft2,
{places:2});a.columnSettingTotalFloorAreaM2=k.format(b.item.total_floor_area_m2,{places:2});a.columnSettingFloorAreaHasBuildUp=b.item.floor_area_has_build_up;a.columnSettingFloorAreaUseMetric=b.item.floor_area_use_metric;a.columnSettingFloorAreaDisplayMetric=b.item.floor_area_display_metric;a.columnSettingShowEstimatedTotalCost=b.item.show_estimated_total_cost;a.setValues();a.toggleEditableInputElements(!1);f.reconstructBillContainer();d.hide()},error:function(a){d.hide()}})},doChangeFloorAreaUseMetric:function(a){if(a&&
this.floorAreaUseMetricNode.get("checked")!=this.columnSettingFloorAreaUseMetric){var c=this;a=function(){c.toggleCheckUseMetric()};var f=function(){c.columnSettingFloorAreaUseMetric=c.floorAreaUseMetricNode.get("checked")?!0:!1},e=function(){c.columnSettingFloorAreaHasBuildUp=!1;f();this.editMode?c.toggleFloorAreaInputDiv(!0):c.doSave()};c.columnSettingFloorAreaHasBuildUp?buildspace.dialog.confirm(b.confirmation,"<div>"+b.detachAllBuildUpAndLink+"</div>",60,280,e,a):this.editMode?(f(),c.toggleFloorAreaInputDiv(!0)):
c.doSave()}}}),C=h("buildspace.apps.Tendering.BillManager.BillPropertiesMainInfoForm",[u,l,m,n,dojox.form.manager._Mixin,dojox.form.manager._NodeMixin,dojox.form.manager._ValueMixin,dojox.form.manager._DisplayMixin],{templateString:v,baseClass:"buildspace-form",region:"top",billId:-1,projectBreakdownGrid:null,formData:null,buildUpRateRoundingType:null,buildUpQuantityRoundingType:null,unitTypeText:null,description:null,nls:b,style:"padding:5px;overflow:auto;border:0px;height:140px;",constructor:function(){var a=
this.BillTypeConstantArray=[];this.ROUNDING_TYPE_DISABLED=buildspace.constants.ROUNDING_TYPE_DISABLED;this.ROUNDING_TYPE_UPWARD=buildspace.constants.ROUNDING_TYPE_UPWARD;this.ROUNDING_TYPE_DOWNWARD=buildspace.constants.ROUNDING_TYPE_DOWNWARD;this.ROUNDING_TYPE_NEAREST_WHOLE_NUMBER=buildspace.constants.ROUNDING_TYPE_NEAREST_WHOLE_NUMBER;this.ROUNDING_TYPE_NEAREST_TENTH=buildspace.constants.ROUNDING_TYPE_NEAREST_TENTH;this.ROUNDING_TYPE_DISABLED_TEXT=buildspace.constants.ROUNDING_TYPE_DISABLED_TEXT;
this.ROUNDING_TYPE_UPWARD_TEXT=buildspace.constants.ROUNDING_TYPE_UPWARD_TEXT;this.ROUNDING_TYPE_DOWNWARD_TEXT=buildspace.constants.ROUNDING_TYPE_DOWNWARD_TEXT;this.ROUNDING_TYPE_NEAREST_WHOLE_NUMBER_TEXT=buildspace.constants.ROUNDING_TYPE_NEAREST_WHOLE_NUMBER_TEXT;this.ROUNDING_TYPE_NEAREST_TENTH_TEXT=buildspace.constants.ROUNDING_TYPE_NEAREST_TENTH_TEXT;a[buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_STANDARD]=buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_STANDARD_TEXT;
a[buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_PRELIMINARY]=buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_PRELIMINARY_TEXT;a[buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_PROVISIONAL]=buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_PROVISIONAL_TEXT;a[buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_PROVISIONAL]=buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_PROVISIONAL_TEXT;a[buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_PRIMECOST]=
buildspace.apps.Tendering.ProjectStructureConstants.BILL_TYPE_PRIMECOST_TEXT;this.currencyAbbreviation=buildspace.billCurrencyAbbreviation?buildspace.billCurrencyAbbreviation:buildspace.currencyAbbreviation;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);var a;switch(String(this.formData["bill_setting[build_up_quantity_rounding_type]"])){case this.ROUNDING_TYPE_UPWARD:a=this.ROUNDING_TYPE_UPWARD_TEXT;break;case this.ROUNDING_TYPE_DOWNWARD:a=this.ROUNDING_TYPE_DOWNWARD_TEXT;
break;case this.ROUNDING_TYPE_NEAREST_WHOLE_NUMBER:a=this.ROUNDING_TYPE_NEAREST_WHOLE_NUMBER_TEXT;break;case this.ROUNDING_TYPE_NEAREST_TENTH:a=this.ROUNDING_TYPE_NEAREST_TENTH_TEXT;break;case this.ROUNDING_TYPE_DISABLED:a=this.ROUNDING_TYPE_DISABLED_TEXT;break;default:a=""}e.set(this.titleNode,this.formData["bill_setting[title]"]);e.set(this.descriptionNode,this.formData["bill_setting[description]"]);e.set(this.buildUpQuantityRoundingTypeNode,a);e.set(this.unitTypeTextNode,this.unitTypeText);e.set(this.billTypeTextNode,
this.BillTypeConstantArray[this.formData.billType])},disableForm:function(){return!0},submit:function(){var a=buildspace.dialog.indeterminateProgressBar({title:b.savingData+"..."}),c=this.billElementObj,f=this,g=dojo.formToObject(this.id);this.validate()&&(a.show(),dojo.xhrPost({url:"billManager/billPropertiesUpdate",content:g,handleAs:"json",load:function(b){dojo.query('[id^="error-bill_setting_"]').forEach(function(a){a.innerHTML=""});if(b.success)f.projectBreakdownGrid.store.fetchItemByIdentity({identity:b.item.id,
onItem:function(a){if(a){for(var d in b.item)a.hasOwnProperty(d)&&d!=f.projectBreakdownGrid.store._getIdentifierAttribute()&&f.projectBreakdownGrid.store.setValue(a,d,b.item[d]);f.projectBreakdownGrid.store.save();f.projectBreakdownGrid.reload();c.reconstructBillContainer()}}});else for(var d in b.errors){var g=b.errors[d];e.set(q.byId("error-bill_setting_"+d),g)}a.hide()},error:function(b){a.hide()}}))},startup:function(){this.inherited(arguments);this.setFormValues(this.formData)}});return h("buildspace.apps.Tendering.BillManager.BillPropertiesForm",
dijit.layout.BorderContainer,{style:"padding:0px;width:100%;margin:0px;border:0px;height:100%;overflow:auto;",gutters:!1,region:"center",billId:-1,projectBreakdownGrid:null,billElementObj:null,nls:b,totalColumnSettings:0,locked:!1,columnSettings_csrf_token:null,postCreate:function(){this.inherited(arguments);var a=this,c=buildspace.dialog.indeterminateProgressBar({title:b.pleaseWait+"..."});c.show();dojo.xhrGet({url:"billManager/billPropertiesForm",handleAs:"json",content:{id:this.billId},load:function(b){a.markupSettings_csrf_token=
b.markup_settings_csrf_token;a.columnSettings_csrf_token=b.column_settings_csrf_token;a.renderBillPropertiesInfoForm(b.bill_setting);a.renderMarkupSettings(b.markup_settings);a.renderBillColumnSettings(b.column_settings);a.resize();c.hide()},error:function(a){c.hide()}})},renderBillPropertiesInfoForm:function(a){a=this.mainForm=new C({billId:this.billId,projectBreakdownGrid:this.projectBreakdownGrid,unitTypeText:a.unit_type_text,billElementObj:this.billElementObj,formData:a});this.addChild(a)},renderMarkupSettings:function(a){this.addChild(new z({billId:this.billId,
billElementObj:this.billElementObj,markupSettings:a,_csrf_token:this.markupSettings_csrf_token}))},renderBillColumnSettings:function(a){var c=this,e=this.billId,g=this.billElementObj,p=this.columnSettings_csrf_token;h("ColumnSettingTableWidget",[l,m,n],{style:"padding:5px;overflow:auto;border:0px;overflow:auto;",region:"bottom",locked:c.locked,baseClass:"buildspace-form",totalColumnSettings:0,columnSettings:a,templateString:"<div><fieldset><legend>"+b.columnSettings+'</legend><div style="height:2px;">&nbsp;</div><table class="buildspace-table"><thead><tr class="gridHeader"><th class="gridCell" style="text-align:center;" rowspan="2">No.</th><th class="gridCell" rowspan="2">'+
b.name+'</th><th class="gridCell" style="text-align: center;" rowspan="2">'+b.totalUnit+'</th><th class="gridCell" style="text-align: center;" rowspan="2">'+b.enable+" "+b.qty+' (2)</th><th class="gridCell" style="text-align: center;" rowspan="2">'+b.use+" "+b.qty+'</th><th class="gridCell" style="text-align: center;" rowspan="2">'+b.use+" "+b.qty+' (2)</th><th class="gridCell" style="text-align: center;" colspan="7">'+b.gross+" "+b.floorArea+'</th><th class="gridCell" style="text-align: center;" rowspan="2">'+
b.action+'</th></tr><tr class="gridHeaderBottom"><th style="text-align:center;" colspan="2">'+b.metreSquare+'</th><th style="text-align:center;" colspan="2">'+b.squareFeet+'</th><th style="text-align:center;">'+b.show+" "+b.metreSquare+'</th><th style="text-align:center;">'+b.show+" "+b.squareFeet+'</th><th style="text-align:center;">'+b.show+" "+b.estimation+'</th></tr></thead><tbody id="columnSettingTbody-'+e+'" data-dojo-attach-point="columnSettingsTBody"></tbody></table></fieldset></div>',postCreate:function(){this.inherited(arguments);
var a=this,b=0;dojo.forEach(this.columnSettings,function(d,f){a.updateTotalColumnSettings(!0);b=a.totalColumnSettings;var h=new B({count:b,locked:c.locked,columnSettingName:d.name,columnSettingQuantity:d.quantity,columnSettingRemeasurementQuantityEnabled:d.remeasurement_quantity_enabled,columnSettingUseOriginalQuantity:d.use_original_quantity,columnSettingTotalFloorAreaM2:k.format(d.total_floor_area_m2,{places:2}),columnSettingTotalFloorAreaFT2:k.format(d.total_floor_area_ft2,{places:2}),columnSettingFloorAreaHasBuildUp:d.floor_area_has_build_up,
columnSettingFloorAreaUseMetric:d.floor_area_use_metric,columnSettingFloorAreaDisplayMetric:d.floor_area_display_metric,columnSettingShowEstimatedTotalCost:d.show_estimated_total_cost,columnId:d.id,billId:e,billElementObj:g,_csrf_token:p});h.placeAt(a.columnSettingsTBody);dojo.parser.parse(h.domNode)},a)},updateTotalColumnSettings:function(a){this.totalColumnSettings=a?this.totalColumnSettings+1:this.totalColumnSettings-1}});this.columnSettingsTable=new ColumnSettingTableWidget;this.addChild(this.columnSettingsTable)},
resize:function(){var a=t.getContentBox(this.domNode).h-265;this.columnSettingsTable&&c.set(this.columnSettingsTable.domNode,"height",a+"px");this.inherited(arguments)}})});
