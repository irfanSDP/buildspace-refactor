define("buildspace/apps/Tendering/WorkArea","dojo/_base/declare ./ProjectProperties ./ProjectBreakdown ./ProjectRevisionSettingsForm buildspace/apps/TenderAlternative/TenderAlternativeContainer dojo/i18n!buildspace/nls/Tendering".split(" "),function(h,l,m,n,k,g){var p=h("buildspace.apps.Tendering.ProjectRevisionContainer",dijit.layout.BorderContainer,{style:"padding:0px;width:100%;margin:0px;border:0px;height:100%;",gutters:!1,projectId:null,rootProject:null,workarea:null,postCreate:function(){this.inherited(arguments);
var a=this.projectRevisionSettingsForm=n({projectId:this.projectId,rootProject:this.rootProject,workarea:this.workarea});this.addChild(a)}});return h("buildspace.apps.Tendering.WorkArea",dijit.layout.TabContainer,{region:"center",style:"padding:0px;margin:0px;border:0px;width:100%;height:100%;",rootProject:null,postCreate:function(){this.inherited(arguments);var a=this,b=buildspace.dialog.indeterminateProgressBar({title:g.pleaseWait+"..."}),c=this.projectBreakdownTab=this.createProjectBreakdownTab(this.rootProject,
!0);b.show().then(function(){dojo.xhrGet({url:"tendering/mainInfoForm",content:{id:parseInt(String(a.rootProject.id))},handleAs:"json"}).then(function(d){b.hide();buildspace.currencyAbbreviation=buildspace.billCurrencyAbbreviation=d.currency;a.addChild(new l({title:g.projectProperties,rootProject:a.rootProject,id:"projectProperties-"+a.rootProject.id,data:d}),1);d=2;parseInt(String(a.rootProject.tender_type_id))&&parseInt(String(a.rootProject.has_tender_alternative))&&(a.addChild(new k({title:g.tenderAlternatives,
project:a.rootProject,id:String(a.rootProject.id)+"-form_1337",projectBreakdownGrid:c.grid,workArea:a}),2),d=3);a.addChild(new p({title:g.billRevisionSettings,id:String(a.rootProject.id)+"-ProjectRevision",projectId:parseInt(String(a.rootProject.id)),rootProject:a.rootProject,workarea:a}),d);a.selectChild(c);a.checkInprogressImportAddendum()})})},checkInprogressImportAddendum:function(){if(this.rootProject&&!isNaN(parseInt(String(this.rootProject.id)))&&parseInt(String(this.rootProject.tender_type_id))===
buildspace.constants.TENDER_TYPE_PARTICIPATED){var a=new dijit.ProgressBar({value:0,title:"Importing Addendum Bills",layoutAlign:"center"}),b=new dijit.Dialog({content:a,style:"background:#fff;padding:5px;height:78px;width:280px;",splitter:!1});b.closeButtonNode.style.display="none";b._onKey=function(c){c.keyCode==keys.ESCAPE&&dojo.stopEvent(c)};b.onHide=function(){b.destroyRecursive()};this.importAddendumProgress(b,a)}},importAddendumProgress:function(a,b){var c=this;dojo.xhrPost({url:"tendering/getImportAddendumBillProgress",
content:{id:parseInt(String(this.rootProject.id))},handleAs:"json",sync:!1,load:function(d){var e=parseInt(d.total_imported_bills),f=parseInt(d.total_bills);d.exists&&0<f&&e!=f?(a.open||a.show(),a.set({title:"Importing "+e+"/"+f+" Addendum Bills"}),b.set({value:e/f*100}),setTimeout(function(){c.importAddendumProgress(a,b)},5E3)):(a.open&&a.hide(),c.reloadProjectBreakdown(),setTimeout(function(){c.reloadRevision()},1E3))},error:function(d){a.open&&a.hide()}})},reloadProjectBreakdown:function(){var a=
dijit.byId("main-project_breakdown");a&&a.grid.reload();(a=dijit.byId(String(this.rootProject.id)+"-tenderAlternative-tenderAlternativeListGrid"))&&a.reload()},reloadRevision:function(){var a=dijit.byId(parseInt(String(this.rootProject.id))+"-ProjectRevision");a&&(dojo.empty(a.projectRevisionSettingsForm.tableContainer),a.projectRevisionSettingsForm.masterGenerateProjectRevisionTableRow())},createProjectBreakdownTab:function(a,b){var c=dijit.byId("main-project_breakdown");c&&(this.removeChild(c),
c.destroy());c=new m({id:"main-project_breakdown",title:g.projectBreakdown,rootProject:a,workArea:this});this.addChild(c,0);b&&this.selectChild(c);return this.projectBreakdownTab=c},createContentPaneTab:function(a,b,c,d,e){c=new dijit.layout.ContentPane({closable:d,id:a,style:"padding:0px;border:0px;margin:0px;overflow:hidden;",title:buildspace.truncateString(b,35),content:c});this.addChild(c);this.selectChild(c);c.pane_info={name:b,type:e,id:a}},removeBillTab:function(){var a=this.getChildren(),
b;for(b in a)"object"==typeof a[b].pane_info&&a[b].pane_info.type==buildspace.apps.Tendering.ProjectStructureConstants.TYPE_BILL&&(this.removeChild(a[b]),a[b].destroy())},initTab:function(a,b,c){var d=!1,e=this.getChildren(),f;for(f in e)"object"==typeof e[f].pane_info&&e[f].pane_info.id==a.id+"-form_"+a.type&&(d=!0,this.selectChild(e[f]));d||this.makeTab(a,b,"undefined"===typeof c||c?!0:!1)},removeTabByType:function(a){var b=this.getChildren(),c;for(c in b)"object"==typeof b[c].pane_info&&b[c].pane_info.type==
a&&(this.removeChild(b[c]),b[c].destroy())},makeTab:function(a,b,c){switch(parseInt(a.type)){case buildspace.apps.Tendering.ProjectStructureConstants.TYPE_BILL:var d=buildspace.apps.Tendering.getBillTypeText(a.bill_type);b=new buildspace.apps.Tendering.BillManager(b);var e=a.id+"-form_"+a.type;d=buildspace.truncateString(a.title,35)+" :: "+d;break;case buildspace.apps.Tendering.ProjectStructureConstants.TYPE_SUPPLY_OF_MATERIAL_BILL:b=new buildspace.apps.Tendering.SupplyOfMaterialBillManager(b);e=
a.id+"-form_"+a.type;d=buildspace.truncateString(a.title,35);break;case buildspace.apps.Tendering.ProjectStructureConstants.TYPE_SCHEDULE_OF_RATE_BILL:b=new buildspace.apps.Tendering.ScheduleOfRateBillManager(b);e=a.id+"-form_"+a.type;d=buildspace.truncateString(a.title,35);break;case 9999999:b=new buildspace.apps.Tendering.SubPackages(b);e=a.id+"-form_"+a.type;d=g.subPackages;break;case 1337:return a=dijit.byId("main-project_breakdown"),b=new k({title:g.tenderAlternatives,project:this.rootProject,
id:this.rootProject.id+"-form_1337",projectBreakdownGrid:a.grid,editable:b.editable,workArea:this}),this.addChild(b,2),this.selectChild(b),!0;default:b=null,e=a.id+"-form_"+a.type,d=buildspace.truncateString(a.title,35)}this.createContentPaneTab(e,d,b,c,a.type)}})});
