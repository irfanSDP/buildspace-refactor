var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(b){var c=0;return function(){return c<b.length?{done:!1,value:b[c++]}:{done:!0}}};$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,c,d){if(b==Array.prototype||b==Object.prototype)return b;b[c]=d.value;return b};$jscomp.getGlobal=function(b){b=["object"==typeof globalThis&&globalThis,b,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var c=0;c<b.length;++c){var d=b[c];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(b,c){var d=$jscomp.propertyToPolyfillSymbol[c];if(null==d)return b[c];d=b[d];return void 0!==d?d:b[c]};
$jscomp.polyfill=function(b,c,d,h){c&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(b,c,d,h):$jscomp.polyfillUnisolated(b,c,d,h))};$jscomp.polyfillUnisolated=function(b,c,d,h){d=$jscomp.global;b=b.split(".");for(h=0;h<b.length-1;h++){var l=b[h];if(!(l in d))return;d=d[l]}b=b[b.length-1];h=d[b];c=c(h);c!=h&&null!=c&&$jscomp.defineProperty(d,b,{configurable:!0,writable:!0,value:c})};
$jscomp.polyfillIsolated=function(b,c,d,h){var l=b.split(".");b=1===l.length;h=l[0];h=!b&&h in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var n=0;n<l.length-1;n++){var u=l[n];if(!(u in h))return;h=h[u]}l=l[l.length-1];d=$jscomp.IS_SYMBOL_NATIVE&&"es6"===d?h[l]:null;c=c(d);null!=c&&(b?$jscomp.defineProperty($jscomp.polyfills,l,{configurable:!0,writable:!0,value:c}):c!==d&&($jscomp.propertyToPolyfillSymbol[l]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(l):$jscomp.POLYFILL_PREFIX+l,l=
$jscomp.propertyToPolyfillSymbol[l],$jscomp.defineProperty(h,l,{configurable:!0,writable:!0,value:c})))};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(b){if(b)return b;var c=function(l,n){this.$jscomp$symbol$id_=l;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:n})};c.prototype.toString=function(){return this.$jscomp$symbol$id_};var d=0,h=function(l){if(this instanceof h)throw new TypeError("Symbol is not a constructor");return new c("jscomp_symbol_"+(l||"")+"_"+d++,l)};return h},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(b){if(b)return b;b=Symbol("Symbol.iterator");for(var c="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),d=0;d<c.length;d++){var h=$jscomp.global[c[d]];"function"===typeof h&&"function"!=typeof h.prototype[b]&&$jscomp.defineProperty(h.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return b},"es6",
"es3");$jscomp.iteratorPrototype=function(b){b={next:b};b[Symbol.iterator]=function(){return this};return b};$jscomp.iteratorFromArray=function(b,c){b instanceof String&&(b+="");var d=0,h=!1,l={next:function(){if(!h&&d<b.length){var n=d++;return{value:c(n,b[n]),done:!1}}h=!0;return{done:!0,value:void 0}}};l[Symbol.iterator]=function(){return l};return l};
$jscomp.polyfill("Array.prototype.values",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(c,d){return d})}},"es8","es3");
define("buildspace/apps/RationalizeRate/BillGrid","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-attr dijit/Menu dojo/number dijit/CheckedMenuItem dojox/grid/enhanced/plugins/Menu dojox/grid/enhanced/plugins/Selector dojox/grid/enhanced/plugins/Rearrange buildspace/widget/grid/plugins/FormulatedColumn dojo/_base/event dojo/keys dijit/focus dojo/_base/html dojo/request/xhr dijit/PopupMenuItem dijit/MenuSeparator buildspace/widget/grid/cells/Textarea buildspace/widget/grid/cells/FormulaTextBox buildspace/widget/grid/cells/Formatter dojo/i18n!buildspace/nls/RationalizeRate dojo/on dojox/grid/_Grid dojox/widget/PlaceholderMenuItem buildspace/widget/grid/cells/TextBox".split(" "),function(b,
c,d,h,l,n,u,E,F,G,H,I,J,K,L,M,N,O,P,Q,x,m,R){var D=b("buildspace.apps.RationalizeRate.BillGrid",dojox.grid.EnhancedGrid,{type:null,billId:-1,elementId:0,itemId:-1,style:"border-top:none;",selectedItem:null,borderContainerWidget:null,keepSelection:!0,rowSelector:"0px",headerMenu:null,typeColumns:null,markupSettings:null,parentGrid:null,elementGridStore:null,updateUrl:null,project:null,typeColumsToQtyUsed:[],constructor:function(a){this.type=a.type;this.hierarchyTypes=a.hierarchyTypes;this.hierarchyTypesForHead=
a.hierarchyTypesForHead;this.unitOfMeasurements=a.unitOfMeasurements;this.columnGroup=a.columnGroup;this.typeColumns=a.typeColumns;this.currencySetting=buildspace.billCurrencyAbbreviation?buildspace.billCurrencyAbbreviation:buildspace.currencyAbbreviation;var e=this.formatter=new x;this.rationalizedColumnChildren=[{name:m.grandTotalQty,field_name:"rationalized_grand_total_quantity",width:"90px",styles:"text-align:right;",editable:!1,formatter:e.unEditableNumberCellFormatter},{name:m.rate,field_name:"rationalized_rate-value",
width:"85px",cellType:"buildspace.widget.grid.cells.TextBox",styles:"text-align:right;",editable:!1,formatter:e.companyRateCurrencyCellFormatter},{name:m.grandTotal,field_name:"rationalized_grand_total_after_markup",width:"100px",styles:"text-align:right;",editable:!1,formatter:e.unEditableCurrencyCellFormatter}];this.setColumnStructure();this.inherited(arguments)},dodblclick:function(a){if(a.cellNode)if(a.cell.editable)this.editableCellDblClick(a);else this.onCellDblClick(a);else this.onRowDblClick(a)},
editableCellDblClick:function(a){var e=1<this._click.length&&has("ie")?this._click[1]:1<this._click.length&&this._click[0].rowIndex!=this._click[1].rowIndex?this._click[0]:a;this.focus.setFocusCell(e.cell,e.rowIndex);this.onRowClick(e);this.onRowDblClick(a)},setColumnStructure:function(){var a=this.formatter;if("tree"==this.type){var e=this.unitOfMeasurements,k=this.hierarchyTypes;a=this.fixedColumns={noscroll:!1,width:57.8,cells:[[{name:"No",field:"id",styles:"text-align:center;",width:"30px",formatter:a.rowCountCellFormatter,
noresize:!0,showInCtxMenu:!0,rowSpan:2},{name:m.billReference,field:"bill_ref",styles:"text-align:center; color: red;",width:"80px",noresize:!0,showInCtxMenu:!0,formatter:a.billRefCellFormatter,rowSpan:2,hidden:!1},{name:m.description,field:"description",width:"auto",editable:!1,cellType:"buildspace.widget.grid.cells.Textarea",formatter:a.treeCellFormatter,noresize:!0,showInCtxMenu:!0,rowSpan:2},{name:m.type,field:"type",width:"70px",styles:"text-align:center;",editable:!1,type:"dojox.grid.cells.Select",
options:k.options,values:k.values,formatter:a.typeCellFormatter,noresize:!0,showInCtxMenu:!0,rowSpan:2},{name:m.unit,field:"uom_id",width:"50px",editable:!1,styles:"text-align:center;",type:"dojox.grid.cells.Select",options:e.options,values:e.values,formatter:a.unitIdCellFormatter,noresize:!0,showInCtxMenu:!0,rowSpan:2},{name:m.grandTotalQty,field:"grand_total_quantity",styles:"text-align:right;color:blue;",width:"90px",formatter:a.unEditableNumberCellFormatter,noresize:!0,showInCtxMenu:!0,rowSpan:2},
{name:m.rate,field:"rate_after_markup",styles:"text-align:right;",width:"75px",editable:!1,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:a.rateAfterMarkupCellFormatter,noresize:!0,rowSpan:2},{name:m.grandTotal,field:"grand_total_after_markup",styles:"text-align:right;color:blue;",width:"100px",formatter:a.unEditableCurrencyCellFormatter,noresize:!0,showInCtxMenu:!0,rowSpan:2}]]};e=[];var g=this.generateRationalizedRateColumn(a)}else a=this.fixedColumns={noscroll:!1,width:"50",cells:[[{name:"No",
field:"id",styles:"text-align:center;",width:"30px",formatter:a.rowCountCellFormatter,noresize:!0},{name:m.description,field:"description",width:"auto",cellType:"buildspace.widget.grid.cells.Textarea",formatter:a.treeCellFormatter,noresize:!0},{name:m.grandTotal,field:"overall_total_after_markup",styles:"text-align:right;color:blue;",width:"100px",formatter:a.unEditableCurrencyCellFormatter,noresize:!0,showInCtxMenu:!0}]]},e=this.generateRationalizedGrandTotalColumn(),g=a;dojo.forEach(e,function(f){g.cells[0].push(f)});
this.structure=g},generateRationalizedRateColumn:function(a){var e=this.rationalizedColumnChildren,k=[];k.push({name:m.rationalizedRate,styles:"text-align:center;",headerClasses:"staticHeader typeHeader1",colSpan:e.length,hidden:!1});for(i=0;i<e.length;i++){var g=e[i].field_name;g={field:g,columnType:"rationalizedColumn",headerClasses:"typeHeader1"};c.mixin(g,e[i]);a.cells[0].push(g)}a.cells.push(k);return a},generateRationalizedGrandTotalColumn:function(){var a=[];a.push({name:m.rationalizedRate,
field:"rationalized_overall_total_after_markup",styles:"text-align:right;",width:"120px",formatter:this.formatter.unEditableCurrencyCellFormatter,headerClasses:"typeHeader1",noresize:!0});return a},canSort:function(a){return!1},postCreate:function(){this.inherited(arguments)},doApplyCellEdit:function(a,e,k){var g=this,f=g.getItem(e),y=g.store,z=k.replace("-value","");if(void 0!=f[k][0]||a!==f[k][0]){var v=buildspace.dialog.indeterminateProgressBar({title:m.pleaseWait+"..."}),B=function(p,q){for(var r in p)f.hasOwnProperty(r)&&
r!=q._getIdentifierAttribute()&&q.setValue(f,r,p[r]),dojo.forEach(p.affected_nodes,function(w){q.fetchItemByIdentity({identity:w.id,onItem:function(A){for(var t in w)f.hasOwnProperty(t)&&t!=q._getIdentifierAttribute()&&q.setValue(A,t,w[t])}})});q.save()},C={url:this.updateUrl,content:{id:f.id,project_id:g.project.id,unsorted:g.unsorted,attr_name:z,val:a,_csrf_token:f._csrf_token?f._csrf_token:null},handleAs:"json",load:function(p){if(p.success){f&&0<parseInt(String(f.id))&&B(p.data,y);var q=g.getCellByField(k);
window.setTimeout(function(){g.focus.setFocusIndex(e,q.index)},10);v.hide()}},error:function(p){v.hide();console.log(p)}};v.show().then(function(){dojo.xhrPost(C)})}g.inherited(arguments)},onStyleRow:function(a){this.inherited(arguments);if(a.node.children[0]&&2<=a.node.children[0].children[0].rows.length){var e=a.node.children[0].children[0].rows[1],k=a.node.children[0].children[0].rows[0].children;e.parentNode.removeChild(e);dojo.forEach(k,function(g,f){f=dojo.attr(g,"rowSpan");(!f||2>f)&&dojo.attr(g,
"rowSpan",2)})}},canEdit:function(a,e){var k=this;if("tree"==this.type&&void 0!=a){var g=this.getItem(e),f=a.field;if(g&&0<parseInt(String(g.id))&&!g.project_revision_deleted_at[0])if(parseInt(String(g.type))!=buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER&&parseInt(String(g.type))!=buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_N||"description"==f||"type"==f||!a.editable){if(parseInt(String(g.type))==buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER&&"description"!=f&&"type"!=
f&&a.editable){window.setTimeout(function(){k.edit.cancel();k.focus.setFocusIndex(e,a.index)},10);return}if(parseInt(String(g.type))!=buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_HTML_EDITOR&&parseInt(String(g.type))!=buildspace.widget.grid.constants.HIERARCHY_TYPE_NOID||"description"!=f){if(parseInt(String(g.type))==buildspace.widget.grid.constants.HIERARCHY_TYPE_NOID&&"type"!=f&&"uom_id"!=f){window.setTimeout(function(){k.edit.cancel();k.focus.setFocusIndex(e,a.index)},10);return}if(parseInt(String(g.type))==
buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_RATE_ONLY&&"description"!=f&&"type"!=f&&"rate-value"!=f&&"markup_percentage-value"!=f&&"markup_amount-value"!=f&&"uom_id"!=f&&a.editable){window.setTimeout(function(){k.edit.cancel();k.focus.setFocusIndex(e,a.index)},10);return}if(parseInt(String(g.type))==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_PC_RATE&&"rate-value"==f){window.setTimeout(function(){k.edit.cancel();k.focus.setFocusIndex(e,a.index)},10);return}if(parseInt(String(g.type))==
buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM_PERCENT&&"description"!=f&&"type"!=f&&"markup_percentage-value"!=f&&"markup_amount-value"!=f&&"uom_id"!=f&&a.editable){window.setTimeout(function(){k.edit.cancel();k.focus.setFocusIndex(e,a.index)},10);return}if(parseInt(String(g.type))==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_NOT_LISTED){window.setTimeout(function(){k.edit.cancel();k.focus.setFocusIndex(e,a.index)},10);return}}else{window.setTimeout(function(){k.edit.cancel();
k.focus.setFocusIndex(e,a.index)},10);return}}else{window.setTimeout(function(){k.edit.cancel();k.focus.setFocusIndex(e,a.index)},10);return}else return}return this._canEdit}});return b("buildspace.apps.RationalizeRate.BillGridBuilder",dijit.layout.BorderContainer,{pageId:"page-00",style:"padding:0px;width:100%;height:100%;",gutters:!1,stackContainerTitle:"",rootProject:null,billId:-1,elementId:0,itemId:-1,rowSelector:null,gridOpts:{},type:null,postCreate:function(){this.inherited(arguments);c.mixin(this.gridOpts,
{billId:this.billId,project:this.rootProject,elementId:this.elementId,type:this.type,region:"center",borderContainerWidget:this});var a=this.grid=new D(this.gridOpts);this.addChild(a);if(a=dijit.byId("rationalizeRateBreakdown"+this.rootProject.id+"-stackContainer")){var e=new dojox.layout.ContentPane({title:buildspace.truncateString(this.stackContainerTitle,60),id:this.pageId});a.addChild(e);e.set("content",this);a.selectChild(this.pageId)}}})});
