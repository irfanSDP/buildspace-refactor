define("buildspace/apps/BQLibraryReport/grid","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/aspect dojo/request dojo/dom-attr dijit/TooltipDialog dijit/popup dojox/grid/enhanced/plugins/Menu dojo/number dojox/grid/enhanced/plugins/Selector dojox/grid/enhanced/plugins/Rearrange buildspace/widget/grid/plugins/FormulatedColumn dojox/grid/enhanced/plugins/IndirectSelection dojo/_base/event dojo/keys dijit/focus dojo/_base/html dojo/request/xhr dijit/PopupMenuItem buildspace/widget/grid/cells/Textarea buildspace/widget/grid/cells/FormulaTextBox dijit/form/DropDownButton dijit/DropDownMenu dijit/MenuItem ./PrintItemsDialog dojo/i18n!buildspace/nls/BQLibrary buildspace/widget/grid/Filter".split(" "),
function(l,m,f,y,n,h,z,p,g,A,B,C,q,r,D,E,F,G,H,I,J,K,L,t,u,v,k,d,w){var x=l("buildspace.apps.BQLibraryReport.Grid",dojox.grid.EnhancedGrid,{type:null,libraryId:0,elementId:0,style:"border-top:none;",selectedItem:null,borderContainerWidget:null,keepSelection:!0,gridContainer:null,constructor:function(a){this.rearranger=q(this,{});this.formulatedColumn=r(this,{});this.plugins={indirectSelection:{headerSelector:!0,width:"40px",styles:"text-align: center;"}};this.inherited(arguments)},canSort:function(a){return!1},
dodblclick:function(a){this.onRowDblClick(a)},postCreate:function(){var a=this,b=null;a.inherited(arguments);"tree"===a.type&&(n.after(a,"_onFetchComplete",function(){a.gridContainer.markedCheckBoxObject(a,a.gridContainer.selectedItemStore[a.libraryId])}),this._connects.push(f.connect(this,"onCellMouseOver",function(a){var c=a.cell.field,e=a.rowIndex,d=this.getItem(e),c=c.replace("-value","");"undefined"!==typeof d[c+"-has_formula"]&&d[c+"-has_formula"][0]&&(d=d[c+"-value"][0],d=this.formulatedColumn.convertItemIdToRowIndex(d,
e),null===b&&(b=new p({content:d,onMouseLeave:function(){g.close(b)}}),g.open({popup:b,around:a.cellNode})))})),this._connects.push(f.connect(this,"onCellMouseOut",function(){null!==b&&(g.close(b),b=null)})),this._connects.push(f.connect(this,"onStartEdit",function(){null!==b&&(g.close(b),b=null)})))},startup:function(){var a=this;a.inherited(arguments);this._connects.push(f.connect(this,"onCellClick",function(b){""===b.cell.name&&a.singleCheckBoxSelection(b)}));this._connects.push(f.connect(this.rowSelectCell,
"toggleAllSelection",function(b){a.toggleAllSelection(b)}))},destroy:function(){this.inherited(arguments);dojo.forEach(this._connects,f.disconnect);delete this._connects}});return l("buildspace.apps.BQLibraryReport.grid",dijit.layout.BorderContainer,{pageId:"page-00",style:"padding:0px;border:0px;width:100%;height:100%;",gutters:!1,stackContainerTitle:null,libraryId:0,elementId:0,rowSelector:null,gridOpts:{},type:null,postCreate:function(){var a=this,b;this.inherited(arguments);m.mixin(a.gridOpts,
{libraryId:a.libraryId,elementId:a.elementId,type:a.type,region:"center",borderContainerWidget:a});var e=new u({style:"display: none;"}),c=new dijit.Toolbar({region:"top",style:"padding:2px;border-bottom:none;width:100%;"}),f=this.grid=new x(a.gridOpts);"tree"==a.type&&(b=[{description:d.description},{uom_symbol:d.unit},{"rate-final_value":d.rate}]);"tree"!=a.type&&(b=[{description:d.description}]);dojo.forEach(["selectedItems","selectedItemsWithRate","selectedItemsWithBuildUpRates"],function(b){var c;
switch(b){case "selectedItems":c="openPrintSelectedItems";break;case "selectedItemsWithRate":c="openPrintSelectedItemsWithRate";break;case "selectedItemsWithBuildUpRates":c="openPrintSelectedItemsWithBuildUpRates"}e.addChild(new v({label:d[b],onClick:function(){a[c](b)}}))});c.addChild(new t({label:d.printPreview,iconClass:"icon-16-container icon-16-print",dropDown:e}));a.addChild(new w({region:"top",grid:f,filterFields:b,editableGrid:!0}));a.addChild(c);a.addChild(new dijit.layout.ContentPane({style:"width:100%",
content:f,region:"center"}));if(b=dijit.byId("bqLibrary_report_"+a.libraryId+"-stackContainer"))c=document.createElement("div"),c=new dojox.layout.ContentPane({title:buildspace.truncateString(a.stackContainerTitle,60),id:a.pageId,executeScripts:!0},c),b.addChild(c),c.set("content",a),m.mixin(c,{grid:f}),b.selectChild(a.pageId)},openPrintSelectedItems:function(){var a=this,b=[];a.gridOpts.gridContainer.selectedItemStore[a.libraryId].query().forEach(function(a){b.push(a.id)});var e=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+
"..."});e.show();h.post("bqLibraryReporting/getPrintPreviewSelectedItems",{handleAs:"json",data:{libraryId:a.libraryId,item_ids:JSON.stringify(a.gridOpts.gridContainer.arrayUnique(b))}}).then(function(c){(new k({libraryId:a.libraryId,title:d.selectedItems,data:c,selectedItems:b,printURL:"bqLibraryReporting/printingSelectedItems",exportURL:"bqLibraryExportExcelReporting/exportExcelSelectedItems",type:"withoutRates"})).show();e.hide()},function(a){console.log(a);e.hide()})},openPrintSelectedItemsWithRate:function(){var a=
this,b=[];a.gridOpts.gridContainer.selectedItemStore[a.libraryId].query().forEach(function(a){b.push(a.id)});var e=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});e.show();h.post("bqLibraryReporting/getPrintPreviewSelectedItemsWithRate",{handleAs:"json",data:{libraryId:a.libraryId,item_ids:JSON.stringify(a.gridOpts.gridContainer.arrayUnique(b))}}).then(function(c){(new k({libraryId:a.libraryId,title:d.selectedItemsWithRate,data:c,selectedItems:b,printURL:"bqLibraryReporting/printingSelectedItemsWithRate",
exportURL:"bqLibraryExportExcelReporting/exportExcelSelectedItemsWithRate"})).show();e.hide()},function(a){console.log(a);e.hide()})},openPrintSelectedItemsWithBuildUpRates:function(){var a=this,b=[];a.gridOpts.gridContainer.selectedItemStore[a.libraryId].query().forEach(function(a){b.push(a.id)});var e=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});e.show();h.post("bqLibraryReporting/getPrintPreviewSelectedItemsWithBuildUpRates",{handleAs:"json",data:{libraryId:a.libraryId,
item_ids:JSON.stringify(a.gridOpts.gridContainer.arrayUnique(b))}}).then(function(c){(new k({libraryId:a.libraryId,title:d.selectedItemsWithBuildUpRates,data:c,selectedItems:b,printURL:"bqLibraryReporting/printingPreviewSelectedItemsWithBuildUpRates",exportURL:"bqLibraryExportExcelReporting/exportExcelSelectedItemsWithBuildUpRates"})).show();e.hide()},function(a){console.log(a);e.hide()})}})});
