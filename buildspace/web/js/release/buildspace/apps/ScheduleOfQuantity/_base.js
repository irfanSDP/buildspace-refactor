define("buildspace/apps/ScheduleOfQuantity/_base","dojo/_base/declare dojo/_base/lang dojo/aspect dojo/when dojo/_base/event dojo/keys dojo/_base/html dijit/PopupMenuItem dojo/number dojo/request dijit/form/DropDownButton dijit/DropDownMenu dijit/MenuItem ./grid ./BuildUpQuantityGrid ./ImportCubitDialog buildspace/widget/grid/Filter buildspace/widget/grid/cells/Formatter buildspace/apps/ProjectBuilder/Builder buildspace/apps/Tendering/Builder dojo/i18n!buildspace/nls/ScheduleOfQuantity".split(" "),
function(r,t,u,v,L,M,N,O,w,A,B,C,D,k,x,E,F,l,y,G,d){var z=r("buildspace.apps.ScheduleOfQuantity.TabGrid",dijit.layout.BorderContainer,{pageId:"page-00",style:"padding:0px;border:0px;width:100%;height:100%;",gutters:!1,stackContainerTitle:null,project:null,scheduleOfQuantity:null,scheduleOfQuantityTrade:null,gridOpts:{},type:null,postCreate:function(){var a;this.inherited(arguments);t.mixin(this.gridOpts,{project:this.project,scheduleOfQuantity:this.scheduleOfQuantity,type:this.type,borderContainerWidget:this});
var c=this.grid=new k(this.gridOpts),e=this.project.id+"_"+this.scheduleOfQuantity.id+"_"+this.type;switch(this.type){case "item_grid":a=[{description:d.description},{uom_symbol:d.unit},{"quantity-final_value":d.qty}];break;case "trade_grid":a=[{description:d.description}];break;default:a=[{description:d.description}]}if(this.gridOpts.editable){var b=new dijit.Toolbar({region:"top",style:"padding:2px;border-bottom:none;width:100%;"});b.addChild(new dijit.form.Button({id:e+"_AddSOQRow-button",label:d.addRow,
iconClass:"icon-16-container icon-16-add",disabled:-1<c.selection.selectedIndex?!1:!0,onClick:function(){-1<c.selection.selectedIndex&&c.addRow(c.selection.selectedIndex)}}));"item_grid"==this.type&&(b.addChild(new dijit.ToolbarSeparator),b.addChild(new dijit.form.Button({id:e+"_IndentSOQ-button",label:d.indent,iconClass:"icon-16-container icon-16-indent",disabled:-1<c.selection.selectedIndex?!1:!0,onClick:function(){-1<c.selection.selectedIndex&&c.indentOutdent(c.selection.selectedIndex,"indent")}})),
b.addChild(new dijit.ToolbarSeparator),b.addChild(new dijit.form.Button({id:e+"_OutdentSOQ-button",label:d.outdent,iconClass:"icon-16-container icon-16-outdent",disabled:-1<c.selection.selectedIndex?!1:!0,onClick:function(){-1<c.selection.selectedIndex&&c.indentOutdent(c.selection.selectedIndex,"outdent")}})));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({id:e+"_DeleteSOQRow-button",label:d.deleteRow,iconClass:"icon-16-container icon-16-delete",disabled:-1<c.selection.selectedIndex?
!1:!0,onClick:function(){-1<c.selection.selectedIndex&&c.deleteRow(c.selection.selectedIndex)}}));this.addChild(b)}this.addChild(new F({grid:this.grid,region:"top",editableGrid:!0,filterFields:a}));this.addChild(new dijit.layout.ContentPane({style:"width:100%",content:c,region:"center"}));if(a=dijit.byId("scheduleOfQuantityGrid"+this.project.id+"_"+this.scheduleOfQuantity.id+"-stackContainer"))e=document.createElement("div"),e=new dojox.layout.ContentPane({title:buildspace.truncateString(this.stackContainerTitle,
50),content:this,id:this.pageId,executeScripts:!0},e),a.addChild(e),t.mixin(e,{grid:c}),a.selectChild(this.pageId)}}),H=function(a,c){return 0<a?a:""},I=function(a,c){var d=this.grid.getItem(c),b=16*d.level;a=null==a?"&nbsp":a;d.type<buildspace.constants.TYPE_BILL&&(a="<b>"+a+"</b>");return'<div class="treeNode" style="padding-left:'+b+'px;"><div class="treeContent">'+a+"&nbsp;</div></div>"},J=function(a,c){return buildspace.getBillTypeText(a)},q=function(a,c,e){a=this.grid.getItem(c);if(0<a.id&&
a.type!=buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER&&a.type!=buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_N&&a.type!=buildspace.widget.grid.constants.HIERARCHY_TYPE_NOID&&a.type!=buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM&&a.type!=buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM_PERCENT&&a.type!=buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM_EXCLUDE&&a.type!=buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_RATE_ONLY)return'<a href="#" onclick="return false;">'+
d.link+"</a>";e.customClasses.push("disable-cell");return"&nbsp;"};return r("buildspace.apps.ScheduleOfQuantity",buildspace.apps._App,{type:null,win:null,project:null,canEdit:!0,init:function(a){var c=this.project=a.project;this.type=a.type;this.canEdit=a.canEdit;a=this.getModuleTitle();this.win=new buildspace.widget.Window({title:a+" > "+d.scheduleOfQuantities+" - "+buildspace.truncateString(c.title,100),onClose:dojo.hitch(this,"kill")});c=this.tabContainer=new dijit.layout.TabContainer({style:"padding:0px;margin:0px;border:0px;width:100%;height:100%;"});
c.addChild(this.createMainTab());c.startup();this.win.addChild(c);this.win.show();this.win.startup()},createMainTab:function(){var a=this,c=new l,e=new dijit.layout.BorderContainer({title:d.scheduleOfQuantities,style:"padding:0px;width:100%;height:100%;",gutters:!1}),b=new k({type:"main_grid",project:this.project,tabContainer:this.tabContainer,editable:this.canEdit,structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:c.rowCountCellFormatter},{name:d.title,field:"title",
width:"auto",editable:this.canEdit,cellType:"buildspace.widget.grid.cells.Textarea"},{name:d.lastUpdated,field:"updated_at",width:"120px",styles:"text-align: center;"}],store:new dojo.data.ItemFileWriteStore({clearOnClose:!0,url:"scheduleOfQuantity/getScheduleOfQuantityList/pid/"+this.project.id}),addUrl:"scheduleOfQuantity/scheduleOfQuantityAdd",updateUrl:"scheduleOfQuantity/scheduleOfQuantityUpdate",deleteUrl:"scheduleOfQuantity/scheduleOfQuantityDelete",pasteUrl:"scheduleOfQuantity/scheduleOfQuantityPaste",
onRowDblClick:function(b){b=this.getItem(b.rowIndex);0<b.id&&null!==b.title[0]&&a.createTradeGrid(b)}}),c=new dijit.Toolbar({region:"top",style:"outline:none!important;border:0px;padding:2px;overflow:hidden;"});c.addChild(new dijit.form.Button({label:d.backTo+" "+this.getModuleTitle(),iconClass:"icon-16-container icon-16-directional_left",style:"outline:none!important;",onClick:dojo.hitch(this,"openBuilderWin",this.project)}));if(this.canEdit){c.addChild(new dijit.ToolbarSeparator);c.addChild(new dijit.form.Button({id:this.project.id+
"_main_grid_AddSOQRow-button",label:d.addRow,disabled:!0,iconClass:"icon-16-container icon-16-add",style:"outline:none!important;",onClick:function(){-1<b.selection.selectedIndex&&b.addRow(b.selection.selectedIndex)}}));c.addChild(new dijit.ToolbarSeparator);c.addChild(new dijit.form.Button({id:this.project.id+"_main_grid_DeleteSOQRow-button",label:d.deleteRow,disabled:!0,iconClass:"icon-16-container icon-16-delete",style:"outline:none!important;",onClick:function(){-1<b.selection.selectedIndex&&
b.deleteRow(b.selection.selectedIndex)}}));var f=new C({style:"display: none;"});f.addChild(new D({label:d.importFromCubit,onClick:function(c){-1<b.selection.selectedIndex&&(c=b.getItem(b.selection.selectedIndex),a.createDialogForImportCubitFile(c,b))}}));c.addChild(new dijit.ToolbarSeparator);c.addChild(new B({id:a.project.id+"_main_grid_ImportDropDownRow-button",label:d.importFromFiles,iconClass:"icon-16-container icon-16-import",dropDown:f,disabled:-1<b.selection.selectedIndex?!1:!0}));c.addChild(new dijit.ToolbarSeparator);
c.addChild(new dijit.form.Button({label:d.linkToBillItems,iconClass:"icon-16-container icon-16-link",style:"outline:none!important;",onClick:dojo.hitch(this,"createLinkToBillItemTab")}))}e.addChild(c);e.addChild(b);return e},openBuilderWin:function(a){this.kill();this.project=a;var c=this.getModuleTitle();this.win=new buildspace.widget.Window({title:c+" > "+buildspace.truncateString(a.title,100)+" ("+d.status+"::"+a.status[0].toUpperCase()+")",onClose:dojo.hitch(this,"kill")});switch(this.type){case buildspace.constants.STATUS_PRETENDER:a=
y({project:a});break;case buildspace.constants.STATUS_TENDERING:a=G({project:a});break;default:a=y({project:a})}this.win.addChild(a);this.win.show();this.win.startup()},createLinkToBillItemTab:function(){var a=this,c=new l,e="SoqLinkToGridTop"+this.project.id,b="SoqLinkToGridCenter"+this.project.id,f=this.tabContainer.getChildren(),g;for(g in f)if("object"==typeof f[g].lib_info&&f[g].lib_info.id==this.project.id+"_linkToBilItemsTab")return this.tabContainer.selectChild(f[g]);c=new k({type:"linkTo_Grid",
project:this.project,editable:!1,structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:c.rowCountCellFormatter},{name:d.title,field:"title",width:"auto"},{name:d.lastUpdated,field:"updated_at",width:"120px",styles:"text-align: center;"}],store:new dojo.data.ItemFileWriteStore({clearOnClose:!0,url:"scheduleOfQuantity/getScheduleOfQuantityList/pid/"+this.project.id}),onRowDblClick:function(b){b=this.getItem(b.rowIndex);0<b.id&&null!==b.title[0]&&a.createLinkToTradeGrid(b,
e)}});f=new k({type:"linkTo_Grid",project:this.project,editable:!1,structure:[{name:"No.",field:"count",width:"40px",styles:"text-align:center;",formatter:H},{name:d.title,field:"title",width:"auto",formatter:I},{name:d.billType,field:"bill_type",width:"180px",styles:"text-align:center;",formatter:J}],store:new dojo.data.ItemFileWriteStore({clearOnClose:!0,url:"billManagerImportQty/getBillList/pid/"+this.project.id}),onRowDblClick:function(c){c=this.getItem(c.rowIndex);0<c.id&&null!==c.title[0]&&
a.createLinkToBillColumnSettingGrid(c,b)}});g=new dijit.layout.BorderContainer({style:"padding:0;width:100%;height:100%;",gutters:!1,liveSplitters:!0});g.addChild(this.createLinkToSoqContainer(e,d.scheduleOfQuantities,c,"top"));g.addChild(this.createLinkToSoqContainer(b,d.bills,f,"center"));c=new dijit.layout.ContentPane({closable:!0,style:"padding: 0px; overflow: hidden;",title:d.linkToBillItems,content:g});this.tabContainer.addChild(c);this.tabContainer.selectChild(c);c.lib_info={name:d.linkToBillItems,
id:this.project.id+"_linkToBilItemsTab"}},createLinkToSoqContainer:function(a,c,d,b){var e=dijit.byId(a+"-stackContainer");e&&dijit.byId(a+"-stackContainer").destroyRecursive();e=new dijit.layout.StackContainer({style:"width:100%;height:100%;",region:"center",id:a+"-stackContainer"});e.addChild(new dijit.layout.ContentPane({title:c,content:d}));c=new dijit.layout.StackController({region:"top",containerId:a+"-stackContainer"});b=new dijit.layout.BorderContainer({region:b,style:"padding:0px;margin:0px;width:100%;height:50%;",
gutters:!1,splitter:!0});b.addChild(e);b.addChild(new dijit.layout.ContentPane({style:"padding:0px;overflow:hidden;","class":"breadCrumbTrail",region:"top",content:c}));dojo.subscribe(a+"-stackContainer-selectChild","",function(b){var c=dijit.byId(a+"-stackContainer");if(c){var d=c.getChildren(),e=dojo.indexOf(d,b),e=e+1;if(d.length>e){for(;d.length>e;)c.removeChild(d[e]),d[e].destroyRecursive(!0),e+=1;var f=b.content.selection.selectedIndex;b.content.store.save();b.content.store.close();var g=u.after(b.content,
"_onFetchComplete",function(){g.remove();-1<f&&(this.scrollToRow(f),this.selection.setSelected(f,!0))});b.content.sort()}}});return b},createLinkToTradeGrid:function(a,c){var e=this,b=new l,f=new k({type:"linkTo_Grid",project:this.project,editable:!1,structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:b.rowCountCellFormatter},{name:d.description,field:"description",width:"auto"},{name:d.lastUpdated,field:"updated_at",width:"120px",styles:"text-align: center;"}],store:new dojo.data.ItemFileWriteStore({clearOnClose:!0,
url:"scheduleOfQuantity/getTradeList/sid/"+a.id}),onRowDblClick:function(a){a=this.getItem(a.rowIndex);0<a.id&&null!==a.description[0]&&e.createLinkToItemGrid(a,c)}});if(b=dijit.byId(c+"-stackContainer")){var g=document.createElement("div"),f=new dojox.layout.ContentPane({title:buildspace.truncateString(a.title,50),content:f,executeScripts:!0},g);b.addChild(f);b.selectChild(f)}},createLinkToItemGrid:function(a,c){var e=l(),b=new k({id:"linkToItemGrid_"+this.project.id,type:"linkTo_ItemGrid",project:this.project,
editable:!1,structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:e.rowCountCellFormatter},{name:d.description,field:"description",width:"auto",formatter:e.treeCellFormatter},{name:d.type,field:"type",width:"70px",styles:"text-align:center;",formatter:e.typeCellFormatter},{name:d.unit,field:"uom_id",width:"70px",styles:"text-align:center;",formatter:e.unitIdCellFormatter},{name:d.qty,field:"quantity-value",width:"100px",styles:"text-align:right;",formatter:e.formulaNumberCellFormatter}],
store:new dojo.data.ItemFileWriteStore({clearOnClose:!0,url:"scheduleOfQuantity/getItemList/tid/"+a.id}),onRowDblClick:function(a){this.getItem(a.rowIndex)}});if(e=dijit.byId(c+"-stackContainer")){var f=document.createElement("div"),b=new dojox.layout.ContentPane({title:buildspace.truncateString(a.description,50),content:b,executeScripts:!0},f);e.addChild(b);e.selectChild(b)}},createLinkToBillColumnSettingGrid:function(a,c){var e=this,b=l(),f=new k({type:"linkTo_Grid",project:this.project,edtable:!1,
structure:[{name:"No.",field:"id",width:"40px",styles:"text-align:center;",formatter:b.rowCountCellFormatter},{name:d.name,field:"name",width:"auto"}],store:new dojo.data.ItemFileWriteStore({clearOnClose:!0,url:"billManagerImportQty/getBillColumnSettingList/bid/"+a.id}),onRowDblClick:function(a){a=this.getItem(a.rowIndex);0<a.id&&null!==a.name[0]&&e.createLinkToBillElementGrid(a,c)}});if(b=dijit.byId(c+"-stackContainer")){var g=document.createElement("div"),f=new dojox.layout.ContentPane({title:buildspace.truncateString(a.title,
50),content:f,executeScripts:!0},g);b.addChild(f);b.selectChild(f)}},createLinkToBillElementGrid:function(a,c){var e=this,b=l(),f=new k({type:"linkTo_Grid",project:this.project,editable:!1,structure:[{name:"No.",field:"id",width:"40px",styles:"text-align:center;",formatter:b.rowCountCellFormatter},{name:d.description,field:"description",width:"auto"}],store:new dojo.data.ItemFileWriteStore({clearOnClose:!0,url:"billManagerImportQty/getElementList/cid/"+a.id}),onRowDblClick:function(b){b=this.getItem(b.rowIndex);
0<b.id&&null!==b.description[0]&&e.createLinkToBillItemGrid(b,a,c)}});if(b=dijit.byId(c+"-stackContainer")){var g=document.createElement("div"),f=new dojox.layout.ContentPane({title:buildspace.truncateString(a.name,50),content:f,executeScripts:!0},g);b.addChild(f);b.selectChild(f)}},createLinkToBillItemGrid:function(a,c,e){var b=l();c=new k({type:"linkTo_BillItemGrid",billColumnSetting:c,project:this.project,editable:!1,structure:c.remeasurement_quantity_enabled[0]?[{name:"No.",field:"id",width:"30px",
styles:"text-align:center;",formatter:b.rowCountCellFormatter},{name:d.description,field:"description",width:"auto",formatter:b.treeCellFormatter},{name:d.type,field:"type",width:"70px",styles:"text-align:center;",formatter:b.typeCellFormatter},{name:d.unit,field:"uom_id",width:"70px",styles:"text-align:center;",formatter:b.unitIdCellFormatter},{name:d.qty+"/"+d.unit,field:"quantity_per_unit-value",width:"80px",styles:"text-align:right;",formatter:b.formulaCurrencyCellFormatter},{name:d.link+" "+
d.qty,field:"quantity_import",width:"80px",styles:"text-align:center;",formatter:q},{name:d.qty+"/"+d.unit+" (2)",field:"quantity_per_unit_remeasurement-value",width:"80px",styles:"text-align:right;",formatter:b.formulaCurrencyCellFormatter},{name:d.link+" "+d.qty+" 2",field:"quantity_remeasurement_import",width:"80px",styles:"text-align:center;",formatter:q}]:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:b.rowCountCellFormatter},{name:d.description,field:"description",
width:"auto",formatter:b.treeCellFormatter},{name:d.type,field:"type",width:"70px",styles:"text-align:center;",formatter:b.typeCellFormatter},{name:d.unit,field:"uom_id",width:"70px",styles:"text-align:center;",formatter:b.unitIdCellFormatter},{name:d.qty+"/"+d.unit,field:"quantity_per_unit-value",width:"80px",styles:"text-align:right;",formatter:b.formulaCurrencyCellFormatter},{name:d.link+" "+d.qty,field:"quantity_import",width:"80px",styles:"text-align:center;",formatter:q}],store:new dojo.data.ItemFileWriteStore({clearOnClose:!0,
url:"billManagerImportQty/getItemList/eid/"+a.id+"/cid/"+c.id})});if(e=dijit.byId(e+"-stackContainer"))b=document.createElement("div"),a=new dojox.layout.ContentPane({title:buildspace.truncateString(a.description,50),content:c,executeScripts:!0},b),e.addChild(a),e.selectChild(a)},createTradeGrid:function(a){var c=this,e=this.tabContainer.getChildren(),b;for(b in e)if("object"==typeof e[b].lib_info&&e[b].lib_info.id==this.project.id+"_"+a.id)return this.tabContainer.selectChild(e[b]);e=dojo.data.ItemFileWriteStore({url:"scheduleOfQuantity/getTradeList/sid/"+
a.id,clearOnClose:!0,urlPreventCache:!0});b=new l;e=new z({id:"soq_trade-page-container-"+a.id,type:"trade_grid",stackContainerTitle:a.title,pageId:"page-trade_"+a.id,project:this.project,scheduleOfQuantity:a,gridOpts:{store:e,editable:this.canEdit,structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:b.rowCountCellFormatter},{name:d.description,field:"description",width:"auto",editable:this.canEdit,cellType:"buildspace.widget.grid.cells.Textarea"},{name:d.lastUpdated,
field:"updated_at",width:"120px",styles:"text-align: center;"}],addUrl:"scheduleOfQuantity/tradeAdd",updateUrl:"scheduleOfQuantity/tradeUpdate",deleteUrl:"scheduleOfQuantity/tradeDelete",pasteUrl:"scheduleOfQuantity/tradePaste",onRowDblClick:function(b){b=this.getItem(b.rowIndex);0<b.id&&null!==b.description[0]&&c.createItemGrid(a,b)}}});this.makeTab(this.project.id+"_"+a.id,a.title,e)},createItemGrid:function(a,c){var e=this,b=[buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_TEXT,buildspace.widget.grid.constants.HIERARCHY_TYPE_WORK_ITEM_TEXT],
f=[buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER,buildspace.widget.grid.constants.HIERARCHY_TYPE_WORK_ITEM],g=dojo.data.ItemFileWriteStore({url:"scheduleOfQuantity/getItemList/tid/"+c.id,clearOnClose:!0,urlPreventCache:!0}),m=new l,h=dojo.xhrGet({url:"bqLibrary/getUnits",handleAs:"json"}),p=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});p.show();return v(h,function(h){p.hide();new z({id:"soq_item-page-container-"+a.id,type:"item_grid",stackContainerTitle:c.description,
pageId:"page-item_"+a.id,project:e.project,scheduleOfQuantity:a,gridOpts:{store:g,editable:e.canEdit,structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:m.rowCountCellFormatter},{name:d.description,field:"description",width:"auto",editable:e.canEdit,formatter:m.treeCellFormatter,cellType:"buildspace.widget.grid.cells.Textarea"},{name:d.type,field:"type",width:"70px",styles:"text-align:center;",editable:e.canEdit,cellType:"dojox.grid.cells.Select",options:b,values:f,
formatter:m.typeCellFormatter},{name:d.unit,field:"uom_id",width:"70px",styles:"text-align:center;",editable:e.canEdit,cellType:"dojox.grid.cells.Select",options:h.options,values:h.values,formatter:m.unitIdCellFormatter},{name:d.qty,field:"quantity-value",width:"100px",styles:"text-align:right;",editable:e.canEdit,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:m.formulaNumberCellFormatter},{name:d.lastUpdated,field:"updated_at",width:"120px",styles:"text-align: center;"}],addUrl:"scheduleOfQuantity/itemAdd",
updateUrl:"scheduleOfQuantity/itemUpdate",deleteUrl:"scheduleOfQuantity/itemDelete",pasteUrl:"scheduleOfQuantity/itemPaste",indentUrl:"scheduleOfQuantity/itemIndent",outdentUrl:"scheduleOfQuantity/itemOutdent",editableCellDblClick:function(a){var b=a.cell.field,c=this.getItem(a.rowIndex);if("quantity-value"==b&&0<c.id&&c.type!=buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER)if(0<c.uom_id[0]){a=dojo.xhrGet({url:"billBuildUpQuantity/getDimensionColumnStructure",content:{uom_id:c.uom_id[0]},handleAs:"json"});
var f=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});f.show();var g=this.project.id+"_"+this.scheduleOfQuantity.id;a.then(function(a){e.createBuildUpQuantityContainer(c,a,g);f.hide()})}else buildspace.dialog.alert(d.buildUpQtyAlert,d.pleaseSetUOM,60,300)},customCellDblClick:function(a){if(!e.canEdit){var b=a.cell.field,c=this.getItem(a.rowIndex);if("quantity-value"==b&&0<c.id&&c.type!=buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER)if(0<c.uom_id[0]){a=dojo.xhrGet({url:"billBuildUpQuantity/getDimensionColumnStructure",
content:{uom_id:c.uom_id[0]},handleAs:"json"});var f=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});f.show();var g=this.project.id+"_"+this.scheduleOfQuantity.id;a.then(function(a){e.createBuildUpQuantityContainer(c,a,g);f.hide()})}else buildspace.dialog.alert(d.buildUpQtyAlert,d.pleaseSetUOM,60,300)}},canEdit:function(a,b){var c=this,d=this.getItem(b);if(!this.editable||d&&1!=d.identifier_type[0])return!1;if(void 0!=a){var e=a.field;if("type"===e){var f=this.getItem(b+1);
if(0<d.id[0]&&d.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER&&void 0!==f&&d.level[0]<f.level[0])return window.setTimeout(function(){c.edit.cancel();c.focus.setFocusIndex(b,a.index)},10),!1}if(0<d.id[0]&&d.type!=buildspace.widget.grid.constants.HIERARCHY_TYPE_WORK_ITEM&&("quantity-value"==e||"uom_id"==e))return window.setTimeout(function(){c.edit.cancel();c.focus.setFocusIndex(b,a.index)},10),!1}return this._canEdit}}})},function(a){})},createBuildUpQuantityContainer:function(a,c,e){var b=
this,f=new dijit.layout.BorderContainer({style:"padding:0;margin:0;width:100%;height:100%;border:none!important;outline:none;",gutters:!1}),g=new dijit.layout.AccordionContainer({id:"acc_"+e+"-container",region:"center",style:"padding:0;margin:0;width:100%;height:100%;border:none!important;outline:none;"}),m=dojo.xhrGet({url:"scheduleOfQuantity/hasImportedItems/id/"+a.id,handleAs:"json"}),h=new l,p=[buildspace.constants.SIGN_POSITIVE_TEXT,buildspace.constants.SIGN_NEGATIVE_TEXT],k=[buildspace.constants.SIGN_POSITIVE,
buildspace.constants.SIGN_NEGATIVE];try{var n=[{name:"No",field:"id",styles:"text-align:center;",width:"30px",formatter:h.rowCountCellFormatter},{name:d.description,field:"description",width:"auto",editable:this.canEdit,cellType:"buildspace.widget.grid.cells.Textarea"},{name:d.factor,field:"factor-value",width:"100px",styles:"text-align:right;",editable:this.canEdit,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:h.formulaNumberCellFormatter}];dojo.forEach(c,function(a){n.push({name:a.title,
field:a.field_name,width:"100px",styles:"text-align:right;",editable:b.canEdit,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:h.formulaNumberCellFormatter})});n.push({name:d.total,field:"total",width:"100px",styles:"text-align:right;",formatter:h.numberCellFormatter});n.push({name:d.sign,field:"sign",width:"70px",styles:"text-align:center;",editable:this.canEdit,cellType:"dojox.grid.cells.Select",options:p,values:k,formatter:h.signCellFormatter});v(m,function(c){g.addChild(new dijit.layout.ContentPane({title:d.manualItems+
'<span style="color:blue;float:right;">'+w.format(a.editable_total,{places:2})+"&nbsp;"+a.uom_symbol+"</span>",style:"padding:0;border:none!important;",doLayout:!1,id:"accPane-manual_"+a.id,content:new x({type:"manual",scheduleOfQuantityItem:a,gridOpts:{editable:b.canEdit,structure:n,store:new dojo.data.ItemFileWriteStore({url:"scheduleOfQuantity/getBuildUpItemList/id/"+a.id+"/t/m",clearOnClose:!0}),addUrl:"scheduleOfQuantity/buildUpItemAdd",updateUrl:"scheduleOfQuantity/buildUpItemUpdate",deleteUrl:"scheduleOfQuantity/buildUpItemDelete",
pasteUrl:"scheduleOfQuantity/buildUpItemPaste"}})}));c&&(c=new dijit.layout.ContentPane({title:d.importedItems+'<span style="color:blue;float:right;">'+w.format(a.non_editable_total,{places:2})+"&nbsp;"+a.uom_symbol+"</span>",style:"padding:0;border:none!important;",doLayout:!1,id:"accPane-imported_"+a.id,content:new x({type:"imported",scheduleOfQuantityItem:a,gridOpts:{editable:b.canEdit,structure:n,store:new dojo.data.ItemFileWriteStore({url:"scheduleOfQuantity/getBuildUpItemList/id/"+a.id+"/t/i",
clearOnClose:!0})}})}),g.addChild(c),g.startup(),g.selectChild(c));f.addChild(g);if(c=dijit.byId("scheduleOfQuantityGrid"+e+"-stackContainer")){var h=document.createElement("div"),h=new dojox.layout.ContentPane({title:buildspace.truncateString(a.description,50)+" ("+d.buildUpQuantity+" - "+a.uom_symbol+")",id:"buildUpQuantityPage-"+a.id,style:"padding:0;border:none!important;",content:f,executeScripts:!0},h);c.addChild(h);c.selectChild("buildUpQuantityPage-"+a.id)}})}catch(K){console.log(K)}},makeTab:function(a,
c,d){var b=dijit.byId("scheduleOfQuantityGrid"+a+"-stackContainer");b&&dijit.byId("scheduleOfQuantityGrid"+a+"-stackContainer").destroyRecursive();b=new dijit.layout.StackContainer({style:"width:100%;height:100%;",region:"center",id:"scheduleOfQuantityGrid"+a+"-stackContainer"});b.addChild(new dijit.layout.ContentPane({title:c,content:d,grid:d.grid}));d=new dijit.layout.StackController({region:"top",containerId:"scheduleOfQuantityGrid"+a+"-stackContainer"});var e=new dijit.layout.BorderContainer({style:"padding:0px;width:100%;height:100%;",
gutters:!1});e.addChild(b);e.addChild(new dijit.layout.ContentPane({style:"padding: 0px; overflow: hidden;","class":"breadCrumbTrail",region:"top",content:d}));b=new dijit.layout.ContentPane({closable:!0,style:"padding: 0px; overflow: hidden;",title:buildspace.truncateString(c,30),content:e});this.tabContainer.addChild(b);this.tabContainer.selectChild(b);dojo.subscribe("scheduleOfQuantityGrid"+a+"-stackContainer-selectChild","",function(b){var c=dijit.byId("scheduleOfQuantityGrid"+a+"-stackContainer");
if(c){var d=c.getChildren(),e=dojo.indexOf(d,b),e=e+1;if(d.length>e){for(;d.length>e;)c.removeChild(d[e]),d[e].destroyRecursive(!0),e+=1;var f=b.grid.selection.selectedIndex;b.grid.store.save();b.grid.store.close();var g=u.after(b.grid,"_onFetchComplete",function(){g.remove();-1<f&&(this.scrollToRow(f),this.selection.setSelected(f,!0))});b.grid.sort()}}});b.lib_info={name:c,id:a}},getModuleTitle:function(){var a;switch(this.type){case buildspace.constants.STATUS_PRETENDER:a=d.ProjectBuilder;break;
case buildspace.constants.STATUS_TENDERING:a=d.tendering;break;default:a=d.ProjectBuilder}return a},createDialogForImportCubitFile:function(a,c){var e;e=new buildspace.dialog.indeterminateProgressBar({title:""+d.pleaseWait+"..."});e.show();return A("scheduleOfQuantityImport/getImportFilePermission",{query:{scheduleOfQuantityId:a.id[0]},handleAs:"json"}).then(function(b){e.hide();return(new E({title:d.importFromCubit,scheduleOfQuantityId:a.id[0],scheduleOfQuantityGrid:c,formInfo:b})).show()},function(a){return e.hide()})},
kill:function(){"undefined"!=typeof this.win&&this.win.close()}})});
