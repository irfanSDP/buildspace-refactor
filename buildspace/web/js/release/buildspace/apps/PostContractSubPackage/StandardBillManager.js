define("buildspace/apps/PostContractSubPackage/StandardBillManager","dojo/_base/declare dojo/dom-style dojo/when dojo/number dojo/currency dijit/layout/ContentPane dojox/grid/EnhancedGrid buildspace/widget/grid/cells/Formatter buildspace/apps/ProjectBuilder/BillManager/ScheduleOfQuantityGrid ./BillManager/buildUpQuantityGrid ./BillManager/buildUpQuantitySummary dojo/aspect dojo/i18n!buildspace/nls/PostContractSubPackage ./BillManager/StandardBillGrid ./BillManager/lumpSumPercentDialog buildspace/widget/grid/cells/Textarea".split(" "),
function(p,D,E,q,F,G,w,u,x,H,y,z,f,v,A){var C=p("buildspace.apps.PostContractSubPackage.TypeGrid",w,{rootProject:null,style:"border:none;",region:"center",pageId:null,billId:null,subPackage:null,updateUrl:null,keepSelection:!0,rowSelector:"0px",constructor:function(a){var c=new u;this.structure={noscroll:!1,cells:[[{name:"No.",field:"count",width:"30px",styles:"text-align:center;",formatter:B.rowCountCellFormatter,rowSpan:2},{name:f.description,field:"description",width:"auto",formatter:c.typeListTreeCellFormatter,
rowSpan:2},{name:f.renameDescription,field:"new_name",width:"180px",editable:"true",cellType:"buildspace.widget.grid.cells.Textarea",rowSpan:2,styles:"text-align:center;",formatter:c.typeListLevelFormatter},{name:f.amount,field:"total_per_unit",width:"120px",styles:"text-align: right;color:blue;",formatter:c.unEditableCurrencyCellFormatter,rowSpan:2},{name:f.percent,field:"up_to_date_percentage",width:"120px",headerClasses:"typeHeader1",formatter:c.unEditablePercentageCellFormatter,styles:"text-align: right;"},
{name:f.amount,field:"up_to_date_amount",width:"120px",headerClasses:"typeHeader1",formatter:c.unEditableCurrencyCellFormatter,styles:"text-align: right;"}],[{name:f.upToDateClaim,styles:"text-align:center;",headerClasses:"staticHeader typeHeader1",colSpan:2}]]};this.inherited(arguments)},canSort:function(a){return!1},dodblclick:function(a){this.onRowDblClick(a)},canEdit:function(a,c){var b=this;if(void 0!=a&&0===this.getItem(c).level[0])window.setTimeout(function(){b.edit.cancel();b.focus.setFocusIndex(c,
a.index)},10);else return this._canEdit},onStyleRow:function(a){this.inherited(arguments);if(a.node.children[0]&&2<=a.node.children[0].children[0].rows.length){var c=a.node.children[0].children[0].rows[1],b=a.node.children[0].children[0].rows[0].children;c.parentNode.removeChild(c);dojo.forEach(b,function(a,c){var b=dojo.attr(a,"rowSpan");(!b||2>b)&&dojo.attr(a,"rowSpan",2)})}},doApplyCellEdit:function(a,c,b){var d=this,e=d.getItem(c),g=d.store;if(void 0!=e[b][0]||a!==e[b][0]){var h=buildspace.dialog.indeterminateProgressBar({title:f.pleaseWait+
"..."}),l={id:e.id,project_id:d.rootProject.id,type_id:e.relation_id,counter:e.count,attr_name:b,val:a},k=this.updateUrl,m=function(a,c){for(var b in a)e.hasOwnProperty(b)&&b!=c._getIdentifierAttribute()&&c.setValue(e,b,a[b]);c.save()};h.show().then(function(){dojo.xhrPost({url:k,content:l,handleAs:"json",load:function(a){if(a.success){m(a.item,g);var e=d.getCellByField(b);window.setTimeout(function(){d.focus.setFocusIndex(c,e.index)},10);h.hide()}},error:function(a){h.hide();console.log(a)}})})}d.inherited(arguments)},
reload:function(){this.store.close();this._refresh()}}),B={rowCountCellFormatter:function(a,c,b){c=this.grid.getItem(c);void 0!=c.type&&1>c.type&&b.customClasses.push("invalidTypeItemCell");return 0<a?a:""}};return p("buildspace.apps.PostContractSubPackage.StandardBillManager",dijit.layout.BorderContainer,{style:"padding:0px;border:0px;width:100%;height:100%;",gutters:!1,billId:null,subPackage:null,rootProject:null,postCreate:function(){this.inherited(arguments);var a=this;a.createTypeGrid();dojo.subscribe("subPackagePostContractStandardBill"+
a.billId+"-stackContainer-selectChild","",function(c){var b=dijit.byId("subPackagePostContractStandardBill"+a.billId+"-stackContainer");if(b){var d=b.getChildren(),e=dojo.indexOf(d,dijit.byId(c)),e=e+1;if(d.length>e){for(;d.length>e;)b.removeChild(d[e]),d[e].destroyDescendants(),d[e].destroyRecursive(),e+=1;if(c.grid){var g=c.grid.selection.selectedIndex;c.grid.store.save();c.grid.store.close();var f=z.after(c.grid,"_onFetchComplete",function(){f.remove();-1<g&&(this.scrollToRow(g),this.selection.setSelected(g,
!0))});c.grid.sort()}}}})},createTypeGrid:function(){var a=this,c=dijit.byId("subPackagePostContractStandardBill"+this.billId+"-stackContainer");c&&dijit.byId("subPackagePostContractStandardBill"+this.billId+"-stackContainer").destroyRecursive();var c=this.stackContainer=new dijit.layout.StackContainer({style:"border:0px;width:100%;height:100%;",region:"center",id:"subPackagePostContractStandardBill"+this.billId+"-stackContainer"}),b=this;dojo.xhrGet({url:"postContractSubPackage/getBillInfo",handleAs:"json",
content:{id:this.billId,sub_package_id:this.subPackage.id}}).then(function(d){try{var e=dojo.data.ItemFileWriteStore({url:"subPackagePostContractStandardBillClaim/getTypeList/id/"+a.billId+"/sub_package_id/"+a.subPackage.id,clearOnClose:!0}),g=new C({billId:b.billId,rootProject:b.rootProject,subPackage:b.subPackage,pageId:"type-page-"+b.billId,id:"type-page-container-"+b.billId,updateUrl:"subPackagePostContractStandardBillClaim/updateTypeList",store:e,onRowDblClick:function(a){a=this.getItem(a.rowIndex);
0<a.level[0]&&b.createElementGrid(a,d,g)}}),h=new dijit.layout.ContentPane({title:f.type+" / "+f.unit,content:g,grid:g}),l=new dijit.layout.StackController({region:"top",containerId:"subPackagePostContractStandardBill"+b.billId+"-stackContainer"});c.addChild(h);var k=new dijit.layout.ContentPane({style:"padding:0px;overflow:hidden;",baseClass:"breadCrumbTrail",region:"top",id:"billGrid"+b.billId+"-controllerPane",content:l});b.addChild(c);b.addChild(k)}catch(m){console.debug(m)}})},createElementGrid:function(a,
c,b){var d=this;dojo.xhrGet({url:"subPackagePostContractStandardBillClaim/getTypeItem",handleAs:"json",content:{type_id:a.relation_id,project_id:d.rootProject.id,counter:a.count}}).then(function(a){var b=dojo.data.ItemFileWriteStore({url:"subPackagePostContractStandardBillClaim/getBillElementList/id/"+d.billId+"/project_id/"+d.rootProject.id+"/sub_package_id/"+d.subPackage.id+"/type_ref_id/"+a.id,clearOnClose:!0,urlPreventCache:!0}),e=new v({stackContainerTitle:0<a.new_name.length?a.relation_name+
" :: "+a.new_name:a.relation_name+" :: "+a.description,billId:d.billId,subPackage:d.subPackage,rootProject:d.rootProject,pageId:"element-page-"+d.billId,id:"element-page-container-"+d.billId,typeItem:a,gridOpts:{store:b,updateUrl:"subPackagePostContractStandardBillClaim/standardBillClaimElementUpdate",typeColumns:c.column_settings,bqCSRFToken:c.bqCSRFToken,claimRevision:c.claim_project_revision_status,selectedClaimRevision:c.current_selected_claim_project_revision_status,currentGridType:"element",
onRowDblClick:function(b){b=this.getItem(b.rowIndex);0<b.id[0]&&null!==b.description[0]&&""!==b.description[0]&&d.createItemGrid(b,a,c,e)}}})})},createItemGrid:function(a,c,b,d){var e=this.billId,g=this,h=new dojo.data.ItemFileWriteStore({url:"subPackagePostContractStandardBillClaim/getItemList/id/"+a.id+"/bill_id/"+e+"/type_ref_id/"+a.claim_type_ref_id+"/project_id/"+g.rootProject.id+"/sub_package_id/"+g.subPackage.id,clearOnClose:!0});try{new v({stackContainerTitle:a.description,billId:e,disableEditing:!1,
rootProject:g.rootProject,subPackage:g.subPackage,id:"item-page-container-"+e,elementId:a.id,pageId:"item-page-"+e,type:"tree",typeItem:c,gridOpts:{store:h,escapeHTMLInData:!1,elementGridStore:d,claimRevision:b.claim_project_revision_status,selectedClaimRevision:b.current_selected_claim_project_revision_status,updateUrl:"subPackagePostContractStandardBillClaim/standardBillClaimUpdate",currentGridType:"item",onRowDblClick:function(a){var b=a.cell.field,d=this.getItem(a.rowIndex);if("qty_per_unit"==
b&&d[b+"-has_build_up"][0]){var e=c.relation_id,l=dojo.xhrPost({url:"billBuildUpQuantity/getDimensionColumnStructure",content:{uom_id:d.uom_id[0]},handleAs:"json"}),h=buildspace.dialog.indeterminateProgressBar({title:f.pleaseWait+"..."});h.show().then(function(){l.then(function(a){g.createBuildUpQuantityContainer(d,a,e);h.hide()})})}},editableCellDblClick:function(a){var b=a.cell.field;a=this.getItem(a.rowIndex);var c=this.store,e=!1;if("rate"==b&&0<a.id){if(q.parse(a.up_to_date_percentage)||q.parse(a.current_percentage)||
q.parse(a.prev_percentage))e=!0;a.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM_PERCENT&&(new A({itemObj:a,projectId:g.rootProject.id,billGridStore:c,elementGridStore:d,disableEditingMode:e})).show()}}}})}catch(l){console.debug(l)}},createBuildUpQuantityContainer:function(a,c,b){var d=this,e,g=new dijit.layout.BorderContainer({style:"padding:0;margin:0;width:100%;height:100%;border:none;outline:none;",gutters:!1}),h=new dijit.layout.TabContainer({nested:!0,style:"padding:0;border:none;margin:0;width:100%;height:100%;",
region:"center"}),l=buildspace.constants.QUANTITY_PER_UNIT_ORIGINAL,k=new u,m=dojo.xhrGet({url:"billBuildUpQuantity/getLinkInfo/id/"+a.id+"/bcid/"+b+"/t/"+l,handleAs:"json"}),q=new dojo.data.ItemFileWriteStore({url:"billBuildUpQuantity/getBuildUpQuantityItemList/bill_item_id/"+a.id+"/bill_column_setting_id/"+b+"/type/"+l,clearOnClose:!0}),t=!1,p=buildspace.dialog.indeterminateProgressBar({title:f.pleaseWait+"..."});p.show();m.then(function(n){var m=[{name:"No",field:"id",styles:"text-align:center;",
width:"30px",formatter:k.rowCountCellFormatter},{name:f.description,field:"description",width:"auto",cellType:"buildspace.widget.grid.cells.Textarea"},{name:f.factor,field:"factor-value",width:"100px",styles:"text-align:right;",formatter:k.formulaNumberCellFormatter}];dojo.forEach(c,function(a){m.push({name:a.title,field:a.field_name,width:"100px",styles:"text-align:right;",formatter:k.formulaNumberCellFormatter})});m.push({name:f.total,field:"total",width:"100px",styles:"text-align:right;",formatter:k.numberCellFormatter});
m.push({name:f.sign,field:"sign",width:"70px",styles:"text-align:center;",formatter:k.signCellFormatter});var r=new y({itemId:a.id,billColumnSettingId:b,type:l,hasLinkedQty:n.has_linked_qty,container:g,_csrf_token:a._csrf_token,disableEditingMode:!0});n.has_linked_qty&&(t=!0,e=x({title:f.scheduleOfQuantities,BillItem:a,billColumnSettingId:b,disableEditingMode:!0,stackContainerId:"subPackagePostContractStandardBill"+d.billId+"-stackContainer",gridOpts:{qtyType:l,buildUpSummaryWidget:r,store:new dojo.data.ItemFileWriteStore({url:"billBuildUpQuantity/getScheduleOfQuantities/id/"+
a.id+"/bcid/"+b+"/type/"+l,clearOnClose:!0}),structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:k.rowCountCellFormatter},{name:f.description,field:"description",width:"auto",formatter:k.treeCellFormatter},{name:f.type,field:"type",width:"70px",styles:"text-align:center;",formatter:k.typeCellFormatter},{name:f.unit,field:"uom_id",width:"70px",styles:"text-align:center;",formatter:k.unitIdCellFormatter},{name:f.qty,field:"quantity-value",width:"100px",styles:"text-align:right;",
formatter:k.formulaNumberCellFormatter}]}}));n=new dojox.grid.EnhancedGrid({title:f.manualQtyItems,region:"center",store:q,structure:m});h.addChild(n);t&&h.addChild(e);g.addChild(h);g.addChild(r);if(r=dijit.byId("subPackagePostContractStandardBill"+d.billId+"-stackContainer"))n=document.createElement("div"),n=new dojox.layout.ContentPane({title:buildspace.truncateString(a.description,45)+" ("+f.buildUpQuantity+" - "+a.uom_symbol+")",id:"subPackageBuildUpQuantityPage-"+a.id,style:"padding:0px;border:0px;",
content:g,grid:t?e.grid:null,executeScripts:!0},n),r.addChild(n),r.selectChild("subPackageBuildUpQuantityPage-"+a.id);p.hide()})}})});
