define("buildspace/apps/PostContractSubPackage/VariationOrder/VariationOrderItemContainer","dojo/_base/declare dojo/_base/lang dojo/currency dojo/number dojo/when dojo/aspect dijit/layout/TabContainer dijit/layout/ContentPane ./VariationOrderGrid ./buildUpQuantityGrid ./buildUpQuantitySummary ./VariationOrderClaim ./BillDialog buildspace/apps/ProjectBuilder/BillManager/ScheduleOfQuantityGrid buildspace/widget/grid/cells/Formatter dojo/i18n!buildspace/nls/PostContract".split(" "),function(r,w,m,e,
x,y,z,A,B,C,D,E,F,G,t,b){var H=function(c,a,d){a=this.grid.getItem(a);a.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER||a.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_N||a.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_NOID||a.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_RATE_ONLY?(d.customClasses.push("disable-cell"),c="&nbsp;"):(0<a.bill_item_id[0]||!a.can_be_edited[0])&&d.customClasses.push("disable-cell");return c},I=function(c,a,d){var b=e.parse(c);
a=this.grid.getItem(a);isNaN(b)||0==b||null==b?c="&nbsp;":(c=m.format(b),c=0<=b?c:'<span style="color:#FF0000">'+c+"</span>");a.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER||a.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_N||a.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_NOID||a.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_RATE_ONLY?d.customClasses.push("disable-cell"):0<a.bill_item_id[0]&&d.customClasses.push("disable-cell");return c},J=function(c,
a,b){a=this.grid.getItem(a);c=e.parse(c);var d="&nbsp;";a.can_be_edited[0]||b.customClasses.push("disable-cell");isNaN(c)||0==c||null==c||(d=e.format(c,{places:2}));a.type!=buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER&&a.type!=buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_N&&a.type!=buildspace.widget.grid.constants.HIERARCHY_TYPE_NOID&&a.type!=buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_RATE_ONLY||b.customClasses.push("disable-cell");return void 0!=a.has_addition_build_up_quantity&&
a.has_addition_build_up_quantity[0]?'<span style="color:#0000FF;"><b>'+d+"</b></span>":0<=c?d:'<span style="color:#FF0000">'+d+"</span>"},K=function(c,a,b){a=this.grid.getItem(a);var d=e.parse(c);c="&nbsp;";a=0<a.id?d*e.parse(a["rate-value"][0])*e.parse(a.total_unit[0]):0;isNaN(a)||0==a||(c=m.format(a));b.customClasses.push("disable-cell");return 0<=a?c:'<span style="color:#FF0000">'+c+"</span>"},L=function(c,a,b){a=this.grid.getItem(a);c=e.parse(c);var d="&nbsp;";b.customClasses.push("disable-cell");
isNaN(c)||0==c||null==c||(d=e.format(c,{places:2}));return void 0!=a.has_omission_build_up_quantity&&a.has_omission_build_up_quantity[0]?'<span style="color:#0000FF;"><b>'+d+"</b></span>":0<=c?d:'<span style="color:#FF0000">'+d+"</span>"},M=function(c,a,b){a=this.grid.getItem(a);var d=e.parse(c);c="&nbsp;";a=0<a.id?d*e.parse(a["rate-value"][0])*e.parse(a.total_unit[0]):0;isNaN(a)||0==a||(c=m.format(a));b.customClasses.push("disable-cell");return'<span style="color:#FF0000">'+c+"</span>"},N=function(c,
a,b){a=this.grid.getItem(a);c=0<a.id?e.parse(a["omission_quantity-value"][0])*e.parse(a["rate-value"][0])*e.parse(a.total_unit[0]):0;a=0<a.id?e.parse(a["addition_quantity-value"][0])*e.parse(a["rate-value"][0])*e.parse(a.total_unit[0]):0;b.customClasses.push("disable-cell");b=a-c;return 0>b?'<span style="color:#FF0000">'+m.format(b)+"</span>":0==b?"&nbsp;":'<span style="color:#42b449;">'+m.format(b)+"</span>"};return r("buildspace.apps.PostContractSubPackage.VariationOrder.VariationOrderItemContainer",
z,{pageId:"page-00",style:"margin:0;padding:0;border:none;width:100%;height:100%;",gutters:!1,stackContainerTitle:null,gridOpts:{},subPackage:null,nested:!0,variationOrder:null,type:null,postCreate:function(){var c=this;this.inherited(arguments);w.mixin(this.gridOpts,{variationOrder:this.variationOrder,subPackage:this.subPackage,type:this.type,region:"center",tabContainerWidget:this});var a=dojo.xhrGet({url:"variationOrder/getUnits",handleAs:"json"}),d=buildspace.dialog.indeterminateProgressBar({title:b.pleaseWait+
"..."}),h=dojo.xhrGet({url:"variationOrder/getSpClaimStatus",content:{id:this.variationOrder.id},handleAs:"json"});d.show();x(a,function(a){h.then(function(b){d.hide();c.createVariationOrderItemGrid(a,b,!0);c.createVariationOrderClaimGrid(b)})});if(a=dijit.byId("SP_variationOrder-"+c.subPackage.id+"-stackContainer")){var k=document.createElement("div"),k=new dojox.layout.ContentPane({title:buildspace.truncateString(c.stackContainerTitle,45),id:this.pageId,content:this,executeScripts:!0},k);a.addChild(k);
a.selectChild(this.pageId)}},createVariationOrderItemGrid:function(c,a,d){var h=dijit.byId("SP_variationOrderItems_tab-"+this.subPackage.id+"_"+this.variationOrder.id+"-StackPane");h||(h=new dijit.layout.StackContainer({id:"SP_variationOrderItems_tab-"+this.subPackage.id+"_"+this.variationOrder.id+"-StackPane",style:"margin:0;padding:0;border:none;width:100%;height:100%;",title:b.variationOrderItems}));var k=dijit.byId("SP_variationOrderItems-"+this.subPackage.id+"_"+this.variationOrder.id+"-borderContainer");
k&&(h.removeChild(k),k.destroyRecursive());var f=this,k=[buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_TEXT,buildspace.widget.grid.constants.HIERARCHY_TYPE_WORK_ITEM_TEXT],e=[buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER,buildspace.widget.grid.constants.HIERARCHY_TYPE_WORK_ITEM],g=new t,l=dojo.data.ItemFileWriteStore({url:"variationOrder/getSpVariationOrderItemList/id/"+f.variationOrder.id,clearOnClose:!0});c=new B({subPackage:f.subPackage,variationOrder:f.variationOrder,type:0<
a.count?"vo-claims":"vo-items",locked:"true"==f.variationOrder.is_approved[0],gridOpts:{store:l,escapeHTMLInData:!1,addUrl:"variationOrder/spVariationOrderItemAdd",updateUrl:0<a.count?"variationOrder/spClaimItemUpdate":"variationOrder/spVariationOrderItemUpdate",deleteUrl:"variationOrder/spVariationOrderItemDelete",indentUrl:"variationOrder/spVariationOrderItemIndent",outdentUrl:"variationOrder/spVariationOrderItemOutdent",pasteUrl:"variationOrder/spVariationOrderItemPaste",structure:{cells:[[{name:"No",
field:"id",styles:"text-align:center;",width:"30px",formatter:g.rowCountCellFormatter,noresize:!0,rowSpan:2},{name:b.billReference,field:"bill_ref",styles:"text-align:center; color:red;",width:"80px",formatter:g.unEditableCellFormatter,noresize:!0,rowSpan:2},{name:b.totalUnit,field:"total_unit",styles:"text-align:center;",width:"70px",formatter:H,noresize:!0,rowSpan:2},{name:b.description,field:"description",width:"500px",editable:"true"!=f.variationOrder.is_approved[0],cellType:"buildspace.widget.grid.cells.Textarea",
formatter:g.treeCellFormatter,noresize:!0,rowSpan:2},{name:b.type,field:"type",width:"70px",styles:"text-align:center;",editable:"true"!=f.variationOrder.is_approved[0],type:"dojox.grid.cells.Select",options:k,values:e,formatter:g.typeCellFormatter,noresize:!0,rowSpan:2},{name:b.unit,field:"uom_id",width:"70px",editable:"true"!=f.variationOrder.is_approved[0],styles:"text-align:center;",type:"dojox.grid.cells.Select",options:c.options,values:c.values,formatter:g.unitIdCellFormatter,noresize:!0,rowSpan:2},
{name:b.rate,field:"rate-value",styles:"text-align:right;",width:"120px",editable:"true"!=f.variationOrder.is_approved[0],cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:"true"==f.variationOrder.is_approved[0]?g.unEditableCurrencyCellFormatter:I,noresize:!0,rowSpan:2},{name:b.qty,field:"omission_quantity-value",styles:"text-align:right;",width:"90px",formatter:L,noresize:!0},{name:b.total,field:"omission_quantity-value",styles:"text-align:right;",width:"120px",formatter:M,noresize:!0},
{name:b.qty,field:"addition_quantity-value",styles:"text-align:right;",width:"90px",editable:"true"!=f.variationOrder.is_approved[0],cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:J,noresize:!0},{name:b.total,field:"addition_quantity-value",styles:"text-align:right;",width:"120px",formatter:K,noresize:!0},{name:b.nettOmissionAddition,field:"id",styles:"text-align:right;",width:"120px",noresize:!0,formatter:N,rowSpan:2},{name:"%",field:"previous_percentage-value",styles:"text-align:right;",
width:"60px",formatter:g.unEditablePercentageCellFormatter,noresize:!0},{name:b.amount,field:"previous_amount-value",styles:"text-align:right;",width:"120px",formatter:g.unEditableCurrencyCellFormatter,noresize:!0},{name:"%",field:"current_percentage-value",styles:"text-align:right;",width:"60px",editable:0<a.count&&a.can_edit_claim_amount?!0:!1,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:0<a.count&&a.can_edit_claim_amount?g.editablePercentageCellFormatter:g.unEditablePercentageCellFormatter,
noresize:!0},{name:b.amount,field:"current_amount-value",styles:"text-align:right;",width:"120px",editable:0<a.count&&a.can_edit_claim_amount?!0:!1,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:0<a.count&&a.can_edit_claim_amount?g.currencyCellFormatter:g.unEditableCurrencyCellFormatter,noresize:!0},{name:"%",field:"up_to_date_percentage-value",styles:"text-align:right;",width:"60px",editable:0<a.count&&a.can_edit_claim_amount?!0:!1,cellType:"buildspace.widget.grid.cells.FormulaTextBox",
formatter:0<a.count&&a.can_edit_claim_amount?g.editablePercentageCellFormatter:g.unEditablePercentageCellFormatter,noresize:!0},{name:b.amount,field:"up_to_date_amount-value",styles:"text-align:right;",width:"120px",editable:0<a.count&&a.can_edit_claim_amount?!0:!1,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:0<a.count&&a.can_edit_claim_amount?g.currencyCellFormatter:g.unEditableCurrencyCellFormatter,noresize:!0}],[{name:b.omission,field:"id",styles:"text-align:center;",headerClasses:"staticHeader",
noresize:!0,colSpan:2},{name:b.addition,field:"id",styles:"text-align:center;",headerClasses:"staticHeader",noresize:!0,colSpan:2},{name:b.previousClaim,field:"id",styles:"text-align:center;",headerClasses:"staticHeader",noresize:!0,colSpan:2},{name:b.currentClaim,field:"id",styles:"text-align:center;",headerClasses:"staticHeader",noresize:!0,colSpan:2},{name:b.upToDateClaim,field:"id",styles:"text-align:center;",headerClasses:"staticHeader",noresize:!0,colSpan:2}]]},onRowDblClick:function(a){var c=
a.cell.field,d=this.getItem(a.rowIndex);if((this.locked||"omission_quantity-value"==c&&d.has_omission_build_up_quantity[0])&&("addition_quantity-value"==c&&d.has_addition_build_up_quantity[0]||"omission_quantity-value"==c&&d.has_omission_build_up_quantity[0])&&0<d.id&&(d.type[0]==buildspace.widget.grid.constants.HIERARCHY_TYPE_WORK_ITEM||d.type[0]==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_HTML_EDITOR||d.type[0]==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_PROVISIONAL||d.type[0]==
buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_NOT_LISTED))if(0<d.uom_id[0]){var g=this;a=dojo.xhrGet({url:"billBuildUpQuantity/getDimensionColumnStructure",content:{uom_id:d.uom_id[0]},handleAs:"json"});var h=buildspace.dialog.indeterminateProgressBar({title:b.pleaseWait+"..."}),e="addition_quantity-value"==c?"addition":"omission";h.show();a.then(function(a){f.createBuildUpQuantityContainer(d,a,e,g.locked);h.hide()},function(a){h.hide()})}else buildspace.dialog.alert(b.buildUpQtyAlert,b.pleaseSetUOM,
60,300);"total_unit"==c&&0<d.id&&(d.type[0]==buildspace.widget.grid.constants.HIERARCHY_TYPE_WORK_ITEM||d.type[0]==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_HTML_EDITOR||d.type[0]==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_PROVISIONAL||d.type[0]==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_NOT_LISTED||d.type[0]==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_RATE_ONLY||d.type[0]==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM||d.type[0]==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM_PERCENT||
d.type[0]==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM_EXCLUDE)&&F({variationOrderItem:d,variationOrder:f.variationOrder,type:"update_total_unit",locked:"true"==f.variationOrder.is_approved[0],variationOrderItemGrid:this}).show()},editableCellDblClick:function(a){var c=a.cell.field,d=this.getItem(a.rowIndex);if("addition_quantity-value"==c&&0<d.id&&(d.type[0]==buildspace.widget.grid.constants.HIERARCHY_TYPE_WORK_ITEM||d.type[0]==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_HTML_EDITOR||
d.type[0]==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_PROVISIONAL||d.type[0]==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_NOT_LISTED))if(0<d.uom_id[0]){a=dojo.xhrGet({url:"billBuildUpQuantity/getDimensionColumnStructure",content:{uom_id:d.uom_id[0]},handleAs:"json"});var g=buildspace.dialog.indeterminateProgressBar({title:b.pleaseWait+"..."});g.show();a.then(function(a){f.createBuildUpQuantityContainer(d,a,"addition",!1);g.hide()},function(a){g.hide()})}else buildspace.dialog.alert(b.buildUpQtyAlert,
b.pleaseSetUOM,60,300)}}});h.addChild(this.makeItemGridContainer(c,b.variationOrderItems));d&&this.addChild(h)},createBuildUpQuantityContainer:function(c,a,d,h){h="omission"==d?!0:h;var e=this,f,q=new dijit.layout.BorderContainer({style:"padding:0px;width:100%;height:100%;border:0px;outline:none;",gutters:!1}),g=new dijit.layout.TabContainer({nested:!0,style:"padding:0;border:none;margin:0;width:100%;height:100%;",region:"center"}),l=new t,p=dojo.xhrGet({url:"variationOrder/getSpLinkInfo/id/"+c.id+
"/t/"+d,handleAs:"json"}),m=new dojo.data.ItemFileWriteStore({url:"variationOrder/getSpBuildUpQuantityItemList/id/"+c.id+"/type/"+d,clearOnClose:!0}),O=[buildspace.constants.SIGN_POSITIVE_TEXT,buildspace.constants.SIGN_NEGATIVE_TEXT],r=[buildspace.constants.SIGN_POSITIVE,buildspace.constants.SIGN_NEGATIVE],u=!1,v=buildspace.dialog.indeterminateProgressBar({title:b.pleaseWait+"..."});v.show();p.then(function(k){var p=[{name:"No",field:"id",styles:"text-align:center;",width:"30px",formatter:l.rowCountCellFormatter},
{name:b.description,field:"description",width:"auto",editable:!h,cellType:"buildspace.widget.grid.cells.Textarea"},{name:b.factor,field:"factor-value",width:"100px",styles:"text-align:right;",editable:!h,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:l.formulaNumberCellFormatter}];dojo.forEach(a,function(a){p.push({name:a.title,field:a.field_name,width:"100px",styles:"text-align:right;",editable:!h,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:l.formulaNumberCellFormatter})});
p.push({name:b.total,field:"total",width:"100px",styles:"text-align:right;",formatter:l.numberCellFormatter});p.push({name:b.sign,field:"sign",width:"70px",styles:"text-align:center;",editable:!0,cellType:"dojox.grid.cells.Select",options:O,values:r,formatter:l.signCellFormatter});var n=new D({itemId:c.id,type:d,container:q,hasLinkedQty:k.has_linked_qty,_csrf_token:c._csrf_token,locked:h});k.has_linked_qty&&(u=!0,f=G({title:b.scheduleOfQuantities,BillItem:c,disableEditingMode:!0,stackContainerId:"SP_variationOrderItems-"+
e.subPackage.id+"_"+e.variationOrder.id+"-stackContainer",gridOpts:{qtyType:d,buildUpSummaryWidget:n,store:new dojo.data.ItemFileWriteStore({url:"variationOrder/getSpScheduleOfQuantities/id/"+c.id+"/t/"+d,clearOnClose:!0}),structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:l.rowCountCellFormatter},{name:b.description,field:"description",width:"auto",formatter:l.treeCellFormatter},{name:b.type,field:"type",width:"70px",styles:"text-align:center;",formatter:l.typeCellFormatter},
{name:b.unit,field:"uom_id",width:"70px",styles:"text-align:center;",formatter:l.unitIdCellFormatter},{name:b.qty,field:"quantity-value",width:"100px",styles:"text-align:right;",formatter:l.formulaNumberCellFormatter}]}}));g.addChild(new C({title:b.manualQtyItems,region:"center",VariationOrderItem:c,type:d,locked:h,gridOpts:{addUrl:"variationOrder/spBuildUpQuantityItemAdd",updateUrl:"variationOrder/spBuildUpQuantityItemUpdate",deleteUrl:"variationOrder/spBuildUpQuantityItemDelete",pasteUrl:"variationOrder/spBuildUpQuantityItemPaste",
store:m,structure:p,buildUpSummaryWidget:n}}));u&&g.addChild(f);q.addChild(g);q.addChild(n);if(k=dijit.byId("SP_variationOrderItems-"+e.subPackage.id+"_"+e.variationOrder.id+"-stackContainer"))n=document.createElement("div"),n=new dojox.layout.ContentPane({title:buildspace.truncateString(c.description,45)+" ("+b.buildUpQuantity+" - "+c.uom_symbol+")",id:"SP_variationOrderBuildUpQuantityPage-"+c.id,style:"padding:0px;border:0px;",content:q,executeScripts:!0},n),k.addChild(n),k.selectChild("SP_variationOrderBuildUpQuantityPage-"+
c.id);v.hide()})},createVariationOrderClaimGrid:function(c){this.addChild(new A({style:"margin:0;padding:0;border:none;width:100%;height:100%;",title:b.claimRevisions,content:new E({variationOrder:this.variationOrder,variationOrderItemContainer:this,claimStatus:c})}))},makeItemGridContainer:function(c,a){var d=this.subPackage.id+"_"+this.variationOrder.id,b=dijit.byId("SP_variationOrderItems-"+d+"-stackContainer");b&&b.destroyRecursive();b=new dijit.layout.StackContainer({style:"width:100%;height:100%;border:none;",
region:"center",id:"SP_variationOrderItems-"+d+"-stackContainer"});b.addChild(new dijit.layout.ContentPane({title:a,content:c,grid:c.grid}));var e=new dijit.layout.StackController({region:"top",containerId:"SP_variationOrderItems-"+d+"-stackContainer"}),e=new dijit.layout.ContentPane({style:"padding:0;overflow:hidden;","class":"breadCrumbTrail",region:"top",content:e}),f=dijit.byId("SP_variationOrderItems-"+d+"-borderContainer");f&&f.destroyRecursive(!0);f=new dijit.layout.BorderContainer({id:"SP_variationOrderItems-"+
d+"-borderContainer",style:"padding:0;margin:0;width:100%;height:100%;border:none;",gutters:!1,region:"center"});f.addChild(b);f.addChild(e);dojo.subscribe("SP_variationOrderItems-"+d+"-stackContainer-selectChild","",function(a){var c=dijit.byId("SP_variationOrderItems-"+d+"-stackContainer");if(c){var b=c.getChildren(),e=dojo.indexOf(b,a),e=e+1;if(b.length>e){for(;b.length>e;)c.removeChild(b[e]),b[e].destroyDescendants(),b[e].destroyRecursive(),e+=1;if(a.grid){var f=a.grid.selection.selectedIndex;
a.grid.store.save();a.grid.store.close();var h=y.after(a.grid,"_onFetchComplete",function(){h.remove();-1<f&&(this.scrollToRow(f),this.selection.setSelected(f,!0))});a.grid.sort()}}}});return f}})});
