(function(){var r={}.hasOwnProperty;define("buildspace/apps/PostContractSubPackage/ClaimRevisionSettingsForm","dojo/_base/declare dojo/html dojo/dom dojo/dom-construct dojo/keys dojo/request dojo/dom-style dojo/dom-attr dojo/dom-geometry dojo/_base/lang dijit/form/Form dijit/form/RadioButton dijit/form/Select dijit/form/ValidationTextBox dijit/form/NumberTextBox dijit/form/CurrencyTextBox dojo/number dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/on dojo/text!./templates/claimRevisionSettingsForm.html dojo/text!./templates/claimRevisionSettingsRow.html dojo/i18n!buildspace/nls/PostContractSubPackage".split(" "),
function(k,l,x,t,y,f,b,z,A,g,B,C,D,E,F,G,H,m,I,n,p,u,v,w,d){var q,h;h=buildspace.constants.MAX_CLAIM_REVISIONS;q=k("buildspace.apps.PostContractSubPackage.ClaimRevisionSettingRowForm",[m,n,p],{isNew:!1,projectId:-1,revisionId:-1,subPackage:null,subPackageId:-1,region:"center",nls:d,rootProject:null,revisionData:null,ClaimRevisionSettingsForm:null,_csrf_token:0,constructor:function(a){return a.templateString=w},postCreate:function(){var a;this.inherited(arguments);a=this;this.setSelectedCurrentSelectedRevision();
this.exitEditMode();this.updateRevisionStatusDescription(this.revisionData.locked_status);this.lockedStatusValue.set("value",this.revisionData.locked_status);return u(this.showRevisionSelectedLink,"click",function(c){return a.assignNewSelectedRevision()})},assignNewSelectedRevision:function(){var a,c;c=this;a=new buildspace.dialog.indeterminateProgressBar({title:"Processing..."});a.show();return f.post("postContractSubPackage/assignNewSelectedRevision",{data:{sub_package_id:this.revisionData.sub_package_id,
revisionId:this.revisionId,"sub_package_post_contract_claim_revision[sub_package_id]":this.revisionData.sub_package_id,"sub_package_post_contract_claim_revision[current_selected_revision]":!0,"sub_package_post_contract_claim_revision[_csrf_token]":this._csrf_token},handleAs:"json",preventCache:!0}).then(function(e){c.ClaimRevisionSettingsForm.revisionDatas=e;a.hide();return c.ClaimRevisionSettingsForm.clearOldRevisionAndAddNewRevision()},function(c){console.log(c);return a.hide()})},save:function(){var a,
c,e;a=this.ClaimRevisionSettingsForm;e=this;c=new buildspace.dialog.indeterminateProgressBar({title:"Processing..."});c.show();f.post("postContractSubPackage/saveClaimRevision",{data:{sub_package_id:this.revisionData.sub_package_id,revisionId:this.revisionId,"sub_package_post_contract_claim_revision[sub_package_id]":this.revisionData.sub_package_id,"sub_package_post_contract_claim_revision[version]":this.revisionData.version,"sub_package_post_contract_claim_revision[locked_status]":this.lockedStatusValue.value,
"sub_package_post_contract_claim_revision[_csrf_token]":this._csrf_token},handleAs:"json",preventCache:!0}).then(function(b){c.hide();e.revisionId=b.item.id;e.updateRevisionStatusDescription(b.item.locked_status);l.set(e.updatedAtView,b.item.updated_at);return g.hitch(a,"closeElementItemGrid")()},function(a){console.log(a);return c.hide()});return this.exitEditMode()},setSelectedCurrentSelectedRevision:function(){if(this.revisionData.selected)return b.set(this.showRevisionSelectedMarker,"display",
"block"),dijit.byId(this.rootProject.id[0]+"-ProjectRevision").set("title",d.claimRevision+"::"+d.version+" "+this.revisionData.version),b.set(this.showRevisionSelectedLink,"display","none");b.set(this.showRevisionSelectedMarker,"display","none");return b.set(this.showRevisionSelectedLink,"display","block")},enterEditMode:function(){return this.setupEditMode()},setupEditMode:function(){b.set(this.addendumStatusInput,"display","");b.set(this.addendumStatusView,"display","none");b.set(this.editButton.domNode,
"display","none");return b.set(this.saveButton.domNode,"display","")},exitEditMode:function(){b.set(this.addendumStatusInput,"display","none");b.set(this.addendumStatusView,"display","");b.set(this.editButton.domNode,"display","");return b.set(this.saveButton.domNode,"display","none")},updateRevisionStatusDescription:function(a){l.set(this.addendumStatusView,a?d.addendumLocked:d.addendumProgressing);return a&&this.ClaimRevisionSettingsForm.tableCount!==h+2?this.ClaimRevisionSettingsForm.addClaimButton.set("disabled",
!1):this.ClaimRevisionSettingsForm.addClaimButton.set("disabled",!0)},hideActionButton:function(){b.set(this.editButton.domNode,"display","none");b.set(this.saveButton.domNode,"display","none");return b.set(this.noActionLabel,"display","")}});return k("buildspace.apps.PostContractSubPackage.ClaimRevisionSettingsForm",[m,n,p],{projectId:-1,baseClass:"buildspace-form",style:"padding:5px;overflow:auto;border:0px;",region:"center",rootProject:null,subPackage:null,subPackageId:-1,nls:d,workarea:null,revisionDatas:null,
_csrf_token:0,tableCount:1,rowArray:[],constructor:function(a){return a.templateString=v},postMixInProperties:function(){this.inherited(arguments);return this.rowArray[this.projectId]=[]},postCreate:function(){this.inherited(arguments);return this.masterGenerateClaimRevisionTableRow()},masterGenerateClaimRevisionTableRow:function(){var a,c=this;a=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});a.show();return dojo.xhrGet({url:"postContractSubPackage/getClaimRevisionLists",handleAs:"json",
content:{id:this.subPackage.id},load:function(e){c.revisionDatas=e;c.populateClaimRevisionTableRow();c.subPackageId=e.subPackageId;return a.hide()},error:function(c){return a.hide()}})},addClaim:function(){var a,c,b;b=this;a=this.tableCount;c=new buildspace.dialog.indeterminateProgressBar({title:"Processing..."});c.show();return f.post("postContractSubPackage/saveClaimRevision",{data:{revisionId:-1,sub_package_id:this.subPackageId,"sub_package_post_contract_claim_revision[sub_package_id]":this.subPackageId,
"sub_package_post_contract_claim_revision[version]":a,"sub_package_post_contract_claim_revision[locked_status]":!1,"sub_package_post_contract_claim_revision[_csrf_token]":this._csrf_token},handleAs:"json",preventCache:!0}).then(function(a){b.revisionDatas=a;c.hide();return b.clearOldRevisionAndAddNewRevision()},function(a){console.log(a);return c.hide()})},clearOldRevisionAndAddNewRevision:function(){this.rowArray[this.projectId]=[];this.tableCount=1;dojo.empty(this.tableContainer);this.populateClaimRevisionTableRow();
return g.hitch(this,"closeElementItemGrid")()},populateClaimRevisionTableRow:function(){var a,c,b,d;this._csrf_token=this.revisionDatas.form.csrf_token;d=this.revisionDatas.claimRevisions;for(c in d)r.call(d,c)&&(b=d[c],a=this.rowArray[this.projectId][c]=new q({count:this.tableCount,rootProject:this.rootProject,projectId:this.projectId,revisionId:b.id,subPackage:this.subPackage,subPackageId:b.sub_package_id,revisionData:b,ClaimRevisionSettingsForm:this,_csrf_token:this.revisionDatas.form.csrf_token}),
0<c&&this.rowArray[this.projectId][c-1].hideActionButton(),this.addTableRow(a));if(!b.locked_status||this.tableCount===h+2)return this.addClaimButton.set("disabled",!0)},addTableRow:function(a){t.place(a.domNode,this.tableContainer);return this.tableCount++},closeElementItemGrid:function(){return g.hitch(this.workarea,"removeBillTab")()}})})}).call(this);
