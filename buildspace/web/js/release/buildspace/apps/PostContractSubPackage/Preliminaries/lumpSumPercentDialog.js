define("buildspace/apps/PostContractSubPackage/Preliminaries/lumpSumPercentDialog","dojo/_base/declare dojo/_base/lang dojo/when dojo/html dojo/dom dojo/keys dojo/dom-style dijit/form/Form dijit/form/CurrencyTextBox dijit/form/NumberTextBox dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/lumpSumPercentForm.html dojo/currency dojo/number dojo/i18n!buildspace/nls/PostContractSubPackage".split(" "),function(e,u,v,w,x,k,l,y,z,A,m,n,
p,q,r,B,h,c){var t=e("buildspace.apps.PostContractSubPackage.Preliminaries.LumpSumPercentForm",[m,n,p,q],{templateString:r,baseClass:"buildspace-form",style:"outline:none;",itemObj:null,nls:c,billGridStore:null,elementGridStore:null,region:"center",disableEditingMode:!1,constructor:function(a){this.inherited(arguments);this.currencyAbbreviation=buildspace.billCurrencyAbbreviation?buildspace.billCurrencyAbbreviation:buildspace.currencyAbbreviation},postCreate:function(){this.inherited(arguments);var a=
this;dojo.connect(this.rateNode,"onKeyUp",function(){a.updateTotal()});dojo.connect(this.percentageNode,"onKeyUp",function(){a.updateTotal()});this.percentageNode.set("readOnly",!0);this.rateNode.set("readOnly",this.disableEditingMode)},startup:function(){this.inherited(arguments);var a=this,b=buildspace.dialog.indeterminateProgressBar({title:c.pleaseWait+"..."});b.show().then(function(){dojo.xhrGet({url:"postContractPreliminaries/lumpSumPercentageForm",handleAs:"json",content:{id:this.itemObj.id},
load:function(d){a.lumpSumPercentageForm.setFormValues(d);b.hide()},error:function(a){b.hide()}})})},submit:function(a){var b=buildspace.dialog.indeterminateProgressBar({title:c.savingData+"..."}),d=this,f=this.billGridStore,g=dojo.formToObject(d.lumpSumPercentageForm.id),e={url:"postContractPreliminaries/lumpSumPercentageUpdate",content:{id:g.id,rate:g["bill_item_lump_sum_percentage[amount]"],_csrf_token:g["bill_item_lump_sum_percentage[_csrf_token]"]},handleAs:"json",load:function(c){b.hide();var e=
c.data;c.success&&(f.fetchItemByIdentity({identity:d.itemObj.id,onItem:function(a){for(var b in e)a.hasOwnProperty(b)&&b!=f._getIdentifierAttribute()&&f.setValue(a,b,e[b]);f.save()}}),a.hide())},error:function(c){b.hide();a.hide()}};this.lumpSumPercentageForm.validate()&&b.show().then(function(){dojo.xhrPost(e)})},updateTotal:function(){var a=isNaN(this.rateNode.get("value"))?0:this.rateNode.get("value"),b=isNaN(this.percentageNode.get("value"))?0:this.percentageNode.get("value"),a=h.parse(a)*(h.parse(b)/
100);this.amountNode.set("value",a)}});return e("buildspace.apps.PostContractSubPackage.Preliminaries.LumpSumPercentDialog",dijit.Dialog,{style:"padding:0;margin:0;",title:c.lumpSumPercentage,itemObj:null,billGridStore:null,elementGridStore:null,disableEditingMode:!1,buildRendering:function(){var a=this.createContent();a.startup();this.content=a;this.inherited(arguments)},postCreate:function(){l.set(this.containerNode,{padding:"0px",margin:"0px"});this.closeButtonNode.style.display="none";this.inherited(arguments)},
_onKey:function(a){a.keyCode==k.ESCAPE&&dojo.stopEvent(a)},onHide:function(){this.destroyRecursive()},createContent:function(){var a=new dijit.layout.BorderContainer({style:"padding:0;margin:0;width:400px;height:150px;",gutters:!1}),b=new t({itemObj:this.itemObj,billGridStore:this.billGridStore,elementGridStore:this.elementGridStore,disableEditingMode:this.disableEditingMode}),d=new dijit.Toolbar({region:"top",style:"outline:none!important;padding:2px;overflow:hidden;"});d.addChild(new dijit.form.Button({label:c.save,
iconClass:"icon-16-container icon-16-save",style:"outline:none!important;",disabled:this.disableEditingMode,onClick:dojo.hitch(b,"submit",this)}));d.addChild(new dijit.ToolbarSeparator);d.addChild(new dijit.form.Button({label:c.close,iconClass:"icon-16-container icon-16-close",style:"outline:none!important;",onClick:dojo.hitch(this,"hide")}));a.addChild(d);a.addChild(b);return a}})});
