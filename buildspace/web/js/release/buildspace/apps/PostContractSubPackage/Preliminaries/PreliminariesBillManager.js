define("buildspace/apps/PostContractSubPackage/Preliminaries/PreliminariesBillManager","dojo/_base/declare dojo/dom-style dojo/when dojo/currency dijit/layout/AccordionContainer dijit/layout/ContentPane dojox/grid/EnhancedGrid buildspace/widget/grid/cells/Formatter buildspace/apps/ProjectBuilder/BillManager/ScheduleOfQuantityGrid dojo/aspect dojo/request ./PreliminariesBillGrid ./buildUpQuantitySummary ./buildUpQuantityGrid ./TimeBasedFormDialog ./WorkBasedFormDialog ./lumpSumPercentDialog dojo/i18n!buildspace/nls/PostContractSubPackage".split(" "),
function(v,E,w,F,G,H,I,x,y,z,q,n,A,J,B,C,D,g){return v("buildspace.apps.PostContractSubPackage.PrelimBillManager",dijit.layout.BorderContainer,{style:"padding:0;margin:0;border:none;width:100%;height:100%;",gutters:!1,billId:null,rootProject:null,subPackage:null,bqVersion:0,columnData:null,currentBillType:null,currentSelectedClaimRevision:null,currentClaimRevision:null,gridEditable:!0,postCreate:function(){this.inherited(arguments);var a=this;this.createElementGrid();dojo.subscribe("subPackageBillGrid"+
a.billId+"-stackContainer-selectChild","",function(f){var c=dijit.byId("subPackageBillGrid"+a.billId+"-stackContainer");if(c){var b=c.getChildren(),d=dojo.indexOf(b,dijit.byId(f)),d=d+1;if(b.length>d){for(;b.length>d;)c.removeChild(b[d]),b[d].destroyDescendants(),b[d].destroyRecursive(),d+=1;if(f.grid){var e=f.grid.selection.selectedIndex;f.grid.store.save();f.grid.store.close();var h=z.after(f.grid,"_onFetchComplete",function(){h.remove();-1<e&&(this.scrollToRow(e),this.selection.setSelected(e,!0))});
f.grid.sort()}}}})},createElementGrid:function(){var a=this,f=dijit.byId("subPackageBillGrid"+this.billId+"-stackContainer");f&&dijit.byId("subPackageBillGrid"+this.billId+"-stackContainer").destroyRecursive();var f=this.stackContainer=new dijit.layout.StackContainer({style:"border:0px;width:100%;height:100%;",region:"center",id:"subPackageBillGrid"+this.billId+"-stackContainer"}),c=this;dojo.xhrGet({url:"postContractSubPackage/getBillInfo",handleAs:"json",content:{id:this.billId,sub_package_id:this.subPackage.id}}).then(function(b){try{c.currentBillType=
b.bill_type.type;c.currentSelectedClaimRevision=b.current_selected_claim_project_revision_status;c.currentClaimRevision=b.claim_project_revision_status;if(c.currentClaimRevision.locked_status||c.currentClaimRevision.id!=c.currentSelectedClaimRevision.id)c.gridEditable=!1;var d=dojo.data.ItemFileWriteStore({url:"subPackagePostContractPreliminaries/getElementList/id/"+a.billId+"/sub_package_id/"+a.subPackage.id,clearOnClose:!0,urlPreventCache:!0}),e=new n({stackContainerTitle:"Element",billId:c.billId,
rootProject:c.rootProject,subPackage:c.subPackage,pageId:"sub_package_element-page-"+c.billId,id:"sub_package_element-page-container-"+c.billId,gridOpts:{store:d,typeColumns:b.column_settings,markupSettings:b.markup_settings,bqCSRFToken:b.bqCSRFToken,currentBillType:c.currentBillType,currentSelectedClaimRevision:c.currentSelectedClaimRevision,currentClaimRevision:c.currentClaimRevision,currentGridType:"element",gridEditable:c.gridEditable,onRowDblClick:function(a){a=this.getItem(a.rowIndex);0<a.id[0]&&
null!==a.description[0]&&""!==a.description[0]&&c.createItemGrid(a,b,e)}}}),h=new dijit.layout.StackController({region:"top",containerId:"subPackageBillGrid"+c.billId+"-stackContainer"}),g=new dijit.layout.ContentPane({style:"padding:0px;overflow:hidden;",baseClass:"breadCrumbTrail",region:"top",id:"subPackageBillGrid"+c.billId+"-controllerPane",content:h});c.addChild(f);c.addChild(g)}catch(k){console.debug(k)}})},createItemGrid:function(a,f,c){var b=this,d={options:[buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_TEXT,
buildspace.widget.grid.constants.HIERARCHY_TYPE_WORK_ITEM_TEXT,buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_HTML_EDITOR_TEXT,buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_PROVISIONAL_TEXT,buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_PC_RATE_TEXT,buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_RATE_ONLY_TEXT,buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_NOT_LISTED_TEXT,buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM_TEXT,buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM_PERCENT_TEXT,
buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM_EXCLUDE_TEXT,buildspace.widget.grid.constants.HIERARCHY_TYPE_NOID_TEXT],values:[buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER,buildspace.widget.grid.constants.HIERARCHY_TYPE_WORK_ITEM,buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_HTML_EDITOR,buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_PROVISIONAL,buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_PC_RATE,buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_RATE_ONLY,
buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_NOT_LISTED,buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM,buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM_PERCENT,buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM_EXCLUDE,buildspace.widget.grid.constants.HIERARCHY_TYPE_NOID]},e={options:[buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_TEXT],values:[buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER]},h=dojo.xhrGet({url:"billManager/getUnits/billId/"+
b.billId,handleAs:"json"}),l=buildspace.dialog.indeterminateProgressBar({title:g.pleaseWait+"..."});l.show();h.then(function(b){return b});var k=new dojo.data.ItemFileWriteStore({url:"subPackagePostContractPreliminaries/getItemList/id/"+a.id+"/bill_id/"+b.billId+"/sub_package_id/"+b.subPackage.id,clearOnClose:!0});return w(h,function(h){l.hide();try{new n({stackContainerTitle:a.description,billId:b.billId,rootProject:b.rootProject,subPackage:b.subPackage,id:"sub_package_item-page-container-"+b.billId,
elementId:a.id,pageId:"sub_package_item-page-"+b.billId,type:"tree",gridOpts:{store:k,escapeHTMLInData:!1,typeColumns:f.column_settings,markupSettings:f.markup_settings,elementGridStore:c,hierarchyTypes:d,hierarchyTypesForHead:e,unitOfMeasurements:h,currentBillType:b.currentBillType,currentSelectedClaimRevision:b.currentSelectedClaimRevision,currentClaimRevision:b.currentClaimRevision,currentGridType:"item",gridEditable:b.gridEditable,onRowDblClick:function(a){var e=a.cell.field,d=this.getItem(a.rowIndex);
a=this.store;var f=e.split("-"),h=b.gridEditable?!1:!0;if(0<d.id[0]){if(d.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM_PERCENT&&"rate"===e)return 0!=d["previousClaim-amount"][0]&&(h=!0),(new D({itemObj:d,billGridStore:a,elementGridStore:c,disableEditingMode:h})).show();if("qty-qty_per_unit"===e&&d["qty-has_build_up"][0]){var k=d["qty-column_id"][0],e=dojo.xhrPost({url:"billBuildUpQuantity/getDimensionColumnStructure",content:{uom_id:d.uom_id[0]},handleAs:"json"}),l=buildspace.dialog.indeterminateProgressBar({title:g.pleaseWait+
"..."});l.show();e.then(function(a){b.createBuildUpQuantityContainer(d,a,k);l.hide()})}d.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER||d.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_N||d.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_NOID||f[0]!=buildspace.apps.PostContractSubPackage.ProjectStructureConstants.PRELIM_COLUMN_TIMEBASED&&f[0]!=buildspace.apps.PostContractSubPackage.ProjectStructureConstants.PRELIM_COLUMN_WORKBASED||(f[0]==buildspace.apps.PostContractSubPackage.ProjectStructureConstants.PRELIM_COLUMN_TIMEBASED?
b.timeBasedClaimDialog(d,b.currentClaimRevision,b.currentSelectedClaimRevision,a):f[0]==buildspace.apps.PostContractSubPackage.ProjectStructureConstants.PRELIM_COLUMN_WORKBASED&&b.workBasedClaimDialog(d,b.currentClaimRevision,b.currentSelectedClaimRevision,a))}}}})}catch(t){console.debug(t)}},function(a){})},createBuildUpQuantityContainer:function(a,f,c){var b=this,d,e=buildspace.constants.QUANTITY_PER_UNIT_ORIGINAL,h=new dijit.layout.BorderContainer({style:"padding:0;margin:0;width:100%;height:100%;border:none;outline:none;",
gutters:!1}),l=new dijit.layout.TabContainer({nested:!0,style:"padding:0;border:none;margin:0;width:100%;height:100%;",region:"center"}),k=new x,q=new dojo.data.ItemFileWriteStore({url:"billBuildUpQuantity/getBuildUpQuantityItemList/bill_item_id/"+a.id+"/bill_column_setting_id/"+c+"/type/"+e,clearOnClose:!0}),t=dojo.xhrGet({url:"billBuildUpQuantity/getLinkInfo/id/"+a.id+"/bcid/"+c+"/t/"+e,handleAs:"json"}),u=!1,n=buildspace.dialog.indeterminateProgressBar({title:g.pleaseWait+"..."});n.show();t.then(function(m){var r=
[{name:"No",field:"id",styles:"text-align:center;",width:"30px",formatter:k.rowCountCellFormatter},{name:g.description,field:"description",width:"auto"},{name:g.factor,field:"factor-value",width:"100px",styles:"text-align:right;",formatter:k.formulaNumberCellFormatter}];dojo.forEach(f,function(a){r.push({name:a.title,field:a.field_name,width:"100px",styles:"text-align:right;",formatter:k.formulaNumberCellFormatter})});r.push({name:g.total,field:"total",width:"100px",styles:"text-align:right;",formatter:k.numberCellFormatter});
r.push({name:g.sign,field:"sign",width:"70px",styles:"text-align:center;",formatter:k.signCellFormatter});var p=new A({itemId:a.id,billColumnSettingId:c,type:e,hasLinkedQty:m.has_linked_qty,container:h,_csrf_token:a._csrf_token,moduleName:"billBuildUpQuantity",editable:!1});m.has_linked_qty&&(u=!0,d=y({title:g.scheduleOfQuantities,BillItem:a,billColumnSettingId:c,disableEditingMode:!0,stackContainerId:"subPackageBillGrid"+b.billId+"-stackContainer",gridOpts:{qtyType:e,buildUpSummaryWidget:p,store:new dojo.data.ItemFileWriteStore({url:"billBuildUpQuantity/getScheduleOfQuantities/id/"+
a.id+"/bcid/"+c+"/type/"+e,clearOnClose:!0}),structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:k.rowCountCellFormatter},{name:g.description,field:"description",width:"auto",formatter:k.treeCellFormatter},{name:g.type,field:"type",width:"70px",styles:"text-align:center;",formatter:k.typeCellFormatter},{name:g.unit,field:"uom_id",width:"70px",styles:"text-align:center;",formatter:k.unitIdCellFormatter},{name:g.qty,field:"quantity-value",width:"100px",styles:"text-align:right;",
formatter:k.formulaNumberCellFormatter}]}}));m=new dojox.grid.EnhancedGrid({title:g.manualQtyItems,region:"center",store:q,structure:r});l.addChild(m);u&&l.addChild(d);h.addChild(l);h.addChild(p);if(p=dijit.byId("subPackageBillGrid"+b.billId+"-stackContainer"))m=document.createElement("div"),m=new dojox.layout.ContentPane({title:buildspace.truncateString(a.description,45)+" ("+g.buildUpQuantity+" - "+a.uom_symbol+")",id:"buildUpQuantityPage-"+a.id,content:h,style:"padding:0px;border:0px;",grid:u?
d.grid:null,executeScripts:!0},m),p.addChild(m),p.selectChild("buildUpQuantityPage-"+a.id);n.hide()})},timeBasedClaimDialog:function(a,f,c,b){var d,e;e=this;d=new buildspace.dialog.indeterminateProgressBar({title:""+g.processing+"..."});d.show();q.get("subPackagePostContractPreliminaries/getTimeBasedInformation",{query:{id:a.sub_package_post_contract_bill_item_rate_id,sub_package_id:e.subPackage.id,bill_id:e.billId},handleAs:"json"}).then(function(c){(new B({itemId:a.sub_package_post_contract_bill_item_rate_id,
bill_id:e.billId,subPackage:e.subPackage,formInfo:c.form,item:a,billGridStore:b,currentClaimRevision:f,gridEditable:e.gridEditable})).show();return d.hide()},function(a){return d.hide()})},workBasedClaimDialog:function(a,f,c,b){var d,e;e=this;d=new buildspace.dialog.indeterminateProgressBar({title:""+g.processing+"..."});d.show();q.get("subPackagePostContractPreliminaries/getWorkBasedInformation",{query:{id:a.sub_package_post_contract_bill_item_rate_id,sub_package_id:e.subPackage.id,bill_id:e.billId},
handleAs:"json"}).then(function(c){(new C({itemId:a.sub_package_post_contract_bill_item_rate_id,bill_id:e.billId,subPackage:e.subPackage,formInfo:c.form,item:a,billGridStore:b,currentClaimRevision:f,gridEditable:e.gridEditable})).show();return d.hide()},function(a){return d.hide()})},reconstructBillContainer:function(){var a=dijit.byId("subPackageBillGrid"+this.billId+"-controllerPane"),f=dijit.byId("subPackageBillGrid"+this.billId+"-stackContainer");a.destroyRecursive();f.destroyRecursive();this.createElement}})});
