define("buildspace/apps/PostContractSubPackage/ProjectBreakdown","dojo/_base/declare dojo/number dojox/grid/EnhancedGrid buildspace/widget/grid/cells/Formatter dijit/DropDownMenu dijit/form/DropDownButton dijit/MenuItem buildspace/apps/PostContract/Builder dojo/i18n!buildspace/nls/PostContractSubPackage".split(" "),function(f,g,h,k,l,m,n,p,d){var q=f("buildspace.apps.PostContractSubPackage.ProjectBreakdownGrid",h,{rootProject:null,subPackage:null,style:"border:none;",region:"center",keepSelection:!0,
workArea:null,rowSelector:"0px",constructor:function(a){var b=new k;this.currencySetting=buildspace.billCurrencyAbbreviation?buildspace.billCurrencyAbbreviation:buildspace.currencyAbbreviation;this.structure={noscroll:!1,cells:[[{name:"No.",field:"count",width:"30px",styles:"text-align:center;",formatter:e.rowCountCellFormatter,rowSpan:2},{name:d.description,field:"title",width:"auto",formatter:e.treeCellFormatter,rowSpan:2},{name:d.overallTotal,field:"overall_total_after_markup",width:"150px",rowSpan:2,
styles:"text-align:right;",formatter:b.unEditableCurrencyCellFormatter},{name:d.percent,field:"up_to_date_percentage",width:"80px",formatter:e.unEditablePercentageCellFormatter,styles:"text-align: right;"},{name:d.amount,field:"up_to_date_amount",width:"160px",formatter:b.unEditableCurrencyCellFormatter,styles:"text-align: right;"}],[{name:d.upToDateClaim,styles:"text-align:center;",headerClasses:"staticHeader",colSpan:2}]]};this.inherited(arguments)},canSort:function(a){return!1},postCreate:function(){this.inherited(arguments);
this.on("RowClick",function(a){(a=this.getItem(a.rowIndex))&&0<a.id&&a.type[0]==buildspace.apps.PostContractSubPackage.ProjectStructureConstants.TYPE_BILL?this.disableToolbarButtons(!1):this.disableToolbarButtons(!0)},!0)},dodblclick:function(a){this.onRowDblClick(a)},onStyleRow:function(a){this.inherited(arguments);if(a.node.children[0]&&2<=a.node.children[0].children[0].rows.length){var b=a.node.children[0].children[0].rows[1],c=a.node.children[0].children[0].rows[0].children;b.parentNode.removeChild(b);
dojo.forEach(c,function(a,b){b=dojo.attr(a,"rowSpan");(!b||2>b)&&dojo.attr(a,"rowSpan",2)})}},onRowDblClick:function(a){a=this.getItem(a.rowIndex);switch(parseInt(a.type)){case buildspace.apps.PostContractSubPackage.ProjectStructureConstants.BILL_TYPE_PRELIMINARY:this.workArea.initTab(a,{billId:a.id,billLayoutSettingId:a.billLayoutSettingId,workArea:this.workArea,rootProject:this.rootProject,subPackage:this.subPackage});break;case buildspace.apps.PostContractSubPackage.ProjectStructureConstants.TYPE_VARIATION_ORDER:this.workArea.initTab(a,
{subPackage:this.subPackage});break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_MATERIAL_ON_SITE:this.workArea.initTab(a,{subPackage:this.subPackage})}},disableToolbarButtons:function(a,b){if(a&&b instanceof Array){var c=this;dojo.forEach(b,function(a){(a=dijit.byId(c.rootProject.id+a+"Row-button"))&&a._setDisabledAttr(!1)})}},reload:function(){this.store.close();this._refresh()}}),e={rowCountCellFormatter:function(a,b,c){b=this.grid.getItem(b);void 0!=b.type&&1>b.type&&c.customClasses.push("invalidTypeItemCell");
return 0<a?a:""},unEditablePercentageCellFormatter:function(a,b,c){a=g.parse(a);b=this.grid.getItem(b);void 0!=b.type&&1>b.type?c.customClasses.push("invalidTypeItemCell"):c.customClasses.push("disable-cell");isNaN(a)||0==a||null==a?a="&nbsp;":(c=g.format(a,{places:2})+"%",a=0<=a?'<span style="color:blue;">'+c+"</span>":'<span style="color:#FF0000">'+c+"</span>");return a},treeCellFormatter:function(a,b,c){b=this.grid.getItem(b);var d=16*b.level;a=null==a?"&nbsp":a;void 0!=b.type&&1>b.type?c.customClasses.push("invalidTypeItemCell"):
a='<div class="treeNode" style="padding-left:'+d+'px;"><div class="treeContent">'+a+"&nbsp;</div></div>";return a}};return f("buildspace.apps.PostContractSubPackage.ProjectBreakdown",dijit.layout.BorderContainer,{region:"center",style:"padding:0;margin:0;border:none;width:100%;height:100%;",gutters:!1,rootProject:null,subPackage:null,workArea:null,grid:null,postCreate:function(){this.inherited(arguments);var a=this,b=new dojo.data.ItemFileWriteStore({clearOnClose:!0,url:"postContractSubPackage/getProjectBreakdown/id/"+
this.subPackage.id}),c=this.grid=q({rootProject:this.rootProject,subPackage:this.subPackage,store:b,workArea:this.workArea});b=new dijit.Toolbar({region:"top",style:"outline:none!important;border-bottom:none;padding:2px;width:100%;"});var e=new l({style:"display: none;"});dojo.forEach(["allItems","provisionalItems"],function(b){var c=new n({id:b+"-"+a.rootProject.id+"-menuItem",label:d[b],onClick:function(){buildspace.app.launch({__children:[],icon:"project_analyzer",id:a.rootProject.id+"-postcontract_subpackage_remeasurement",
is_app:!0,level:0,sysname:"PostContractSubPackageRemeasurement",title:d.remeasureProvisional},{type:buildspace.constants.STATUS_POSTCONTRACT,opt:b,project:a.rootProject,subPackage:a.subPackage})}});e.addChild(c)});b.addChild(new dijit.form.Button({label:d.backToProjectPostContract,iconClass:"icon-16-container icon-16-directional_left",style:"outline:none!important;",onClick:dojo.hitch(this,"openBuilderWin",a.rootProject)}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new m({label:d.remeasureProvisional,
id:a.rootProject.id+"RemeasureProvisionalRow-button",iconClass:"icon-16-container icon-16-ruler_square",dropDown:e}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({id:a.rootProject.id+"ReloadGridRow-button",label:d.reload,iconClass:"icon-16-container icon-16-reload",onClick:function(a){c.reload()}}));this.addChild(b);this.addChild(new dijit.layout.ContentPane({style:"width:100%",content:c,region:"center"}))},openBuilderWin:function(a){this.kill();this.project=a;this.win=
new buildspace.widget.Window({title:d.postContract+" > "+buildspace.truncateString(a.title,100)+" ("+d.status+": "+a.status[0].toUpperCase()+")",onClose:dojo.hitch(this,"kill")});this.win.addChild(new p({project:a}));this.win.show();this.win.startup()},kill:function(){"undefined"!=typeof this.win&&this.win.close()}})});
