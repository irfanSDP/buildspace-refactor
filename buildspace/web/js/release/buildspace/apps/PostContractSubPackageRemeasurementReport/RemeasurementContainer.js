define("buildspace/apps/PostContractSubPackageRemeasurementReport/RemeasurementContainer","dojo/_base/declare dojo/aspect dojo/request dojo/store/Memory ./RemeasurementGrid ./buildUpQuantitySummary ./buildUpQuantityGrid buildspace/widget/grid/cells/Formatter buildspace/apps/ProjectBuilder/BillManager/ScheduleOfQuantityGrid dojo/i18n!buildspace/nls/PostContractRemeasurement".split(" "),function(v,D,r,n,m,z,A,t,B,d){return v("buildspace.apps.PostContractSubPackageRemeasurementReport.RemeasurementContainer",
dijit.layout.BorderContainer,{style:"padding:0px;width:100%;margin:0px;border:0px;height:100%;",gutters:!1,project:null,subPackage:null,opt:null,selectedTypeStore:[],selectedElementStore:[],selectedItemStore:[],postCreate:function(){var f=this;this.inherited(arguments);var e=new t,a=dojo.data.ItemFileWriteStore({url:"postContractSubPackageRemeasurement/getAllBills/subPackageId/"+f.subPackage.id+"/opt/"+f.opt,clearOnClose:!0}),e=new m({id:"post-contract-subpackage-remeasurement-report-grid-"+f.subPackage.id,
stackContainerTitle:d.bill,pageId:"post-contract-subpackage-remeasurement-report-grid-"+f.subPackage.id,project:f.project,subPackage:f.subPackage,gridOpts:{type:"bill",store:a,structure:[{name:"No.",field:"id",width:"40px",styles:"text-align:center;",formatter:e.rowCountCellFormatter},{name:d.bill,field:"title",width:"auto",formatter:e.analyzerDescriptionCellFormatter},{name:d.omission,field:"omission",width:"150px",styles:"text-align:right;color:red;",formatter:e.unEditableCurrencyCellFormatter},
{name:d.addition,field:"addition",width:"150px",styles:"text-align:right;",formatter:e.unEditableCurrencyCellFormatter},{name:d.nettAdditionOmission,field:"nettAdditionOmission",width:"150px",styles:"text-align:right;color:green;",formatter:e.unEditableCurrencyCellFormatter}],onRowDblClick:function(a){a=this.getItem(a.rowIndex);0<a.id&&null!==a.title[0]&&f.createBillTypesGrid(a)}}}),e=this.makeGridContainer(e,d.bill);this.addChild(e)},createBillTypesGrid:function(f){var e=this,a=new t,h=dojo.data.ItemFileWriteStore({url:"postContractSubPackageRemeasurement/getBillTypes/subPackageId/"+
e.subPackage.id+"/bid/"+f.id+"/opt/"+e.opt,clearOnClose:!0});this.selectedTypeStore=new n({idProperty:"id"});this.selectedElementStore=[];this.selectedItemStore=[];new m({id:"post-contract-subpackage-remeasurement-report-billtype"+e.subPackage.id,stackContainerTitle:f.title,pageId:"post-contract-subpackage-remeasurement-report-billtype"+e.subPackage.id+"_"+f.id,project:e.project,subPackage:e.subPackage,gridOpts:{bill:f,gridContainer:e,type:"billTypes",store:h,structure:[{name:"No.",field:"id",width:"40px",
styles:"text-align:center;",formatter:a.rowCountCellFormatter},{name:d.description,field:"name",width:"auto",formatter:a.analyzerDescriptionCellFormatter},{name:d.totalUnits,field:"quantity",width:"150px",styles:"text-align:right;",formatter:a.unEditableCurrencyCellFormatter},{name:d.omission,field:"omission",width:"150px",styles:"text-align:right;color:red;",formatter:a.unEditableCurrencyCellFormatter},{name:d.addition,field:"addition",width:"150px",styles:"text-align:right;",formatter:a.unEditableCurrencyCellFormatter},
{name:d.nettAdditionOmission,field:"nettAdditionOmission",width:"150px",styles:"text-align:right;color:green;",formatter:a.unEditableCurrencyCellFormatter}],onRowDblClick:function(a){a=this.getItem(a.rowIndex);0<a.id&&null!==a.name[0]&&e.createElementGrid(f,a)},singleCheckBoxSelection:function(a){var g=a.rowIndex;a=this.selection.selected[g];g=this.getItem(g);this.removedIds=[];if(a)return this.gridContainer.selectedTypeStore.put({id:g.id[0]}),this.getAffectedElementsAndItemsByTypes(g,"add");this.gridContainer.selectedTypeStore.remove(g.id[0]);
this.removedIds.push(g.id[0]);return this.getAffectedElementsAndItemsByTypes(g,"remove")},toggleAllSelection:function(a){var g=this,b=this.selection;g.removedIds=[];if(a)return b.selectRange(0,g.rowCount-1),g.store.fetch({onComplete:function(b){dojo.forEach(b,function(b,c){0<b.id&&g.gridContainer.selectedTypeStore.put({id:b.id[0]})})}}),g.getAffectedElementsAndItemsByTypes(null,"add");b.deselectAll();g.store.fetch({onComplete:function(b){dojo.forEach(b,function(b,c){0<b.id&&(g.gridContainer.selectedTypeStore.remove(b.id[0]),
g.removedIds.push(b.id[0]))})}});return g.getAffectedElementsAndItemsByTypes(null,"remove")},getAffectedElementsAndItemsByTypes:function(a,g){var b=this,c=[],e=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});e.show();if("add"===g)b.gridContainer.selectedTypeStore.query().forEach(function(b){c.push(b.id)});else for(var p in b.removedIds)c.push(b.removedIds[p]);r.post("postContractSubPackageRemeasurementReport/getElementsAndItemsByTypes",{handleAs:"json",data:{subPackageId:b.subPackage.id,
bill_id:f.id,type_ids:JSON.stringify(b.gridContainer.arrayUnique(c)),opt:b.gridContainer.opt}}).then(function(c){for(var a in c)b.gridContainer.selectedElementStore[a]||(b.gridContainer.selectedElementStore[a]=new n({idProperty:"id"})),b.gridContainer.selectedItemStore[a]||(b.gridContainer.selectedItemStore[a]=new n({idProperty:"id"}));if("add"===g)for(a in c)for(var d in c[a]){b.gridContainer.selectedElementStore[a].put({id:d});for(var l in c[a][d])b.gridContainer.selectedItemStore[a].put({id:c[a][d][l]})}else for(a in c)for(d in c[a])for(l in b.gridContainer.selectedElementStore[a].remove(d),
c[a][d])b.gridContainer.selectedItemStore[a].remove(c[a][d][l]);e.hide()},function(b){e.hide();console.log(b)})}}})},createElementGrid:function(f,e){var a=this,h=new t,k=dojo.data.ItemFileWriteStore({url:"postContractSubPackageRemeasurement/getElementList/subPackageId/"+a.subPackage.id+"/btId/"+e.id+"/opt/"+a.opt,clearOnClose:!0});a.selectedElementStore[e.id]||(a.selectedElementStore[e.id]=new n({idProperty:"id"}));a.selectedItemStore[e.id]||(a.selectedItemStore[e.id]=new n({idProperty:"id"}));new m({id:"post-contract-subpackage-remeasurement-report-element-"+
a.subPackage.id,stackContainerTitle:e.name,pageId:"post-contract-subpackage-remeasurement-report-element-"+a.subPackage.id+"_"+e.id,project:a.project,subPackage:a.subPackage,gridOpts:{gridContainer:a,bill:f,billTypeId:e.id,type:"element",store:k,structure:[{name:"No.",field:"id",width:"40px",styles:"text-align:center;",formatter:h.rowCountCellFormatter},{name:d.description,field:"description",width:"auto"},{name:d.omission,field:"omission",width:"150px",styles:"text-align:right;color:red;",formatter:h.unEditableCurrencyCellFormatter},
{name:d.addition,field:"addition",width:"150px",styles:"text-align:right;",formatter:h.unEditableCurrencyCellFormatter},{name:d.nettAdditionOmission,field:"nettAdditionOmission",width:"150px",styles:"text-align:right;color:green;",formatter:h.unEditableCurrencyCellFormatter}],onRowDblClick:function(g){g=this.getItem(g.rowIndex);0<g.id&&null!==g.description[0]&&a.createItemGrid(f,e,g)},singleCheckBoxSelection:function(a){var b=a.rowIndex;a=this.selection.selected[b];b=this.getItem(b);this.removedIds=
[];if(a)return this.gridContainer.selectedElementStore[this.billTypeId].put({id:b.id[0]}),this.getAffectedTypesAndItemsByTypes(b,"add");this.gridContainer.selectedElementStore[this.billTypeId].remove(b.id[0]);this.removedIds.push(b.id[0]);return this.getAffectedTypesAndItemsByTypes(b,"remove")},toggleAllSelection:function(a){var b=this,c=this.selection;b.removedIds=[];if(a)return c.selectRange(0,b.rowCount-1),b.store.fetch({onComplete:function(a){dojo.forEach(a,function(a,c){0<a.id[0]&&b.gridContainer.selectedElementStore[b.billTypeId].put({id:a.id[0]})})}}),
b.getAffectedTypesAndItemsByTypes(null,"add");c.deselectAll();b.store.fetch({onComplete:function(a){dojo.forEach(a,function(a,c){0<a.id[0]&&(b.gridContainer.selectedElementStore[b.billTypeId].remove(a.id[0]),b.removedIds.push(a.id[0]))})}});return b.getAffectedTypesAndItemsByTypes(null,"remove")},getAffectedTypesAndItemsByTypes:function(a,b){var c=this,g=[],e=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});e.show();if("add"===b)c.gridContainer.selectedElementStore[c.billTypeId].query().forEach(function(b){g.push(b.id)});
else for(var f in c.removedIds)g.push(c.removedIds[f]);r.post("postContractSubPackageRemeasurementReport/getTypesAndItemsByElement",{handleAs:"json",data:{subPackageId:c.subPackage.id,bill_type_id:c.billTypeId,element_ids:JSON.stringify(c.gridContainer.arrayUnique(g)),opt:c.gridContainer.opt}}).then(function(a){var g=dijit.byId("post-contract-subpackage-remeasurement-report-billtype"+c.subPackage.id);if("add"===b)for(var d in a){for(var f in a[d])for(var h in a[d][f])c.gridContainer.selectedItemStore[d].put({id:a[d][f][h]});
g.grid.store.fetchItemByIdentity({identity:d,onItem:function(a){if(a&&0<c.gridContainer.selectedElementStore[d].data.length)return c.gridContainer.selectedTypeStore.put({id:d}),g.grid.rowSelectCell.toggleRow(a._0,!0)}})}else for(d in a){for(f in a[d])for(h in c.gridContainer.selectedElementStore[d].remove(f),a[d][f])c.gridContainer.selectedItemStore[d].remove(a[d][f][h]);g.grid.store.fetchItemByIdentity({identity:d,onItem:function(a){if(a&&0==c.gridContainer.selectedElementStore[d].data.length)return c.gridContainer.selectedTypeStore.remove(d),
g.grid.rowSelectCell.toggleRow(a._0,!1)}})}e.hide()},function(a){e.hide();console.log(a)})}}})},createItemGrid:function(f,e,a){var h=this;t();var k=new dojo.data.ItemFileWriteStore({url:"postContractSubPackageRemeasurement/getItemList/subPackageId/"+h.subPackage.id+"/btId/"+e.id+"/elementId/"+a.id+"/opt/"+h.opt,clearOnClose:!0});new m({id:"post-contract-subpackage-remeasurement-report-item-"+h.subPackage.id,stackContainerTitle:a.description,pageId:"post-contract-subpackage-remeasurement-report-item-"+
h.subPackage.id+"_"+a.id,project:h.project,subPackage:h.subPackage,gridOpts:{gridContainer:h,bill:f,billTypeId:e.id,store:k,type:"item",updateUrl:"postContractSubPackageRemeasurement/remeasurementItemUpdate",onRowDblClick:function(a){var b=a.cell.field,c=this.getItem(a.rowIndex),g=this.store,f=e.id;editable=!1;if(0<c.id&&("omission-qty_per_unit"===b||"addition-qty_per_unit"===b)&&c.type!=buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER&&c.type!=buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_N&&
c.type!=buildspace.widget.grid.constants.HIERARCHY_TYPE_NOID&&c.type!=buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM&&c.type!=buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM_EXCLUDE&&c.type!=buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_RATE_ONLY&&("omission-qty_per_unit"!==b||void 0!=c["omission-has_build_up"]&&c["omission-has_build_up"][0]))if(0<c.uom_id[0]){if("addition-qty_per_unit"!==b||c.include[0]){a=dojo.xhrPost({url:"billBuildUpQuantity/getDimensionColumnStructure",
content:{uom_id:c.uom_id[0]},handleAs:"json"});var k=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});k.show();a.then(function(a){h.createBuildUpQuantityContainer(b,editable,c,a,f,g);k.hide()})}}else buildspace.dialog.alert(d.buildUpQtyAlert,d.pleaseSetUOM,60,300)},singleCheckBoxSelection:function(a){var b=a.rowIndex;a=this.selection.selected[b];b=this.getItem(b);this.removedIds=[];if(a)return this.gridContainer.selectedItemStore[this.billTypeId].put({id:b.id[0]}),this.getAffectedTypesAndElementsByItems(b,
"add");this.gridContainer.selectedItemStore[this.billTypeId].remove(b.id[0]);this.removedIds.push(b.id[0]);return this.getAffectedTypesAndElementsByItems(b,"remove")},toggleAllSelection:function(a){var b=this,c=this.selection;b.removedIds=[];if(a)return c.selectRange(0,b.rowCount-1),b.store.fetch({onComplete:function(a){dojo.forEach(a,function(a,c){0<a.id[0]&&b.gridContainer.selectedItemStore[b.billTypeId].put({id:a.id[0]})})}}),b.getAffectedTypesAndElementsByItems(null,"add");c.deselectAll();b.store.fetch({onComplete:function(a){dojo.forEach(a,
function(a,c){0<a.id[0]&&(b.gridContainer.selectedItemStore[b.billTypeId].remove(a.id[0]),b.removedIds.push(a.id[0]))})}});return b.getAffectedTypesAndElementsByItems(null,"remove")},getAffectedTypesAndElementsByItems:function(a,b){var c=this,e=[],g=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});g.show();if("add"===b)c.gridContainer.selectedItemStore[c.billTypeId].query().forEach(function(a){e.push(a.id)});else for(var f in c.removedIds)e.push(c.removedIds[f]);r.post("postContractSubPackageRemeasurementReport/getTypesAndElementsByItem",
{handleAs:"json",data:{subPackageId:c.subPackage.id,bill_type_id:c.billTypeId,item_ids:JSON.stringify(c.gridContainer.arrayUnique(e)),opt:c.gridContainer.opt}}).then(function(d){var e=dijit.byId("post-contract-subpackage-remeasurement-report-billtype"+c.subPackage.id),f=dijit.byId("post-contract-subpackage-remeasurement-report-element-"+c.subPackage.id);if("add"===b)for(var h in d){for(var k in d[h]){for(var u in d[h][k])c.gridContainer.selectedItemStore[h].put({id:d[h][k][u]});f.grid.store.fetchItemByIdentity({identity:k,
onItem:function(a){if(a&&0<c.gridContainer.selectedItemStore[h].data.length)return c.gridContainer.selectedElementStore[h].put({id:k}),f.grid.rowSelectCell.toggleRow(a._0,!0)}})}e.grid.store.fetchItemByIdentity({identity:h,onItem:function(a){if(a&&0<c.gridContainer.selectedElementStore[h].data.length)return c.gridContainer.selectedTypeStore.put({id:h}),e.grid.rowSelectCell.toggleRow(a._0,!0)}})}else for(h in a&&c.gridContainer.selectedItemStore[c.billTypeId].remove(a.id[0]),d){for(k in d[h])f.grid.store.fetchItemByIdentity({identity:k,
onItem:function(a){if(a&&0==c.gridContainer.selectedItemStore[h].data.length)return c.gridContainer.selectedElementStore[h].remove(k),f.grid.rowSelectCell.toggleRow(a._0,!1)}});e.grid.store.fetchItemByIdentity({identity:h,onItem:function(a){if(a&&0==c.gridContainer.selectedElementStore[h].data.length)return c.gridContainer.selectedTypeStore.remove(h),e.grid.rowSelectCell.toggleRow(a._0,!1)}})}g.hide()},function(a){g.hide();console.log(a)})}}})},createBuildUpQuantityContainer:function(f,e,a,h,k,g){var b,
c;"addition-qty_per_unit"===f?(b="postContractSubPackageRemeasurementBillBuildUpQuantity",c=a.sub_package_post_contract_bill_item_rate_id):(b="billBuildUpQuantity",c=a.id);var u=this,p=buildspace.constants.QUANTITY_PER_UNIT_ORIGINAL,n,m=new dijit.layout.BorderContainer({style:"padding:0px;width:100%;height:100%;border:0px;outline:none;",gutters:!1}),r=new dijit.layout.TabContainer({nested:!0,style:"padding:0;border:none;margin:0;width:100%;height:100%;",region:"center"}),l=new t;f=dojo.xhrGet({url:b+
"/getLinkInfo/id/"+a.id+"/bcid/"+k+"/t/"+p,handleAs:"json"});var w=new dojo.data.ItemFileWriteStore({url:b+"/getBuildUpQuantityItemList/bill_item_id/"+c+"/bill_column_setting_id/"+k+"/type/"+p,clearOnClose:!0}),v=[buildspace.constants.SIGN_POSITIVE_TEXT,buildspace.constants.SIGN_NEGATIVE_TEXT],C=[buildspace.constants.SIGN_POSITIVE,buildspace.constants.SIGN_NEGATIVE],x=!1,y=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});y.show();f.then(function(e){var f=[{name:"No",field:"id",
styles:"text-align:center;",width:"30px",formatter:l.rowCountCellFormatter},{name:d.description,field:"description",width:"auto",cellType:"buildspace.widget.grid.cells.Textarea"},{name:d.factor,field:"factor-value",width:"100px",styles:"text-align:right;",cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:l.formulaNumberCellFormatter}];dojo.forEach(h,function(a){f.push({name:a.title,field:a.field_name,width:"100px",styles:"text-align:right;",cellType:"buildspace.widget.grid.cells.FormulaTextBox",
formatter:l.formulaNumberCellFormatter})});f.push({name:d.total,field:"total",width:"100px",styles:"text-align:right;",formatter:l.numberCellFormatter});f.push({name:d.sign,field:"sign",width:"70px",styles:"text-align:center;",cellType:"dojox.grid.cells.Select",options:v,values:C,formatter:l.signCellFormatter});var q=new z({itemId:c,billColumnSettingId:k,type:p,container:m,billGridStore:g,buildUpGridStore:w,hasLinkedQty:e.has_linked_qty,_csrf_token:a._csrf_token,moduleName:b,locked:!0});e.has_linked_qty&&
(x=!0,n=new B({title:d.scheduleOfQuantities,BillItem:a,disableEditingMode:!0,stackContainerId:"postContractSubPackageRemeasurementReport-grid_"+u.subPackage.id+"-stackContainer",gridOpts:{qtyType:p,buildUpSummaryWidget:q,store:new dojo.data.ItemFileWriteStore({url:b+"/getScheduleOfQuantities/id/"+a.id+"/bcid/"+k+"/type/"+p,clearOnClose:!0}),structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:l.rowCountCellFormatter},{name:d.description,field:"description",width:"auto",
formatter:l.treeCellFormatter},{name:d.type,field:"type",width:"70px",styles:"text-align:center;",formatter:l.typeCellFormatter},{name:d.unit,field:"uom_id",width:"70px",styles:"text-align:center;",formatter:l.unitIdCellFormatter},{name:d.qty,field:"quantity-value",width:"100px",styles:"text-align:right;",formatter:l.formulaNumberCellFormatter}]}}));r.addChild(new A({title:d.manualQtyItems,region:"center",billColumnSettingId:k,BillItem:a,type:p,locked:!0,gridOpts:{store:w,structure:f,buildUpSummaryWidget:q,
currentBillLockedStatus:u.currentBillLockedStatus}}));x&&r.addChild(n);m.addChild(r);m.addChild(q);if(e=dijit.byId("postContractSubPackageRemeasurementReport-grid_"+u.subPackage.id+"-stackContainer"))q=document.createElement("div"),q=new dojox.layout.ContentPane({title:buildspace.truncateString(a.description,60)+" ("+d.buildUpQuantity+" - "+a.uom_symbol+")",id:"buildUpQuantityPage-"+c,style:"padding:0px;border:0px;",executeScripts:!0},q),e.addChild(q),q.set("content",m),e.selectChild("buildUpQuantityPage-"+
c);y.hide()})},makeGridContainer:function(d,e){var a=this.subPackage.id,f=dijit.byId("postContractSubPackageRemeasurementReport-grid_"+a+"-stackContainer");f&&dijit.byId("postContractSubPackageRemeasurementReport-grid_"+a+"-stackContainer").destroyRecursive();var f=new dijit.layout.StackContainer({style:"width:100%;height:100%;border:0px;",region:"center",id:"postContractSubPackageRemeasurementReport-grid_"+a+"-stackContainer"}),k=new dijit.layout.ContentPane({title:e,content:d,grid:d.grid});f.addChild(k);
var k=new dijit.layout.StackController({region:"top",containerId:"postContractSubPackageRemeasurementReport-grid_"+a+"-stackContainer"}),k=new dijit.layout.ContentPane({style:"padding:0px;overflow:hidden;","class":"breadCrumbTrail",region:"top",content:k}),g=new dijit.layout.BorderContainer({style:"padding:0px;width:100%;height:100%;border:0px;",gutters:!1,region:"center"});g.addChild(f);g.addChild(k);dojo.subscribe("postContractSubPackageRemeasurementReport-grid_"+a+"-stackContainer-selectChild",
"",function(b){var c=dijit.byId("postContractSubPackageRemeasurementReport-grid_"+a+"-stackContainer");if(c){var d=c.getChildren();b=dojo.indexOf(d,b);b+=1;if(d.length>b)for(;d.length>b;)c.removeChild(d[b]),d[b].destroyDescendants(),d[b].destroyRecursive(),b+=1}});return g},markedCheckBoxObject:function(d,e){var a=d.store;e.query().forEach(function(e){e.id!=buildspace.constants.GRID_LAST_ROW&&a.fetchItemByIdentity({identity:e.id,onItem:function(a){if(a)return d.rowSelectCell.toggleRow(a._0,!0)}})})},
arrayUnique:function(d){return d.reverse().filter(function(d,a,f){return-1===f.indexOf(d,a+1)}).reverse()}})});
