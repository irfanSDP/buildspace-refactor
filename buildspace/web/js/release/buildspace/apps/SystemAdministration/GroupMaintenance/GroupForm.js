(function(){define("buildspace/apps/SystemAdministration/GroupMaintenance/GroupForm","dojo/_base/declare dojo/aspect dojo/on dojo/_base/connect dojo/_base/lang dojo/dom-form dojo/html dojo/dom dojo/dom-attr dojo/dom-style dojo/_base/array ./assignUserGroupGrid dojox/form/Manager dojox/validate/web dijit/form/Form dojox/form/PasswordValidator dijit/form/ValidationTextBox dijit/form/Textarea dijit/form/DateTextBox dijit/form/RadioButton dijit/form/Select dijit/form/FilteringSelect dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojox/grid/enhanced/plugins/IndirectSelection buildspace/widget/grid/cells/Formatter dojox/grid/enhanced/plugins/Rearrange dojo/text!./templates/groupForm.html dojo/i18n!buildspace/nls/SystemAdministration".split(" "),
function(g,p,A,k,q,B,C,D,E,h,F,r,G,H,I,J,K,L,M,N,O,P,t,u,v,w,Q,x,y,z,e){var l,m;m=g("buildspace.apps.SystemAdministration.GroupMaintenance.MenuPermissionGrid",dojox.grid.EnhancedGrid,{style:"border-top:none; height: 300px;",keepSelection:!0,rowSelector:"0px",region:"center",groupId:-1,groupMaintenanceGridContainer:null,selectedMenus:null,isSuperAdmin:!1,constructor:function(a){this.urlGetDescendantIds="systemAdministration/getMenuDescendants";this.plugins={indirectSelection:{headerSelector:!0,width:"20px",
styles:"text-align: center;"}};this.rearranger=y(this,{});return this.itemIds=[]},canSort:function(a){return!1},postCreate:function(){var a;this.inherited(arguments);a=this;p.after(this,"_onFetchComplete",function(b){return function(){return b.markedCheckBoxObject(b.selectedMenus,!0)}}(this));this._connects.push(k.connect(this,"onCellClick",function(b){return""!==b.cell.name?!1:a.selectTree(b)}));return this._connects.push(k.connect(this.rowSelectCell,"toggleAllSelection",function(b){return a.toggleAllSelection(b)}))},
markedCheckBoxObject:function(a,b){var c,d,f,n,e;f=this;n=this.store;c=-1;e=[];for(d in a)e.push(n.fetchItemByIdentity({identity:d,onItem:function(a){c=a._0;f.pushItemIdIntoGridArray(a,b);return f.selection.setSelected(c,b)}}));return e},markedCheckBoxArray:function(a,b){var c,d,f;d=this;f=this.store;c=-1;return dojo.forEach(a,function(a){return f.fetchItemByIdentity({identity:a.id,onItem:function(a){c=a._0;d.pushItemIdIntoGridArray(a,b);return d.selection.setSelected(c,b)}})})},selectTree:function(a){var b,
c,d,f;f=this;a=a.rowIndex;c=this.selection.selected[a];b=this.getItem(a);d=buildspace.dialog.indeterminateProgressBar({title:e.pleaseWait+"..."});d.show().then(function(){dojo.xhrPost({url:f.urlGetDescendantIds,content:{id:b.id},handleAs:"json",load:function(a){d.hide();return f.markedCheckBoxArray(a.items,c)},error:function(a){return d.hide()}})})},toggleAllSelection:function(a){var b,c;b=this;c=this.selection;if(a)return c.selectRange(0,b.rowCount-1),b.itemIds=[],b.store.fetch({onComplete:function(a){return dojo.forEach(a,
function(a,c){if(0<a.id)return b.itemIds.push(a.id[0])})}});c.deselectAll();return b.itemIds=[]},pushItemIdIntoGridArray:function(a,b){var c;c=dojo.indexOf(this.itemIds,a.id[0]);if(b){if(-1===c)return this.itemIds.push(a.id[0])}else if(-1!==c)return this.itemIds.splice(c,1)}});l=g("buildspace.apps.SystemAdministration.GroupMaintenance.GroupForm",[t,u,v,w],{templateString:z,baseClass:"buildspace-form",region:"center",style:"border:none;padding:5px;overflow:auto;",groupId:-1,groupName:null,data:null,
GroupFormContainer:null,groupMaintenanceGrid:null,nls:e,isSuperAdmin:!1,startup:function(){this.inherited(arguments);this.createPermissionGrid();this.groupMaintenanceForm.setFormValues(this.data);return this.showMenuPermissionGrid()},clearInputErrorMsgs:function(){var a,b,c,d;c={name:null};d=[];for(b in c)a=this["error-"+b],a.innerHTML=c[b],d.push(h.set(a,"display","none"));return d},save:function(){var a,b,c;this.clearInputErrorMsgs();if(!this.groupMaintenanceForm.validate())return!1;c=this;a=dojo.formToObject(this.groupMaintenanceForm.id);
b=buildspace.dialog.indeterminateProgressBar({title:e.pleaseWait+"..."});q.mixin(a,{id:c.groupId,"sf_guard_group[menus_list][]":this.menuGrid.itemIds});b.show().then(function(){dojo.xhrPost({url:"systemAdministration/updateGroupInfo",handleAs:"json",content:a,load:function(a){var d,e,g;b.hide();if(a.success&&0<a.id)return c.groupId=a.id,c.groupName=a.name,c.showMenuPermissionGrid(),(a=dijit.byId("addUserToGroup-groupMaintenance"))&&0<c.groupId&&a.set("disabled",!1),c.groupMaintenanceGrid.refreshGrid();
g=[];for(e in a.errorMsgs)d=c["error-"+e],d.innerHTML=a.errorMsgs[e],g.push(h.set(d,"display","block"));return g},error:function(a){return b.hide()}})})},addUserToGroup:function(){var a,b;b=this;a=buildspace.dialog.indeterminateProgressBar({title:e.pleaseWait+"..."});a.show().then(function(){dojo.xhrGet({url:"systemAdministration/getGroupUserLists",content:{id:b.groupId},handleAs:"json",load:function(c){a.hide();return(new r({groupMaintenanceGrid:b.groupMaintenanceGrid,groupId:b.groupId,groupName:b.groupName,
data:c,isSuperAdmin:b.isSuperAdmin})).show()},error:function(b){return a.hide()}})})},createPermissionGrid:function(){var a;a=new dojo.data.ItemFileWriteStore({url:"systemAdministration/getMenuLists",clearOnClose:!0,urlPreventCache:!0});this.menuGrid=new m({groupId:this.groupId,structure:this.getGridLayout(),store:a,selectedMenus:this.data.menus});this.menuGrid.placeAt(this.groupMenuPermissionGrid);return this.menuGrid.startup()},getGridLayout:function(){var a;a=new x;return[{name:"No",field:"id",
width:"30px",styles:"text-align: center;",formatter:a.rowCountCellFormatter},{name:e.name,field:"title",width:"auto",formatter:a.menuCellFormatter},{name:e.isApp,field:"is_app",width:"100px",styles:"text-align: center;",formatter:function(a,c,d){return a?e.isAnApp:e.isNotAnApp}}]},showMenuPermissionGrid:function(){return 1!==this.groupId?h.set(this.groupMenuPermissionGridContainer,"display","block"):h.set(this.groupMenuPermissionGridContainer,"display","none")}});return g("buildspace.apps.SystemAdministration.GroupMaintenance.GroupFormContainer",
dijit.layout.BorderContainer,{region:"top",style:"padding:0px; width: 560px; height: 200px;",gutters:!1,data:null,groupMaintenanceGrid:null,groupId:-1,groupName:null,isSuperAdmin:!1,postCreate:function(){var a,b;this.inherited(arguments);this.groupId=this.data[0].id;a=new l({data:this.data[0],groupId:this.groupId,groupName:this.data[0].name,GroupFormContainer:this,groupMaintenanceGrid:this.groupMaintenanceGrid,isSuperAdmin:this.isSuperAdmin});b=new dijit.Toolbar({region:"top",style:"outline:none!important;border-bottom: 1px solid #ccc;border-top:none;border-left:none;border-right:none;padding:2px;width:100%;"});
b.addChild(new dijit.form.Button({label:e.save,iconClass:"icon-16-container icon-16-save",style:"outline:none!important;",onClick:dojo.hitch(a,"save")}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({id:"addUserToGroup-groupMaintenance",label:e.addUserToGroup,iconClass:"icon-16-container icon-16-add",style:"outline:none!important;",disabled:0<this.groupId?!1:!0,onClick:dojo.hitch(a,"addUserToGroup")}));this.addChild(b);return this.addChild(a)}})})}).call(this);
