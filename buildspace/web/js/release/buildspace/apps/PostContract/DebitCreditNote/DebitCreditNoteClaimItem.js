define("buildspace/apps/PostContract/DebitCreditNote/DebitCreditNoteClaimItem","dojo/_base/declare dojo/_base/lang dojox/grid/enhanced/plugins/Rearrange dojo/_base/event dojo/keys dijit/focus buildspace/widget/grid/Filter buildspace/widget/grid/cells/DateTextBox dojox/grid/EnhancedGrid buildspace/widget/grid/cells/Formatter buildspace/apps/Attachment/UploadAttachmentContainer dojo/i18n!buildspace/nls/DebitCreditNote".split(" "),function(l,n,q,r,t,k,u,z,v,w,x,d){var y=l("buildspace.apps.PostContract.DebitCreditNote.DebitCreditClaimItemGrid",
v,{style:"border:none;",region:"center",keepSelection:!0,rowSelector:"0px",accountGroupId:null,debitCreditNoteClaimId:null,container:null,locked:null,lockedForVerify:null,debitCreditNoteClaimGrid:null,accountGroupSelectionGrid:null,constructor:function(){this.inherited(arguments);this.rearranger=q(this,{})},canSort:function(a){return!1},canEdit:function(){return!this.locked&&!this.lockedForVerify},postCreate:function(){this.inherited(arguments);var a=this;a.lockedForVerify||(this.on("RowContextMenu",
function(b){if(!a.locked){this.selection.clear();var c=this.getItem(b.rowIndex);this.selection.setSelected(b.rowIndex,!0);this.contextMenu(b);c&&!isNaN(parseInt(c.id[0]))?this.disableToolbarButtons(!1):this.disableToolbarButtons(!0,["Add"])}},!0),this.on("RowClick",function(b){a.locked||((b=this.getItem(b.rowIndex))&&!isNaN(parseInt(String(b.id)))?this.disableToolbarButtons(!1):this.disableToolbarButtons(!0,["Add"]))}));this.on("CellClick",function(b){"attachment"===b.cell.field&&(b=a.getItem(b.rowIndex),
isNaN(String(b.id))||a.container.addChild(a.addUploadAttachmentContainer(b)))})},startup:function(a){this.inherited(arguments);this.locked&&this.disableToolbarButtons(!0)},dodblclick:function(a){this.onRowDblClick(a)},doApplyCellEdit:function(a,b,c){var f=this,e=this.getItem(b),g=this.store;if(a!==e[c][0]){if(("account_code_id"===c||"uom_id"===c)&&0>a)return;var h=buildspace.dialog.indeterminateProgressBar({title:d.savingData+". "+d.pleaseWait+"..."}),p={id:String(e.id),debitCreditNoteClaimId:f.debitCreditNoteClaimId,
accountGroupId:f.accountGroupId,attr_name:c,val:a,_csrf_token:e._csrf_token?e._csrf_token:null},m="debitCreditNote/debitCreditNoteClaimItemUpdate";if(e&&isNaN(parseInt(String(e.id[0])))){var k=0<b?this.getItem(b-1):!1;n.mixin(p,{prev_item_id:k?k.id:0});m="debitCreditNote/debitCreditNoteClaimItemAdd"}var l=function(a,b){for(var c in a)e.hasOwnProperty(c)&&c!=b._getIdentifierAttribute()&&b.setValue(e,c,a[c]);b.save()};h.show().then(function(){dojo.xhrPost({url:m,content:p,handleAs:"json",load:function(a){if(a.success){isNaN(parseInt(String(e.id)))?
(g.deleteItem(e),g.save(),dojo.forEach(a.items,function(a){g.newItem(a)}),g.save()):l(a.data,g);var d=f.getCellByField(c);window.setTimeout(function(){f.focus.setFocusIndex(b,d.index)},10);f.debitCreditNoteClaimGrid.reloadGrid();f.accountGroupSelectionGrid.reloadGrid();h.hide()}},error:function(a){h.hide()}})})}this.inherited(arguments)},addRow:function(a){k.curNode.blur();k.curNode=null;if(-1<this.selection.selectedIndex)var b=this.selection.selectedIndex,c=this,f,e=buildspace.dialog.indeterminateProgressBar({title:d.savingData+
". "+d.pleaseWait+"..."}),g=this.store,h=this.getItem(b);isNaN(parseInt(String(h.id)))?(a=0<b?this.getItem(b-1).id:0,f={id:String(h.id),prev_item_id:String(a),_csrf_token:h._csrf_token}):(a=0<b?this.getItem(b-1).id:0,f={prev_item_id:String(a),before_id:String(h.id),_csrf_token:h._csrf_token});n.mixin(f,{accountGroupId:c.accountGroupId,debitCreditNoteClaimId:c.debitCreditNoteClaimId});e.show().then(function(){dojo.xhrPost({url:"debitCreditNote/debitCreditNoteClaimItemAdd",content:f,handleAs:"json",
load:function(a){a.success&&dojo.forEach(a.items,function(a){0<a.id&&(a=g.newItem(a),g.save(),a=c.getItemIndex(a),c.rearranger.moveRows([a],b),c.selection.clear())});window.setTimeout(function(){c.selection.setSelected(b,!0);c.focus.setFocusIndex(b,1)},30);e.hide()},error:function(a){c.selection.clear();c.disableToolbarButtons(!0);e.hide()}})})},deleteRow:function(a){var b=this.selection.selectedIndex;a=this.getItem(b);k.curNode.blur();k.curNode=null;if(-1<this.selection.selectedIndex&&a&&!isNaN(parseInt(String(a.id)))){var c=
this,f=buildspace.dialog.indeterminateProgressBar({title:d.deleting+". "+d.pleaseWait+"..."}),e={id:a.id,_csrf_token:a._csrf_token,accountGroupId:c.accountGroupId,debitCreditNoteClaimId:c.debitCreditNoteClaimId};buildspace.dialog.confirm(d.deleteClaimItemConfirmation,"<div>"+d.doYouReallywantToDeleteClaimItem+" ?</div>",90,320,function(){f.show().then(function(){dojo.xhrPost({url:"debitCreditNote/debitCreditClaimItemDelete",content:e,handleAs:"json",load:function(a){if(a.success){a=a.items;for(var d=
c.store,e=0,g=a.length;e<g;++e)d.fetchItemByIdentity({identity:a[e].id,onItem:function(a){d.deleteItem(a);d.save()}});a.length=0;c.selection.clear();window.setTimeout(function(){c.focus.setFocusIndex(b,0)},10);c.disableToolbarButtons(!0)}f.hide();c.selectedItem=null;c.pasteOp=null},error:function(a){c.selection.clear();c.disableToolbarButtons(!0);c.selectedItem=null;c.pasteOp=null;f.hide()}})})})}},contextMenu:function(a){var b=this.rowCtxMenu=new dijit.Menu;this.contextMenuItems(a);var c={target:a.target,
coords:a.keyCode!==t.F10&&"pageX"in a?{x:a.pageX,y:a.pageY}:null},d=this.getItem(a.rowIndex);b&&d&&(this.selection.isSelected(a.rowIndex)||a.rowNode&&html.hasClass(a.rowNode,"dojoxGridRowbar"))&&(b._openMyself(c),r.stop(a))},contextMenuItems:function(a){(a=this.getItem(a.rowIndex))&&!isNaN(parseInt(String(a.id)))&&(this.rowCtxMenu.addChild(new dijit.MenuItem({label:d.addRow,iconClass:"icon-16-container icon-16-add",onClick:dojo.hitch(this,"addRow")})),this.rowCtxMenu.addChild(new dijit.MenuItem({label:d.deleteRow,
iconClass:"icon-16-container icon-16-delete",onClick:dojo.hitch(this,"deleteRow")})))},disableToolbarButtons:function(a,b){var c=dijit.byId("AddDebitCreditNoteClaimItemRow-button"),d=dijit.byId("DeleteDebitCreditNoteClaimItemRow-button");c._setDisabledAttr(a);d._setDisabledAttr(a);a&&b instanceof Array&&dojo.forEach(b,function(a){(a=dijit.byId(a+"DebitCreditNoteClaimItemRow-button"))&&a._setDisabledAttr(!1)})},addUploadAttachmentContainer:function(a){var b="project-"+this.projectId+"-uploadAttachment",
c=dijit.byId(b);c&&(this.container.removeChild(c),c.destroy());return c=new x({id:b,region:"bottom",item:a,disableEditing:this.locked||this.lockedForVerify,style:"padding:0;margin:0;border:none;width:100%;height:40%;"})}});return l("buildspace.apps.PostContract.DebitCreditNote.DebitCreditNoteClaimItem",dijit.layout.BorderContainer,{style:"padding:0;margin:0px;border:none;width:100%;height:100%;",gutters:!1,accountGroupId:null,debitCreditNoteClaimId:null,locked:null,lockedForVerify:null,debitCreditNoteClaimGrid:null,
accountGroupSelectionGrid:null,constructor:function(){this.inherited(arguments)},postCreate:function(){this.inherited(arguments);var a=this,b=new w,c=function(a,b,c){a=this.grid.getItem(b);return 0<=a.id?'<span style="color:blue;">'+a.attachment+"</span>":null};pb=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});pb.show().then(function(){dojo.xhrPost({url:"debitCreditNote/getAccountCodes",handleAs:"json",content:{accountGroupId:a.accountGroupId}}).then(function(f){dojo.xhrPost({url:"variationOrder/getUnits",
handleAs:"json",content:{}}).then(function(e){try{var g=this.DebitCreditClaimItemGrid=new y({store:new dojo.data.ItemFileWriteStore({clearOnClose:!0,url:"debitCreditNote/getDebitCreditClaimItems/debitCreditNoteClaimId/"+a.debitCreditNoteClaimId}),structure:[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:b.rowCountCellFormatter},{name:d.description,field:"account_code_id",editable:!0,cellType:"dojox.grid.cells.Select",options:f.options,values:f.values,noresize:!0,width:"auto",
styles:"text-align:left;"},{name:d.invoiceNumber,field:"invoice_number",editable:!0,cellType:"buildspace.widget.grid.cells.Textarea",noresize:!0,width:"120px",styles:"text-align:center;"},{name:d.invoiceDate,field:"invoice_date",editable:!0,cellType:"buildspace.widget.grid.cells.DateTextBox",noresize:!0,width:"100px",styles:"text-align:center;"},{name:d.dueDate,field:"due_date",editable:!0,cellType:"buildspace.widget.grid.cells.DateTextBox",noresize:!0,width:"100px",styles:"text-align:center;"},{name:d.attachment,
field:"attachment",editable:!1,cellType:"buildspace.widget.grid.cells.Textarea",noresize:!0,width:"82px",styles:"text-align:center;",formatter:c},{name:d.unit,field:"uom_id",width:"70px",styles:"text-align:center;",editable:!0,cellType:"dojox.grid.cells.Select",options:e.options,values:e.values},{name:d.quantity,field:"quantity",editable:!0,cellType:"buildspace.widget.grid.cells.Textarea",noresize:!0,width:"80px",styles:"text-align:center;",formatter:b.numberCellFormatter},{name:d.rate,field:"rate",
editable:!0,cellType:"buildspace.widget.grid.cells.Textarea",noresize:!0,width:"120px",styles:"text-align:right;",formatter:b.currencyCellFormatter},{name:d.amount,field:"amount",editable:!1,cellType:"buildspace.widget.grid.cells.Textarea",noresize:!0,width:"160px",styles:"text-align:right;",formatter:b.unEditableCurrencyCellFormatter},{name:d.remark,field:"remarks",editable:!0,cellType:"buildspace.widget.grid.cells.Textarea",noresize:!0,width:"150px",styles:"text-align:center;"}],debitCreditNoteClaimId:a.debitCreditNoteClaimId,
accountGroupId:a.accountGroupId,container:a,locked:a.locked,lockedForVerify:a.lockedForVerify,accountGroupSelectionGrid:a.accountGroupSelectionGrid,debitCreditNoteClaimGrid:a.debitCreditNoteClaimGrid}),h=new dijit.Toolbar({region:"top",style:"padding:2px;border-bottom:none;width:100%;"});h.addChild(new dijit.form.Button({id:"AddDebitCreditNoteClaimItemRow-button",label:d.addRow,iconClass:"icon-16-container icon-16-add",disabled:!0,onClick:dojo.hitch(g,"addRow")}));h.addChild(new dijit.form.Button({id:"DeleteDebitCreditNoteClaimItemRow-button",
label:d.deleteRow,iconClass:"icon-16-container icon-16-delete",disabled:!0,onClick:dojo.hitch(g,"deleteRow")}));var k=new u({grid:g,region:"top",filterFields:[{name:d.description}]});a.addChild(k);a.lockedForVerify||a.addChild(h);a.addChild(g);pb.hide()}catch(m){console.log(m.message)}})})})}})});
