define("buildspace/apps/PostContract/PostContractClaim/PostContractClaimItemContainer","dojo/_base/declare dojo/_base/lang dojo/aspect dojo/currency dojo/when dojo/number dijit/layout/TabContainer dijit/layout/ContentPane dojox/grid/EnhancedGrid ./PostContractClaimGrid ./PostContractClaimClaimGrid buildspace/apps/Attachment/UploadAttachmentContainer buildspace/widget/grid/cells/Select dojox/grid/enhanced/plugins/Rearrange buildspace/widget/grid/cells/Formatter dojo/i18n!buildspace/nls/PostContract".split(" "),
function(w,F,x,G,y,H,z,I,J,A,B,C,K,L,D,e){return w("buildspace.apps.PostContract.PostContractClaim.PostContractClaimItemContainer",z,{pageId:"page-00",style:"margin:0;padding:0;border:none;width:100%;height:100%;",gutters:!1,stackContainerTitle:null,gridOpts:{},project:null,nested:!0,postContractClaim:null,withProgressClaim:null,borderContainerWidget:null,itemType:null,claimCertificate:null,locked:!1,postCreate:function(){var c=this;this.inherited(arguments);var a=dojo.xhrGet({url:"postContractClaim/getUnits",
handleAs:"json"}),f=buildspace.dialog.indeterminateProgressBar({title:e.pleaseWait+"..."}),h={id:this.postContractClaim.id};this.claimCertificate&&(h.claimRevision=this.claimCertificate.post_contract_claim_revision_id);var d=dojo.xhrGet({url:"postContractClaim/getClaimStatus",content:h,handleAs:"json"});y(a,function(b){f.show().then(function(){d.then(function(l){f.hide();c.createPostContractClaimItemGrid(b,l,!0);c.withProgressClaim&&c.createPostContractClaimClaimGrid(l)})})});switch(parseInt(c.itemType)){case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_ADVANCE_PAYMENT:stackContainerName=
"advancePayment-";break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_POST_CONTRACT_CLAIM_MATERIAL_ON_SITE:stackContainerName="materialOnSite-";break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_DEPOSIT:stackContainerName="deposit-";break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_PURCHASE_ON_BEHALF:stackContainerName="purchaseOnBehalf-";break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_PERMIT:stackContainerName="permit-";
break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_KONGSIKONG:stackContainerName="kongSiKong-";break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_WORK_ON_BEHALF:stackContainerName="workOnBehalf-";break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_WORK_ON_BEHALF_BACKCHARGE:stackContainerName="workOnBehalfBackcharge-";break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_PENALTY:stackContainerName="penalty-";break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_WATER_DEPOSIT:stackContainerName=
"waterDeposit-"}if(a=dijit.byId(stackContainerName+this.project.id+"-stackContainer"))a.addChild(new dojox.layout.ContentPane({title:buildspace.truncateString(this.stackContainerTitle,45),id:this.pageId,content:this,executeScripts:!0})),a.selectChild(this.pageId)},createPostContractClaimItemGrid:function(c,a,f){var h=dijit.byId("postContractClaimItems_tab-"+this.project.id+"_"+this.postContractClaim.id+"-StackPane");switch(parseInt(this.itemType)){case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_ADVANCE_PAYMENT:var d=
buildspace.apps.PostContract.ProjectStructureConstants.TYPE_ADVANCE_PAYMENT_TEXT+" Items";break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_POST_CONTRACT_CLAIM_MATERIAL_ON_SITE:d=buildspace.apps.PostContract.ProjectStructureConstants.TYPE_MATERIAL_ON_SITE_TEXT+" Items";break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_DEPOSIT:d=buildspace.apps.PostContract.ProjectStructureConstants.TYPE_DEPOSIT_TEXT+" Items";break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_PURCHASE_ON_BEHALF:d=
buildspace.apps.PostContract.ProjectStructureConstants.TYPE_PURCHASE_ON_BEHALF_TEXT+" Items";break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_PERMIT:d=buildspace.apps.PostContract.ProjectStructureConstants.TYPE_PERMIT_TEXT+" Items";break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_KONGSIKONG:d=buildspace.apps.PostContract.ProjectStructureConstants.TYPE_KONGSIKONG_TEXT+" Items";break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_WORK_ON_BEHALF:d=
buildspace.apps.PostContract.ProjectStructureConstants.TYPE_WORK_ON_BEHALF_TEXT+" Items";break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_WORK_ON_BEHALF_BACKCHARGE:d=buildspace.apps.PostContract.ProjectStructureConstants.TYPE_WORK_ON_BEHALF_BACKCHARGE_TEXT+" Items";break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_PENALTY:d=buildspace.apps.PostContract.ProjectStructureConstants.TYPE_PENALTY_TEXT+" Items";break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_WATER_DEPOSIT:d=
buildspace.apps.PostContract.ProjectStructureConstants.TYPE_WATER_DEPOSIT_TEXT+" Items"}h||=new dijit.layout.StackContainer({id:"postContractClaimItems_tab-"+this.project.id+"_"+this.postContractClaim.id+"-StackPane",style:"margin:0;padding:0;border:none;width:100%;height:100%;",region:"center",title:d});var b=dijit.byId("postContractClaimItems-"+this.project.id+"_"+this.postContractClaim.id+"-borderContainer");b&&(h.removeChild(b),b.destroyRecursive());var l=[buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_TEXT,
buildspace.widget.grid.constants.HIERARCHY_TYPE_WORK_ITEM_TEXT],u=[buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER,buildspace.widget.grid.constants.HIERARCHY_TYPE_WORK_ITEM];b=new D;switch(parseInt(this.itemType)){case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_ADVANCE_PAYMENT:var g="advancePayment/getAdvancePaymentItemList/id/"+this.postContractClaim.id;var k="advancePayment/advancePaymentItemAdd";var m=0<a.count?"postContractClaim/claimItemUpdate":"advancePayment/advancePaymentItemUpdate";
var n="advancePayment/advancePaymentItemDelete";var p="advancePayment/advancePaymentItemIndent";var q="advancePayment/advancePaymentItemOutdent";var r="advancePayment/advancePaymentItemPaste";var t=this.itemType;break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_POST_CONTRACT_CLAIM_MATERIAL_ON_SITE:g="postContractClaimMaterialOnSite/getMaterialOnSiteItemList/id/"+this.postContractClaim.id;k="postContractClaimMaterialOnSite/materialOnSiteItemAdd";m=0<a.count?"postContractClaim/claimItemUpdate":
"postContractClaimMaterialOnSite/materialOnSiteItemUpdate";n="postContractClaimMaterialOnSite/materialOnSiteItemDelete";p="postContractClaimMaterialOnSite/materialOnSiteItemIndent";q="postContractClaimMaterialOnSite/materialOnSiteItemOutdent";r="postContractClaimMaterialOnSite/materialOnSiteItemPaste";t=this.itemType;break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_DEPOSIT:g="postContractClaimDeposit/getDepositItemList/id/"+this.postContractClaim.id;k="postContractClaimDeposit/depositItemAdd";
m=0<a.count?"postContractClaim/claimItemUpdate":"postContractClaimDeposit/depositItemUpdate";n="postContractClaimDeposit/depositItemDelete";p="postContractClaimDeposit/depositItemIndent";q="postContractClaimDeposit/depositItemOutdent";r="postContractClaimDeposit/depositItemPaste";t=this.itemType;break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_PURCHASE_ON_BEHALF:g="postContractClaimPurchaseOnBehalf/getPurchaseOnBehalfItemList/id/"+this.postContractClaim.id;k="postContractClaimPurchaseOnBehalf/purchaseOnBehalfItemAdd";
m=0<a.count?"postContractClaim/claimItemUpdate":"postContractClaimPurchaseOnBehalf/purchaseOnBehalfItemUpdate";n="postContractClaimPurchaseOnBehalf/purchaseOnBehalfItemDelete";p="postContractClaimPurchaseOnBehalf/purchaseOnBehalfItemIndent";q="postContractClaimPurchaseOnBehalf/purchaseOnBehalfItemOutdent";r="postContractClaimPurchaseOnBehalf/purchaseOnBehalfItemPaste";t=this.itemType;break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_PERMIT:g="postContractClaimPermit/getPermitItemList/id/"+
this.postContractClaim.id;k="postContractClaimPermit/permitItemAdd";m=0<a.count?"postContractClaim/claimItemUpdate":"postContractClaimPermit/permitItemUpdate";n="postContractClaimPermit/permitItemDelete";p="postContractClaimPermit/permitItemIndent";q="postContractClaimPermit/permitItemOutdent";r="postContractClaimPermit/permitItemPaste";t=this.itemType;break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_KONGSIKONG:g="postContractClaimKongSiKong/getKongSiKongItemList/id/"+this.postContractClaim.id;
k="postContractClaimKongSiKong/kongSiKongItemAdd";m=0<a.count?"postContractClaim/claimItemUpdate":"postContractClaimKongSiKong/kongSiKongItemUpdate";n="postContractClaimKongSiKong/kongSiKongItemDelete";p="postContractClaimKongSiKong/kongSiKongItemIndent";q="postContractClaimKongSiKong/kongSiKongItemOutdent";r="postContractClaimKongSiKong/kongSiKongItemPaste";t=this.itemType;break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_WORK_ON_BEHALF:g="postContractClaimWorkOnBehalf/getWorkOnBehalfItemList/id/"+
this.postContractClaim.id;k="postContractClaimWorkOnBehalf/workOnBehalfItemAdd";m=0<a.count?"postContractClaim/claimItemUpdate":"postContractClaimWorkOnBehalf/workOnBehalfItemUpdate";n="postContractClaimWorkOnBehalf/workOnBehalfItemDelete";p="postContractClaimWorkOnBehalf/workOnBehalfItemIndent";q="postContractClaimWorkOnBehalf/workOnBehalfItemOutdent";r="postContractClaimWorkOnBehalf/workOnBehalfItemPaste";t=this.itemType;break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_WORK_ON_BEHALF_BACKCHARGE:g=
"postContractClaimWorkOnBehalfBackcharge/getWorkOnBehalfBackchargeItemList/id/"+this.postContractClaim.id;k="postContractClaimWorkOnBehalfBackcharge/workOnBehalfBackchargeItemAdd";m=0<a.count?"postContractClaim/claimItemUpdate":"postContractClaimWorkOnBehalfBackcharge/workOnBehalfBackchargeItemUpdate";n="postContractClaimWorkOnBehalfBackcharge/workOnBehalfBackchargeItemDelete";p="postContractClaimWorkOnBehalfBackcharge/workOnBehalfBackchargeItemIndent";q="postContractClaimWorkOnBehalfBackcharge/workOnBehalfBackchargeItemOutdent";
r="postContractClaimWorkOnBehalfBackcharge/workOnBehalfBackchargeItemPaste";t=this.itemType;break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_PENALTY:g="postContractClaimPenalty/getPenaltyItemList/id/"+this.postContractClaim.id;k="postContractClaimPenalty/penaltyItemAdd";m=0<a.count?"postContractClaim/claimItemUpdate":"postContractClaimPenalty/penaltyItemUpdate";n="postContractClaimPenalty/penaltyItemDelete";p="postContractClaimPenalty/penaltyItemIndent";q="postContractClaimPenalty/penaltyItemOutdent";
r="postContractClaimPenalty/penaltyItemPaste";t=this.itemType;break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_WATER_DEPOSIT:g="postContractClaimWaterDeposit/getWaterDepositItemList/id/"+this.postContractClaim.id,k="postContractClaimWaterDeposit/waterDepositItemAdd",m=0<a.count?"postContractClaim/claimItemUpdate":"postContractClaimWaterDeposit/waterDepositItemUpdate",n="postContractClaimWaterDeposit/waterDepositItemDelete",p="postContractClaimWaterDeposit/waterDepositItemIndent",
q="postContractClaimWaterDeposit/waterDepositItemOutdent",r="postContractClaimWaterDeposit/waterDepositItemPaste",t=this.itemType}this.claimCertificate&&(g+="/claimRevision/"+this.claimCertificate.post_contract_claim_revision_id);g=dojo.data.ItemFileWriteStore({url:g,clearOnClose:!0});c={cells:[[{name:"No",field:"id",styles:"text-align:center;",width:"30px",formatter:b.rowCountCellFormatter,noresize:!0,rowSpan:2},{name:e.description,field:"description",styles:"text-align:left;",width:"500px",editable:this.postContractClaim.can_be_edited[0],
cellType:"buildspace.widget.grid.cells.Textarea",formatter:b.treeCellFormatter,noresize:!0,rowSpan:2},{name:e.attachment,field:"attachment",width:"100px",styles:"text-align:center;",formatter:function(v,E,M){v=this.grid.getItem(E);return 0<=v.id?'<span style="color:blue;">'+v.attachment+"</span>":null},noresize:!0,rowSpan:2},{name:e.type,field:"type",width:"120px",styles:"text-align:center;",editable:this.postContractClaim.can_be_edited[0],type:"dojox.grid.cells.Select",options:l,values:u,noresize:!0,
rowSpan:2},{name:e.unit,field:"uom_id",width:"90px",editable:this.postContractClaim.can_be_edited[0],styles:"text-align:center;",type:"dojox.grid.cells.Select",options:c.options,values:c.values,formatter:b.unitIdCellFormatter,noresize:!0,rowSpan:2},{name:e.qty,field:"quantity",styles:"text-align:right;",width:"120px",editable:this.postContractClaim.can_be_edited[0],cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:b.numberCellFormatter,noresize:!0,rowSpan:2},{name:e.rate,field:"rate",
styles:"text-align:right;",width:"120px",editable:this.postContractClaim.can_be_edited[0],cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:this.postContractClaim.can_be_edited[0]?b.currencyCellFormatter:b.unEditableCurrencyCellFormatter,noresize:!0,rowSpan:2},{name:e.amount,field:"amount",styles:"text-align:right;",width:"120px",formatter:b.unEditableCurrencyCellFormatter,noresize:!0,rowSpan:2}],[]]};this.withProgressClaim&&(c.cells[0].push({name:"%",field:"previous_percentage-value",
styles:"text-align:right;",width:"60px",formatter:b.unEditableNumberCellFormatter,noresize:!0},{name:e.qty,field:"previous_quantity-value",styles:"text-align:right;",width:"90px",formatter:b.unEditableNumberCellFormatter,noresize:!0},{name:e.amount,field:"previous_amount-value",styles:"text-align:right;",width:"120px",formatter:b.unEditableNumberCellFormatter,noresize:!0},{name:"%",field:"current_percentage-value",styles:"text-align:right;",width:"60px",editable:0<a.count&&a.can_edit_claim_amount?
!0:!1,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:0<a.count&&a.can_edit_claim_amount?b.editablePercentageCellFormatter:b.unEditablePercentageCellFormatter,noresize:!0},{name:e.qty,field:"current_quantity-value",styles:"text-align:right;",width:"90px",editable:0<a.count&&a.can_edit_claim_amount?!0:!1,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:0<a.count&&a.can_edit_claim_amount?b.currencyCellFormatter:b.unEditableNumberCellFormatter,noresize:!0},{name:e.amount,
field:"current_amount-value",styles:"text-align:right;",width:"120px",editable:0<a.count&&a.can_edit_claim_amount?!0:!1,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:0<a.count&&a.can_edit_claim_amount?b.currencyCellFormatter:b.unEditableCurrencyCellFormatter,noresize:!0},{name:"%",field:"up_to_date_percentage-value",styles:"text-align:right;",width:"60px",editable:0<a.count&&a.can_edit_claim_amount?!0:!1,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:0<a.count&&
a.can_edit_claim_amount?b.editablePercentageCellFormatter:b.unEditablePercentageCellFormatter,noresize:!0},{name:e.qty,field:"up_to_date_quantity-value",styles:"text-align:right;",width:"90px",editable:0<a.count&&a.can_edit_claim_amount?!0:!1,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:0<a.count&&a.can_edit_claim_amount?b.currencyCellFormatter:b.unEditableNumberCellFormatter,noresize:!0},{name:e.amount,field:"up_to_date_amount-value",styles:"text-align:right;",width:"120px",editable:0<
a.count&&a.can_edit_claim_amount?!0:!1,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:0<a.count&&a.can_edit_claim_amount?b.currencyCellFormatter:b.unEditableNumberCellFormatter,noresize:!0}),c.cells[1].push({name:"Previous Pay Back",field:"previous_payback",styles:"text-align:center;",headerClasses:"staticHeader",noresize:!0,colSpan:3},{name:"Current Pay Back",field:"current_payback",styles:"text-align:center;",headerClasses:"staticHeader",noresize:!0,colSpan:3},{name:"Up To Date Pay Back",
field:"up_to_date_payback",styles:"text-align:center;",headerClasses:"staticHeader",noresize:!0,colSpan:3}));switch(parseInt(this.itemType)){case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_POST_CONTRACT_CLAIM_MATERIAL_ON_SITE:c.cells[0].splice(8,0,{name:"%",field:"reduction_percentage-value",styles:"text-align:right;",width:"60px",editable:this.postContractClaim.can_be_edited[0],cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:b.editablePercentageCellFormatter,noresize:!0},
{name:e.amount,field:"reduction_amount-value",styles:"text-align:right;",width:"120px",editable:this.postContractClaim.can_be_edited[0],cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:b.currencyCellFormatter,noresize:!0});c.cells[1].splice(0,0,{name:e.reduction,field:"reduction",styles:"text-align:center;",headerClasses:"staticHeader",noresize:!0,colSpan:2});break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_PURCHASE_ON_BEHALF:c.cells[0].splice(1,0,{name:e.document_number,
field:"document_number",styles:"text-align:center;",width:"120px",editable:this.postContractClaim.can_be_edited[0],cellType:"buildspace.widget.grid.cells.Textarea",formatter:b.treeCellFormatter,noresize:!0,rowSpan:2});break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_KONGSIKONG:c.cells[0].splice(1,0,{name:e.labourType,field:"labour_type",width:"120px",styles:"text-align:center;",editable:this.postContractClaim.can_be_edited[0],type:"dojox.grid.cells.Select",options:[buildspace.apps.PostContract.ProjectStructureConstants.LABOUR_TYPE_SKILLED_TEXT,
buildspace.apps.PostContract.ProjectStructureConstants.LABOUR_TYPE_UNSKILLED_TEXT],values:[buildspace.apps.PostContract.ProjectStructureConstants.LABOUR_TYPE_SKILLED,buildspace.apps.PostContract.ProjectStructureConstants.LABOUR_TYPE_UNSKILLED],noresize:!0,rowSpan:2})}a=this.grid=new A({project:this.project,postContractClaim:this.postContractClaim,postContractClaimItemContainer:this,type:t,itemLevel:!0,locked:!this.postContractClaim.can_be_edited[0],hideMosToolbar:!0,gridOpts:{store:g,addUrl:k,updateUrl:m,
deleteUrl:n,indentUrl:p,outdentUrl:q,pasteUrl:r,structure:c}});d=this.makeItemGridContainer(a,d);h.addChild(d);this.borderContainerWidget=d;f&&this.addChild(h)},createPostContractClaimClaimGrid:function(c){this.addChild(new B({title:e.claimRevisions,project:this.project,postContractClaim:this.postContractClaim,postContractClaimItemContainer:this,claimCertificate:this.claimCertificate,claimStatus:c,locked:this.locked}))},makeItemGridContainer:function(c,a){var f=this.project.id+"_"+this.postContractClaim.id,
h=dijit.byId("postContractClaimItems-"+f+"-stackContainer");h&&h.destroyRecursive();h=new dijit.layout.StackContainer({style:"width:100%;height:100%;border:none;",region:"center",id:"postContractClaimItems-"+f+"-stackContainer"});h.addChild(new dijit.layout.ContentPane({title:a,content:c,grid:c.grid}));c=new dijit.layout.StackController({region:"top",containerId:"postContractClaimItems-"+f+"-stackContainer"});c=new dijit.layout.ContentPane({style:"padding:0;overflow:hidden;",class:"breadCrumbTrail",
region:"top",content:c});(a=dijit.byId("postContractClaimItems-"+f+"-borderContainer"))&&a.destroyRecursive(!0);a=new dijit.layout.BorderContainer({id:"postContractClaimItems-"+f+"-borderContainer",style:"padding:0;margin:0;width:100%;height:100%;border:none;",gutters:!1,region:"center"});a.addChild(h);a.addChild(c);dojo.subscribe("postContractClaimItems-"+f+"-stackContainer-selectChild","",function(d){var b=dijit.byId("postContractClaimItems-"+f+"-stackContainer");if(b){var l=b.getChildren(),u=dojo.indexOf(l,
d);u+=1;if(l.length>u){for(;l.length>u;)b.removeChild(l[u]),l[u].destroyDescendants(),l[u].destroyRecursive(),u+=1;if(d.grid){var g=d.grid.selection.selectedIndex;d.grid.store.save();d.grid.store.close();var k=x.after(d.grid,"_onFetchComplete",function(){k.remove();-1<g&&(this.scrollToRow(g),this.selection.setSelected(g,!0))});d.grid.sort()}}}});return a},addUploadAttachmentContainer:function(c){var a="project-"+this.project.id+"-uploadAttachment",f=dijit.byId(a);f&&(this.borderContainerWidget.removeChild(f),
f.destroy());f=new C({id:a,region:"bottom",item:c,disableEditing:!c.can_be_edited[0],style:"padding:0;margin:0;border:none;width:100%;height:40%;"});this.borderContainerWidget.addChild(f);return f}})});
