define("buildspace/apps/PostContract/RequestForVariationClaim","dojo/_base/declare dojo/_base/lang dojo/aspect dojo/currency dojo/number dijit/layout/ContentPane ./RequestForVariationClaim/RequestForVariationClaimGrid buildspace/widget/grid/cells/Formatter dojo/i18n!buildspace/nls/PostContract".split(" "),function(q,u,r,s,l,n,p,t,a){return q("buildspace.apps.PostContract.RequestForVariationClaim",dijit.layout.BorderContainer,{style:"padding:0;margin:0;border:none;width:100%;height:100%;",region:"center",
gutters:!1,project:null,borderContainerWidget:null,locked:!1,postCreate:function(){this.inherited(arguments);var c=this,d=new t,g=[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:d.rowCountCellFormatter,noresize:!0},{name:a.rfvNumber,field:"rfv_number",width:"64px",styles:"text-align:center;"},{name:a.description,field:"description",width:"auto"},{name:a.totalClaimAmount,field:"total_claim_amount",width:"140px",styles:"text-align:right;",formatter:d.unEditableCurrencyCellFormatter},
{name:a.deductionAtClaimCert,field:"claim_cert_number",width:"180px",styles:"text-align:center;"}],h="requestForVariationClaim/getRequestForVariationClaims/pid/"+this.project.id,k=buildspace.dialog.indeterminateProgressBar({title:a.pleaseWait+"..."});k.show().then(function(){dojo.xhrGet({url:"postContract/getClaimGridEditableStatus",handleAs:"json",content:{id:c.project.id}}).then(function(b){c.locked||(c.locked=!b.editable);b=new p({id:"request_for_variation_claim-"+c.project.id,stackContainerTitle:a.requestForVariationClaims,
pageId:"request_for_variation_claim-"+c.project.id,project:c.project,type:"requestForVariationClaim",locked:c.locked,gridOpts:{store:dojo.data.ItemFileWriteStore({url:h,clearOnClose:!0}),structure:g,onRowDblClick:function(e){if((e=this.getItem(e.rowIndex))&&!isNaN(parseInt(String(e.id)))){var c=function(f,a,c){f=l.parse(f);a=this.grid.getItem(a);if(isNaN(f)||0==f||null==f)f="&nbsp;";else{var b=l.format(f,{places:2})+"%";f=0<=f?'<span style="color:blue;">'+b+"</span>":'<span style="color:#FF0000">'+
b+"</span>"}(!a.can_claim[0]||a.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER||a.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_N||a.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_NOID||a.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_RATE_ONLY)&&c.customClasses.push("disable-cell");return f},b=function(a,b,c){var e=l.parse(a);b=this.grid.getItem(b);isNaN(e)||0==e||null==e?a="&nbsp;":(a=s.format(e),a=0<=e?a:'<span style="color:#FF0000">'+a+"</span>");
(!b.can_claim[0]||b.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER||b.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_N||b.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_NOID||b.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_RATE_ONLY)&&c.customClasses.push("disable-cell");return a},m=this.locked;m||(m=!isNaN(parseInt(String(e.claim_cert_number))));new p({id:"request_for_variation_claim_items-"+e.id+"-"+this.project.id,stackContainerTitle:a.requestForVariationClaimItems,
pageId:"request_for_variation_claim_items-"+e.id+"-"+this.project.id+"-page",project:this.project,requestForVariationClaim:e,type:"requestForVariationClaimItems",locked:m,gridOpts:{store:dojo.data.ItemFileWriteStore({url:"requestForVariationClaim/getRequestForVariationClaimItems/id/"+e.id,clearOnClose:!0}),structure:{cells:[[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",formatter:d.rowCountCellFormatter,noresize:!0,rowSpan:2},{name:a.billReference,field:"bill_ref",styles:"text-align:center; color:red;",
width:"80px",formatter:d.unEditableCellFormatter,noresize:!0,rowSpan:2},{name:a.description,field:"description",width:"auto",noresize:!0,rowSpan:2},{name:a.type,field:"type",width:"70px",styles:"text-align:center;",formatter:d.typeCellFormatter,noresize:!0,rowSpan:2},{name:a.unit,field:"uom_id",width:"70px",styles:"text-align:center;",formatter:d.unitIdCellFormatter,noresize:!0,rowSpan:2},{name:a.rate,field:"rate",styles:"text-align:right;",width:"120px",noresize:!0,rowSpan:2,formatter:d.unEditableCurrencyCellFormatter},
{name:a.qty,field:"quantity",styles:"text-align:right;",width:"90px",formatter:d.unEditableNumberCellFormatter,noresize:!0,rowSpan:2},{name:a.total,field:"total",styles:"text-align:right;",width:"120px",formatter:d.unEditableCurrencyCellFormatter,noresize:!0,rowSpan:2},{name:"%",field:"percentage-value",styles:"text-align:right;",width:"60px",editable:!this.locked,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:!this.locked?c:d.unEditablePercentageCellFormatter,noresize:!0},{name:a.amount,
field:"amount-value",styles:"text-align:right;",width:"120px",editable:!this.locked,cellType:"buildspace.widget.grid.cells.FormulaTextBox",formatter:!this.locked?b:d.unEditableCurrencyCellFormatter,noresize:!0},{name:a.claimCertificateNumber,field:"claim_cert_number",width:"100px",styles:"text-align:center;",noresize:!0,rowSpan:2}],[{name:a.claims,field:"id",styles:"text-align:center;",headerClasses:"staticHeader",noresize:!0,colSpan:2}]]}}})}}}});b=c.makeGridContainer(b,a.requestForVariationClaims);
c.borderContainerWidget=b;c.addChild(b);k.hide()})})},makeGridContainer:function(a,d){var g=this.project.id,h=dijit.byId("requestForVariationClaim-"+g+"-stackContainer");h&&h.destroyRecursive();h=new dijit.layout.StackContainer({style:"width:100%;height:100%;border:none;",region:"center",id:"requestForVariationClaim-"+g+"-stackContainer"});h.addChild(new n({title:d,content:a,grid:a.grid}));var k=new dijit.layout.StackController({region:"top",containerId:"requestForVariationClaim-"+g+"-stackContainer"}),
k=new n({style:"padding:0;overflow:hidden;","class":"breadCrumbTrail",region:"top",content:k}),b=dijit.byId("requestForVariationClaim-"+g+"-borderContainer");b&&b.destroyRecursive(!0);b=new dijit.layout.BorderContainer({id:"requestForVariationClaim-"+g+"-borderContainer",style:"padding:0;margin:0;width:100%;height:100%;border:none;",gutters:!1,region:"center"});b.addChild(h);b.addChild(k);dojo.subscribe("requestForVariationClaim-"+g+"-stackContainer-selectChild","",function(a){var b=dijit.byId("requestForVariationClaim-"+
g+"-stackContainer");if(b){var c=b.getChildren(),d=dojo.indexOf(c,a),d=d+1;if(c.length>d){for(;c.length>d;)b.removeChild(c[d]),c[d].destroyDescendants(),c[d].destroyRecursive(),d+=1;var f=a.grid.selection.selectedIndex;a.grid.store.save();a.grid.store.close();var h=r.after(a.grid,"_onFetchComplete",function(){h.remove();-1<f&&(this.scrollToRow(f,!0),this.selection.setSelected(f,!0))});a.grid.sort()}}});return b}})});
