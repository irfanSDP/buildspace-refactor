var __hasProp={}.hasOwnProperty;
define("buildspace/apps/PostContract/ClaimRevisionSettingsForm","dojo/_base/declare dojo/html dojo/dom dojo/dom-construct dojo/keys dojo/request dojo/dom-style dojo/dom-attr dojo/dom-geometry dojo/_base/lang dijit/form/Form dijit/form/RadioButton dijit/form/Select dijit/form/ValidationTextBox dijit/form/NumberTextBox dijit/form/CurrencyTextBox dojo/number dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/on dojo/text!./templates/claimRevisionSettingsForm.html dojo/text!./templates/claimRevisionSettingsRow.html dojo/i18n!buildspace/nls/PostContract".split(" "),function(k,
l,x,r,y,f,a,z,A,g,B,C,D,E,F,G,H,m,I,n,p,t,u,v,d){var q=buildspace.constants.MAX_CLAIM_REVISIONS,w=k("buildspace.apps.PostContract.ClaimRevisionSettingRowForm",[m,n,p],{isNew:!1,projectId:-1,revisionId:-1,postContractId:-1,region:"center",nls:d,rootProject:null,revisionData:null,ClaimRevisionSettingsForm:null,_csrf_token:0,constructor:function(b){return b.templateString=v},postCreate:function(){var b;this.inherited(arguments);b=this;this.setSelectedCurrentSelectedRevision();this.exitEditMode();this.updateRevisionStatusDescription(this.revisionData.locked_status);
this.lockedStatusValue.set("value",this.revisionData.locked_status);return t(this.showRevisionSelectedLink,"click",function(c){return b.assignNewSelectedRevision()})},assignNewSelectedRevision:function(){var b=this,c=new buildspace.dialog.indeterminateProgressBar({title:d.processing+"..."}),e={post_contract_id:this.revisionData.post_contract_id,revisionId:this.revisionId,"post_contract_claim_revision[post_contract_id]":this.revisionData.post_contract_id,"post_contract_claim_revision[current_selected_revision]":!0,
"post_contract_claim_revision[_csrf_token]":this._csrf_token};c.show().then(function(){f.post("postContract/assignNewSelectedRevision",{data:e,handleAs:"json",preventCache:!0}).then(function(e){b.ClaimRevisionSettingsForm.revisionDatas=e;b.ClaimRevisionSettingsForm.clearOldRevisionAndAddNewRevision();c.hide()},function(b){c.hide()})})},save:function(){var b=this.ClaimRevisionSettingsForm,c=this,e=new buildspace.dialog.indeterminateProgressBar({title:d.processing+"..."}),a={post_contract_id:this.revisionData.post_contract_id,
revisionId:this.revisionId,"post_contract_claim_revision[post_contract_id]":this.revisionData.post_contract_id,"post_contract_claim_revision[version]":this.revisionData.version,"post_contract_claim_revision[locked_status]":this.lockedStatusValue.value,"post_contract_claim_revision[_csrf_token]":this._csrf_token};e.show().then(function(){f.post("postContract/saveClaimRevision",{data:a,handleAs:"json",preventCache:!0}).then(function(a){c.revisionId=a.item.id;c.updateRevisionStatusDescription(a.item.locked_status);
l.set(c.updatedAtView,a.item.updated_at);g.hitch(b,"closeElementItemGrid")();c.exitEditMode();e.hide()},function(b){c.exitEditMode();e.hide()})})},setSelectedCurrentSelectedRevision:function(){if(this.revisionData.selected)return a.set(this.showRevisionSelectedMarker,"display","block"),dijit.byId(this.rootProject.id[0]+"-ProjectRevision").set("title",d.claimRevision+"::"+d.version+" "+this.revisionData.version),a.set(this.showRevisionSelectedLink,"display","none");a.set(this.showRevisionSelectedMarker,
"display","none");return a.set(this.showRevisionSelectedLink,"display","block")},enterEditMode:function(){return this.setupEditMode()},setupEditMode:function(){a.set(this.addendumStatusInput,"display","");a.set(this.addendumStatusView,"display","none");a.set(this.editButton.domNode,"display","none");a.set(this.saveButton.domNode,"display","")},exitEditMode:function(){a.set(this.addendumStatusInput,"display","none");a.set(this.addendumStatusView,"display","");a.set(this.editButton.domNode,"display",
"");a.set(this.saveButton.domNode,"display","none")},updateRevisionStatusDescription:function(b){l.set(this.addendumStatusView,b?d.addendumLocked:d.addendumProgressing);b&&this.ClaimRevisionSettingsForm.tableCount!==q+2?this.ClaimRevisionSettingsForm.addClaimButton.set("disabled",!1):this.ClaimRevisionSettingsForm.addClaimButton.set("disabled",!0)},hideActionButton:function(){a.set(this.editButton.domNode,"display","none");a.set(this.saveButton.domNode,"display","none");a.set(this.noActionLabel,"display",
"")}});return k("buildspace.apps.PostContract.ClaimRevisionSettingsForm",[m,n,p],{projectId:-1,baseClass:"buildspace-form",style:"padding:5px;overflow:auto;border:0px;",region:"center",rootProject:null,nls:d,workarea:null,revisionDatas:null,postContractId:null,_csrf_token:0,tableCount:1,rowArray:[],constructor:function(b){return b.templateString=u},postMixInProperties:function(){this.inherited(arguments);return this.rowArray[this.projectId]=[]},postCreate:function(){this.inherited(arguments);this.masterGenerateClaimRevisionTableRow()},
masterGenerateClaimRevisionTableRow:function(){var b=this,c=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});c.show().then(function(){dojo.xhrGet({url:"postContract/getClaimRevisionLists",handleAs:"json",content:{id:b.projectId},load:function(a){b.revisionDatas=a;b.populateClaimRevisionTableRow();b.postContractId=a.postContractId;c.hide()},error:function(b){c.hide()}})})},addClaim:function(){var b,c,a,h;h=this;b=this.tableCount;c=new buildspace.dialog.indeterminateProgressBar({title:d.processing+
"..."});a={revisionId:-1,post_contract_id:this.postContractId,"post_contract_claim_revision[post_contract_id]":this.postContractId,"post_contract_claim_revision[version]":b,"post_contract_claim_revision[locked_status]":!1,"post_contract_claim_revision[_csrf_token]":this._csrf_token};c.show().then(function(){f.post("postContract/saveClaimRevision",{data:a,handleAs:"json",preventCache:!0}).then(function(b){h.revisionDatas=b;h.clearOldRevisionAndAddNewRevision();c.hide()},function(b){c.hide()})})},clearOldRevisionAndAddNewRevision:function(){this.rowArray[this.projectId]=
[];this.tableCount=1;dojo.empty(this.tableContainer);this.populateClaimRevisionTableRow();return g.hitch(this,"closeElementItemGrid")()},populateClaimRevisionTableRow:function(){var b,a,e,d;this._csrf_token=this.revisionDatas.form.csrf_token;d=this.revisionDatas.claimRevisions;for(a in d)__hasProp.call(d,a)&&(e=d[a],b=this.rowArray[this.projectId][a]=new w({count:this.tableCount,rootProject:this.rootProject,projectId:this.projectId,revisionId:e.id,postContractId:e.post_contract_id,revisionData:e,
ClaimRevisionSettingsForm:this,_csrf_token:this.revisionDatas.form.csrf_token}),0<a&&this.rowArray[this.projectId][a-1].hideActionButton(),this.addTableRow(b));e.locked_status&&this.tableCount!==q+2||this.addClaimButton.set("disabled",!0)},addTableRow:function(a){r.place(a.domNode,this.tableContainer);this.tableCount++},closeElementItemGrid:function(){return g.hitch(this.workarea,"removeBillTab")()}})});
