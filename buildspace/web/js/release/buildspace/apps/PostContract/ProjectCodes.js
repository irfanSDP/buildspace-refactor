define("buildspace/apps/PostContract/ProjectCodes","dojo/_base/declare dojo/_base/lang dojo/on dojo/html dojo/data/ObjectStore dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/projectCodeSettingsForm.html dojo/text!./templates/subsidiaryDetailsRow.html dojo/text!./templates/subsidiaryProportionRow.html dojo/i18n!buildspace/nls/PostContract".split(" "),function(e,n,p,q,r,f,y,g,h,t,u,v,k){var x=e("buildspace.apps.PostContract.ProjectCodeSettingsForm",
[f,g,h],{templateString:t,baseClass:"buildspace-form",nls:k,project:null,data:null,subsidiaries:null,subsidiaryIds:null,subsidiaryProportionRowCount:null,postCreate:function(){this.inherited(arguments);this.subsidiaries=this.data.data.subsidiaries;var b=this.data.data.subsidiaryIdArray;this.subSidiaryIds=b.join(",");for(var c=0;c<b.length;c++)(new w({eprojectSubId:this.subsidiaries["project_code_settings[eproject_sub_id_"+b[c]+"]"],name:this.subsidiaries["project_code_settings[name_"+b[c]+"]"],identifier:this.subsidiaries["project_code_settings[identifier_"+
b[c]+"]"],proportion:this.subsidiaries["project_code_settings[proportion_"+b[c]+"]"],isProjectSubsidiary:this.subsidiaries["project_code_settings[isProjectSubsidiary_"+b[c]+"]"],isProjectSubsidiaryChild:this.subsidiaries["project_code_settings[isProjectSubsidiaryChild_"+b+"]"]})).placeAt(this.subsidiariesTBody);0<this.data.data.childrenOfSubsidiarySelectOptionId.length&&(this.subsidiaryProportionSection.style.display="block",p(this.subsidiaryProportionRowAddButton,"click",n.hitch(this,"addSubsidiaryProportionRow")),
this.renderSubsidiaryProportionRow())},startup:function(){this.inherited(arguments);this.projectCodeSettingsForm.setFormValues(this.subsidiaries);this.subsidiaryIdsHiddenInput.set("value",this.subSidiaryIds)},renderSubsidiaryProportionRow:function(){var b=this;this.data.data.childSubsidiaryIdArray.forEach(function(c){var a=new l({subsidiaryChildrenSelection:b.data.data.selection_children,childrenOfSubsidiarySelectOptionId:b.data.data.childrenOfSubsidiarySelectOptionId,parent:b});a.setSelectedOption(b.data.data.saved_children["project_code_settings[eproject_subsidiary_id_"+
c+"]"]+"");a.setProportion(b.data.data.saved_children["project_code_settings[proportion_"+c+"]"]);a.placeAt(b.subsidiaryProportionTBody);b.updateSubsidiaryProportionRowCount("add")})},updateSubsidiaryProportionRowCount:function(b){"add"===b?this.subsidiaryProportionRowCount+=1:--this.subsidiaryProportionRowCount;this.disableAddButton(this.subsidiaryProportionRowCount>=this.data.data.childrenOfSubsidiarySelectOptionId.length)},disableAddButton:function(b){this.subsidiaryProportionRowAddButton.set("disabled",
b)},addSubsidiaryProportionRow:function(){(new l({subsidiaryChildrenSelection:this.data.data.selection_children,childrenOfSubsidiarySelectOptionId:this.data.data.childrenOfSubsidiarySelectOptionId,parent:this})).placeAt(this.subsidiaryProportionTBody);this.updateSubsidiaryProportionRowCount("add")},save:function(){var b=this,c=buildspace.dialog.indeterminateProgressBar({title:k.pleaseWait+"..."}),a=dojo.formToObject(this.projectCodeSettingsForm.id),m=[];if(a.selectedSubsidiaryId&&a.subsidiaryProportion&&
a.selectedSubsidiaryIdentifier){Array.isArray(a.selectedSubsidiaryId)||(a.selectedSubsidiaryId=a.selectedSubsidiaryId.split(" "),a.selectedSubsidiaryIdentifier=a.selectedSubsidiaryIdentifier.split(" "),a.subsidiaryProportion=a.subsidiaryProportion.split(" "));for(var d=0;d<a.selectedSubsidiaryId.length;d++){var e=a.selectedSubsidiaryId[d],f="project_code_settings[identifier_"+a.selectedSubsidiaryId[d]+"]",g=a.selectedSubsidiaryIdentifier[d],h="project_code_settings[proportion_"+a.selectedSubsidiaryId[d]+
"]",l=a.subsidiaryProportion[d],n="project_code_settings[isProjectSubsidiary_"+a.selectedSubsidiaryId[d]+"]",p="project_code_settings[isProjectSubsidiaryChild_"+a.selectedSubsidiaryId[d]+"]";a["project_code_settings[eproject_sub_id_"+a.selectedSubsidiaryId[d]+"]"]=e;a[f]=g;a[h]=l;a[n]="false";a[p]="true";m.push(e)}m=a["project_code_settings[subsidiaryIds]"].concat(",").concat(m.join(","));a["project_code_settings[subsidiaryIds]"]=m;delete a.selectedSubsidiaryId;delete a.selectedSubsidiaryIdentifier;
delete a.subsidiaryProportion}this.projectCodeSettingsForm.validate()&&(q.set(b.project_code_error_name.id,""),c.show().then(function(){dojo.xhrPost({url:"postContract/saveProjectCodeSettings",handleAs:"json",content:a,load:function(a){a.success||q.set(b.project_code_error_name.id,a.errors.global_errors[0]);c.hide()},error:function(a){console.log(a);c.hide()}})}))}}),w=e("buildspace.apps.PostContract.SubsidiaryDetailsRow",[f,g,h],{templateString:u,baseClass:"buildspace-form",nls:k,eprojectSubId:null,
name:null,identifier:null,proportion:null,isProjectSubsidiary:null,isProjectSubsidiaryChild:null}),l=e("buildspace.apps.PostContract.SubsidiaryProportionRow",[f,g,h],{templateString:v,baseClass:"buildspace-form",nls:k,store:null,objStore:null,subsidiaryChildrenSelection:null,childrenOfSubsidiarySelectOptionId:null,subsidiaryDropDownSelect:null,parent:null,constructor:function(){this.inherited(arguments);this.store=new dojo.store.Memory({data:[{id:null,label:null,identifier:null}]})},postCreate:function(){this.inherited(arguments);
var b=this;this.childrenOfSubsidiarySelectOptionId.forEach(function(c){b.store.add({id:c,label:b.subsidiaryChildrenSelection["project_code_settings[name_"+c+"]"],subsidiaryCode:b.subsidiaryChildrenSelection["project_code_settings[identifier_"+c+"]"]})});this.objStore=new r({objectStore:this.store});this.subsidiaryDropDownSelect=new dijit.form.Select({parent:b,store:this.objStore,style:"padding:20px;width:100%;"},b.subsidiaryDropDown);this.subsidiaryDropDownSelect.startup();this.subsidiaryDropDownSelect.on("change",
this.onSelectionChanged)},setSelectedOption:function(b){this.subsidiaryDropDownSelect.set("value",b)},setProportion:function(b){this.subsidiaryProportion.set("value",b)},onSelectionChanged:function(){var b=this.get("value");selectedSubsidiaryIdentifier=this.store.objectStore.data.filter(function(c){return c.id===b})[0].subsidiaryCode;this.parent.selectedSubsidiaryId.set("value",b);this.parent.selectedSubsidiaryIdentifier.set("value",selectedSubsidiaryIdentifier)},deleteSubsidiaryProportionRow:function(){this.parent.updateSubsidiaryProportionRowCount("remove");
dojo.destroy(dojo.byId(this.id))}});return e("buildspace.apps.PostContract.ProjectCodes",dijit.layout.BorderContainer,{region:"center",style:"padding:0;margin:0;width:100%;height:100%;",gutters:!1,project:null,postCreate:function(){this.inherited(arguments);var b=this,c={projectId:parseInt(String(this.project.id))};dojo.xhrPost({url:"postContract/getSubsidiaryData",content:c,handleAs:"json",load:function(a){a=new x({region:"center",style:"padding:0;width:100%;margin:5px;border:none;height:100%;",
gutters:!1,project:b.project,data:a});var c=new dijit.Toolbar({region:"top",style:"outline:none!important;padding:2px;width:100%;background:#f7f7f7;"});c.addChild(new dijit.form.Button({label:k.save,iconClass:"icon-16-container icon-16-save",onClick:dojo.hitch(a,"save")}));b.addChild(c);b.addChild(a)}})}})});
