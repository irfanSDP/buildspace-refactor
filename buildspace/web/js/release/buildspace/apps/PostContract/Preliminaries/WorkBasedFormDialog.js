(function(){define("buildspace/apps/PostContract/Preliminaries/WorkBasedFormDialog","dojo/_base/declare dojo/_base/lang dojo/keys dojo/parser dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/Toolbar dijit/form/Button dijit/layout/BorderContainer dijit/form/ValidationTextBox dijit/form/SimpleTextarea dijit/registry dojo/dom-style dojo/dom-form dojo/on dojo/request dojox/validate/web dijit/form/Select dijit/form/FilteringSelect dojo/store/Memory dojox/form/Manager dojo/text!./templates/workBasedForm.html dojo/i18n!../../../nls/PostContract".split(" "),
function(k,n,p,A,q,r,t,u,v,w,x,B,C,D,g,E,l,y,F,G,H,I,J,z,b){var m;m=k("buildspace.apps.PostContract.WorkBasedForm",[q,r,t,u],{baseClass:"buildspace-form",itemId:-1,bill_id:-1,templateString:z,region:"center",style:"overflow: auto;",formInfo:null,businessTypeSelections:null,nls:b,dialogContainer:null,item:null,billGridStore:null,total:0,currentClaimRevision:null,gridEditable:!0,postCreate:function(a){null==a&&(a=this);this.inherited(arguments);l(this.buildersWorkDoneInput,"blur",function(d){return a.calculateTotal()});
return l(this.totalBuildersWorkInput,"blur",function(d){return a.calculateTotal()})},startup:function(){this.inherited(arguments);this.prelimWorkBasedClaimForm.setFormValues(this.formInfo);if(!this.gridEditable)return this.prelimWorkBasedClaimForm.disable()},clearInputErrorMsgs:function(a){var d,c,e,b;null==a&&(a=this);e={builders_work_done:null,total_builders_work:null};b=[];for(c in e)d=a["error-"+c],d.innerHTML=e[c],b.push(g.set(d,"display","none"));return b},save:function(){var a,d,c,e,f;c=this;
e=c.billGridStore;if(100<this.total)return buildspace.dialog.alert(b.error,b.totalMustBelowOneHundredPercent,80,320);this.clearInputErrorMsgs();if(!this.prelimWorkBasedClaimForm.validate())return!1;a=dojo.formToObject(this.prelimWorkBasedClaimForm.id);d=buildspace.dialog.indeterminateProgressBar({title:b.pleaseWait+"..."});n.mixin(a,{id:c.itemId,bill_id:c.bill_id});d.show();f=function(){return y.post("postContractPreliminaries/updatedWorkBasedInformation",{data:a,handleAs:"json"}).then(function(a){var b,
f,h;d.hide();if(a.success){for(b in a.item)c.item.hasOwnProperty(b)&&b!==e._getIdentifierAttribute()&&e.setValue(c.item,b,a.item[b]);e.save();return c.dialogContainer.hide()}h=[];for(f in a.errorMsgs)b=c["error-"+f],b.innerHTML=a.errorMsgs[f],h.push(g.set(b,"display","block"));return h},function(a){return d.hide()})};return this.item["timeBased-applied"][0]?new buildspace.dialog.confirm(b.deleteTimeBasedClaimTitle,b.deleteTimeBasedClaimMsg,80,320,function(){return f()},function(){return d.hide()}):
f()},calculateTotal:function(a){var b;a=parseFloat(this.buildersWorkDoneInput.value);b=parseFloat(this.totalBuildersWorkInput.value);a/=b;a=isFinite(a)?a:0;a=100*this.RoundNum(a,5);this.total=this.RoundNum(a,2);return this.workBasedClaimCalculatedRates.innerHTML=""+this.total},RoundNum:function(a,b){return Math.round(a*Math.pow(10,b))/Math.pow(10,b)}});return k("buildspace.apps.PostContract.WorkBasedFormDialog",dijit.Dialog,{title:b.workBasedRecurringClaim,style:"padding:0px;margin:0px;width:320px;height:180px;",
itemId:-1,bill_id:-1,formInfo:null,item:null,billGridStore:null,currentClaimRevision:null,gridEditable:!0,buildRendering:function(){var a;this.content=a=this.createContent();a.startup();return this.inherited(arguments)},postCreate:function(){g.set(this.containerNode,{padding:"0px",margin:"0px"});this.closeButtonNode.style.display="none";return this.inherited(arguments)},createContent:function(){var a,d,c,e;c=this;a=new x({style:"width:320px;height:180px;padding:0;margin:0;",gutters:!1});d=new m({itemId:c.itemId,
bill_id:this.bill_id,formInfo:this.formInfo,dialogContainer:c,item:this.item,billGridStore:this.billGridStore,total:this.formInfo.total,currentClaimRevision:this.currentClaimRevision,gridEditable:this.gridEditable});e=new v({region:"top",style:"outline:none!important;padding:2px;overflow:hidden;"});e.addChild(new w({label:b.save,iconClass:"icon-16-container icon-16-save",onClick:function(){return d.save()},disabled:c.gridEditable?!1:!0}));e.addChild(new dijit.ToolbarSeparator);e.addChild(new dijit.form.Button({label:b.close,
iconClass:"icon-16-container icon-16-close",onClick:function(){return c.hide()}}));a.addChild(e);a.addChild(d);return a},_onKey:function(a){if(a.keyCode===p.ESCAPE)return dojo.stopEvent(a)},onHide:function(){return this.destroyRecursive()}})})}).call(this);
