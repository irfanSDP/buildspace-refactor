define("buildspace/apps/PostContract/BillManager/StandardBillGrid","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-attr dijit/Menu dojo/number dijit/CheckedMenuItem dojox/grid/enhanced/plugins/Menu dojox/grid/enhanced/plugins/Selector dojox/grid/enhanced/plugins/Rearrange buildspace/widget/grid/plugins/FormulatedColumn dojo/_base/event dojo/keys dijit/focus dojo/_base/html dojo/request/xhr dijit/PopupMenuItem dijit/MenuSeparator buildspace/widget/grid/cells/Formatter ./ApplyToUnitDialog ./editBillNoteDialog dojo/i18n!buildspace/nls/PostContract dojo/on dojox/grid/_Grid dojox/widget/PlaceholderMenuItem buildspace/widget/grid/cells/TextBox".split(" "),
function(n,q,C,D,E,l,F,G,H,I,J,r,t,K,u,L,M,N,v,w,p,b,O){var B=n("buildspace.apps.PostContract.BillManager.StandardBillGrid",dojox.grid.EnhancedGrid,{type:null,billId:-1,elementId:0,itemId:-1,disableEditing:!1,style:"border-top:none;",selectedItem:null,borderContainerWidget:null,keepSelection:!0,rowSelector:"0px",markupSettings:null,parentGrid:null,elementGridStore:null,selectedClaimRevision:null,claimRevision:null,updateUrl:null,typeItem:null,project:null,constructor:function(a){this.type=a.type;
this.disableEditing=a.disableEditing;this.formatter=new v;this.setColumnStructure();buildspace.grid.headerCtxMenu.createMenu(this);this.inherited(arguments)},dodblclick:function(a){if(a.cellNode)if(a.cell.editable)this.editableCellDblClick(a);else this.onCellDblClick(a);else this.onRowDblClick(a)},editableCellDblClick:function(a){},setColumnStructure:function(){var a=this.formatter;this.structure="tree"==this.type?{noscroll:!1,cells:[[{name:"No.",field:"id",width:"30px",styles:"text-align:center;",
formatter:a.rowCountCellFormatter,rowSpan:2},{name:b.billReference,field:"bill_ref",styles:"text-align:center; color: red;",width:"80px",noresize:!0,showInCtxMenu:!0,formatter:a.billRefCellFormatter,rowSpan:2,hidden:!0},{name:b.description,field:"description",width:"500px",formatter:a.claimTreeCellFormatter,showInCtxMenu:!0,rowSpan:2},{name:b.type,field:"type",width:"70px",rowSpan:2,type:"dojox.grid.cells.Select",formatter:a.typeCellFormatter,styles:"text-align:center;",showInCtxMenu:!0,hidden:!0},
{name:b.voOmittedAt,field:"omitted_at_vo",width:"90px",styles:"text-align: center;",showInCtxMenu:!0,noresize:!0,rowSpan:2,editable:!1,formatter:a.unEditableCellFormatter},{name:b.qty,field:"qty_per_unit",width:"90px",styles:"text-align: right;",formatter:a.claimQtyPerUnitCellFormatter,showInCtxMenu:!0,noresize:!0,rowSpan:2},{name:b.unit,field:"uom_symbol",width:"70px",styles:"text-align: center;",formatter:a.unitIdCellFormatter,showInCtxMenu:!0,rowSpan:2},{name:b.rate,field:"rate",width:"70px",styles:"text-align: right;",
formatter:a.claimRateLSCellFormatter,editable:!this.disableEditing,cellType:"buildspace.widget.grid.cells.TextBox",showInCtxMenu:!0,rowSpan:2},{name:b.total,field:"total_per_unit",width:"90px",styles:"text-align: right;color:blue;",formatter:a.unEditableCurrencyCellFormatter,showInCtxMenu:!0,rowSpan:2},{name:b.percent,field:"prev_percentage",width:"70px",headerClasses:"typeHeader1",formatter:a.unEditablePercentageCellFormatter,styles:"text-align: right;"},{name:b.amount,field:"prev_amount",width:"110px",
headerClasses:"typeHeader1",formatter:a.unEditableCurrencyCellFormatter,styles:"text-align: right;"},{name:b.percent,field:"current_percentage",width:"70px",headerClasses:"typeHeader2",styles:"text-align: right;",formatter:this.disableEditing?a.unEditablePercentageCellFormatter:a.editableClaimPercentageCellFormatter,editable:!this.disableEditing,cellType:"buildspace.widget.grid.cells.TextBox"},{name:b.amount,field:"current_amount",width:"110px",headerClasses:"typeHeader2",styles:"text-align: right;",
formatter:this.disableEditing?a.unEditableCurrencyCellFormatter:a.claimAmountCellFormatter,editable:!this.disableEditing,cellType:"buildspace.widget.grid.cells.TextBox"},{name:b.percent,field:"up_to_date_percentage",width:"70px",headerClasses:"typeHeader1",styles:"text-align: right;",formatter:this.disableEditing?a.unEditablePercentageCellFormatter:a.editableClaimPercentageCellFormatter,editable:!this.disableEditing,cellType:"buildspace.widget.grid.cells.TextBox"},{name:b.qty,field:"up_to_date_qty",
width:"90px",headerClasses:"typeHeader1",styles:"text-align: right;",formatter:this.disableEditing?a.unEditableCurrencyCellFormatter:a.claimAmountCellFormatter,editable:!this.disableEditing,cellType:"buildspace.widget.grid.cells.TextBox"},{name:b.amount,field:"up_to_date_amount",width:"110px",headerClasses:"typeHeader1",styles:"text-align: right;",formatter:this.disableEditing?a.unEditableCurrencyCellFormatter:a.claimAmountCellFormatter,editable:!this.disableEditing,cellType:"buildspace.widget.grid.cells.TextBox"},
{name:b.percent,field:"imported_up_to_date_percentage",width:"70px",styles:"text-align: right;",formatter:a.unEditablePercentageCellFormatter,showInCtxMenu:!0,ctxMenuLabel:b.importedUpToDateClaim,hideColumnGroup:[{field:"imported_up_to_date_amount"},{field:"imported_up_to_date_qty"},{name:b.importedUpToDateClaim}]},{name:b.qty,field:"imported_up_to_date_qty",width:"90px",styles:"text-align: right;",formatter:a.unEditableCurrencyCellFormatter},{name:b.amount,field:"imported_up_to_date_amount",width:"110px",
styles:"text-align: right;",formatter:a.unEditableCurrencyCellFormatter}],[{name:b.previousClaim,styles:"text-align:center;",headerClasses:"staticHeader typeHeader1",colSpan:2},{name:b.currentClaim,styles:"text-align:center;",headerClasses:"staticHeader typeHeader2",colSpan:2},{name:b.upToDateClaim,styles:"text-align:center;",headerClasses:"staticHeader typeHeader1",colSpan:3},{name:b.importedUpToDateClaim,styles:"text-align:center;",headerClasses:"staticHeader",colSpan:3}]]}:{noscroll:!1,cells:[[{name:"No.",
field:"id",width:"30px",styles:"text-align:center;",formatter:a.rowCountCellFormatter,noresize:!0,rowSpan:2},{name:b.description,field:"description",width:"auto",noresize:!0,formatter:a.claimTreeCellFormatter,rowSpan:2},{name:b.omittedItems,field:"vo_omitted_items",width:"45px",styles:"text-align: center;",editable:!1,noresize:!0,showInCtxMenu:!0,rowSpan:2,formatter:a.unEditableCellFormatter},{name:b.total,field:"total_per_unit",width:"90px",styles:"text-align: right;color:blue;",formatter:a.unEditableCurrencyCellFormatter,
noresize:!0,rowSpan:2},{name:b.percent,field:"prev_percentage",width:"70px",headerClasses:"typeHeader1",formatter:a.unEditablePercentageCellFormatter,styles:"text-align: right;",noresize:!0},{name:b.amount,field:"prev_amount",width:"110px",headerClasses:"typeHeader1",formatter:a.unEditableCurrencyCellFormatter,styles:"text-align: right;",noresize:!0},{name:b.percent,field:"current_percentage",width:"70px",headerClasses:"typeHeader2",styles:"text-align: right;",formatter:a.unEditablePercentageCellFormatter,
noresize:!0,cellType:"buildspace.widget.grid.cells.TextBox"},{name:b.amount,field:"current_amount",width:"110px",headerClasses:"typeHeader2",styles:"text-align: right;",formatter:a.unEditableCurrencyCellFormatter,noresize:!0,cellType:"buildspace.widget.grid.cells.TextBox"},{name:b.percent,field:"up_to_date_percentage",width:"70px",headerClasses:"typeHeader1",styles:"text-align: right;",formatter:this.disableEditing?a.unEditablePercentageCellFormatter:a.elementClaimEditablePercentageCellFormatter,
editable:!this.disableEditing,cellType:"buildspace.widget.grid.cells.TextBox"},{name:b.amount,field:"up_to_date_amount",width:"110px",headerClasses:"typeHeader1",styles:"text-align: right;",formatter:this.disableEditing?a.unEditableCurrencyCellFormatter:a.elementClaimAmountCellFormatter,editable:!this.disableEditing,cellType:"buildspace.widget.grid.cells.TextBox"},{name:b.percent,field:"imported_up_to_date_percentage",width:"70px",styles:"text-align: right;",formatter:a.unEditablePercentageCellFormatter,
showInCtxMenu:!0,ctxMenuLabel:b.importedUpToDateClaim,hideColumnGroup:[{field:"imported_up_to_date_amount"},{name:b.importedUpToDateClaim}]},{name:b.amount,field:"imported_up_to_date_amount",width:"110px",styles:"text-align: right;",formatter:a.unEditableCurrencyCellFormatter}],[{name:b.previousClaim,styles:"text-align:center;",headerClasses:"staticHeader typeHeader1",colSpan:2,noresize:!0},{name:b.currentClaim,styles:"text-align:center;",headerClasses:"staticHeader typeHeader2",colSpan:2,noresize:!0},
{name:b.upToDateClaim,styles:"text-align:center;",headerClasses:"staticHeader typeHeader1",colSpan:2},{name:b.importedUpToDateClaim,styles:"text-align:center;",headerClasses:"staticHeader",colSpan:2}]]}},canSort:function(a){return!1},postCreate:function(){this.inherited(arguments);this.on("RowContextMenu",function(a){this.selection.clear();this.selection.setSelected(a.rowIndex,!0);var c=this.getItem(a.rowIndex);c&&!isNaN(parseInt(c.id[0]))&&this.contextMenu(a)},!0)},onStyleRow:function(a){this.inherited(arguments);
if(a.node.children[0]&&2<=a.node.children[0].children[0].rows.length){var c=a.node.children[0].children[0].rows[1],d=a.node.children[0].children[0].rows[0].children;c.parentNode.removeChild(c);dojo.forEach(d,function(e,f){f=dojo.attr(e,"rowSpan");(!f||2>f)&&dojo.attr(e,"rowSpan",2)})}},canEdit:function(a,c){var d=this;if(void 0!=a){var e=this.getItem(c),f=a.field;if(e.id==buildspace.constants.GRID_LAST_ROW||void 0!=e.include&&1!=e.include[0]||"rate"==f&&(e.type!=buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM_EXCLUDE||
l.parse(e.up_to_date_percentage)||l.parse(e.current_percentage)||l.parse(e.prev_percentage)))return window.setTimeout(function(){d.edit.cancel();d.focus.setFocusIndex(c,a.index)},10),!1}return this._canEdit},contextMenu:function(a){var c=this.rowCtxMenu=new dijit.Menu;this.contextMenuItems(a);var d={target:a.target,coords:a.keyCode!==t.F10&&"pageX"in a?{x:a.pageX,y:a.pageY}:null},e=this.getItem(a.rowIndex);c&&e&&(this.selection.isSelected(a.rowIndex)||a.rowNode&&u.hasClass(a.rowNode,"dojoxGridRowbar"))&&
(c._openMyself(d),r.stop(a))},contextMenuItems:function(a){if((a=this.getItem(a.rowIndex))&&!isNaN(parseInt(a.id[0]))){if("tree"==this.type){var c=b.editItemNote;var d="doEditItemNote"}else c=b.editTradeNote,d="doEditTradeNote";this.rowCtxMenu.addChild(new dijit.PopupMenuItem({label:c,iconClass:"icon-16-container icon-16-note",onClick:dojo.hitch(this,d,a)}))}},doEditItemNote:function(a){(new p({item:a,billGrid:this,title:b.editItemNote,updateUrl:"billManager/itemNoteUpdate"})).show()},doEditTradeNote:function(a){(new p({item:a,
billGrid:this,title:b.editTradeNote,updateUrl:"billManager/elementNoteUpdate"})).show()},doApplyCellEdit:function(a,c,d){var e=this,f=this.getItem(c),x=this.store;if(void 0!=f[d][0]||a!==f[d][0]){var m=buildspace.dialog.indeterminateProgressBar({title:b.pleaseWait+"..."}),y={id:f.id,project_id:this.project.id,type_ref_id:this.typeItem.id,attr_name:d,val:a,_csrf_token:f._csrf_token?f._csrf_token:null},z=this.updateUrl,A=function(g,h){for(var k in g)f.hasOwnProperty(k)&&k!=h._getIdentifierAttribute()&&
h.setValue(f,k,g[k]);h.save()};m.show().then(function(){dojo.xhrPost({url:z,content:y,handleAs:"json",load:function(g){if(g.success){0<f.id&&A(g.item,x);var h=e.getCellByField(d);window.setTimeout(function(){e.focus.setFocusIndex(c,h.index)},10);m.hide()}},error:function(g){m.hide();console.log(g)}})})}this.inherited(arguments)}});return n("buildspace.apps.PostContract.BillManager.StandardBillGridBuilder",dijit.layout.BorderContainer,{pageId:"page-00",style:"padding:0px;width:100%;height:100%;",gutters:!1,
stackContainerTitle:"",rootProject:null,billId:-1,elementId:0,disableEditing:!1,itemId:-1,rowSelector:null,typeItem:null,gridOpts:{},type:null,locked:!1,postCreate:function(){this.inherited(arguments);q.mixin(this.gridOpts,{billId:this.billId,typeItem:this.typeItem,project:this.rootProject,elementId:this.elementId,type:this.type,region:"center",disableEditing:this.disableEditing,borderContainerWidget:this});var a=this.grid=new B(this.gridOpts);this.addChild(a);"tree"==this.type||this.disableEditing||
this.locked||(a=new dijit.Toolbar({region:"top",style:"padding:2px;border-bottom:none;width:100%;"}),a.addChild(new dijit.form.Button({id:this.billId+this.billId+"ApplyRow-button",label:b.applyToOtherUnit,iconClass:"icon-16-container icon-16-add",onClick:dojo.hitch(this,"openApplyToUnitDialog")})),this.addChild(a));if(a=dijit.byId("postContractStandardBill"+this.billId+"-stackContainer"))a.addChild(new dojox.layout.ContentPane({title:buildspace.truncateString(this.stackContainerTitle,60),id:this.pageId,
content:this,grid:this.grid})),a.selectChild(this.pageId)},openApplyToUnitDialog:function(){(new w({rootProject:this.rootProject,typeItem:this.typeItem,billId:this.billId,elementId:this.elementId,url:"postContractStandardBillClaim/applyToOtherUnit"})).show()}})});
