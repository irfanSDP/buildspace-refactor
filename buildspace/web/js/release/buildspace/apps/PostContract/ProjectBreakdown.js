define("buildspace/apps/PostContract/ProjectBreakdown","dojo/_base/declare dojo/number dojox/grid/EnhancedGrid buildspace/widget/grid/cells/Formatter dijit/DropDownMenu dijit/form/DropDownButton dijit/MenuItem dojo/i18n!buildspace/nls/PostContract".split(" "),function(m,n,r,t,p,q,l,c){var v=m("buildspace.apps.PostContract.ProjectBreakdownGrid",r,{rootProject:null,style:"border:none;",region:"center",keepSelection:!0,workArea:null,rowSelector:"0px",locked:!1,gridContainer:!1,claimCertificate:null,
constructor:function(a){var b=new t;this.currencySetting=buildspace.billCurrencyAbbreviation?buildspace.billCurrencyAbbreviation:buildspace.currencyAbbreviation;this.structure={noscroll:!1,cells:[[{name:"No.",field:"count",width:"30px",styles:"text-align:center;",formatter:k.rowCountCellFormatter,rowSpan:2},{name:c.description,field:"title",width:"auto",formatter:k.treeCellFormatter,rowSpan:2},{name:c.omittedItems,field:"vo_omitted_items",width:"45px",styles:"text-align: center;",editable:!1,noresize:!0,
showInCtxMenu:!0,rowSpan:2,formatter:b.unEditableCellFormatter},{name:c.overallTotal,field:"overall_total_after_markup",width:"150px",rowSpan:2,styles:"text-align:right;",formatter:b.unEditableCurrencyCellFormatter},{name:c.percent,field:"up_to_date_percentage",width:"80px",formatter:k.unEditablePercentageCellFormatter,styles:"text-align: right;"},{name:c.amount,field:"up_to_date_amount",width:"160px",formatter:b.unEditableCurrencyCellFormatter,styles:"text-align: right;"},{name:c.percent,field:"imported_up_to_date_percentage",
width:"80px",formatter:k.unEditablePercentageCellFormatter,styles:"text-align: right;",showInCtxMenu:!0,ctxMenuLabel:c.importedUpToDateClaim,hideColumnGroup:[{field:"imported_up_to_date_amount"},{name:c.importedUpToDateClaim}]},{name:c.amount,field:"imported_up_to_date_amount",width:"160px",styles:"text-align: right;",formatter:b.unEditableCurrencyCellFormatter}],[{name:c.upToDateClaim,styles:"text-align:center;",headerClasses:"staticHeader",colSpan:2},{name:c.importedUpToDateClaim,styles:"text-align:center;",
headerClasses:"staticHeader",colSpan:2}]]};buildspace.grid.headerCtxMenu.createMenu(this);this.inherited(arguments)},canSort:function(a){return!1},postCreate:function(){this.inherited(arguments);this.on("RowClick",function(a){(a=this.getItem(a.rowIndex))&&!isNaN(parseInt(String(a.id)))&&a.type[0]==buildspace.apps.PostContract.ProjectStructureConstants.TYPE_BILL?this.disableToolbarButtons(!1):this.disableToolbarButtons(!0)},!0)},dodblclick:function(a){var b=this.getItem(a.rowIndex);if(-1!=parseInt(String(b.type))){b=
new dijit.ProgressBar({value:0,title:"Importing Claims",layoutAlign:"center"});var d=new dijit.Dialog({content:b,style:"background:#fff;padding:5px;height:78px;width:280px;",splitter:!1});d.closeButtonNode.style.display="none";d._onKey=function(e){e.keyCode==keys.ESCAPE&&dojo.stopEvent(e)};d.onHide=function(){d.destroyRecursive()};this.importClaimProgress(a,d,b)}},importClaimProgress:function(a,b,d){var e=this;dojo.xhrPost({url:"claimTransfer/getImportClaimProgress",content:{id:parseInt(String(this.rootProject.id))},
handleAs:"json",sync:!1,load:function(f){var g=parseInt(f.total_imported_files),h=parseInt(f.total_files),u=parseInt(f.version);if(f.exists&&0<h&&g!=h)b.open||b.show(),b.set({title:"Importing "+g+"/"+h+" Files for Claim Revision "+u}),d.set({value:g/h*100}),setTimeout(function(){e.importClaimProgress(a,b,d)},5E3);else return b.open&&b.hide(),e.onRowDblClick(a)},error:function(f){b.open&&b.hide()}})},onStyleRow:function(a){this.inherited(arguments);if(a.node.children[0]&&2<=a.node.children[0].children[0].rows.length){var b=
a.node.children[0].children[0].rows[1],d=a.node.children[0].children[0].rows[0].children;b.parentNode.removeChild(b);dojo.forEach(d,function(e,f){f=dojo.attr(e,"rowSpan");(!f||2>f)&&dojo.attr(e,"rowSpan",2)})}},onRowDblClick:function(a){a=this.getItem(a.rowIndex);if(isNaN(String(a.id)))switch(parseInt(String(a.type))){case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_VARIATION_ORDER:case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_REQUEST_FOR_VARIATION_CLAIM:var b=parseInt(a.type)==
buildspace.apps.PostContract.ProjectStructureConstants.TYPE_VARIATION_ORDER?{rootProject:this.rootProject,locked:this.locked,claimCertificate:this.claimCertificate}:{project:this.rootProject,locked:this.locked,claimCertificate:this.claimCertificate};this.workArea.initTab(a,b);break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_MATERIAL_ON_SITE:this.workArea.initTab(a,{rootProject:this.rootProject});break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_ADVANCE_PAYMENT:case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_POST_CONTRACT_CLAIM_MATERIAL_ON_SITE:case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_DEPOSIT:case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_PURCHASE_ON_BEHALF:case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_PERMIT:this.workArea.initTab(a,
{rootProject:this.rootProject,type:a.type,withProgressClaim:!0,locked:this.locked,claimCertificate:this.claimCertificate});break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_KONGSIKONG:case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_WORK_ON_BEHALF:case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_WORK_ON_BEHALF_BACKCHARGE:case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_PENALTY:case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_WATER_DEPOSIT:this.workArea.initTab(a,
{rootProject:this.rootProject,type:a.type,withProgressClaim:!1,locked:this.locked,claimCertificate:this.claimCertificate});break;case buildspace.apps.PostContract.ProjectStructureConstants.TYPE_DEBIT_CREDIT_NOTE:this.workArea.initTab(a,{rootProject:this.rootProject,claimCertificate:this.claimCertificate})}else switch(parseInt(String(a.type))){case buildspace.apps.PostContract.ProjectStructureConstants.BILL_TYPE_PRELIMINARY:this.workArea.initTab(a,{billId:a.id,billLayoutSettingId:a.billLayoutSettingId,
workArea:this.workArea,rootProject:this.rootProject,locked:this.locked})}},disableToolbarButtons:function(a,b){if(a&&b instanceof Array){var d=this;dojo.forEach(b,function(e){(e=dijit.byId(d.rootProject.id+e+"Row-button"))&&e._setDisabledAttr(!1)})}},reload:function(){this.claimCertificate=this.gridContainer.claimCertificate;this.store.url=this.gridContainer.getProjectBreakdownUrl();this.store.close();this._refresh()}}),k={rowCountCellFormatter:function(a,b,d){b=this.grid.getItem(b);void 0!=b.type&&
1>b.type&&d.customClasses.push("invalidTypeItemCell");return 0<a?a:""},unEditablePercentageCellFormatter:function(a,b,d){a=n.parse(a);b=this.grid.getItem(b);void 0!=b.type&&1>b.type?d.customClasses.push("invalidTypeItemCell"):d.customClasses.push("disable-cell");isNaN(a)||0==a||null==a?a="&nbsp;":(d=n.format(a,{places:2})+"%",a=0<=a?'<span style="color:blue;">'+d+"</span>":'<span style="color:#FF0000">'+d+"</span>");return a},treeCellFormatter:function(a,b,d){b=this.grid.getItem(b);var e=16*b.level;
a=null==a?"&nbsp":a;b.type<buildspace.apps.PostContract.ProjectStructureConstants.TYPE_BILL&&!isNaN(b.id)&&(a="<b>"+a+"</b>");void 0!=b.type&&1>b.type?d.customClasses.push("invalidTypeItemCell"):a='<div class="treeNode" style="padding-left:'+e+'px;"><div class="treeContent">'+a+"&nbsp;</div></div>";return a}};return m("buildspace.apps.PostContract.ProjectBreakdown",dijit.layout.BorderContainer,{region:"center",style:"padding:0px;width:100%;height:100%;",gutters:!1,rootProject:null,workArea:null,grid:null,
locked:!1,claimCertificate:null,getProjectBreakdownUrl:function(){var a="postContract/getProjectBreakdown/id/"+this.rootProject.id;this.claimCertificate&&(a+="/claimRevision/"+this.claimCertificate.post_contract_claim_revision_id);return a},postCreate:function(){this.inherited(arguments);var a=this,b=new dojo.data.ItemFileWriteStore({clearOnClose:!0,url:a.getProjectBreakdownUrl()}),d=this.grid=v({rootProject:this.rootProject,store:b,workArea:this.workArea,locked:this.locked,gridContainer:this,claimCertificate:this.claimCertificate});
if(!this.locked){b=new dijit.Toolbar({region:"top",style:"outline:none!important;border-bottom:none;padding:2px;width:100%;"});var e=new p({style:"display: none;"});dojo.forEach(["allItems","provisionalItems"],function(g){var h=new l({id:g+"-"+a.rootProject.id+"-menuItem",label:c[g],onClick:function(){buildspace.app.launch({__children:[],icon:"project_analyzer",id:a.rootProject.id+"-postcontract_remeasurement",is_app:!0,level:0,sysname:"PostContractRemeasurement",title:c.remeasureProvisional},{type:buildspace.constants.STATUS_PRETENDER,
opt:g,project:a.rootProject})}});e.addChild(h)});b.addChild(new q({label:c.remeasureProvisional,id:a.rootProject.id+"RemeasureProvisionalRow-button",iconClass:"icon-16-container icon-16-ruler_square",dropDown:e}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({id:"locationManagement-"+a.rootProject.id+"-mainButton",label:c.locationManagement,iconClass:"icon-16-container icon-16-shopping_basket",onClick:function(g){buildspace.app.launch({__children:[],icon:"project_location_management",
id:a.rootProject.id+"-location_management",is_app:!0,level:0,sysname:"ProjectLocationManagement",title:c.locationManagement},{type:buildspace.constants.STATUS_POSTCONTRACT,project:a.rootProject,canEdit:!0})}}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({id:a.rootProject.id+"LocationCodeContainerRow-button",label:c.defineLocations,iconClass:"icon-16-container icon-16-location",onClick:dojo.hitch(this.workArea,"initLocationCodeContainerTab")}));b.addChild(new dijit.ToolbarSeparator);
b.addChild(new dijit.form.Button({id:a.rootProject.id+"ViewSubPackageRow-button",label:c.subPackages,iconClass:"icon-16-container icon-16-file",onClick:function(){buildspace.app.launch({__children:[],icon:"view_subpackage",id:a.rootProject.id+"-view_subpackage",is_app:!0,level:0,sysname:"PostContractSubPackage",title:c.subPackages},{project:a.rootProject})}}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({id:a.rootProject.id+"-wastageReport-button",label:c.wastageReport,
iconClass:"icon-16-container icon-16-project_analyzer",onClick:function(g){buildspace.app.launch({__children:[],icon:"project_analyzer",id:a.rootProject.id+"-project_analyzer",is_app:!0,level:0,sysname:"ProjectAnalyzer",title:c.projectAnalyzer},{type:buildspace.constants.STATUS_POSTCONTRACT,opt:"resourceAnalysis",project:a.rootProject})}}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({id:a.rootProject.id+"finalAccountExport-button",label:c.finalAccountStatement,iconClass:"icon-16-container icon-16-spreadsheet",
onClick:function(g){window.open("exportExcelReport/exportFinalAccountStatement/pid/"+a.rootProject.id,"_self");return window.focus()}}));b.addChild(new dijit.ToolbarSeparator);var f=new p({style:"display: none;"});f.addChild(l({label:c.budgetReport,onClick:dojo.hitch(a.workArea,"initBudgetReportContainerTab")}));f.addChild(l({label:c.tagSubProjectItems,onClick:dojo.hitch(a.workArea,"initSubProjectItemLinkContainerTab")}));b.addChild(new q({label:c.budgetReport,iconClass:"icon-16-container icon-16-abacus",
dropDown:f}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({label:c.subPackageClaims,iconClass:"icon-16-container icon-16-bill",onClick:dojo.hitch(a.workArea,"initSubPackageClaimsContainerTab")}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({id:a.rootProject.id+"ReloadGridRow-button",label:c.reload,iconClass:"icon-16-container icon-16-reload",onClick:function(g){d.reload()}}));this.addChild(b)}this.addChild(d)}})});
