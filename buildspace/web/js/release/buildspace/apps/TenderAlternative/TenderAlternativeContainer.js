define("buildspace/apps/TenderAlternative/TenderAlternativeContainer","dojo/_base/declare dojo/_base/lang dojo/aspect dojox/grid/EnhancedGrid buildspace/widget/grid/cells/Formatter buildspace/apps/ProjectBuilder/EmptyGrandTotalQtyDialog buildspace/apps/ProjectBuilder/RecalculateDialog ./TenderAlternativeFormDialog ./LinkBillDialog dojo/i18n!buildspace/nls/TenderAlternative".split(" "),function(p,u,v,w,q,x,y,r,z,c){var A=p("buildspace.apps.TenderAlternative.TenderAlternativeListGrid",w,{project:null,
tenderAlternative:null,projectBreakdownGrid:null,workArea:null,editable:!0,type:"tender_alternative",style:"border:none;",region:"center",keepSelection:!0,rowSelector:"0px",currencySetting:buildspace.currencyAbbreviation,canSort:function(){return!1},postCreate:function(){var a=this;this.inherited(arguments);this.projectBreakdownGrid=this.workArea.projectBreakdownTab.grid;this.on("RowClick",function(b){var g=[],h=b.cell?b.cell.field:null;b=this.getItem(b.rowIndex);switch(this.type){case "tender_alternative":this.editable&&
b&&0<parseInt(String(b.id))&&0==String(b.project_revision_deleted_at).length&&(g=["Delete"]);break;case "bills":this.tenderAlternative&&("unlink"==h&&0<parseInt(String(b.id))&&parseInt(String(b.type))>=buildspace.constants.TYPE_BILL&&parseInt(String(b.type))<=buildspace.constants.TYPE_SCHEDULE_OF_RATE_BILL&&a.unlinkBill(b),b&&!isNaN(parseInt(String(b.id)))&&parseInt(String(b.type))==buildspace.constants.TYPE_BILL&&buildspace.isRecalculateBillStatus(parseInt(String(b.bill_status)))&&"recalculate"==
h&&(new y({title:c.recalculate+" "+buildspace.truncateString(String(b.title),65),rootProject:a.project,bill:b,projectBreakDownGrid:a.projectBreakdownGrid,tenderAlternativeBillGrid:a})).show())}this.disableToolbarButtons(!0,g)},!0)},deleteRow:function(a){var b=this,g=this.workArea,h=this.project,f=buildspace.dialog.indeterminateProgressBar({title:c.deleting+". "+c.pleaseWait+"..."});buildspace.dialog.confirm(c.confirmation,"<div>"+c.deleteTenderAlternative+"</div>",80,300,function(){f.show().then(function(){dojo.xhrPost({url:"deleteTenderAlternative",
content:{id:a.id,_csrf_token:a._csrf_token},handleAs:"json",load:function(e){if(e.has_alternative)e.success&&b.reload(),b.selection.clear(),b.disableToolbarButtons(!0);else if(e=dijit.byId(String(h.id)+"-form_1337"))g.removeChild(e),e.destroy(),dojo.xhrGet({url:"getTenderAlternativeProject/"+String(h.id),handleAs:"json"}).then(function(d){d=g.createProjectBreakdownTab(d,!0);d.grid&&(b.projectBreakdownGrid=d.grid,d.grid.reload())});f.hide()},error:function(e){f.hide();b.selection.clear();b.disableToolbarButtons(!0)}})})})},
disableToolbarButtons:function(a,b){var g=dijit.byId(parseInt(String(this.project.id))+"DeleteTenderAlternativeRow-button");g&&g._setDisabledAttr(a);if(a&&b instanceof Array){var h=this;dojo.forEach(b,function(f){(f=dijit.byId(parseInt(String(h.project.id))+f+"TenderAlternativeRow-button"))&&f._setDisabledAttr(!1)})}},unlinkBill:function(a){var b=this,g=this.project,h=this.tenderAlternative,f=buildspace.dialog.indeterminateProgressBar({title:c.deleting+". "+c.pleaseWait+"..."}),e={url:"unlinkTenderAlternativeBill",
content:{id:parseInt(String(h.id)),bid:parseInt(String(a.id)),_csrf_token:String(a._csrf_token)},handleAs:"json",load:function(d){d.success&&(b.reload(),f.hide())},error:function(d){f.hide()}};f.show().then(function(){dojo.xhrGet({url:"getProjectRevisionInfo/"+String(g.id),handleAs:"json",sync:!0,preventCache:!0}).then(function(d){f.hide();!d.locked_status&&d.current_selected_revision&&d.id==parseInt(String(h.project_revision_id))?(f=buildspace.dialog.indeterminateProgressBar({title:c.deleting+". "+
c.pleaseWait+"..."}),buildspace.dialog.confirm(c.untagBill,"<div>"+c.untagBillConfirmation+"</div>",68,280,function(){f.show().then(function(){dojo.xhrPost(e)})})):buildspace.dialog.alert(c.tenderAlternativeAlert,c.projectRevisionAlertDesc,100,300)})})},reload:function(){var a=this;parseInt(String(this.project.status_id))==buildspace.constants.STATUS_PRETENDER&&dojo.xhrGet({url:"projectBuilder/validateEmptyGrandTotalQty/",content:{pid:this.project.id},handleAs:"json"}).then(function(g){g.has_error&&
(new x({id:"EmptyGrandTotalQtyDialog-"+a.project.id,project:a.project,data:g})).show()});var b=dijit.byId("main-project_breakdown");b&&(this.projectBreakdownGrid=b.grid,this.projectBreakdownGrid.reload());this.store.close();this._refresh()}}),t=p("buildspace.apps.TenderAlternative.GridContainer",dijit.layout.BorderContainer,{pageId:"page-00",style:"padding:0px;width:100%;height:100%;border:0px!important;",gutters:!1,stackContainerTitle:"",project:null,workArea:null,projectBreakdownGrid:null,tenderAlternative:null,
editable:!0,rowSelector:null,gridOpts:{},type:null,projectRevision:null,postCreate:function(){var a=this.project,b=this.projectBreakdownGrid=this.workArea.projectBreakdownTab.grid,g=this.projectRevision;this.inherited(arguments);u.mixin(this.gridOpts,{project:a,workArea:this.workArea,editable:this.editable,type:this.type,tenderAlternative:this.tenderAlternative,projectBreakdownGrid:this.projectBreakdownGrid,region:"center",borderContainerWidget:this});var h=this.grid=new A(this.gridOpts),f=new dijit.Toolbar({region:"top",
style:"outline:none!important;border:none;padding:2px;width:100%;"});if(parseInt(String(this.project.tender_type_id))!=buildspace.constants.TENDER_TYPE_PARTICIPATED)switch(this.type){case "tender_alternative":parseInt(String(a.status_id))!=buildspace.constants.STATUS_POSTCONTRACT&&(f.addChild(new dijit.form.Button({id:parseInt(String(a.id))+"AddTenderAlternative-container-button",label:c.addTenderAlternative,iconClass:"icon-16-container icon-16-add",style:"outline:none!important;",disabled:!this.editable,
onClick:function(){var d=buildspace.dialog.indeterminateProgressBar({title:c.pleaseWait+"..."});d.show().then(function(){dojo.xhrGet({url:"getProjectRevisionInfo/"+String(a.id),handleAs:"json",sync:!0,preventCache:!0}).then(function(k){d.hide();!k.locked_status&&k.current_selected_revision?(new r({title:c.createNewTenderAlternative,tenderAlternativeId:-1,project:a,projectBreakdownGrid:b})).show():buildspace.dialog.alert(c.tenderAlternativeAlert,c.projectRevisionAlertDesc,100,300)})})}})),f.addChild(new dijit.ToolbarSeparator),
f.addChild(new dijit.form.Button({id:parseInt(String(a.id))+"DeleteTenderAlternativeRow-button",label:c.delete,iconClass:"icon-16-container icon-16-delete",disabled:!0,style:"outline:none!important;",onClick:function(){var d=buildspace.dialog.indeterminateProgressBar({title:c.pleaseWait+"..."});d.show().then(function(){dojo.xhrGet({url:"getProjectRevisionInfo/"+String(a.id),handleAs:"json",sync:!0,preventCache:!0}).then(function(k){d.hide();!k.locked_status&&k.current_selected_revision?-1<h.selection.selectedIndex&&
(k=h.getItem(h.selection.selectedIndex),0<parseInt(String(k.id))&&h.deleteRow(k)):buildspace.dialog.alert(c.tenderAlternativeAlert,c.projectRevisionAlertDesc,100,300)})})}})),f.addChild(new dijit.ToolbarSeparator));break;case "bills":var e=this.tenderAlternative;parseInt(String(a.status_id))!=buildspace.constants.STATUS_POSTCONTRACT&&0==String(e.project_revision_deleted_at).length&&parseInt(g.id)==parseInt(String(e.project_revision_id))&&(f.addChild(new dijit.form.Button({id:parseInt(String(a.id))+
"-"+parseInt(String(e.id))+"EditTenderAlternative-container-button",label:c.editTenderAlternative,iconClass:"icon-16-container icon-16-edit",style:"outline:none!important;",disabled:!this.editable,onClick:function(){var d=buildspace.dialog.indeterminateProgressBar({title:c.pleaseWait+"..."});d.show().then(function(){dojo.xhrGet({url:"getProjectRevisionInfo/"+String(a.id),handleAs:"json",sync:!0,preventCache:!0}).then(function(k){d.hide();!k.locked_status&&k.current_selected_revision&&k.id==parseInt(String(e.project_revision_id))?
(new r({title:c.editTenderAlternative,tenderAlternativeId:parseInt(String(e.id)),project:a,projectBreakdownGrid:b})).show():buildspace.dialog.alert(c.tenderAlternativeAlert,c.projectRevisionAlertDesc,100,300)})})}})),f.addChild(new dijit.ToolbarSeparator),f.addChild(new dijit.form.Button({id:parseInt(String(a.id))+"-"+parseInt(String(e.id))+"LinkBillTenderAlternative-container-button",label:c.tagBills,iconClass:"icon-16-container icon-16-connect",style:"outline:none!important;",disabled:!this.editable,
onClick:function(){var d=buildspace.dialog.indeterminateProgressBar({title:c.pleaseWait+"..."});d.show().then(function(){dojo.xhrGet({url:"getProjectRevisionInfo/"+String(a.id),handleAs:"json",sync:!0,preventCache:!0}).then(function(k){d.hide();!k.locked_status&&k.current_selected_revision&&k.id==parseInt(String(e.project_revision_id))?(new z({tenderAlternative:e,tenderAlternativeGrid:h})).show():buildspace.dialog.alert(c.tenderAlternativeAlert,c.projectRevisionAlertDesc,100,300)})})}})),f.addChild(new dijit.ToolbarSeparator))}f.addChild(new dijit.form.Button({label:c.reload,
iconClass:"icon-16-container icon-16-reload",onClick:dojo.hitch(h,"reload")}));this.addChild(f);this.addChild(h);if(g=dijit.byId("tenderAlternativeGrid"+String(this.project.id)+"-stackContainer"))g.addChild(new dojox.layout.ContentPane({title:buildspace.truncateString(this.stackContainerTitle,60),content:this,id:this.pageId,grid:h})),g.selectChild(this.pageId)}});return p("buildspace.apps.TenderAlternative.TenderAlternativeContainer",dijit.layout.BorderContainer,{region:"center",style:"padding:0px;width:100%;height:100%;",
gutters:!1,project:null,projectBreakdownGrid:null,workArea:null,grid:null,editable:!0,pane_info:{},postCreate:function(){this.inherited(arguments);var a=this.project;this.projectBreakdownGrid=this.workArea.projectBreakdownTab.grid;this.createTenderAlternativeGrid();dojo.subscribe("tenderAlternativeGrid"+String(a.id)+"-stackContainer-selectChild","",function(b){var g=dijit.byId("tenderAlternativeGrid"+String(a.id)+"-stackContainer");if(g){var h=g.getChildren(),f=dojo.indexOf(h,b);f+=1;if(h.length>
f){for(;h.length>f;)g.removeChild(h[f]),h[f].destroyDescendants(),h[f].destroyRecursive(),f+=1;if(b.grid){var e=b.grid.selection.selectedIndex;b.grid.store.save();b.grid.store.close();var d=v.after(b.grid,"_onFetchComplete",function(){d.remove();-1<e&&(this.scrollToRow(e),this.selection.setSelected(e,!0))});b.grid.sort()}}}});this.pane_info={name:c.tenderAlternative,type:1337,id:a.id+"-form_1337"}},createTenderAlternativeGrid:function(){var a=dijit.byId("tenderAlternativeGrid"+String(this.project.id)+
"-stackContainer");a&&dijit.byId("tenderAlternativeGrid"+String(this.project.id)+"-stackContainer").destroyRecursive();a=this.stackContainer=new dijit.layout.StackContainer({style:"border:0px;width:100%;height:100%;",region:"center",id:"tenderAlternativeGrid"+String(this.project.id)+"-stackContainer"});var b=new q,g=buildspace.billCurrencyAbbreviation?buildspace.billCurrencyAbbreviation:buildspace.currencyAbbreviation,h=this,f=new t({stackContainerTitle:c.tenderAlternatives,project:this.project,workArea:this.workArea,
projectBreakdownGrid:this.projectBreakdownGrid,editable:this.editable,pageId:"tender_alternative-page-"+String(this.project.id),id:"tender_alternative-page-container-"+String(this.project.id),type:"tender_alternative",gridOpts:{id:String(this.project.id)+"-tenderAlternative-tenderAlternativeListGrid",currencySetting:g,structure:[{name:"No.",field:"count",width:"30px",styles:"text-align:center;",formatter:function(e,d){return 0<e?e:""}},{name:c.description,field:"title",width:"auto",formatter:function(e,
d,k){d=this.grid.getItem(d);var n=16*parseInt(String(d.level));e=null==e?"&nbsp":e;-9999==parseInt(String(d.id))&&(e="<b>"+e+"</b>");d&&0<parseInt(String(d.id))&&void 0!=d.project_revision_deleted_at&&0<String(d.project_revision_deleted_at).length&&"false"!=String(d.project_revision_deleted_at).toLowerCase()&&k.customClasses.push("addendumDeletedItemCell");return'<div class="treeNode" style="padding-left:'+n+'px;"><div class="treeContent">'+e+"&nbsp;</div></div>"}},{name:c.selected,field:"is_awarded",
width:"80px",styles:"text-align:center;",formatter:b.awardedCellFormatter},{name:c.originalAmount,field:"original_total",width:"150px",styles:"text-align: right;",formatter:b.unEditableCurrencyCellFormatter},{name:c.total+" "+c.markup+" (%)",field:"original_total",width:"100px",styles:"text-align: right;",formatter:b.elementTotalMarkupPercentageCellFormatter},{name:c.total+" "+c.markup+" ("+g+")",field:"original_total",width:"120px",styles:"text-align: right;",formatter:b.elementTotalMarkupAmountCellFormatter},
{name:c.overallTotal,field:"overall_total_after_markup",width:"150px",styles:"text-align: right;",formatter:b.unEditableCurrencyCellFormatter}],store:new dojo.data.ItemFileWriteStore({clearOnClose:!0,url:"getTenderAlternatives/"+this.project.id+"/0"}),onRowDblClick:function(e){var d=this.getItem(e.rowIndex);if(0<parseInt(String(d.id))&&null!==String(d.title)&&""!==String(d.title)){var k=buildspace.dialog.indeterminateProgressBar({title:c.pleaseWait+"..."});k.show().then(function(){dojo.xhrGet({url:"getProjectRevisionInfo/"+
String(h.project.id),handleAs:"json",sync:!0,preventCache:!0}).then(function(n){k.hide();h.createBillGrid(d,n,f)})})}}}});b=new dijit.layout.StackController({region:"top",containerId:"tenderAlternativeGrid"+String(this.project.id)+"-stackContainer"});this.addChild(a);this.addChild(new dijit.layout.ContentPane({style:"padding:0px;overflow:hidden;",baseClass:"breadCrumbTrail",region:"top",id:"tenderAlternativeGrid"+String(this.project.id)+"-controllerPane",content:b}))},createBillGrid:function(a,b,
g){g=function(l,m){return l=(l=this.grid.getItem(m))&&!isNaN(parseInt(String(l.bill_type)))&&0<parseInt(String(l.id))?'<a href="#"><span class="dijitReset dijitInline dijitIcon icon-16-container icon-16-disconnect"></span></a>':""};var h=this,f=this.project,e=new q,d=buildspace.billCurrencyAbbreviation?buildspace.billCurrencyAbbreviation:buildspace.currencyAbbreviation,k=[{name:"No.",field:"count",width:"30px",styles:"text-align:center;",formatter:function(l,m){return 0<l?l:""}}];parseInt(String(f.tender_type_id))!=
buildspace.constants.TENDER_TYPE_PARTICIPATED&&parseInt(String(f.status_id))!=buildspace.constants.STATUS_POSTCONTRACT&&0==String(a.project_revision_deleted_at).length&&parseInt(b.id)==parseInt(String(a.project_revision_id))&&k.push({name:c.untag,field:"unlink",width:"48px",styles:"text-align:center;",formatter:g});dojo.forEach([{name:c.description,field:"title",width:"auto",formatter:function(l,m){m=this.grid.getItem(m);var B=16*parseInt(String(m.level));l=null==l?"&nbsp":l;m&&0<parseInt(String(m.id))&&
isNaN(parseInt(String(m.bill_type)))&&(l="<b>"+l+"</b>");return'<div class="treeNode" style="padding-left:'+B+'px;"><div class="treeContent">'+l+"&nbsp;</div></div>"}},{name:c.originalAmount,field:"original_total",width:"150px",styles:"text-align: right;",formatter:e.unEditableCurrencyCellFormatter},{name:c.total+" "+c.markup+" (%)",field:"original_total",width:"100px",styles:"text-align: right;",formatter:e.elementTotalMarkupPercentageCellFormatter},{name:c.total+" "+c.markup+" ("+d+")",field:"original_total",
width:"120px",styles:"text-align: right;",formatter:e.elementTotalMarkupAmountCellFormatter},{name:c.overallTotal,field:"overall_total_after_markup",width:"150px",styles:"text-align: right;",formatter:e.unEditableCurrencyCellFormatter},{name:"% "+c.project,field:"overall_total_after_markup",width:"80px",styles:"text-align: center;",formatter:e.projectBreakdownJobPercentageCellFormatter},{name:c.recalculate,field:"recalculate",width:"80px",styles:"text-align: center;",formatter:e.recalculateBillCellFormatter}],
function(l){k.push(l)});var n=new t({stackContainerTitle:String(a.title),project:this.project,workArea:this.workArea,projectBreakdownGrid:this.projectBreakdownGrid,tenderAlternative:a,editable:this.editable,pageId:String(a.id)+"-bill-page-"+String(this.project.id),id:String(a.id)+"-bill-page-container-"+String(this.project.id),projectRevision:b,type:"bills",gridOpts:{id:String(this.project.id)+"-"+String(a.id)+"-tenderAlternative-billListGrid",currencySetting:d,structure:k,store:new dojo.data.ItemFileWriteStore({clearOnClose:!0,
url:"getTenderAlternativeBills/"+parseInt(String(a.id))}),onRowDblClick:function(l){l=this.getItem(l.rowIndex);0<parseInt(String(l.id))&&null!==String(l.description)&&""!==String(l.description)&&h.openBillTab(l,n)}}})},openBillTab:function(a,b){var g=null;switch(parseInt(String(a.type))){case buildspace.constants.TYPE_BILL:switch(parseInt(String(this.project.status_id))){case buildspace.constants.STATUS_PRETENDER:g={billId:parseInt(String(a.id)),billType:parseInt(String(a.bill_type)),billLayoutSettingId:parseInt(String(a.billLayoutSettingId)),
projectBreakdownGrid:this.projectBreakdownGrid,tenderAlternativeBillGridId:String(b.id),rootProject:this.project};break;default:g={bill:a,billLayoutSettingId:a.billLayoutSettingId,projectBreakdownGrid:this.projectBreakdownGrid,tenderAlternativeBillGridId:String(b.id),rootProject:this.project}}break;case buildspace.constants.TYPE_SUPPLY_OF_MATERIAL_BILL:switch(parseInt(String(this.project.status_id))){case buildspace.constants.STATUS_PRETENDER:g={billId:parseInt(String(a.id)),somBillLayoutSettingId:parseInt(String(a.somBillLayoutSettingId)),
projectBreakdownGrid:this.projectBreakdownGrid,tenderAlternativeBillGridId:String(b.id),rootProject:this.project};break;default:g={billId:parseInt(String(a.id)),projectBreakdownGrid:this.projectBreakdownGrid,tenderAlternativeBillGridId:String(b.id),rootProject:this.project}}break;case buildspace.constants.TYPE_SCHEDULE_OF_RATE_BILL:switch(parseInt(String(this.project.status_id))){case buildspace.constants.STATUS_PRETENDER:g={billId:parseInt(String(a.id)),sorBillLayoutSettingId:parseInt(String(a.sorBillLayoutSettingId)),
projectBreakdownGrid:this.projectBreakdownGrid,tenderAlternativeBillGridId:String(b.id),rootProject:this.project};break;default:g={billId:parseInt(String(a.id)),projectBreakdownGrid:this.projectBreakdownGrid,rootProject:this.project}}}a&&parseInt(String(a.id))&&g&&this.workArea.initTab(a,g)}})});
