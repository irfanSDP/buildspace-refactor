define("buildspace/apps/ViewTenderer/HistoricalRateSearchDialog","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/when dojo/html dojo/dom dojo/keys dijit/TooltipDialog dijit/popup dojo/dom-style dijit/Toolbar dijit/ToolbarSeparator dijit/form/TextBox dijit/form/Button dijit/TitlePane dijit/layout/ContentPane dojo/store/Memory dojo/data/ObjectStore dojox/grid/enhanced/plugins/IndirectSelection buildspace/widget/grid/cells/Formatter dojo/i18n!buildspace/nls/Tendering".split(" "),function(g,
C,h,D,E,F,w,x,k,n,p,l,q,m,G,r,t,u,H,v,e){var z=g("buildspace.apps.ViewTenderer.HistoricalRateSearchDialog.TooltipDialog",x,{billItem:null,columnSettings:null,hierarchyInfo:null,buildRendering:function(){this.inherited(arguments);this.startup()},postCreate:function(){this.inherited(arguments);n.set(this.containerNode,{padding:"0",margin:"0"});var c=this.createContent();this.set("content",c)},createContent:function(){var c=new dijit.layout.BorderContainer({design:"headline",style:"padding:0;margin:0;width:580px;height:280px;border:0;",
gutters:!1}),d=new v,b=[],a=[],f={id:1};dojo.forEach(this.columnSettings,function(a){b.push({name:a.name,field:"qty_"+a.id,width:"auto",styles:"text-align:center;"});f["qty_"+a.id]="<b>"+e.totalUnit+":</b>&nbsp;"+a.qty});a.push(f);a=new dojox.layout.ContentPane({region:"center",style:"background-color:green;padding:0;margin:0;height:20%;border:0;",content:new dojox.grid.DataGrid({escapeHTMLInData:!1,canSort:function(a){return!1},store:new u({objectStore:new t({data:a})}),structure:b,rowSelector:"0px",
style:"border:none;width:100%;height:100%;"}),executeScripts:!0});d=new dojox.layout.ContentPane({region:"bottom",style:"background-color:blue;padding:0;height:80%;margin:0;border:0;",content:new dojox.grid.DataGrid({escapeHTMLInData:!1,canSort:function(a){return!1},store:new u({objectStore:new t({data:this.hierarchyInfo})}),structure:[{name:"No",field:"id",styles:"text-align:center;",width:"30px",formatter:d.rowCountCellFormatter},{name:e.description,field:"description",width:"auto",formatter:d.treeCellFormatter},
{name:e.type,field:"type",styles:"text-align:center;",width:"70px",formatter:d.typeCellFormatter}],rowSelector:"0px",style:"border:none;width:100%;height:100%;"}),executeScripts:!0});c.addChild(a);c.addChild(d);return c}}),A=g("buildspace.apps.ViewTenderer.HistoricalRateSearchDialog.ResultGrid",dojox.grid.EnhancedGrid,{type:null,style:"border-top:none;",element:null,region:"center",constructor:function(c){this.connects=[];this.escapeHTMLInData=!1;this.selectionMode="single";this.plugins={indirectSelection:{headerSelector:!1,
width:"20px",styles:"text-align:center;"}};this.inherited(arguments)},postCreate:function(){var c=this;this.inherited(arguments);this.on("CellClick",function(b){var a=c.getItem(b.rowIndex);b=dijit.byId("ViewTendererHistoricalRateSaveBtn");a.id[0]===parseInt(a.id[0],10)&&0<a.id[0]&&-1<c.selection.selectedIndex?a=!1:(a=!0,c.selection.deselectAll());b&&b._setDisabledAttr(a)});var d=null;this._connects.push(h.connect(this,"onCellMouseOver",function(b){var a=c.getItem(b.rowIndex);"description"==b.cell.field&&
a.id[0]===parseInt(a.id[0],10)&&0<a.id[0]&&null==d&&dojo.xhrPost({url:"viewTenderer/getHistoricalItemInfo",content:{id:a.id},handleAs:"json",load:function(c){d=new z({billItem:a,columnSettings:c.columns,hierarchyInfo:c.items,onMouseLeave:function(){k.close(d);d=null}});k.open({popup:d,around:b.cellNode})}})}));this._connects.push(h.connect(this,"onCellMouseOut",function(b){null!==d&&(k.close(d),d=null)}))},canSort:function(c){return!1},destroy:function(){this.inherited(arguments);dojo.forEach(this._connects,
h.disconnect);delete this._connects}}),B=g("buildspace.apps.ViewTenderer.HistoricalRateSearchDialog.FilterToolbar",p,{style:"outline:none!important;padding:2px;overflow:hidden!important;border:none;background-color:#fff!important;",gutters:!1,targetBillItem:null,resultGrid:null,tendererGrid:null,searchDialog:null,postCreate:function(){var c=this.projectTitleTextBox=new q({style:"width:250px;padding:3px;"}),d=this.itemDescTextBox=new q({style:"width:250px;padding:3px;",value:this.targetBillItem.description[0]}),
b=new r({style:"padding:3px;margin:0;",baseClass:"dijitInline",content:e.projectTitle}),a=new r({style:"padding:3px;margin:0;",baseClass:"dijitInline",content:e.billItemDesc}),f=this.nextButton=new m({onClick:dojo.hitch(this,"searchHistoricalRates"),label:e.search,iconClass:"icon-16-container icon-16-zoom"}),y=this.nextButton=new m({onClick:dojo.hitch(this,"saveHistoricalRate"),id:"ViewTendererHistoricalRateSaveBtn",label:e.save,disabled:!0,iconClass:"icon-16-container icon-16-save"});this.addChild(b);
this.addChild(c);this.addChild(new l);this.addChild(a);this.addChild(d);this.addChild(new l);this.addChild(f);this.addChild(new l);this.addChild(y);this.searchHistoricalRates();this.inherited(arguments)},searchHistoricalRates:function(){if(this.resultGrid){var c=this.resultGrid,d=this.projectTitleTextBox,b=this.itemDescTextBox,a=dijit.byId("ViewTendererHistoricalRateSaveBtn");c.selection.deselectAll();a&&a._setDisabledAttr(!0);var f=buildspace.dialog.indeterminateProgressBar({title:e.pleaseWait+"..."});
f.show().then(function(){dojo.xhrPost({url:"viewTenderer/historicalRateList",content:{pt:d.get("value"),bid:b.get("value")},handleAs:"json",load:function(a){f.hide();a=new dojo.data.ItemFileReadStore({data:a,clearOnClose:!0});c.setStore(a)}})})}},saveHistoricalRate:function(){if(this.targetBillItem.id[0]===parseInt(this.targetBillItem.id[0],10)&&0<this.targetBillItem.id[0]&&-1<this.resultGrid.selection.selectedIndex){var c=this.resultGrid.selection.getFirstSelected(),d=this.searchDialog,b=this.targetBillItem,
a=this.tendererGrid,f=buildspace.dialog.indeterminateProgressBar({title:e.pleaseWait+"..."});f.show().then(function(){dojo.xhrPost({url:"viewTenderer/historicalRateUpdate",content:{tid:b.id,rid:c.rate_id,_csrf_token:b._csrf_token},handleAs:"json",load:function(c){c.success&&(a.store.setValue(b,"historical_rate",c.rate),a.store.save());f.hide();d.hide()}})})}}});return g("buildspace.apps.ViewTenderer.HistoricalRateSearchDialog",dijit.Dialog,{style:"padding:0px;margin:0px;",title:e.searchHistoricalRate,
targetBillItem:null,tendererGrid:null,buildRendering:function(){var c=this.createForm();c.startup();this.content=c;this.inherited(arguments)},postCreate:function(){n.set(this.containerNode,{padding:"0px",margin:"0px"});this.closeButtonNode.style.display="none";this.inherited(arguments)},_onKey:function(c){c.keyCode==w.ESCAPE&&dojo.stopEvent(c)},onHide:function(){this.destroyRecursive()},createForm:function(){var c=new dijit.layout.BorderContainer({style:"padding:0;margin:0;width:900px;height:650px;",
gutters:!1}),d=new p({region:"top",style:"outline:none!important;padding:2px;overflow:hidden;"});d.addChild(new m({label:e.close,iconClass:"icon-16-container icon-16-close",style:"outline:none!important;",onClick:dojo.hitch(this,"hide")}));var b=this.createResultGrid(),a=new B({targetBillItem:this.targetBillItem,resultGrid:b,tendererGrid:this.tendererGrid,searchDialog:this,region:"top"}),f=new dijit.layout.BorderContainer({style:"padding:0;margin:0;",gutters:!1,region:"center"});f.addChild(a);f.addChild(b);
c.addChild(d);c.addChild(f);return c},createResultGrid:function(){var c=new dojo.data.ItemFileReadStore({data:{identifier:"id",items:[{id:buildspace.constants.GRID_LAST_ROW,description:"",type:"2",uom_id:"-1",uom_symbol:"",rate:0}]},clearOnClose:!0}),d=v();return new A({id:"grid",store:c,structure:[[{name:e.description,field:"description",noresize:!0,width:"auto",formatter:function(b,a,c){a=this.grid.getItem(a);var d=16*a.level;b=null==b?"&nbsp":b;if(a.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER||
a.type==buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_N)b="<b>"+b+"</b>";1>a.type&&c.customClasses.push("invalidTypeItemCell");return'<div style="padding-left:'+d+'px;">'+b+"&nbsp;</div>"}},{name:e.type,field:"type",noresize:!0,width:"70px",styles:"text-align:center;",formatter:function(b,a,c){a=this.grid.getItem(a);switch(b){case buildspace.widget.grid.constants.HIERARCHY_TYPE_WORK_ITEM:b=buildspace.widget.grid.constants.HIERARCHY_TYPE_WORK_ITEM_TEXT;break;case buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_HTML_EDITOR:b=
buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_HTML_EDITOR_TEXT;break;case buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_PROVISIONAL:b=buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_PROVISIONAL_TEXT;break;case buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_RATE_ONLY:b=buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_RATE_ONLY_TEXT;break;case buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_NOT_LISTED:b=buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_NOT_LISTED_TEXT;
break;case buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_PC_RATE:b=buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_PC_RATE_TEXT;break;case buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM:b=buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM_TEXT;break;case buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM_EXCLUDE:b=buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM_EXCLUDE_TEXT;break;case buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM_PERCENT:b=
buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM_PERCENT_TEXT;break;default:b="&nbsp;"}0>a.type&&c.customClasses.push("invalidTypeItemCell");return 0<a.id[0]?b:"&nbsp;"}},{name:e.unit,field:"uom_id",noresize:!0,width:"50px",styles:"text-align:center;",formatter:d.unitIdCellFormatter},{name:e.rate,field:"rate",noresize:!0,width:"100px",styles:"text-align:right;",formatter:d.currencyCellFormatter},{name:e.publishedDate,field:"published_at",width:"100px",styles:"text-align: center;",formatter:function(b,
a,c){a=this.grid.getItem(a);0>a.type&&c.customClasses.push("invalidTypeItemCell");return 0<a.id[0]?b:"&nbsp;"}}]],region:"center"})}})});
