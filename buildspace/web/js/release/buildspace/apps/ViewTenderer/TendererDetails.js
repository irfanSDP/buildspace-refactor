define("buildspace/apps/ViewTenderer/TendererDetails","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-attr dijit/Menu dojo/number dijit/CheckedMenuItem dojox/grid/enhanced/plugins/Menu dojox/grid/enhanced/plugins/Selector dojox/grid/enhanced/plugins/Rearrange buildspace/widget/grid/plugins/FormulatedColumn dojo/_base/event dojo/keys dijit/focus dojo/html dojo/dom dojo/request/xhr dijit/PopupMenuItem dijit/MenuSeparator dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin ./HistoricalRateSearchDialog buildspace/widget/grid/cells/Textarea buildspace/widget/grid/cells/FormulaTextBox buildspace/widget/grid/cells/Formatter dojo/i18n!buildspace/nls/ViewTenderer dojo/on dojo/text!./templates/attachmentsForm.html dojo/text!./templates/tendererRemarksForm.html".split(" "),
function(e,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,f,g,k,l,O,P,Q,q,d,m,r,t){var u=e("buildspace.apps.ViewTenderer.AttachmentsForm",[f,g,k,l],{baseClass:"buildspace-form",templateString:r,region:"center",style:"overflow: auto;",nls:d,project:null,company_id:-1,startup:function(){this.inherited(arguments);return this.createUploader()},createUploader:function(){var a;a=this;this.uploader=new dojox.form.Uploader({label:d.upload,uploadOnSelect:!0,style:"height:24px;",url:"viewTenderer/uploadTendererAttachment/project/"+
a.project.id+"/company/"+a.company_id,name:"attachment"});m(this.uploader,"Begin",function(b){a.pb=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});return a.pb.show()});m(this.uploader,"Complete",function(b){a.attachmentList.refreshGrid();return a.pb.hide()});this.buildspaceFormUploader.appendChild(this.uploader.domNode);return this.uploader.startup()}}),n=e("buildspace.apps.ViewTenderer.AttachmentList",dijit.layout.BorderContainer,{project:null,disableEditing:!1,company_id:-1,
postCreate:function(){var a=this,b=new q,b=a.attachmentList=new dojox.grid.EnhancedGrid({style:a.disableEditing?"width: 100%":"width:75%",region:"center",startup:function(){var b=this;this.on("RowClick",function(c){(c=b.getItem(c.rowIndex))&&!isNaN(parseInt(c.id[0]))?a.disableToolbarButtons(!1):a.disableToolbarButtons(!0)})},structure:[{name:"No.",field:"count",width:"30px",styles:"text-align:center;",formatter:b.rowCountCellFormatter},{name:d.name,field:"name",width:"180px",formatter:b.downloadCellFormatter},
{name:d.uploadedBy,field:"updated_by",width:"120px",styles:"text-align:center;"},{name:d.uploadedAt,field:"updated_at",width:"120px",styles:"text-align:center;"}],store:new dojo.data.ItemFileWriteStore({url:"viewTenderer/getTendererAttachments/project_id/"+a.project.id+"/company_id/"+a.company_id,clearOnClose:!0}),refreshGrid:function(){this.store.close();this._refresh()}});a.addChild(b);if(!a.disableEditing){b=new dijit.Toolbar({region:"bottom",style:"padding:2px;width:100%;"});b.addChild(a.deleteButton=
new dijit.form.Button({label:d["delete"],iconClass:"icon-16-container icon-16-container icon-16-delete",disabled:!0,onClick:dojo.hitch(a,"deleteAttachment")}));var c=new u({region:"right",project:a.project,company_id:a.company_id,attachmentList:a.attachmentList,style:"width:25%"});a.addChild(c);a.addChild(b)}},deleteAttachment:function(){var a=this;if(-1<this.attachmentList.selection.selectedIndex){var b=this,c=b.attachmentList.getItem(this.attachmentList.selection.selectedIndex),h=buildspace.dialog.indeterminateProgressBar({title:d.deleting+
". "+d.pleaseWait+"..."});c&&!isNaN(parseInt(c.id))&&buildspace.dialog.confirm(d.deleteConfirmation,"<div>"+d.firstLevelCategoryDialogMsg+"</div>",75,320,function(){h.show().then(function(){dojo.xhrPost({url:"viewTenderer/deleteTendererAttachment",content:{id:c.id,"form[_csrf_token]":c._csrf_token},handleAs:"json",load:function(c){c.success&&b.attachmentList.refreshGrid();a.disableToolbarButtons(!0);h.hide()},error:function(a){h.hide()}})})})}},disableToolbarButtons:function(a){this.deleteButton._setDisabledAttr(a)},
close:function(){return this.destroyRecursive()}}),v=e("buildspace.apps.ViewTenderer.RemarksForm",[f,g,k,l],{baseClass:"buildspace-form",templateString:t,region:"center",nls:d,project:null,company_id:-1,tendererRemarksInputId:null,readonly:"",formid:null,startup:function(){this.inherited(arguments);this.refreshRemarks()},refreshRemarks:function(){var a=this;dojo.xhrGet({url:"viewTenderer/getTendererRemarks",content:{project_id:a.project.id,company_id:a.company_id},handleAs:"json",load:function(b){dijit.byId(a.tendererRemarksInputId).set("value",
b.data.remarks)},error:function(a){}})}}),p=e("buildspace.apps.ViewTenderer.AttachmentList",dijit.layout.BorderContainer,{project:null,company_id:-1,disableEditing:!1,postCreate:function(){var a=this,b=a.remarksForm=new v({region:"center",project:a.project,company_id:a.company_id,readonly:a.disableEditing?"readonly":"",tendererRemarksInputId:"tendererRemarksInput-p"+a.project.id+"-c"+a.company_id,formid:"tenderer-details-p"+a.project.id+"-c"+a.company_id});dojo.xhrPost({url:"default/getCsrfToken",
handleAs:"json",load:function(b){a.remarksForm._csrf_token=b._csrf_token}}).then(function(){a.addChild(b);if(!a.disableEditing){var c=new dijit.Toolbar({region:"bottom",style:"padding:2px;width:100%;"});c.addChild(new dijit.form.Button({label:d.save,iconClass:"icon-16-container icon-16-container icon-16-save",onClick:dojo.hitch(a,"save")}));a.addChild(c)}})},save:function(){var a=this,b=dojo.formToObject(a.remarksForm.formid),c=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});
c.show().then(function(){dojo.xhrPost({url:"viewTenderer/updateTendererRemarks",content:{project_id:a.project.id,company_id:a.company_id,remarks:b.remarks,"form[_csrf_token]":a.remarksForm._csrf_token},handleAs:"json",load:function(b){a.remarksForm.refreshRemarks();c.hide()},error:function(a){c.hide()}})})},close:function(){return this.destroyRecursive()}});return e("buildspace.apps.ViewTenderer.TendererDetails",dijit.layout.BorderContainer,{style:"padding:0px;border:none;width:100%;height:100%;",
gutters:!1,project:null,company_id:-1,tender_companies:[],disableEditing:!1,postCreate:function(){var a=this;this.inherited(arguments);var b=new dijit.Toolbar({region:"top",style:"padding:2px;width:100%;"});b.addChild(new dijit.form.Button({label:d.close,iconClass:"icon-16-container icon-16-container icon-16-close",style:"float:right;",onClick:dojo.hitch(a,"close")}));b.addChild(new dijit.form.Button({label:d.compareRemarks,iconClass:"icon-16-container icon-16-container icon-16-clipboard",onClick:dojo.hitch(a,
"openRemarksComparison")}));b.addChild(new dijit.ToolbarSeparator);b.addChild(new dijit.form.Button({label:d.compareAttachments,iconClass:"icon-16-container icon-16-container icon-16-clip",onClick:dojo.hitch(a,"openAttachmentsComparison")}));var c=a.remarksContainer=new p({region:"left",project:a.project,company_id:a.company_id,disableEditing:a.project.tendering_module_locked[0],style:"width:50%;"}),e=a.attachmentContainer=new n({region:"right",project:a.project,company_id:a.company_id,disableEditing:a.project.tendering_module_locked[0],
style:"width:50%;"}),f,g=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});g.show().then(function(){dojo.xhrGet({url:"viewTenderer/getCompanyDetails",content:{company_id:a.company_id},handleAs:"json",load:function(b){f=a.titlePane=a.createTitlePane(b.data.name)},error:function(a){}}).then(function(){a.addChild(b);a.addChild(f);a.addChild(c);a.addChild(e);g.hide()})})},createTitlePane:function(a){return new dijit.layout.ContentPane({style:"background-color: #dddddd; border:none;",
content:"<strong>"+a+"</strong>",region:"top",close:function(){return this.destroyRecursive()}})},openRemarksComparison:function(){this.remarksContainer.close();this.attachmentContainer.close();this.titlePane.close();this.pb=buildspace.dialog.indeterminateProgressBar({title:d.pleaseWait+"..."});this.remarksComparisonContainer&&this.remarksComparisonContainer.close();var a=this.remarksComparisonContainer=new dijit.layout.BorderContainer({region:"center",gutters:!1,style:"overflow: auto",close:function(){return this.destroyRecursive()}}),
b,c;for(c in this.tender_companies)b=new dijit.layout.BorderContainer({region:"left",style:"width: "+100/this.tender_companies.length+"%; min-width:350px;"}),b.addChild(this.createTitlePane(buildspace.truncateString(this.tender_companies[c].name,28))),b.addChild(new p({region:"center",project:this.project,company_id:this.tender_companies[c].id,disableEditing:this.project.tendering_module_locked[0],style:"width:100%;"})),a.addChild(b);this.addChild(a)},openAttachmentsComparison:function(){this.remarksContainer.close();
this.attachmentContainer.close();this.titlePane.close();this.attachmentsComparisonContainer&&this.attachmentsComparisonContainer.close();var a=this.attachmentsComparisonContainer=new dijit.layout.BorderContainer({region:"center",gutters:!1,style:"overflow: auto",close:function(){return this.destroyRecursive()}}),b,c;for(c in this.tender_companies)b=new dijit.layout.BorderContainer({region:"left",style:"width: "+100/this.tender_companies.length+"%; min-width:350px;"}),b.addChild(this.createTitlePane(buildspace.truncateString(this.tender_companies[c].name,
28))),b.addChild(new n({region:"center",project:this.project,company_id:this.tender_companies[c].id,disableEditing:this.project.tendering_module_locked[0],style:"width:100%;"})),a.addChild(b);this.addChild(a)},close:function(){return this.destroyRecursive()},onHide:function(){return this.destroyRecursive()}})});
