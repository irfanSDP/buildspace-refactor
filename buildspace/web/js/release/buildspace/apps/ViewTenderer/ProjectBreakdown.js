var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(c,e,d){if(null==c)throw new TypeError("The 'this' value for String.prototype."+d+" must not be null or undefined");if(e instanceof RegExp)throw new TypeError("First argument to String.prototype."+d+" must not be a regular expression");return c+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,e,d){if(c==Array.prototype||c==Object.prototype)return c;c[e]=d.value;return c};
$jscomp.getGlobal=function(c){c=["object"==typeof globalThis&&globalThis,c,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var e=0;e<c.length;++e){var d=c[e];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(c,e){var d=$jscomp.propertyToPolyfillSymbol[e];if(null==d)return c[e];d=c[d];return void 0!==d?d:c[e]};$jscomp.polyfill=function(c,e,d,l){e&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(c,e,d,l):$jscomp.polyfillUnisolated(c,e,d,l))};
$jscomp.polyfillUnisolated=function(c,e,d,l){d=$jscomp.global;c=c.split(".");for(l=0;l<c.length-1;l++){var m=c[l];if(!(m in d))return;d=d[m]}c=c[c.length-1];l=d[c];e=e(l);e!=l&&null!=e&&$jscomp.defineProperty(d,c,{configurable:!0,writable:!0,value:e})};
$jscomp.polyfillIsolated=function(c,e,d,l){var m=c.split(".");c=1===m.length;l=m[0];l=!c&&l in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var y=0;y<m.length-1;y++){var z=m[y];if(!(z in l))return;l=l[z]}m=m[m.length-1];d=$jscomp.IS_SYMBOL_NATIVE&&"es6"===d?l[m]:null;e=e(d);null!=e&&(c?$jscomp.defineProperty($jscomp.polyfills,m,{configurable:!0,writable:!0,value:e}):e!==d&&($jscomp.propertyToPolyfillSymbol[m]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(m):$jscomp.POLYFILL_PREFIX+m,m=
$jscomp.propertyToPolyfillSymbol[m],$jscomp.defineProperty(l,m,{configurable:!0,writable:!0,value:e})))};$jscomp.polyfill("String.prototype.endsWith",function(c){return c?c:function(e,d){var l=$jscomp.checkStringArgs(this,e,"endsWith");e+="";void 0===d&&(d=l.length);d=Math.max(0,Math.min(d|0,l.length));for(var m=e.length;0<m&&0<d;)if(l[--d]!=e[--m])return!1;return 0>=m}},"es6","es3");
define("buildspace/apps/ViewTenderer/ProjectBreakdown","dojo/_base/declare dojox/grid/EnhancedGrid buildspace/widget/grid/cells/Formatter dijit/form/DropDownButton dijit/DropDownMenu ./AssignContractorDialog dijit/MenuItem dojo/when ./BillGrid ./SupplyOfMaterialBillGrid ./ScheduleOfRateBillGrid ./lumpSumPercentDialog ./primeCostRateDialog ./HistoricalRateSearchDialog ./TendererDetails dojo/aspect dojo/i18n!buildspace/nls/ViewTenderer".split(" "),function(c,e,d,l,m,y,z,G,B,C,D,H,I,J,K,L,w){var M=c("buildspace.apps.ViewTenderer.ProjectBreakdownGrid",
e,{rootProject:null,style:"border:none;",region:"center",keepSelection:!0,tender_setting:null,tender_companies:null,rowSelector:"0px",escapeHTMLInData:!1,borderContainerWidget:null,constructor:function(a){this.formatter=new d;this.tender_setting=a.tender_setting;this.tender_companies=a.tender_companies;this.currencySetting=buildspace.billCurrencyAbbreviation?buildspace.billCurrencyAbbreviation:buildspace.currencyAbbreviation;this.generateColumnStructure();this.inherited(arguments)},canSort:function(a){return!1},
postCreate:function(){this.inherited(arguments);this.on("RowClick",function(a){(a=this.getItem(a.rowIndex))&&0<parseInt(String(a.id))&&parseInt(String(a.type))==buildspace.apps.ViewTenderer.ProjectStructureConstants.TYPE_BILL?this.disableToolbarButtons(!1,["ExportItemFromBill"],["ImportDropDown"]):this.disableToolbarButtons(!0)},!0)},generateColumnStructure:function(){this.fixedColumns={noscroll:!1,width:"50",cells:[[{name:"No.",field:"count",width:"30px",styles:"text-align:center;",formatter:E.rowCountCellFormatter},
{name:w.description,field:"title",width:"auto",formatter:E.treeCellFormatter},{name:w.amount,field:"overall_total_after_markup",width:"150px",styles:"color:blue;text-align: right;",formatter:this.formatter.unEditableCurrencyCellFormatter}]]};var a=this.generateContractorGrandTotalColumn(),b=this.fixedColumns;dojo.forEach(a,function(h){b.cells[0].push(h)});this.structure=b},generateContractorGrandTotalColumn:function(){var a=[],b=this.formatter,h=0;dojo.forEach(this.tender_companies,function(f){h++;
var k=f.awarded?'<span style="color:blue;">'+buildspace.truncateString(f.name,28)+"</span>":buildspace.truncateString(f.name,28);a.push({name:k,field:f.id+"-overall_total_after_markup",styles:"text-align:right;",width:"120px",formatter:b.unEditableCurrencyCellFormatter,headerClasses:"typeHeader"+h,noresize:!0})});return a},dodblclick:function(a){this.onRowDblClick(a)},disableToolbarButtons:function(a,b){if(a&&b instanceof Array){var h=this;dojo.forEach(b,function(f){(f=dijit.byId(h.rootProject.id+
f+"Row-button"))&&f._setDisabledAttr(!1)})}},addTendererDetailsContainer:function(a){var b="project-"+this.rootProject.id+"-viewTendererDetails",h=dijit.byId(b);h&&(this.borderContainerWidget.removeChild(h),h.destroy());h=new K({id:b,region:"bottom",project:this.rootProject,company_id:a,tender_companies:this.tender_companies,style:"padding:0px;margin:0px;width:100%;height:40%;",gutters:!0});this.borderContainerWidget.addChild(h);return h},onHeaderCellDblClick:function(a){a.cell.field.endsWith("-overall_total_after_markup")&&
(a=a.cell.field.replace("-overall_total_after_markup",""),this.addTendererDetailsContainer(a))},reload:function(){this.store.close();this._refresh()}}),E={rowCountCellFormatter:function(a,b){return 0<a?a:""},treeCellFormatter:function(a,b){b=this.grid.getItem(b);var h=16*parseInt(String(b.level));a=null==a?"&nbsp":a;b&&parseInt(String(b.type))<buildspace.apps.ViewTenderer.ProjectStructureConstants.TYPE_BILL&&(a="<b>"+a+"</b>");return'<div class="treeNode" style="padding-left:'+h+'px;"><div class="treeContent">'+
a+"&nbsp;</div></div>"}};return c("buildspace.apps.ViewTenderer.ProjectBreakdown",dijit.layout.BorderContainer,{region:"center",style:"padding:0px;border:none;width:100%;height:100%;",gutters:!1,rootProject:null,tenderAlternative:null,type:null,grid:null,postCreate:function(){this.inherited(arguments);this.createBreakdownGrid()},reconstructBillContainer:function(){var a=dijit.byId("viewTenderBreakdown"+this.rootProject.id+"-controllerPane"),b=dijit.byId("viewTenderBreakdown"+this.rootProject.id+"-stackContainer");
a&&a.destroyRecursive();b&&b.destroyRecursive();this.createBreakdownGrid()},createBreakdownGrid:function(){var a=this,b=this.rootProject,h=this.tenderAlternative;dojo.xhrGet({url:"viewTenderer/getTenderInfo",handleAs:"json",content:{id:parseInt(String(b.id))}}).then(function(f){var k="viewTendererProjectBreakdown/"+parseInt(String(b.id));k=h?k+("/"+parseInt(String(h.id))):k+"/-1";k=new dojo.data.ItemFileWriteStore({clearOnClose:!0,url:k});var g=a.grid=M({rootProject:a.rootProject,tender_companies:f.tender_companies,
tender_setting:f.tender_setting,borderContainerWidget:a,onRowDblClick:function(p){p=this.getItem(p.rowIndex);var q=dijit.byId("project-"+a.rootProject.id+"-viewTendererDetails");q&&(this.borderContainerWidget.removeChild(q),q.destroy());switch(parseInt(String(p.type))){case buildspace.constants.TYPE_BILL:a.createElementGrid(p,f,g);break;case buildspace.constants.TYPE_SUPPLY_OF_MATERIAL_BILL:a.createSupplyOfMaterialElementGrid(p,f);break;case buildspace.constants.TYPE_SCHEDULE_OF_RATE_BILL:a.createScheduleOfRateBillElementGrid(p,
f)}},store:k});(k=dijit.byId("viewTenderBreakdown"+a.rootProject.id+"-stackContainer"))&&dijit.byId("viewTenderBreakdown"+a.rootProject.id+"-stackContainer").destroyRecursive();k=a.stackContainer=new dijit.layout.StackContainer({style:"border:0px;width:100%;height:100%;",region:"center",id:"viewTenderBreakdown"+a.rootProject.id+"-stackContainer"});var r=new dijit.layout.StackController({region:"top",containerId:"viewTenderBreakdown"+a.rootProject.id+"-stackContainer"});r=new dijit.layout.ContentPane({style:"padding:0px;overflow:hidden;",
baseClass:"breadCrumbTrail",region:"top",id:"viewTenderBreakdown"+a.rootProject.id+"-controllerPane",content:r});a.addChild(k);a.addChild(r);r=new dojox.layout.ContentPane({title:buildspace.truncateString(w.bills,60),content:g,grid:g});k.addChild(r);dojo.subscribe("viewTenderBreakdown"+a.rootProject.id+"-stackContainer-selectChild","",function(p){var q=dijit.byId("viewTenderBreakdown"+a.rootProject.id+"-stackContainer");if(q){var u=q.getChildren(),t=dojo.indexOf(u,p);t+=1;if(u.length>t){for(;u.length>
t;)q.removeChild(u[t]),u[t].destroyDescendants(),u[t].destroyRecursive(),t+=1;if(p.grid){var v=p.grid.selection.selectedIndex;p.grid.store.save();p.grid.store.close();var n=L.after(p.grid,"_onFetchComplete",function(){n.remove();-1<v&&(this.scrollToRow(v),this.selection.setSelected(v,!0))});p.grid.sort()}}}})})},createElementGrid:function(a,b,h){this.billId=a.id;var f=dojo.data.ItemFileWriteStore({url:"viewTenderer/getElementList/id/"+a.id,clearOnClose:!0,urlPreventCache:!0});h=dojo.xhrGet({url:"billManager/getBillInfo",
handleAs:"json",content:{id:a.id}});var k=this,g=buildspace.dialog.indeterminateProgressBar({title:w.pleaseWait+"..."});g.show();h.then(function(r){g.hide();try{var p=new B({stackContainerTitle:a.title,billId:a.id,rootProject:k.rootProject,pageId:"element-page-"+a.id,id:"element-page-container-"+a.id,gridOpts:{store:f,tender_setting:b.tender_setting,tender_companies:b.tender_companies,typeColumns:r.column_settings,currentGridType:"element",onRowDblClick:function(q){(q=this.getItem(q.rowIndex))&&0<
parseInt(String(q.id))&&null!==String(q.description)&&""!==String(q.description)&&k.createItemGrid(q,r,b,p,a)}}})}catch(q){console.debug(q)}})},createItemGrid:function(a,b,h,f,k){this.billId=k.id;var g=this,r={options:[buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_N_TEXT,buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_TEXT,buildspace.widget.grid.constants.HIERARCHY_TYPE_WORK_ITEM_TEXT,buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_HTML_EDITOR_TEXT,buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_PROVISIONAL_TEXT,
buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_PC_RATE_TEXT,buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_RATE_ONLY_TEXT,buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_NOT_LISTED_TEXT,buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM_TEXT,buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM_PERCENT_TEXT,buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM_EXCLUDE_TEXT,buildspace.widget.grid.constants.HIERARCHY_TYPE_NOID_TEXT],values:[buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_N,
buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER,buildspace.widget.grid.constants.HIERARCHY_TYPE_WORK_ITEM,buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_HTML_EDITOR,buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_PROVISIONAL,buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_PC_RATE,buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_RATE_ONLY,buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_NOT_LISTED,buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM,buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM_PERCENT,
buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM_EXCLUDE,buildspace.widget.grid.constants.HIERARCHY_TYPE_NOID]},p={options:[buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_N_TEXT,buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_TEXT],values:[buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_N,buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER]},q=new dojo.data.ItemFileWriteStore({url:"viewTenderer/getItemList/id/"+a.id+"/bill_id/"+k.id,clearOnClose:!0}),u=dojo.xhrGet({url:"billManager/getUnits/billId/"+
k.id,handleAs:"json"}),t=buildspace.dialog.indeterminateProgressBar({title:w.pleaseWait+"..."});t.show();u.then(function(v){return v});return G(u,function(v){t.hide();try{new B({stackContainerTitle:a.description,billId:k.id,disableEditing:g.rootProject.tendering_module_locked[0],rootProject:g.rootProject,id:"item-page-container-"+k.id,elementId:a.id,pageId:"item-page-"+k.id,type:"tree",gridOpts:{store:q,escapeHTMLInData:!1,typeColumns:b.column_settings,markupSettings:b.markup_settings,elementGridStore:f,
hierarchyTypes:r,hierarchyTypesForHead:p,tender_setting:h.tender_setting,tender_companies:h.tender_companies,updateUrl:"viewTenderer/billItemRateUpdate",unitOfMeasurements:v,currentGridType:"item",editableCellDblClick:function(n){var x=n.cell.field;n=this.getItem(n.rowIndex);var F=this.store,A=x.split("-");if(n&&void 0!==n.project_revision_deleted_at&&"false"!=String(n.project_revision_deleted_at).toLowerCase()&&0<String(n.project_revision_deleted_at).length)return!1;"historical_rate"==x&&n&&0<parseInt(String(n.id))&&
parseInt(String(n.type))!=buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER&&parseInt(String(n.type))!=buildspace.widget.grid.constants.HIERARCHY_TYPE_HEADER_N&&parseInt(String(n.type))!=buildspace.widget.grid.constants.HIERARCHY_TYPE_NOID&&(new J({targetBillItem:n,tendererGrid:this})).show();3==A.length&&(x=A[0],"rate"==A[1]&&n&&0<parseInt(String(n.id))&&(parseInt(String(n.type))==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_LUMP_SUM_PERCENT?(new H({itemObj:n,companyId:x,rootProject:g.rootProject,
currentBillLockedStatus:!1,billGridStore:F})).show():parseInt(String(n.type))==buildspace.widget.grid.constants.HIERARCHY_TYPE_ITEM_PC_RATE&&(new I({itemObj:n,companyId:x,rootProject:g.rootProject,billGridStore:F,currentBillLockedStatus:!1})).show()))}}})}catch(n){console.debug(n)}},function(v){})},createSupplyOfMaterialElementGrid:function(a,b){this.billId=a.id;var h=dojo.data.ItemFileWriteStore({url:"viewTenderer/getSupplyOfMaterialElementList/id/"+a.id,clearOnClose:!0,urlPreventCache:!0}),f=this;
try{var k=new C({stackContainerTitle:a.title,billId:a.id,rootProject:f.rootProject,pageId:"som_element-page-"+a.id,id:"som_element-page-container-"+a.id,gridOpts:{store:h,tender_setting:b.tender_setting,tender_companies:b.tender_companies,onRowDblClick:function(g){(g=this.getItem(g.rowIndex))&&0<parseInt(String(g.id))&&null!==String(g.description)&&""!==String(g.description)&&f.createSupplyOfMaterialItemGrid(g,b,k,a)}}})}catch(g){console.debug(g)}},createSupplyOfMaterialItemGrid:function(a,b,h,f){this.billId=
f.id;var k=new dojo.data.ItemFileWriteStore({url:"viewTenderer/getSupplyOfMaterialItemList/id/"+a.id,clearOnClose:!0});try{new C({stackContainerTitle:a.description,billId:f.id,disableEditing:this.rootProject.tendering_module_locked[0],rootProject:this.rootProject,id:"som_item-page-container-"+f.id,elementId:a.id,pageId:"som_item-page-"+f.id,type:"tree",gridOpts:{store:k,elementGridStore:h,tender_setting:b.tender_setting,tender_companies:b.tender_companies,updateUrl:"viewTenderer/supplyOfMaterialItemUpdate",
currentGridType:"item"}})}catch(g){console.debug(g)}},createScheduleOfRateBillElementGrid:function(a,b){this.billId=a.id;var h=dojo.data.ItemFileWriteStore({url:"viewTenderer/getScheduleOfRateBillElementList/id/"+a.id,clearOnClose:!0,urlPreventCache:!0}),f=this;try{var k=new D({stackContainerTitle:a.title,billId:a.id,rootProject:f.rootProject,pageId:"sorb_element-page-"+a.id,id:"sorb_element-page-container-"+a.id,gridOpts:{store:h,tender_setting:b.tender_setting,tender_companies:b.tender_companies,
onRowDblClick:function(g){(g=this.getItem(g.rowIndex))&&0<parseInt(String(g.id))&&null!==String(g.description)&&""!==String(g.description)&&f.createScheduleOfRateBillItemGrid(g,b,k,a)}}})}catch(g){console.debug(g)}},createScheduleOfRateBillItemGrid:function(a,b,h,f){this.billId=f.id;var k=new dojo.data.ItemFileWriteStore({url:"viewTenderer/getScheduleOfRateBillItemList/id/"+a.id,clearOnClose:!0});try{new D({stackContainerTitle:a.description,billId:f.id,disableEditing:this.rootProject.tendering_module_locked[0],
rootProject:this.rootProject,id:"sorb_item-page-container-"+f.id,elementId:a.id,pageId:"sorb_item-page-"+f.id,type:"tree",gridOpts:{store:k,elementGridStore:h,tender_setting:b.tender_setting,tender_companies:b.tender_companies,updateUrl:"viewTenderer/scheduleOfRateBillItemUpdate",currentGridType:"item"}})}catch(g){console.debug(g)}}})});
