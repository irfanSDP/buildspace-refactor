// Generated by CoffeeScript 1.9.0
(function() {
  define("buildspace/apps/CompanyDirectories/grid", ["dojo/_base/declare", "dojo/_base/lang", "dojo/_base/array", "dojo/dom-attr", "dojox/grid/enhanced/plugins/Menu", "dojox/grid/enhanced/plugins/Selector", "dojo/_base/event", "dojo/keys", "dijit/focus", "dojo/_base/html", "dojo/request/xhr", "dijit/PopupMenuItem", 'dojo/request', "buildspace/widget/grid/cells/Textarea", 'buildspace/widget/grid/cells/Formatter', './CompanyDirectoriesDialog', 'dojo/i18n!../../nls/CompanyDirectories'], function(declare, lang, array, domAttr, Menu, Selector, evt, keys, focusUtil, html, xhr, PopupMenuItem, request, Textarea, Formatter, CompanyDirectoriesDialog, nls) {
    return declare("buildspace.apps.CompanyDirectories.Grid", dojox.grid.EnhancedGrid, {
      style: "border-top:none;",
      keepSelection: true,
      rowSelector: "0px",
      region: 'center',
      companyDirectoriesGridContainer: null,
      canSort: function(inSortInfo) {
        return false;
      },
      noDataMessage: nls.noCompanyAvailableInGrid,
      postCreate: function() {
        this.inherited(arguments);
        this.on('RowClick', function(e) {
          var item;
          item = this.getItem(e.rowIndex);
          if (item && item.id[0] > 0) {
            return this.disableToolbarButtons(false);
          } else {
            return this.disableToolbarButtons(true);
          }
        });
        return this.on('RowContextMenu', function(e) {
          var item, self;
          self = this;
          self.selection.clear();
          item = self.getItem(e.rowIndex);
          self.selection.setSelected(e.rowIndex, true);
          self.contextMenu(e);
          if (item && item.id[0] > 0) {
            return this.disableToolbarButtons(false);
          } else {
            return this.disableToolbarButtons(true);
          }
        });
      },
      onRowDblClick: function(e) {
        var item;
        item = this.getItem(e.rowIndex);
        if (item.id[0] > 0) {
          return this.editExistingCompany(this.getItem(e.rowIndex));
        }
      },
      editExistingCompany: function(company) {
        var pb, self;
        self = this;
        pb = new buildspace.dialog.indeterminateProgressBar({
          title: nls.processing + "..."
        });
        pb.show();
        return request.get('companyDirectories/getCompanyInformation', {
          query: {
            companyId: company.id[0]
          },
          handleAs: 'json'
        }).then(function(response) {
          var dialog;
          pb.hide();
          dialog = new CompanyDirectoriesDialog({
            title: nls.edit + " (" + company.company_name + ")",
            companyId: company.id[0],
            data: response,
            companyDirectoriesGrid: self
          });
          return dialog.show();
        }, function(error) {
          return pb.hide();
        });
      },
      refreshGrid: function() {
        this.store.save();
        this.store.close();
        return this.setStore(this.store);
      },
      contextMenu: function(e) {
        var info, item, rowCtxMenu;
        rowCtxMenu = this.rowCtxMenu = new dijit.Menu();
        this.contextMenuItems(e);
        info = {
          target: e.target
        };
        item = this.getItem(e.rowIndex);
        if (rowCtxMenu && item && (this.selection.isSelected(e.rowIndex) || e.rowNode && html.hasClass(e.rowNode, "dojoxGridRowbar"))) {
          rowCtxMenu._openMyself(info);
          evt.stop(e);
        }
      },
      contextMenuItems: function(e) {
        var item, self;
        self = this;
        item = this.getItem(e.rowIndex);
        if (item.id > 0) {
          return self.rowCtxMenu.addChild(new dijit.MenuItem({
            label: nls.edit,
            iconClass: "icon-16-container icon-16-edit",
            onClick: function() {
              return self.editExistingCompany(item);
            }
          }));
        }
      },
      disableToolbarButtons: function(isDisable, buttonsToEnable) {
        return;
      }
    });
  });

}).call(this);
