// Generated by CoffeeScript 1.9.0
(function() {
  define(["dojo/_base/declare", 'dojo/data/ItemFileWriteStore', 'dojo/request', 'dijit/layout/TabContainer', 'dijit/layout/ContentPane', 'dijit/layout/BorderContainer', 'dijit/layout/StackController', 'dijit/layout/StackContainer', 'dijit/form/Button', './grid', './WorkArea', 'buildspace/widget/grid/cells/Formatter', 'dojo/i18n!../../nls/StockOut', 'buildspace/widget/grid/Filter'], function(declare, ItemFileWriteStore, request, TabContainer, ContentPane, BorderContainer, StackController, StackContainer, Button, StockOutProjectGrid, WorkArea, Formatter, nls, FilterToolbar) {
    return declare("buildspace.apps.StockOutReport", buildspace.apps._App, {
      init: function(args) {
        var grid, mainContainer, self, store;
        self = this;
        self.win = new buildspace.widget.Window({
          title: nls.appName,
          height: "300px",
          width: "450px",
          showMaximize: false,
          iconClass: this.iconClass,
          onClose: dojo.hitch(this, "kill")
        });
        store = new dojo.data.ItemFileWriteStore({
          url: 'stockOut/getProjectListingWithStockIns',
          clearOnClose: true,
          urlPreventCache: true
        });
        grid = new StockOutProjectGrid({
          structure: self.getGridLayout(),
          store: store,
          onRowDblClick: function(e) {
            var builder, project;
            project = this.getItem(e.rowIndex);
            if (!(project.id[0] > 0)) {
              return false;
            }
            self.kill();
            self.win = new buildspace.widget.Window({
              title: buildspace.truncateString(nls.appName + " (" + project.title[0] + ")", 150),
              onClose: dojo.hitch(self, "kill")
            });
            builder = new WorkArea({
              project: project
            });
            self.win.addChild(builder);
            self.win.show();
            return self.win.startup();
          }
        });
        mainContainer = this.mainContainer = new BorderContainer({
          style: "padding:0px;width:100%;height:100%;",
          gutters: false
        });
        mainContainer.addChild(new FilterToolbar({
          region: 'top',
          grid: grid,
          editableGrid: false,
          filterFields: new Array('title', 'country', 'state', 'created_by')
        }));
        mainContainer.addChild(new dijit.layout.ContentPane({
          style: 'width:100%',
          content: grid,
          region: 'center'
        }));
        self.win.addChild(mainContainer);
        self.win.show();
        return self.win.startup();
      },
      getGridLayout: function() {
        var formatter;
        formatter = new Formatter;
        return [
          {
            name: '&nbsp;',
            field: 'id',
            width: '30px',
            styles: 'text-align:center;',
            formatter: formatter.rowCountCellFormatter,
            filterable: false
          }, {
            name: nls.title,
            field: 'title',
            width: 'auto',
            cellType: 'buildspace.widget.grid.cells.Textarea',
            autoComplete: true
          }, {
            name: nls.country,
            field: 'country',
            width: '120px',
            styles: 'text-align: center;',
            autoComplete: true
          }, {
            name: nls.state,
            field: 'state',
            width: '120px',
            styles: 'text-align: center;',
            autoComplete: true
          }, {
            name: nls.created_by,
            field: 'created_by',
            styles: 'text-align: center;',
            width: '140px'
          }, {
            name: nls.created_at,
            field: 'created_at',
            width: '120px',
            styles: 'text-align: center;',
            filterable: false
          }
        ];
      },
      kill: function() {
        if (typeof self.win !== "undefined") {
          return self.win.destroyRecursive();
        }
      }
    });
  });

}).call(this);
