<?php

/**
 * PostContractSubPackageRemeasurementClaimTable
 *
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class PostContractSubPackageRemeasurementClaimTable extends Doctrine_Table
{
	/**
	 * Returns an instance of this class.
	 *
	 * @return object PostContractSubPackageRemeasurementClaimTable
	 */
	public static function getInstance()
	{
		return Doctrine_Core::getTable('PostContractSubPackageRemeasurementClaim');
	}

	public static function updateBuildUpQty(PostContractSubPackageRemeasurementBuildUpQuantitySummary $summary, Doctrine_Connection $conn = null)
	{
		$findFields           = 'sub_package_post_contract_bill_item_rate_idAndbill_column_setting_id';
		$findValues           = array($summary->sub_package_post_contract_bill_item_rate_id, $summary->bill_column_setting_id);
		$pcRemeasurementClaim = self::getInstance()->findOneBy($findFields, $findValues);
		$pcRemeasurementClaim = $pcRemeasurementClaim ?: new PostContractSubPackageRemeasurementClaim();

		if ( $pcRemeasurementClaim->isNew() )
		{
			$pcRemeasurementClaim->sub_package_post_contract_bill_item_rate_id = $summary->sub_package_post_contract_bill_item_rate_id;
			$pcRemeasurementClaim->bill_column_setting_id                      = $summary->bill_column_setting_id;
		}

		$postContractItemRate = Doctrine_Core::getTable('SubPackagePostContractBillItemRate')->find($summary->sub_package_post_contract_bill_item_rate_id);
		$totalPerUnit         = $summary->final_quantity * $postContractItemRate->rate;

		$pcRemeasurementClaim->qty_per_unit   = $summary->final_quantity;
		$pcRemeasurementClaim->total_per_unit = $totalPerUnit;
		$pcRemeasurementClaim->has_build_up   = true;
		$pcRemeasurementClaim->parentSave($conn);
	}
}