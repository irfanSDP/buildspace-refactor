<?php

/**
 * PublishToPostContractOptionTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class PublishToPostContractOptionTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object PublishToPostContractOptionTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('PublishToPostContractOption');
    }

    public static function findByProjectId(int $projectId)
    {
        $object = DoctrineQuery::create()->select('o.*')
            ->from('PublishToPostContractOption o')
            ->where('o.project_structure_id = ?', $projectId)
            ->fetchOne();

        return $object;
    }

    public static function findOrCreate(int $projectId, bool $withNotListedItem, int $rateType, bool $assignUsersManually)
    {
        $pdo = self::getInstance()->getConnection()->getDbh();

        if($object = static::findByProjectId($projectId))
        {
            $object->with_not_listed_item = $withNotListedItem;
            $object->rate_type            = $rateType;
            $object->save();

            return $object;
        }

        $withNotListedItem   = $withNotListedItem ? 'true' : 'false';
        $assignUsersManually = $assignUsersManually ? 'true' : 'false';

        $stmt = $pdo->prepare('INSERT INTO '.self::getInstance()->getTableName().' (project_structure_id, with_not_listed_item, rate_type, assign_users_manually) VALUES ('.$projectId.', '.$withNotListedItem.', '. $rateType.', '.$assignUsersManually.') RETURNING id');

        $stmt->execute();

        return static::findByProjectId($projectId);
    }
}