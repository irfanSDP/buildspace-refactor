<?php

/**
 * PostContractClaimTopManagementVerifier
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 *  
 * @package    buildspace
 * @subpackage model
 * @author     1337 developers
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class PostContractClaimTopManagementVerifier extends BasePostContractClaimTopManagementVerifier
{
    public static function getAllRecords($object)
    {
        $records = DoctrineQuery::create()
                    ->select('v.id, v.object_id, v.object_type, v.sequence, v.user_id')
                    ->from('PostContractClaimTopManagementVerifier v')
                    ->where('v.object_id = ?', $object->id)
                    ->andWhere('v.object_type = ?', get_class($object))
                    ->orderBy('v.sequence ASC')
                    ->execute();

        return $records;
    }

    public static function findRecord(sfGuardUser $bsUser, $object, $isNew = true)
    {
        $record = DoctrineQuery::create()
                 ->select('v.id, v.object_id, v.object_type, v.sequence, v.user_id')
                 ->from('PostContractClaimTopManagementVerifier v')
                 ->where('v.user_id = ?', $bsUser->id)
                 ->andWhere('v.object_id = ?', $object->id)
                 ->andWhere('v.object_type = ?', get_class($object))
                 ->fetchOne();

        return $record;
    }

    public static function uniquenessCheckForExistingRecord(sfGuardUser $bsUser, $object, self $record)
    {
        $records = DoctrineQuery::create()
                 ->select('v.id, v.object_id, v.object_type, v.sequence, v.user_id')
                 ->from('PostContractClaimTopManagementVerifier v')
                 ->where('v.user_id = ?', $bsUser->id)
                 ->andWhere('v.object_id = ?', $object->id)
                 ->andWhere('v.object_type = ?', get_class($object))
                 ->andWhere('v.id != ?', $record->id)
                 ->setHydrationMode(Doctrine_Core::HYDRATE_ARRAY)
                 ->execute();

        return (count($records) > 0) ? false : true;
    }

    public static function getNextFreeSequenceNumber($object)
    {
        $record = DoctrineQuery::create()
                    ->select('v.id, v.sequence')
                    ->from('PostContractClaimTopManagementVerifier v')
                    ->where('v.object_id = ?', $object->id)
                    ->andWhere('v.object_type = ?', get_class($object))
                    ->addOrderBy('v.sequence DESC')
                    ->fetchOne();

        return $record ? ($record->sequence + 1) : 0;
    }
}
