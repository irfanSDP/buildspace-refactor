<?php

/**
 * LetterOfAwardRetentionSumModulesTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class LetterOfAwardRetentionSumModulesTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return LetterOfAwardRetentionSumModulesTable The table instance
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('LetterOfAwardRetentionSumModules');
    }

    public static function sync($letterOfAwardId, array $includedTypes)
    {
        $pdo = self::getInstance()->getConnection()->getDbh();

        $tableName = self::getInstance()->getTableName();

        $stmt = $pdo->prepare("DELETE FROM {$tableName} WHERE new_post_contract_form_information_id = {$letterOfAwardId};");

        $stmt->execute();

        foreach($includedTypes as $type)
        {
            $record = new LetterOfAwardRetentionSumModules();
            $record->new_post_contract_form_information_id = $letterOfAwardId;
            $record->type = $type;
            $record->save();
        }
    }

    public static function isIncluded($letterOfAwardId, $type)
    {
        $pdo = self::getInstance()->getConnection()->getDbh();

        $tableName = self::getInstance()->getTableName();

        $stmt = $pdo->prepare("SELECT t.id
        FROM {$tableName} t
        WHERE t.new_post_contract_form_information_id = {$letterOfAwardId} AND type = {$type};");

        $stmt->execute();

        $record = $stmt->fetch(PDO::FETCH_ASSOC);

        return $record ? true : false;
    }
}