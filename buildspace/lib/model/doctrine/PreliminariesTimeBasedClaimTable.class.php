<?php

/**
 * PreliminariesTimeBasedClaimTable
 *
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class PreliminariesTimeBasedClaimTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object PreliminariesTimeBasedClaimTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('PreliminariesTimeBasedClaim');
    }

    public static function getRecordsByLastRevision(Array $lastLatestRevision)
    {
        $query = DoctrineQuery::create()
        ->from('PreliminariesTimeBasedClaim br')
        ->where('br.revision_id = ?', $lastLatestRevision['id'])
        ->setHydrationMode(Doctrine_Core::HYDRATE_ARRAY);

        return $query->execute();
    }

    public static function insertRecordsByNewRevision(PostContractClaimRevision $revision, Array $data)
    {
        if ( count($data) > 0 )
        {
            $pdo = self::getInstance()->getConnection()->getDbh();
            $sql = 'INSERT INTO '.PreliminariesTimeBasedClaimTable::getInstance()->getTableName().' (post_contract_bill_item_rate_id, up_to_date_duration, total_project_duration, total, revision_id, created_at, updated_at) VALUES ';

            foreach ( $data as $claim )
            {
                $sql_arr[] = '(' . $claim['post_contract_bill_item_rate_id'] . ", " . $claim['up_to_date_duration'] . ", " . $claim['total_project_duration'] . ", " . $claim['total'] . ", " . $revision->id . ", NOW(), NOW())";
            }

            $sql .= implode(", ", $sql_arr);

            $statement = $pdo->prepare($sql);
            $result    = $statement->execute();
        }

    }
}