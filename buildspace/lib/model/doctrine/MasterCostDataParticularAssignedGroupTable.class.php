<?php

/**
 * MasterCostDataParticularAssignedGroupTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class MasterCostDataParticularAssignedGroupTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return MasterCostDataParticularAssignedGroupTable The table instance
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('MasterCostDataParticularAssignedGroup');
    }

    public static function getParticularsByGroup(MasterCostData $masterCostData)
    {
        $pdo = MasterCostDataParticularAssignedGroupTable::getInstance()->getConnection()->getDbh();

        $statement = "SELECT g.group_name, p.id FROM " . MasterCostDataParticularAssignedGroupTable::getInstance()->getTableName() . " g
        JOIN " . MasterCostDataParticularTable::getInstance()->getTableName() . " p on p.id = g.master_cost_data_particular_id
        WHERE p.master_cost_data_id = {$masterCostData->id}";

        $stmt = $pdo->prepare($statement);

        $stmt->execute();

        $records =  $stmt->fetchAll(PDO::FETCH_ASSOC|PDO::FETCH_GROUP);

        $particulars = array();

        foreach($records as $groupName => $record)
        {
            $particulars[$groupName] = array_column($record, 'id');
        }

        $groupNames = array(
            MasterCostDataParticularAssignedGroup::GROUP_TYPE_TOTAL_UNITS,
            MasterCostDataParticularAssignedGroup::GROUP_TYPE_NETT_FLOOR_AREA,
            MasterCostDataParticularAssignedGroup::GROUP_TYPE_GROSS_FLOOR_AREA,
        );

        foreach($groupNames as $groupName)
        {
            if(!array_key_exists($groupName, $particulars)) $particulars[$groupName] = array();
        }

        return $particulars;
    }
}