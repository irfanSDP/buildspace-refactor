<?php

/**
 * MasterCostDataItemTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class MasterCostDataItemTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return MasterCostDataItemTable The table instance
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('MasterCostDataItem');
    }

    public static function getChildrenIds(array $itemIds)
    {
        if(empty($itemIds)) return array();

        $pdo = self::getInstance()->getConnection()->getDbh();

        $parentIds = implode(',', $itemIds);

        $statement = "SELECT p.id FROM ".MasterCostDataItemTable::getInstance()->getTableName()." p
        WHERE p.parent_id in ({$parentIds})
        AND p.deleted_at IS NULL";

        $stmt = $pdo->prepare($statement);

        $stmt->execute();

        return $stmt->fetchAll(PDO::FETCH_COLUMN,0);
    }

    public static function getDescendantIds(array $itemIds)
    {
        $descendantIds = self::getChildrenIds($itemIds);

        if( count($descendantIds) > 0 )
        {
            $nextLevelDescendantIds = self::getDescendantIds($descendantIds);

            $descendantIds = array_unique(array_merge($descendantIds, $nextLevelDescendantIds));
        }

        return $descendantIds;
    }
}