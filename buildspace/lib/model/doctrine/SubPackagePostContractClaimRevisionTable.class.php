<?php

/**
 * SubPackagePostContractClaimRevisionTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class SubPackagePostContractClaimRevisionTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object SubPackagePostContractClaimRevisionTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('SubPackagePostContractClaimRevision');
    }

    public static function getCurrentProjectRevision(SubPackage $subPackage, $hydrate=true)
    {
        $query = DoctrineQuery::create()->select('r.sub_package_id, r.locked_status, r.version')
        ->from('SubPackagePostContractClaimRevision r')
        ->where('r.sub_package_id = ?', $subPackage->id)
        ->addOrderBy('r.id DESC')
        ->limit(1);

        if($hydrate)
        {
            $query->setHydrationMode(Doctrine_Core::HYDRATE_ARRAY);
        }

        return $query->fetchOne();
    }

    public static function getCurrentSelectedProjectRevision(SubPackage $subPackage, $hydrate=true)
    {
        $query = DoctrineQuery::create()->select('r.sub_package_id, r.locked_status, r.version')
        ->from('SubPackagePostContractClaimRevision r')
        ->where('r.sub_package_id = ?', $subPackage->id)
        ->andWhere('r.current_selected_revision = ?', true)
        ->addOrderBy('r.id DESC')
        ->limit(1);

        if($hydrate)
        {
            $query->setHydrationMode(Doctrine_Core::HYDRATE_ARRAY);
        }

        return $query->fetchOne();
    }

    public static function getPreviousProjectRevision(SubPackage $subPackage, $version, $hydrate=true)
    {
        $query = DoctrineQuery::create()->select('r.sub_package_id, r.locked_status, r.version')
        ->from('SubPackagePostContractClaimRevision r')
        ->where('r.sub_package_id = ?', $subPackage->id)
        ->andWhere('r.version < ?', $version)
        ->addOrderBy('r.id DESC')
        ->limit(1);

        if($hydrate)
        {
            $query->setHydrationMode(Doctrine_Core::HYDRATE_ARRAY);
        }

        return $query->fetchOne();
    }
}