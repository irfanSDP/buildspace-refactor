# --- HTTP -> HTTPS redirect ---
server {
  listen 80;
  server_name bq.buildspace.local;
  return 301 https://$host$request_uri;
}

# --- HTTPS site ---
server {
  listen 443 ssl http2;
  server_name bq.buildspace.local;

  root  "C:/laragon/www/buildspace/web";
  index index.php index.html;

  # SSL (Laragon default certs)
  # ssl_certificate     "C:/laragon/etc/ssl/laragon.crt";
  # ssl_certificate_key "C:/laragon/etc/ssl/laragon.key";
  ssl_certificate     "C:/laragon/certs/bq.buildspace.local.pem";
  ssl_certificate_key "C:/laragon/certs/bq.buildspace.local-key.pem";


  # Symfony 1 front controller
  location / {
    # serve static if it exists, otherwise send to index.php
    try_files $uri $uri/ /index.php?$is_args$args;
  }

  # PHP handler
  location ~ \.php$ {
    try_files $uri =404;
    include       fastcgi_params;                      # or snippets/fastcgi-php.conf if you prefer
    fastcgi_pass  php_upstream;                        # Laragon's PHP upstream
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    fastcgi_param HTTPS on;
    fastcgi_intercept_errors off;
    # fastcgi_param PHP_VALUE "display_errors=1";
    # Optional: bump limits if you do big uploads
    # fastcgi_read_timeout 120s;
  }

  # Static assets caching
  location ~* \.(?:css|js|png|jpg|jpeg|gif|svg|ico|woff2?|ttf|eot)$ {
    access_log off;
    add_header Cache-Control "public";
    expires 30d;
    try_files $uri =404;
  }

  # harden a bit
  location = /favicon.ico  { access_log off; log_not_found off; }
  location = /robots.txt   { access_log off; log_not_found off; }
  location ~ /\.ht         { deny all; }

  # Optional: increase body size if needed
  # client_max_body_size 50m;

  autoindex off;
}
